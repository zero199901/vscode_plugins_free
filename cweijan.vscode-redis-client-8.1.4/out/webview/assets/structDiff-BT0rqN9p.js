import{a as j,r as x,G as f,e as A,N as G,v as b,as as J,s as E,f as p,g as u,j as a,J as n,k as K,K as O,o as s,F as v,B as _,I as y,L,t as T}from"./app-quOHq0P1.js";import{a as P,E as z}from"./index-DGIErjzx.js";import{a as W,E as X}from"./index-GYzELZbe.js";import{E as Y,a as Z}from"./index-CCmGJ65B.js";import"./castArray-Rh-FLT90.js";import"./clone-D9JrRJfK.js";import"./_baseClone-DY4tO53J.js";import"./isEqual-DTuzvI-Z.js";import"./_initCloneObject-h1GxFYH3.js";import"./index-NkzjzO9b.js";import"./_baseIteratee-BzHBCr60.js";import"./merge-BVWjjS0z.js";import"./isArrayLikeObject-CBzOw1k1.js";import"./index-BsvDUm3z.js";import"./index-qYnzY8wE.js";import"./index-CyojRPuO.js";import"./_baseFindIndex-D7XfJLKM.js";const $={class:"opt-panel"},ee=["src"],le={class:"opt-panel"},te=["src"],oe={key:0,class:"bg-secondBg pl-5 pt-3"},ae={class:"mb-3"},xe=j({__name:"structDiff",setup(ne){const D=x([{value:"MySQL",icon:"resources/icon/server/mysql_dark.svg"},{value:"MariaDB",icon:"resources/icon/server/mariadb.svg"},{value:"PostgreSQL",icon:"resources/icon/server/pgsql.svg"}]),C=x(null),h=x([]),r=f({dbLoading:!1,dbList:[]}),d=f({dbLoading:!1,dbList:[]}),o=f({from:{connection:null,database:null,db:null},to:{connection:null,database:null,db:null}}),c=f({compare:!1,sync:!1}),V=f({sqlList:null}),N=A(()=>window.outerHeight-340);G(()=>{b.on("nodes",l=>{h.value=l}).on("sourceDB",l=>{r.dbList=l,r.dbLoading=!1}).on("targetDB",l=>{d.dbList=l,d.dbLoading=!1}).on("compareResult",l=>{l.sqlList=l,c.compare=!1}).on("syncSuccess",()=>{J("syncSuccess"),c.sync=!1}).on("success",()=>{Q()}).on("error",l=>{E(l),c.sync=!1}).init()});const S=l=>{for(const t of D.value)if(t.value==l)return t.icon;return"icon/server/mysql_dark.svg"},F=l=>{b.emit("loadDB",{key:l}),r.dbLoading=!0,r.dbList=[],o.from.db=null,o.from.database=null},U=l=>{b.emit("loadDB",{key:l,isTarget:!0}),d.dbLoading=!0,d.dbList=[],o.to.db=null,o.to.database=null},w=(l,t)=>{const m=t?r.dbList:d.dbList;for(const i of m)i.label==l&&(t?o.from.db=i:o.to.db=i)},I=()=>{c.compare=!0,b.emit("start",o)},M=()=>{const l=C.value.getCheckboxRecords();if(!l||l.length==0){E("Need to select at least one sql!");return}c.sync=!0,b.emit("sync",{sqlList:l,option:o})},H=l=>{console.log("selectionChange",l)},Q=()=>{b.emit("init")};return(l,t)=>{const m=Y,i=Z,g=z,q=P,B=O("vsc-button"),k=X,R=W;return s(),p("div",null,[t[8]||(t[8]=u("div",{style:{margin:"30px 20px"}}," Structure sync is being refactored and is currently unavailable ",-1)),u("div",$,[a(q,null,{default:n(()=>[a(g,{"label-width":"80px",label:"Target"},{default:n(()=>[a(i,{modelValue:o.from.connection,"onUpdate:modelValue":t[0]||(t[0]=e=>o.from.connection=e),filterable:"",onChange:F},{default:n(()=>[(s(!0),p(v,null,_(h.value,e=>(s(),y(m,{key:e.key,label:e.label,value:e.key},{default:n(()=>[u("img",{src:S(e.dbType),class:"inline-block",style:{width:"13px",height:"13px",position:"relative",left:"-2px",top:"-1px"}},null,8,ee),L(" "+T(e.label),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(g,{"label-width":"80px",label:"database"},{default:n(()=>[a(i,{modelValue:o.from.database,"onUpdate:modelValue":t[1]||(t[1]=e=>o.from.database=e),loading:r.dbLoading,filterable:"",onChange:t[2]||(t[2]=e=>w(e,!0))},{default:n(()=>[(s(!0),p(v,null,_(r.dbList,e=>(s(),y(m,{key:e.label,label:e.label,value:e.label},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})]),_:1})]),u("div",le,[a(q,null,{default:n(()=>[a(g,{"label-width":"90px",label:"Sync From"},{default:n(()=>[a(i,{modelValue:o.to.connection,"onUpdate:modelValue":t[3]||(t[3]=e=>o.to.connection=e),filterable:"",onChange:U},{default:n(()=>[(s(!0),p(v,null,_(h.value,e=>(s(),y(m,{key:e.key,label:e.label,value:e.key},{default:n(()=>[u("img",{src:S(e.dbType),class:"inline-block",style:{width:"13px",height:"13px",position:"relative",left:"-2px",top:"-1px"}},null,8,te),L(" "+T(e.label),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(g,{"label-width":"90px",label:"database"},{default:n(()=>[a(i,{modelValue:o.to.database,"onUpdate:modelValue":t[4]||(t[4]=e=>o.to.database=e),loading:d.dbLoading,filterable:"",onChange:t[5]||(t[5]=e=>w(e,!1))},{default:n(()=>[(s(!0),p(v,null,_(d.dbList,e=>(s(),y(m,{key:e.label,label:e.label,value:e.label},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})]),_:1})]),a(B,{style:{"margin-left":"250px"},class:"m-2",loading:c.compare,title:"Start Compare",onClick:I},{default:n(()=>t[6]||(t[6]=[L(" Compare ")])),_:1},8,["loading"]),u("div",null,[V.sqlList?(s(),p("div",oe,[u("div",ae,[a(B,{loading:c.sync,title:"Confrim Sync",onClick:M},{default:n(()=>t[7]||(t[7]=[L(" Sync ")])),_:1},8,["loading"])]),a(R,{ref_key:"dataTable",ref:C,data:V.sqlList,height:N.value,style:{width:"100%"},onSelectionChange:H},{default:n(()=>[a(k,{type:"checkbox",width:"40",fixed:"left"}),a(k,{align:"center",width:"60",field:"type",label:"type"}),a(k,{align:"center",field:"sql",label:"sql"})]),_:1},8,["data","height"])])):K("",!0)])])}}});export{xe as default};
