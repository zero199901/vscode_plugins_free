import{q as de,s as Y,v as f,a as K,r as S,D as H,K as R,o as c,f as I,g as N,j as o,J as d,I as b,h as n,t as L,S as G,$ as T,w as Q,O as W,C as X,e as M,k as _,L as F,as as ee,ao as ce,F as Z,B as me,a7 as te,a9 as le,Q as pe,be as ye}from"./app-quOHq0P1.js";import{R as ve}from"./constants-DgoLmzql.js";import{d as j}from"./objectUtil-Z6JRxuBJ.js";import{E as fe,u as ge}from"./dialogStore-CHgdEAfR.js";import{c as _e,s as ke,p as be,l as he}from"./common_view_utils-C42y7P-9.js";import{E as ne,a as ae}from"./index-CCmGJ65B.js";import{E as xe,a as oe}from"./index-DGIErjzx.js";import{E as we}from"./index-fTWddJ3y.js";import{E as Se,a as Ve}from"./index-GYzELZbe.js";import{s as Ce,c as Ee}from"./codemirror-B3TnJZ8m.js";import"./isEqual-DTuzvI-Z.js";import"./index-NkzjzO9b.js";import"./index-qYnzY8wE.js";import"./index-CyojRPuO.js";import"./_baseFindIndex-D7XfJLKM.js";import"./_baseIteratee-BzHBCr60.js";import"./castArray-Rh-FLT90.js";import"./clone-D9JrRJfK.js";import"./_baseClone-DY4tO53J.js";import"./_initCloneObject-h1GxFYH3.js";import"./merge-BVWjjS0z.js";import"./isArrayLikeObject-CBzOw1k1.js";import"./index-BsvDUm3z.js";import"./DatabaseType-C0wmHgR0.js";const O=de("redis",{state:()=>({remainHeight:0,edit:{name:"",ttl:-1,content:null},key:{name:"",ttl:-1,content:null,count:null,type:null},itemModel:{old:null,key:null,index:null,score:null,value:null}}),actions:{saveListItem(s){if(s!=null&&(this.itemModel.value=s),!this.edit.name)return Y("Key name cannot be null!");f.emit("saveItem",{...this.itemModel,keyName:this.edit.name,type:this.key.type})}}}),ze={id:"panel",class:"flex pt-2 pb-4 justify-between pr-4 flex-wrap gap-3"},Ie={key:1,class:"key-label key-detail-type"},Ne=K({__name:"RedisKeyInfo",setup(s){const t=S(!1),e=O(),{key:a,edit:p}=H(e),g=()=>{Q(T("confirm.deleteRedisKey")).then(()=>{f.emit("del",{key:{name:e.key.name}}),e.key={},e.edit={}})},V=()=>{f.emit("rename",{key:{name:e.key.name,newName:e.edit.name}})},k=()=>{f.emit("ttl",{key:{name:e.key.name,ttl:e.edit.ttl}})};return f.on("new",()=>{t.value=!0}),f.on("detail",()=>{t.value=!1}),setInterval(()=>{document.activeElement.tagName!=="INPUT"&&p.value.ttl>0&&(p.value.ttl-=1)},1e3),(E,y)=>{const v=ne,u=ae,m=W,h=R("vsc-button"),B=R("vsc-tooltip");return c(),I("div",ze,[N("div",null,[o(m,{ref:"keyNameInput",modelValue:n(p).name,"onUpdate:modelValue":y[1]||(y[1]=x=>n(p).name=x),size:"small",placeholder:"Please input key name",style:{width:"500px"},onKeyup:G(V,["enter"])},{prepend:d(()=>[t.value?(c(),b(u,{key:0,modelValue:n(a).type,"onUpdate:modelValue":y[0]||(y[0]=x=>n(a).type=x),placeholder:"Forever",size:"small",style:{width:"100px"}},{default:d(()=>[o(v,{value:"string",label:"STRING"}),o(v,{value:"list",label:"LIST"}),o(v,{value:"set",label:"SET"}),o(v,{value:"zset",label:"ZSET"}),o(v,{value:"hash",label:"HASH"}),o(v,{value:"stream",label:"STREAM"})]),_:1},8,["modelValue"])):(c(),I("span",Ie,L(n(a).type),1))]),_:1},8,["modelValue"]),o(B,{title:n(T)("result.copy"),placement:"top"},{default:d(()=>[o(h,{class:"ml-1",size:"mini",icon:"el-icon-document-copy",onClick:y[2]||(y[2]=x=>n(_e)(n(p).name))})]),_:1},8,["title"])]),N("div",null,[o(m,{modelValue:n(p).ttl,"onUpdate:modelValue":y[3]||(y[3]=x=>n(p).ttl=x),size:"small",class:"mr-1",style:{width:"220px"},onKeyup:G(k,["enter"])},{prepend:d(()=>y[4]||(y[4]=[N("span",{class:"key-label"},"TTL",-1)])),_:1},8,["modelValue"]),o(h,{icon:"codicon codicon-save",size:"mini",onClick:k}),o(h,{icon:"el-icon-delete",size:"mini",type:"secondary",onClick:g})])])}}}),Te=X(Ne,[["__scopeId","data-v-d56b00aa"]]),$e={key:0},Re={id:"listPanel"},Be=["title","textContent"],Ue=K({__name:"RedisListView",setup(s){const t=O(),{key:e,itemModel:a,remainHeight:p}=H(t),g=S(""),V=S(""),k=S(1),E=S(100),y=S(0),v=S(!1);f.on("detail",r=>{v.value=!1,k.value=r.page.pageNum,E.value=r.page.pageSize}).on("pagination",r=>{t.key.content=r}).on("success",()=>{v.value=!1});const u=M(()=>{const r=t.itemModel.old;let l=e.value.type;return l=l.charAt(0).toUpperCase()+l.slice(1),`${r?"Edit":"Add to"} ${l}`}),m=M(()=>{const r=e.value.type;switch(r){case"list":return"Element";case"hash":return"Value";case"set":case"zset":return"Member";case"stream":return"Entry";default:return r.charAt(0).toUpperCase()+r.slice(1)}}),h=(r,l)=>{f.emit("changePage",l?r:k.value+r)},B=()=>{v.value=!0,t.itemModel={old:null,key:null,index:null,score:null,value:null}},x=M(()=>{e.value.content||(e.value.content=[]);const r=g.value,l=V.value,z=e.value.content.filter(w=>!(r&&e.value.type=="hash"&&!`${w.key}`.match(new RegExp(r,"i"))||l&&!`${w.value??w}`.match(new RegExp(l,"i"))));return y.value=e.value.count??z.length,z}),P=r=>{Q(T("confirm.deleteRedisKey")).then(()=>{f.emit("deleteLine",r)})},A=r=>{navigator.clipboard.writeText(r.value??r),ee(T("common.copied"))},C=r=>{t.itemModel={...r,old:{...r}},v.value=!0};return(r,l)=>{const z=W,w=R("vsc-button"),J=R("vsc-tooltip"),ie=fe,D=xe,se=oe,re=we,$=Se,ue=Ve;return["list","hash","set","zset","stream"].includes(n(e).type)?(c(),I("div",$e,[N("div",Re,[n(e).type=="hash"?(c(),b(z,{key:0,modelValue:g.value,"onUpdate:modelValue":l[0]||(l[0]=i=>g.value=i),class:"filter-input mb-2 mr-2",size:"small",style:{width:"120px"},placeholder:n(T)("result.searchField"),clearable:!0},null,8,["modelValue","placeholder"])):_("",!0),o(z,{modelValue:V.value,"onUpdate:modelValue":l[1]||(l[1]=i=>V.value=i),class:"filter-input mb-2",size:"small",style:{width:"200px"},placeholder:n(T)("result.searchNotice"),clearable:!0},null,8,["modelValue","placeholder"]),o(J,{title:n(T)("common.refresh"),placement:"top"},{default:d(()=>[o(w,{type:"icon",icon:"codicon-refresh text-lg",class:"ml-2",onClick:l[2]||(l[2]=i=>{n(f).emit("refresh")})})]),_:1},8,["title"]),o(J,{title:"Add new key"},{default:d(()=>[n(e).type!="stream"?(c(),b(w,{key:0,type:"icon",icon:"codicon-add text-lg",class:"inline-block !ml-1",style:{color:"var(--vscode-terminal-ansiYellow)"},onClick:l[3]||(l[3]=i=>B())})):_("",!0)]),_:1}),o(ie,{"page-size":E.value,"onUpdate:pageSize":l[4]||(l[4]=i=>E.value=i),"current-page":k.value,"onUpdate:currentPage":l[5]||(l[5]=i=>k.value=i),small:!0,total:y.value,"page-sizes":[20,50,100,200,300],layout:"prev,pager, next, total",onCurrentChange:l[6]||(l[6]=i=>h(i,!0)),onNextClick:l[7]||(l[7]=()=>h(1)),onPrevClick:l[8]||(l[8]=()=>h(-1))},null,8,["page-size","current-page","total"]),o(re,{modelValue:v.value,"onUpdate:modelValue":l[15]||(l[15]=i=>v.value=i),"show-close":!1,title:u.value,closeOnClickModal:!1,"close-on-press-escape":!1,width:"30%",class:"new-item-dialog"},{footer:d(()=>[o(w,{type:"secondary",onClick:l[13]||(l[13]=i=>v.value=!1)},{default:d(()=>[F(L(n(T)("common.cancel")),1)]),_:1}),o(w,{type:"primary",onClick:l[14]||(l[14]=i=>n(t).saveListItem())},{default:d(()=>l[16]||(l[16]=[F("Confirm")])),_:1})]),default:d(()=>[o(se,{"label-width":"60px"},{default:d(()=>[n(e).type=="list"?(c(),b(D,{key:0,label:"Index"},{default:d(()=>[o(z,{modelValue:n(a).index,"onUpdate:modelValue":l[9]||(l[9]=i=>n(a).index=i),size:"small",disabled:""},null,8,["modelValue"])]),_:1})):_("",!0),n(e).type=="hash"?(c(),b(D,{key:1,label:"Field"},{default:d(()=>[o(z,{modelValue:n(a).key,"onUpdate:modelValue":l[10]||(l[10]=i=>n(a).key=i),size:"small"},null,8,["modelValue"])]),_:1})):_("",!0),n(e).type=="zset"?(c(),b(D,{key:2,label:"Score"},{default:d(()=>[o(z,{modelValue:n(a).score,"onUpdate:modelValue":l[11]||(l[11]=i=>n(a).score=i),size:"small"},null,8,["modelValue"])]),_:1})):_("",!0),o(D,{label:m.value},{default:d(()=>[o(z,{modelValue:n(a).value,"onUpdate:modelValue":l[12]||(l[12]=i=>n(a).value=i),size:"small"},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1},8,["modelValue","title"])]),N("div",null,[o(ue,{data:x.value,height:n(p),border:""},{default:d(()=>[n(e).type=="list"?(c(),b($,{key:0,label:"Index",prop:"index",sortable:"",width:"90",align:"center"})):_("",!0),n(e).type=="hash"?(c(),b($,{key:1,"sort-by":"key",resizable:"",sortable:"",label:"Field",align:"center",width:"200",prop:"key"})):_("",!0),n(e).type=="zset"?(c(),b($,{key:2,"sort-by":"score",resizable:"",sortable:"",label:"Score",align:"center",width:"200",prop:"score"})):_("",!0),n(e).type=="stream"?(c(),b($,{key:3,"sort-by":"id",resizable:"",sortable:"",label:"id",align:"center",width:"200",prop:"id"})):_("",!0),o($,{"sort-by":"value",resizable:"",sortable:"",label:m.value,align:"center"},{default:d(i=>{var U;return[N("span",{class:"item-value",title:i.row.value,textContent:L(((U=i.row)==null?void 0:U.value)||i.row)},null,8,Be)]}),_:1},8,["label"]),o($,{label:"Operation",width:"150",align:"center"},{default:d(i=>[o(w,{type:"icon",icon:"codicon-copy",title:"View On Dialog",onClick:U=>{A(i.row)}},null,8,["onClick"]),["list","hash","set","zset"].includes(n(e).type)?(c(),b(w,{key:0,type:"icon",icon:"codicon-edit text-base",title:"edit",style:{color:"var(--vscode-terminal-ansiYellow)"},onClick:U=>C(i.row)},null,8,["onClick"])):_("",!0),o(w,{class:"ml-3",type:"icon",icon:"el-icon-delete text-base",style:{color:"#f56c6c"},title:"delete",onClick:U=>P(i.row)},null,8,["onClick"])]),_:1})]),_:1},8,["data","height"])])])):_("",!0)}}}),Me=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],Le=["B","k","M","G","T","P","E","Z","Y"],De=["b","kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],Fe=["b","kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],q=(s,t,e)=>{let a=s;return typeof t=="string"||Array.isArray(t)?a=s.toLocaleString(t,e):(t===!0||e!==void 0)&&(a=s.toLocaleString(void 0,e)),a};function Ke(s,t){if(s==null||!Number.isFinite(s)&&(s=parseInt(s),!Number.isFinite(s)))return"";t={bits:!1,binary:!0,...t};const e=t.bits?t.binary?Fe:De:t.binary?Le:Me;if(t.signed&&s===0)return` 0 ${e[0]}`;const a=s<0,p=a?"-":t.signed?"+":"";a&&(s=-s);let g;if(t.minimumFractionDigits!==void 0&&(g={minimumFractionDigits:t.minimumFractionDigits}),t.maximumFractionDigits!==void 0&&(g={maximumFractionDigits:t.maximumFractionDigits,...g}),s<1){const y=q(s,t.locale,g);return p+y+" "+e[0]}const V=Math.min(Math.floor(t.binary?Math.log(s)/Math.log(1024):Math.log10(s)/3),e.length-1);s/=(t.binary,1024**V),g||(s=s.toPrecision(3));const k=q(Number(s),t.locale,g),E=e[V];return`${p+k}${E}`}const Oe={key:0,id:"stringPanel",class:"flex pr-4 mb-2 gap-x-3 items-center ml-1"},Pe={key:0,class:"flex"},Ae={class:"value-panel"},Je=K({__name:"RedisStringView",setup(s){const t=O(),{key:e}=H(t),a=S(""),p=S("Text"),g=S(Ce),V=M(()=>{var u;return Ke(((u=a.value)==null?void 0:u.length)||0)}),k=M(()=>["string","ReJSON-RL"].includes(t.key.type));window.addEventListener("keydown",u=>{k.value&&ce(u)&&u.code=="KeyS"&&E()});const E=()=>{if(!t.edit.name)return Y("Key name cannot be null!");f.emit("update",{key:{name:t.key.name,newName:t.edit.name,type:t.key.type,ttl:t.edit.ttl,content:a.value}})};f.on("detailNext",()=>{y()});const y=()=>{if(!k.value)return a.value="";const u=t.edit.content,m=(u==null?void 0:u.match(/^\s*[{[]/))!=null;p.value=m?"JSON":"Text",m?v(u):a.value=u},v=u=>{var m;try{a.value=ke(be((m=u==null?void 0:u.replace)==null?void 0:m.call(u,/Â /g," ")),null,2)}catch(h){console.error(h),a.value=u}};return(u,m)=>{const h=ne,B=ae,x=R("vsc-button"),P=R("vsc-tooltip"),A=oe;return c(),I(Z,null,[["string","ReJSON-RL"].includes(n(e).type)?(c(),I("div",Oe,[N("div",null," Size: "+L(V.value),1),["string","ReJSON-RL"].includes(n(e).type)?(c(),I("div",Pe,[o(B,{modelValue:p.value,"onUpdate:modelValue":m[0]||(m[0]=C=>p.value=C),placeholder:"Default",size:"small",style:{width:"145px"},class:"mr-2"},{default:d(()=>[(c(!0),I(Z,null,me(g.value,C=>(c(),b(h,{key:C,value:C},{default:d(()=>[F(L(C),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),o(P,{title:u.$t("common.refresh"),placement:"top"},{default:d(()=>[o(x,{type:"secondary",size:"micro",icon:"codicon-refresh",onClick:m[1]||(m[1]=C=>{n(f).emit("refresh")})})]),_:1},8,["title"]),o(x,{icon:"codicon codicon-save",style:{height:"27px"},onClick:E},{default:d(()=>m[3]||(m[3]=[F("Save")])),_:1})])):_("",!0)])):_("",!0),te(o(A,null,{default:d(()=>[N("div",Ae,[o(Ee,{ref:"cmEditor",value:a.value,"onUpdate:value":m[2]||(m[2]=C=>a.value=C),language:p.value,class:"json-panel",style:pe("height:"+n(t).remainHeight+"px")},null,8,["value","language","style"])])]),_:1},512),[[le,["string","ReJSON-RL"].includes(n(e).type)]])],64)}}}),Ye=X(Je,[["__scopeId","data-v-1ea839f2"]]),He={class:"redis-view-container"},Ge={key:0,style:{"text-align":"center"}},Ze={class:"mx-2"},kt=K({__name:"RedisView",setup(s){const t=S(!0),e=O();return ge(),ye(()=>{he(100,[],a=>{e.remainHeight=a}),f.on("new",({prefix:a})=>{t.value=!1,e.key={name:a,type:ve.STRING,ttl:-1},e.edit=j(e.key)}).on("detail",a=>{t.value=!1,e.key=a.res,e.edit=j(a.res),f.emitImmediately("detailNext")}).on("error",a=>{Y(a)}).on("success",a=>{ee(a)}),f.emit("init")}),(a,p)=>(c(),I("div",He,[t.value?(c(),I("div",Ge," loading ")):_("",!0),te(N("div",Ze,[o(Te),o(Ue),o(Ye)],512),[[le,!t.value]])]))}});export{kt as default};
