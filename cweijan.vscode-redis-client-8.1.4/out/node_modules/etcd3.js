"use strict";var w=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var nr=w(B=>{"use strict";var Mf,Pf,xf,Nf,If,Df,qf;Object.defineProperty(B,"__esModule",{value:!0});B.castGrpcError=B.castGrpcErrorMessage=B.STMConflictError=B.NotCampaigningError=B.EtcdWatchStreamEnded=B.EtcdPermissionDeniedError=B.EtcdInvalidAuthTokenError=B.EtcdAuthenticationFailedError=B.EtcdLockFailedError=B.EtcdUserNotFoundError=B.EtcdRoleNotFoundError=B.EtcdRoleNotGrantedError=B.EtcdUserExistsError=B.EtcdRoleExistsError=B.EtcdLeaseInvalidError=B.EtcdError=B.GRPCUnauthenticatedError=B.GRPCUnavailableError=B.GRPCDataLossError=B.GRPCOutOfRangeError=B.GRPCNotImplementedError=B.GRPCAbortedError=B.GRPCFailedPreconditionError=B.GRPCResourceExhastedError=B.GRPCAlreadyExistsError=B.GRPCNotFoundError=B.GRPCDeadlineExceededError=B.GRPCInvalidArgumentError=B.GRPCUnknownError=B.GRPCCancelledError=B.GRPCInternalError=B.GRPCProtocolError=B.GRPCGenericError=B.isRecoverableError=B.RecoverableError=B.ClientClosedError=B.ClientRuntimeError=void 0;var _l=class extends Error{constructor(e){super(`${e} Please report this error at https://github.com/microsoft/etcd3`)}};B.ClientRuntimeError=_l;var Sl=class extends Error{constructor(e){super(`Tried to call a ${e} method on etcd3, but the client was already closed`)}};B.ClientClosedError=Sl;B.RecoverableError=Symbol("RecoverableError");var O0=r=>B.RecoverableError in r;B.isRecoverableError=O0;var Me=class extends Error{};B.GRPCGenericError=Me;var El=class extends Me{};B.GRPCProtocolError=El;var os=class extends Me{constructor(){super(...arguments),this[Mf]=!0}};B.GRPCInternalError=os;Mf=B.RecoverableError;var ls=class extends Me{constructor(){super(...arguments),this[Pf]=!0}};B.GRPCCancelledError=ls;Pf=B.RecoverableError;var cs=class extends Me{constructor(){super(...arguments),this[xf]=!0}};B.GRPCUnknownError=cs;xf=B.RecoverableError;var us=class extends Me{};B.GRPCInvalidArgumentError=us;var hs=class extends Me{constructor(){super(...arguments),this[Nf]=!0}};B.GRPCDeadlineExceededError=hs;Nf=B.RecoverableError;var ds=class extends Me{};B.GRPCNotFoundError=ds;var fs=class extends Me{};B.GRPCAlreadyExistsError=fs;var ps=class extends Me{constructor(){super(...arguments),this[If]=!0}};B.GRPCResourceExhastedError=ps;If=B.RecoverableError;var gs=class extends Me{};B.GRPCFailedPreconditionError=gs;var ms=class extends Me{constructor(){super(...arguments),this[Df]=!0}};B.GRPCAbortedError=ms;Df=B.RecoverableError;var vs=class extends Me{};B.GRPCNotImplementedError=vs;var ys=class extends Me{};B.GRPCOutOfRangeError=ys;var _s=class extends Me{};B.GRPCDataLossError=_s;var Ss=class extends Me{constructor(){super(...arguments),this[qf]=!0}};B.GRPCUnavailableError=Ss;qf=B.RecoverableError;var Es=class extends Me{};B.GRPCUnauthenticatedError=Es;var dn=class extends Error{};B.EtcdError=dn;var Cs=class extends Error{constructor(e){super(`Lease ${e} is expired or revoked`)}};B.EtcdLeaseInvalidError=Cs;var ws=class extends Error{};B.EtcdRoleExistsError=ws;var Ts=class extends Error{};B.EtcdUserExistsError=Ts;var bs=class extends Error{};B.EtcdRoleNotGrantedError=bs;var Rs=class extends Error{};B.EtcdRoleNotFoundError=Rs;var Os=class extends Error{};B.EtcdUserNotFoundError=Os;var Cl=class extends Error{};B.EtcdLockFailedError=Cl;var ks=class extends Error{};B.EtcdAuthenticationFailedError=ks;var As=class extends Error{};B.EtcdInvalidAuthTokenError=As;var fn=class extends Error{};B.EtcdPermissionDeniedError=fn;var wl=class extends Error{constructor(){super("The etcd watch stream was unexpectedly ended")}};B.EtcdWatchStreamEnded=wl;var Tl=class extends Error{};B.NotCampaigningError=Tl;var bl=class extends Error{constructor(){super("A conflict occurred executing the software transaction")}};B.STMConflictError=bl;var k0=new Map([["etcdserver: role name already exists",ws],["etcdserver: user name already exists",Ts],["etcdserver: role is not granted to the user",bs],["etcdserver: role name not found",Rs],["etcdserver: user name not found",Os],["etcdserver: authentication failed, invalid user ID or password",ks],["etcdserver: permission denied",fn],["etcdserver: invalid auth token",As],["etcdserver: requested lease not found",Cs]]),A0=new Map([[1,ls],[2,cs],[3,us],[4,hs],[5,ds],[6,fs],[7,fn],[8,ps],[9,gs],[10,ms],[11,ys],[12,vs],[13,os],[14,Ss],[15,_s],[16,Es]]);function Lf(r){for(let[e,t]of k0)if(r.includes(e))return t}function Af(r,e){return r.replace(/^Error:/,`${e.name}:`)}function M0(r){let e=Lf(r)||dn;return new e(r)}B.castGrpcErrorMessage=M0;function P0(r){if(r.constructor!==Error)return r;let e=Lf(r.message);!e&&"code"in r&&typeof r.code=="number"&&(e=A0.get(r.code)),e||(e=r.message.includes("etcdserver:")?dn:Me);let t=new e(Af(r.message,e));return t.stack=Af(String(r.stack),e),t}B.castGrpcError=P0});var wt=w(se=>{"use strict";Object.defineProperty(se,"__esModule",{value:!0});se.getDeferred=se.resolveCallOptions=se.PromiseWrap=se.debounce=se.onceEvent=se.forOwn=se.delay=se.sample=se.minBy=se.NSApplicator=se.endRangeForPrefix=se.toBuffer=se.emptyKey=se.zeroKey=void 0;var x0=nr();se.zeroKey=Buffer.from([0]);se.emptyKey=Buffer.from([]);function Ff(r){return r instanceof Buffer?r:(typeof r=="number"&&(r=String(r)),Buffer.from(r))}se.toBuffer=Ff;function Bf(r){let e=Ff(r),t=Buffer.from(e);for(let i=t.length-1;i>=0;i--)if(t[i]<255)return t[i]++,t=t.slice(0,i+1),t;return se.zeroKey}se.endRangeForPrefix=Bf;var pn=class{constructor(e){this.prefix=e}applyKey(e){return this.prefix.length===0||!e?e:Buffer.concat([this.prefix,e])}applyRangeEnd(e){return this.prefix.length===0||!e?e:e.equals(se.zeroKey)?(this.endRange||(this.endRange=Bf(this.prefix)),this.endRange):Buffer.concat([this.prefix,e])}applyToRequest(e){return this.prefix.length===0?e:Object.assign({},e,{key:this.applyKey(e.key),range_end:this.applyRangeEnd(e.range_end)})}unprefix(e){if(this.prefix.length===0)return e;if(!e.slice(0,this.prefix.length).equals(this.prefix))throw new x0.ClientRuntimeError(`Cannot slice non-existent prefix ${this.prefix} from ${e}!`);return e.slice(this.prefix.length)}};se.NSApplicator=pn;pn.default=new pn(se.emptyKey);function N0(r,e){let t=e(r[0]),i=[r[0]];for(let n=1;n<r.length;n++){let s=e(r[n]);s<t?(t=s,i=[r[n]]):s===t&&i.push(r[n])}return i}se.minBy=N0;function I0(r){return r[Math.floor(Math.random()*r.length)]}se.sample=I0;function D0(r){return new Promise(e=>setTimeout(e,r))}se.delay=D0;function q0(r,e){let t=Object.keys(r);for(let i of t)e(r[i],i)}se.forOwn=q0;function L0(r,...e){return new Promise((t,i)=>{let n=[],s=(a,o)=>{n.forEach(l=>l()),o==="error"?i(a):t(a)};e.forEach(a=>{let o=l=>s(l,a);n.push(()=>r.removeListener(a,o)),r.once(a,o)})})}se.onceEvent=L0;function F0(r,e){let t,i=()=>{i.cancel(),t=setTimeout(e,r)};return i.cancel=()=>{t&&(clearTimeout(t),t=void 0)},i}se.debounce=F0;var Rl=class{then(e,t){return this.createPromise().then(e,t)}catch(e){return this.createPromise().catch(e)}};se.PromiseWrap=Rl;var B0=(r,e,t)=>e===void 0?r:(typeof e=="function"&&(e=e(t)),r?{...e,...r}:e);se.resolveCallOptions=B0;var U0=()=>{let r,e;return{promise:new Promise((i,n)=>{r=i,e=n}),resolve:r,reject:e}};se.getDeferred=U0});var Kr=w(Ms=>{"use strict";Object.defineProperty(Ms,"__esModule",{value:!0});Ms.Range=void 0;var sr=wt();function gn(r,e){return r.length===0?e.length===0?0:1:e.length===0?-1:r.compare(e)}function z0(r){return r.hasOwnProperty("prefix")}var Ol=class r{static prefix(e){return e.length===0?new r(sr.zeroKey,sr.zeroKey):new r(e,(0,sr.endRangeForPrefix)((0,sr.toBuffer)(e)))}static from(e){return typeof e=="string"||e instanceof Buffer?new r((0,sr.toBuffer)(e)):e instanceof r?e:z0(e)?r.prefix(e.prefix):new r(e.start,e.end)}constructor(e,t=sr.emptyKey){this.start=(0,sr.toBuffer)(e),this.end=(0,sr.toBuffer)(t)}includes(e){return e=(0,sr.toBuffer)(e),gn(this.start,e)<=0&&gn(this.end,e)>0}compare(e){let t=gn(this.start,e.start),i=gn(this.start,e.end),n=gn(this.end,e.start);return t<0&&n<=0?-1:i>=0?1:0}};Ms.Range=Ol});var kl=w(gi=>{"use strict";Object.defineProperty(gi,"__esModule",{value:!0});gi.User=gi.Role=void 0;var zf=Kr(),H0=wt();function Uf(r){return r.hasOwnProperty("key")?new zf.Range((0,H0.toBuffer)(r.key)):r.range}var pi=class{constructor(e,t){this.client=e,this.name=t}create(e){return this.client.roleAdd({name:this.name},e).then(()=>this)}delete(e){return this.client.roleDelete({role:this.name},e).then(()=>this)}revoke(e,t){if(e instanceof Array)return Promise.all(e.map(n=>this.grant(n,t))).then(()=>this);let i=Uf(e);return this.client.roleRevokePermission({role:this.name,key:i.start,range_end:i.end}).then(()=>this)}grant(e,t){if(e instanceof Array)return Promise.all(e.map(n=>this.grant(n))).then(()=>this);let i=Uf(e);return this.client.roleGrantPermission({name:this.name,perm:{permType:e.permission,key:i.start,range_end:i.end}},t).then(()=>this)}permissions(e){return this.client.roleGet({role:this.name},e).then(t=>t.perm.map(i=>({permission:i.permType,range:new zf.Range(i.key,i.range_end)})))}addUser(e,t){return e instanceof mn&&(e=e.name),this.client.userGrantRole({user:e,role:this.name},t).then(()=>this)}removeUser(e,t){return e instanceof mn&&(e=e.name),this.client.userRevokeRole({name:e,role:this.name},t).then(()=>this)}};gi.Role=pi;var mn=class{constructor(e,t){this.client=e,this.name=t}create(e,t){return this.client.userAdd({name:this.name,password:e},t).then(()=>this)}setPassword(e,t){return this.client.userChangePassword({name:this.name,password:e},t).then(()=>this)}delete(e){return this.client.userDelete({name:this.name},e).then(()=>this)}roles(e){return this.client.userGet({name:this.name},e).then(t=>t.roles.map(i=>new pi(this.client,i)))}addRole(e,t){return e instanceof pi&&(e=e.name),this.client.userGrantRole({user:this.name,role:e},t).then(()=>this)}removeRole(e,t){return e instanceof pi&&(e=e.name),this.client.userRevokeRole({name:this.name,role:e},t).then(()=>this)}};gi.User=mn});var re=w(ct=>{"use strict";Object.defineProperty(ct,"__esModule",{value:!0});ct.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=ct.DEFAULT_MAX_SEND_MESSAGE_LENGTH=ct.Propagate=ct.LogVerbosity=ct.Status=void 0;var Hf;(function(r){r[r.OK=0]="OK",r[r.CANCELLED=1]="CANCELLED",r[r.UNKNOWN=2]="UNKNOWN",r[r.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",r[r.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",r[r.NOT_FOUND=5]="NOT_FOUND",r[r.ALREADY_EXISTS=6]="ALREADY_EXISTS",r[r.PERMISSION_DENIED=7]="PERMISSION_DENIED",r[r.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",r[r.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",r[r.ABORTED=10]="ABORTED",r[r.OUT_OF_RANGE=11]="OUT_OF_RANGE",r[r.UNIMPLEMENTED=12]="UNIMPLEMENTED",r[r.INTERNAL=13]="INTERNAL",r[r.UNAVAILABLE=14]="UNAVAILABLE",r[r.DATA_LOSS=15]="DATA_LOSS",r[r.UNAUTHENTICATED=16]="UNAUTHENTICATED"})(Hf||(ct.Status=Hf={}));var jf;(function(r){r[r.DEBUG=0]="DEBUG",r[r.INFO=1]="INFO",r[r.ERROR=2]="ERROR",r[r.NONE=3]="NONE"})(jf||(ct.LogVerbosity=jf={}));var Gf;(function(r){r[r.DEADLINE=1]="DEADLINE",r[r.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",r[r.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",r[r.CANCELLATION=8]="CANCELLATION",r[r.DEFAULTS=65535]="DEFAULTS"})(Gf||(ct.Propagate=Gf={}));ct.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1;ct.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4*1024*1024});var Al=w((HO,j0)=>{j0.exports={name:"@grpc/grpc-js",version:"1.10.8",description:"gRPC Library for Node - pure JS implementation",homepage:"https://grpc.io/",repository:"https://github.com/grpc/grpc-node/tree/master/packages/grpc-js",main:"build/src/index.js",engines:{node:">=12.10.0"},keywords:[],author:{name:"Google Inc."},types:"build/src/index.d.ts",license:"Apache-2.0",devDependencies:{"@types/gulp":"^4.0.17","@types/gulp-mocha":"0.0.37","@types/lodash":"^4.14.202","@types/mocha":"^10.0.6","@types/ncp":"^2.0.8","@types/node":">=20.11.20","@types/pify":"^5.0.4","@types/semver":"^7.5.8","@typescript-eslint/eslint-plugin":"^7.1.0","@typescript-eslint/parser":"^7.1.0","@typescript-eslint/typescript-estree":"^7.1.0","clang-format":"^1.8.0",eslint:"^8.42.0","eslint-config-prettier":"^8.8.0","eslint-plugin-node":"^11.1.0","eslint-plugin-prettier":"^4.2.1",execa:"^2.0.3",gulp:"^4.0.2","gulp-mocha":"^6.0.0",lodash:"^4.17.21",madge:"^5.0.1","mocha-jenkins-reporter":"^0.4.1",ncp:"^2.0.0",pify:"^4.0.1",prettier:"^2.8.8",rimraf:"^3.0.2",semver:"^7.6.0","ts-node":"^10.9.2",typescript:"^5.3.3"},contributors:[{name:"Google Inc."}],scripts:{build:"npm run compile",clean:"rimraf ./build",compile:"tsc -p .",format:'clang-format -i -style="{Language: JavaScript, BasedOnStyle: Google, ColumnLimit: 80}" src/*.ts test/*.ts',lint:"eslint src/*.ts test/*.ts",prepare:"npm run generate-types && npm run compile",test:"gulp test",check:"npm run lint",fix:"eslint --fix src/*.ts test/*.ts",pretest:"npm run generate-types && npm run generate-test-types && npm run compile",posttest:"npm run check && madge -c ./build/src","generate-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --includeDirs proto/ --include-dirs test/fixtures/ -O src/generated/ --grpcLib ../index channelz.proto","generate-test-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --include-dirs test/fixtures/ -O test/generated/ --grpcLib ../../src/index test_service.proto"},dependencies:{"@grpc/proto-loader":"^0.7.13","@js-sdsl/ordered-map":"^4.4.2"},files:["src/**/*.ts","build/src/**/*.{js,d.ts,js.map}","proto/*.proto","LICENSE","deps/envoy-api/envoy/api/v2/**/*.proto","deps/envoy-api/envoy/config/**/*.proto","deps/envoy-api/envoy/service/**/*.proto","deps/envoy-api/envoy/type/**/*.proto","deps/udpa/udpa/**/*.proto","deps/googleapis/google/api/*.proto","deps/googleapis/google/rpc/*.proto","deps/protoc-gen-validate/validate/**/*.proto"]}});var we=w(Xe=>{"use strict";var Ml,Pl,xl,Nl;Object.defineProperty(Xe,"__esModule",{value:!0});Xe.isTracerEnabled=Xe.trace=Xe.log=Xe.setLoggerVerbosity=Xe.setLogger=Xe.getLogger=void 0;var yr=re(),G0=require("process"),W0=Al().version,$0={error:(r,...e)=>{console.error("E "+r,...e)},info:(r,...e)=>{console.error("I "+r,...e)},debug:(r,...e)=>{console.error("D "+r,...e)}},Yr=$0,mi=yr.LogVerbosity.ERROR,V0=(Pl=(Ml=process.env.GRPC_NODE_VERBOSITY)!==null&&Ml!==void 0?Ml:process.env.GRPC_VERBOSITY)!==null&&Pl!==void 0?Pl:"";switch(V0.toUpperCase()){case"DEBUG":mi=yr.LogVerbosity.DEBUG;break;case"INFO":mi=yr.LogVerbosity.INFO;break;case"ERROR":mi=yr.LogVerbosity.ERROR;break;case"NONE":mi=yr.LogVerbosity.NONE;break;default:}var K0=()=>Yr;Xe.getLogger=K0;var Y0=r=>{Yr=r};Xe.setLogger=Y0;var J0=r=>{mi=r};Xe.setLoggerVerbosity=J0;var X0=(r,...e)=>{let t;if(r>=mi){switch(r){case yr.LogVerbosity.DEBUG:t=Yr.debug;break;case yr.LogVerbosity.INFO:t=Yr.info;break;case yr.LogVerbosity.ERROR:t=Yr.error;break}t||(t=Yr.error),t&&t.bind(Yr)(...e)}};Xe.log=X0;var Q0=(Nl=(xl=process.env.GRPC_NODE_TRACE)!==null&&xl!==void 0?xl:process.env.GRPC_TRACE)!==null&&Nl!==void 0?Nl:"",Il=new Set,Wf=new Set;for(let r of Q0.split(","))r.startsWith("-")?Wf.add(r.substring(1)):Il.add(r);var Z0=Il.has("all");function e_(r,e,t){$f(e)&&(0,Xe.log)(r,new Date().toISOString()+" | v"+W0+" "+G0.pid+" | "+e+" | "+t)}Xe.trace=e_;function $f(r){return!Wf.has(r)&&(Z0||Il.has(r))}Xe.isTracerEnabled=$f});var Ps=w(vi=>{"use strict";Object.defineProperty(vi,"__esModule",{value:!0});vi.getErrorCode=vi.getErrorMessage=void 0;function t_(r){return r instanceof Error?r.message:String(r)}vi.getErrorMessage=t_;function r_(r){return typeof r=="object"&&r!==null&&"code"in r&&typeof r.code=="number"?r.code:null}vi.getErrorCode=r_});var Ve=w(Ns=>{"use strict";Object.defineProperty(Ns,"__esModule",{value:!0});Ns.Metadata=void 0;var i_=we(),n_=re(),s_=Ps(),a_=/^[0-9a-z_.-]+$/,o_=/^[ -~]*$/;function l_(r){return a_.test(r)}function c_(r){return o_.test(r)}function Kf(r){return r.endsWith("-bin")}function u_(r){return!r.startsWith("grpc-")}function xs(r){return r.toLowerCase()}function Vf(r,e){if(!l_(r))throw new Error('Metadata key "'+r+'" contains illegal characters');if(e!=null)if(Kf(r)){if(!Buffer.isBuffer(e))throw new Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(e))throw new Error("keys that don't end with '-bin' must have String values");if(!c_(e))throw new Error('Metadata string value "'+e+'" contains illegal characters')}}var Dl=class r{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){e=xs(e),Vf(e,t),this.internalRepr.set(e,[t])}add(e,t){e=xs(e),Vf(e,t);let i=this.internalRepr.get(e);i===void 0?this.internalRepr.set(e,[t]):i.push(t)}remove(e){e=xs(e),this.internalRepr.delete(e)}get(e){return e=xs(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,i]of this.internalRepr)if(i.length>0){let n=i[0];e[t]=Buffer.isBuffer(n)?Buffer.from(n):n}return e}clone(){let e=new r(this.options),t=e.internalRepr;for(let[i,n]of this.internalRepr){let s=n.map(a=>Buffer.isBuffer(a)?Buffer.from(a):a);t.set(i,s)}return e}merge(e){for(let[t,i]of e.internalRepr){let n=(this.internalRepr.get(t)||[]).concat(i);this.internalRepr.set(t,n)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,i]of this.internalRepr)e[t]=i.map(h_);return e}toJSON(){let e={};for(let[t,i]of this.internalRepr)e[t]=i;return e}static fromHttp2Headers(e){let t=new r;for(let i of Object.keys(e)){if(i.charAt(0)===":")continue;let n=e[i];try{Kf(i)?Array.isArray(n)?n.forEach(s=>{t.add(i,Buffer.from(s,"base64"))}):n!==void 0&&(u_(i)?n.split(",").forEach(s=>{t.add(i,Buffer.from(s.trim(),"base64"))}):t.add(i,Buffer.from(n,"base64"))):Array.isArray(n)?n.forEach(s=>{t.add(i,s)}):n!==void 0&&t.add(i,n)}catch(s){let a=`Failed to add metadata entry ${i}: ${n}. ${(0,s_.getErrorMessage)(s)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,i_.log)(n_.LogVerbosity.ERROR,a)}}return t}};Ns.Metadata=Dl;var h_=r=>Buffer.isBuffer(r)?r.toString("base64"):r});var Ul=w(Is=>{"use strict";Object.defineProperty(Is,"__esModule",{value:!0});Is.CallCredentials=void 0;var Bl=Ve();function d_(r){return"getRequestHeaders"in r&&typeof r.getRequestHeaders=="function"}var yi=class r{static createFromMetadataGenerator(e){return new Ll(e)}static createFromGoogleCredential(e){return r.createFromMetadataGenerator((t,i)=>{let n;d_(e)?n=e.getRequestHeaders(t.service_url):n=new Promise((s,a)=>{e.getRequestMetadata(t.service_url,(o,l)=>{if(o){a(o);return}if(!l){a(new Error("Headers not set by metadata plugin"));return}s(l)})}),n.then(s=>{let a=new Bl.Metadata;for(let o of Object.keys(s))a.add(o,s[o]);i(null,a)},s=>{i(s)})})}static createEmpty(){return new Fl}};Is.CallCredentials=yi;var ql=class r extends yi{constructor(e){super(),this.creds=e}async generateMetadata(e){let t=new Bl.Metadata,i=await Promise.all(this.creds.map(n=>n.generateMetadata(e)));for(let n of i)t.merge(n);return t}compose(e){return new r(this.creds.concat([e]))}_equals(e){return this===e?!0:e instanceof r?this.creds.every((t,i)=>t._equals(e.creds[i])):!1}},Ll=class r extends yi{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,i)=>{this.metadataGenerator(e,(n,s)=>{s!==void 0?t(s):i(n)})})}compose(e){return new ql([this,e])}_equals(e){return this===e?!0:e instanceof r?this.metadataGenerator===e.metadataGenerator:!1}},Fl=class r extends yi{generateMetadata(e){return Promise.resolve(new Bl.Metadata)}compose(e){return e}_equals(e){return e instanceof r}}});var Hl=w(_i=>{"use strict";Object.defineProperty(_i,"__esModule",{value:!0});_i.getDefaultRootsData=_i.CIPHER_SUITES=void 0;var f_=require("fs");_i.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;var Yf=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,zl=null;function p_(){return Yf?(zl===null&&(zl=f_.readFileSync(Yf)),zl):null}_i.getDefaultRootsData=p_});var Ls=w(qs=>{"use strict";Object.defineProperty(qs,"__esModule",{value:!0});qs.ChannelCredentials=void 0;var g_=require("tls"),m_=Ul(),Jf=Hl();function jl(r,e){if(r&&!(r instanceof Buffer))throw new TypeError(`${e}, if provided, must be a Buffer.`)}var Si=class{constructor(e){this.callCredentials=e||m_.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,i,n){var s;if(jl(e,"Root certificate"),jl(t,"Private key"),jl(i,"Certificate chain"),t&&!i)throw new Error("Private key must be given with accompanying certificate chain");if(!t&&i)throw new Error("Certificate chain must be given with accompanying private key");let a=(0,g_.createSecureContext)({ca:(s=e??(0,Jf.getDefaultRootsData)())!==null&&s!==void 0?s:void 0,key:t??void 0,cert:i??void 0,ciphers:Jf.CIPHER_SUITES});return new Ds(a,n??{})}static createFromSecureContext(e,t){return new Ds(e,t??{})}static createInsecure(){return new Gl}};qs.ChannelCredentials=Si;var Gl=class r extends Si{constructor(){super()}compose(e){throw new Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof r}},Ds=class r extends Si{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},t?.checkServerIdentity&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){let t=this.callCredentials.compose(e);return new Wl(this,t)}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof r?this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity:!1}},Wl=class r extends Si{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new r(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof r?this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials):!1}}});var Jr=w(Fe=>{"use strict";Object.defineProperty(Fe,"__esModule",{value:!0});Fe.selectLbConfigFromList=Fe.getDefaultConfig=Fe.parseLoadBalancingConfig=Fe.isLoadBalancerNameRegistered=Fe.createLoadBalancer=Fe.registerDefaultLoadBalancerType=Fe.registerLoadBalancerType=Fe.createChildChannelControlHelper=void 0;var v_=we(),y_=re();function __(r,e){var t,i,n,s,a,o,l,c,p,m;return{createSubchannel:(i=(t=e.createSubchannel)===null||t===void 0?void 0:t.bind(e))!==null&&i!==void 0?i:r.createSubchannel.bind(r),updateState:(s=(n=e.updateState)===null||n===void 0?void 0:n.bind(e))!==null&&s!==void 0?s:r.updateState.bind(r),requestReresolution:(o=(a=e.requestReresolution)===null||a===void 0?void 0:a.bind(e))!==null&&o!==void 0?o:r.requestReresolution.bind(r),addChannelzChild:(c=(l=e.addChannelzChild)===null||l===void 0?void 0:l.bind(e))!==null&&c!==void 0?c:r.addChannelzChild.bind(r),removeChannelzChild:(m=(p=e.removeChannelzChild)===null||p===void 0?void 0:p.bind(e))!==null&&m!==void 0?m:r.removeChannelzChild.bind(r)}}Fe.createChildChannelControlHelper=__;var _r={},vn=null;function S_(r,e,t){_r[r]={LoadBalancer:e,LoadBalancingConfig:t}}Fe.registerLoadBalancerType=S_;function E_(r){vn=r}Fe.registerDefaultLoadBalancerType=E_;function C_(r,e,t){let i=r.getLoadBalancerName();return i in _r?new _r[i].LoadBalancer(e,t):null}Fe.createLoadBalancer=C_;function w_(r){return r in _r}Fe.isLoadBalancerNameRegistered=w_;function Xf(r){let e=Object.keys(r);if(e.length!==1)throw new Error("Provided load balancing config has multiple conflicting entries");let t=e[0];if(t in _r)try{return _r[t].LoadBalancingConfig.createFromJson(r[t])}catch(i){throw new Error(`${t}: ${i.message}`)}else throw new Error(`Unrecognized load balancing config name ${t}`)}Fe.parseLoadBalancingConfig=Xf;function T_(){if(!vn)throw new Error("No default load balancer type registered");return new _r[vn].LoadBalancingConfig}Fe.getDefaultConfig=T_;function b_(r,e=!1){for(let t of r)try{return Xf(t)}catch(i){(0,v_.log)(y_.LogVerbosity.DEBUG,"Config parsing failed with error",i.message);continue}return e&&vn?new _r[vn].LoadBalancingConfig:null}Fe.selectLbConfigFromList=b_});var $l=w(Sr=>{"use strict";Object.defineProperty(Sr,"__esModule",{value:!0});Sr.extractAndSelectServiceConfig=Sr.validateServiceConfig=Sr.validateRetryThrottling=void 0;var R_=require("os"),Fs=re(),Bs=/^\d+(\.\d{1,9})?s$/,O_="node";function k_(r){if("service"in r&&r.service!==""){if(typeof r.service!="string")throw new Error(`Invalid method config name: invalid service: expected type string, got ${typeof r.service}`);if("method"in r&&r.method!==""){if(typeof r.method!="string")throw new Error(`Invalid method config name: invalid method: expected type string, got ${typeof r.service}`);return{service:r.service,method:r.method}}else return{service:r.service}}else{if("method"in r&&r.method!==void 0)throw new Error("Invalid method config name: method set with empty or unset service");return{}}}function A_(r){if(!("maxAttempts"in r)||!Number.isInteger(r.maxAttempts)||r.maxAttempts<2)throw new Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in r)||typeof r.initialBackoff!="string"||!Bs.test(r.initialBackoff))throw new Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in r)||typeof r.maxBackoff!="string"||!Bs.test(r.maxBackoff))throw new Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in r)||typeof r.backoffMultiplier!="number"||r.backoffMultiplier<=0)throw new Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in r&&Array.isArray(r.retryableStatusCodes)))throw new Error("Invalid method config retry policy: retryableStatusCodes is required");if(r.retryableStatusCodes.length===0)throw new Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let e of r.retryableStatusCodes)if(typeof e=="number"){if(!Object.values(Fs.Status).includes(e))throw new Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if(typeof e=="string"){if(!Object.values(Fs.Status).includes(e.toUpperCase()))throw new Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw new Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:r.maxAttempts,initialBackoff:r.initialBackoff,maxBackoff:r.maxBackoff,backoffMultiplier:r.backoffMultiplier,retryableStatusCodes:r.retryableStatusCodes}}function M_(r){if(!("maxAttempts"in r)||!Number.isInteger(r.maxAttempts)||r.maxAttempts<2)throw new Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in r&&(typeof r.hedgingDelay!="string"||!Bs.test(r.hedgingDelay)))throw new Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in r&&Array.isArray(r.nonFatalStatusCodes))for(let t of r.nonFatalStatusCodes)if(typeof t=="number"){if(!Object.values(Fs.Status).includes(t))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if(typeof t=="string"){if(!Object.values(Fs.Status).includes(t.toUpperCase()))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let e={maxAttempts:r.maxAttempts};return r.hedgingDelay&&(e.hedgingDelay=r.hedgingDelay),r.nonFatalStatusCodes&&(e.nonFatalStatusCodes=r.nonFatalStatusCodes),e}function P_(r){var e;let t={name:[]};if(!("name"in r)||!Array.isArray(r.name))throw new Error("Invalid method config: invalid name array");for(let i of r.name)t.name.push(k_(i));if("waitForReady"in r){if(typeof r.waitForReady!="boolean")throw new Error("Invalid method config: invalid waitForReady");t.waitForReady=r.waitForReady}if("timeout"in r)if(typeof r.timeout=="object"){if(!("seconds"in r.timeout)||typeof r.timeout.seconds!="number")throw new Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in r.timeout)||typeof r.timeout.nanos!="number")throw new Error("Invalid method config: invalid timeout.nanos");t.timeout=r.timeout}else if(typeof r.timeout=="string"&&Bs.test(r.timeout)){let i=r.timeout.substring(0,r.timeout.length-1).split(".");t.timeout={seconds:i[0]|0,nanos:((e=i[1])!==null&&e!==void 0?e:0)|0}}else throw new Error("Invalid method config: invalid timeout");if("maxRequestBytes"in r){if(typeof r.maxRequestBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxRequestBytes=r.maxRequestBytes}if("maxResponseBytes"in r){if(typeof r.maxResponseBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxResponseBytes=r.maxResponseBytes}if("retryPolicy"in r){if("hedgingPolicy"in r)throw new Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");t.retryPolicy=A_(r.retryPolicy)}else"hedgingPolicy"in r&&(t.hedgingPolicy=M_(r.hedgingPolicy));return t}function Qf(r){if(!("maxTokens"in r)||typeof r.maxTokens!="number"||r.maxTokens<=0||r.maxTokens>1e3)throw new Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in r)||typeof r.tokenRatio!="number"||r.tokenRatio<=0)throw new Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+r.maxTokens.toFixed(3),tokenRatio:+r.tokenRatio.toFixed(3)}}Sr.validateRetryThrottling=Qf;function x_(r){if(!(typeof r=="object"&&r!==null))throw new Error(`Invalid loadBalancingConfig: unexpected type ${typeof r}`);let e=Object.keys(r);if(e.length>1)throw new Error(`Invalid loadBalancingConfig: unexpected multiple keys ${e}`);if(e.length===0)throw new Error("Invalid loadBalancingConfig: load balancing policy name required");return{[e[0]]:r[e[0]]}}function Zf(r){let e={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in r)if(typeof r.loadBalancingPolicy=="string")e.loadBalancingPolicy=r.loadBalancingPolicy;else throw new Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in r)if(Array.isArray(r.loadBalancingConfig))for(let i of r.loadBalancingConfig)e.loadBalancingConfig.push(x_(i));else throw new Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in r&&Array.isArray(r.methodConfig))for(let i of r.methodConfig)e.methodConfig.push(P_(i));"retryThrottling"in r&&(e.retryThrottling=Qf(r.retryThrottling));let t=[];for(let i of e.methodConfig)for(let n of i.name){for(let s of t)if(n.service===s.service&&n.method===s.method)throw new Error(`Invalid service config: duplicate name ${n.service}/${n.method}`);t.push(n)}return e}Sr.validateServiceConfig=Zf;function N_(r){if(!("serviceConfig"in r))throw new Error("Invalid service config choice: missing service config");let e={serviceConfig:Zf(r.serviceConfig)};if("clientLanguage"in r)if(Array.isArray(r.clientLanguage)){e.clientLanguage=[];for(let i of r.clientLanguage)if(typeof i=="string")e.clientLanguage.push(i);else throw new Error("Invalid service config choice: invalid clientLanguage")}else throw new Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in r)if(Array.isArray(r.clientHostname)){e.clientHostname=[];for(let i of r.clientHostname)if(typeof i=="string")e.clientHostname.push(i);else throw new Error("Invalid service config choice: invalid clientHostname")}else throw new Error("Invalid service config choice: invalid clientHostname");if("percentage"in r)if(typeof r.percentage=="number"&&0<=r.percentage&&r.percentage<=100)e.percentage=r.percentage;else throw new Error("Invalid service config choice: invalid percentage");let t=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let i in r)if(!t.includes(i))throw new Error(`Invalid service config choice: unexpected field ${i}`);return e}function I_(r,e){if(!Array.isArray(r))throw new Error("Invalid service config list");for(let t of r){let i=N_(t);if(!(typeof i.percentage=="number"&&e>i.percentage)){if(Array.isArray(i.clientHostname)){let n=!1;for(let s of i.clientHostname)s===R_.hostname()&&(n=!0);if(!n)continue}if(Array.isArray(i.clientLanguage)){let n=!1;for(let s of i.clientLanguage)s===O_&&(n=!0);if(!n)continue}return i.serviceConfig}}throw new Error("No matching service config found")}function D_(r,e){for(let t of r)if(t.length>0&&t[0].startsWith("grpc_config=")){let i=t.join("").substring(12),n=JSON.parse(i);return I_(n,e)}return null}Sr.extractAndSelectServiceConfig=D_});var ut=w(Us=>{"use strict";Object.defineProperty(Us,"__esModule",{value:!0});Us.ConnectivityState=void 0;var ep;(function(r){r[r.IDLE=0]="IDLE",r[r.CONNECTING=1]="CONNECTING",r[r.READY=2]="READY",r[r.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",r[r.SHUTDOWN=4]="SHUTDOWN"})(ep||(Us.ConnectivityState=ep={}))});var rt=w(zt=>{"use strict";Object.defineProperty(zt,"__esModule",{value:!0});zt.uriToString=zt.combineHostPort=zt.splitHostPort=zt.parseUri=void 0;var q_=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;function L_(r){let e=q_.exec(r);return e===null?null:{scheme:e[1],authority:e[2],path:e[3]}}zt.parseUri=L_;var tp=/^\d+$/;function F_(r){if(r.startsWith("[")){let e=r.indexOf("]");if(e===-1)return null;let t=r.substring(1,e);if(t.indexOf(":")===-1)return null;if(r.length>e+1)if(r[e+1]===":"){let i=r.substring(e+2);return tp.test(i)?{host:t,port:+i}:null}else return null;else return{host:t}}else{let e=r.split(":");return e.length===2?tp.test(e[1])?{host:e[0],port:+e[1]}:null:{host:r}}}zt.splitHostPort=F_;function B_(r){return r.port===void 0?r.host:r.host.includes(":")?`[${r.host}]:${r.port}`:`${r.host}:${r.port}`}zt.combineHostPort=B_;function U_(r){let e="";return r.scheme!==void 0&&(e+=r.scheme+":"),r.authority!==void 0&&(e+="//"+r.authority+"/"),e+=r.path,e}zt.uriToString=U_});var Ht=w(ht=>{"use strict";Object.defineProperty(ht,"__esModule",{value:!0});ht.mapUriDefaultScheme=ht.getDefaultAuthority=ht.createResolver=ht.registerDefaultScheme=ht.registerResolver=void 0;var Kl=rt(),Ei={},Vl=null;function z_(r,e){Ei[r]=e}ht.registerResolver=z_;function H_(r){Vl=r}ht.registerDefaultScheme=H_;function j_(r,e,t){if(r.scheme!==void 0&&r.scheme in Ei)return new Ei[r.scheme](r,e,t);throw new Error(`No resolver could be created for target ${(0,Kl.uriToString)(r)}`)}ht.createResolver=j_;function G_(r){if(r.scheme!==void 0&&r.scheme in Ei)return Ei[r.scheme].getDefaultAuthority(r);throw new Error(`Invalid target ${(0,Kl.uriToString)(r)}`)}ht.getDefaultAuthority=G_;function W_(r){return r.scheme===void 0||!(r.scheme in Ei)?Vl!==null?{scheme:Vl,authority:void 0,path:(0,Kl.uriToString)(r)}:null:r}ht.mapUriDefaultScheme=W_});var Cr=w(Er=>{"use strict";Object.defineProperty(Er,"__esModule",{value:!0});Er.QueuePicker=Er.UnavailablePicker=Er.PickResultType=void 0;var $_=Ve(),V_=re(),zs;(function(r){r[r.COMPLETE=0]="COMPLETE",r[r.QUEUE=1]="QUEUE",r[r.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",r[r.DROP=3]="DROP"})(zs||(Er.PickResultType=zs={}));var Yl=class{constructor(e){this.status=Object.assign({code:V_.Status.UNAVAILABLE,details:"No connection established",metadata:new $_.Metadata},e)}pick(e){return{pickResultType:zs.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}};Er.UnavailablePicker=Yl;var Jl=class{constructor(e,t){this.loadBalancer=e,this.childPicker=t,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),this.childPicker?this.childPicker.pick(e):{pickResultType:zs.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}};Er.QueuePicker=Jl});var yn=w(Hs=>{"use strict";Object.defineProperty(Hs,"__esModule",{value:!0});Hs.BackoffTimeout=void 0;var K_=1e3,Y_=1.6,J_=12e4,X_=.2;function Q_(r,e){return Math.random()*(e-r)+r}var Xl=class{constructor(e,t){this.callback=e,this.initialDelay=K_,this.multiplier=Y_,this.maxDelay=J_,this.jitter=X_,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,i;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||(i=(t=this.timerId).unref)===null||i===void 0||i.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+Q_(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,(t=(e=this.timerId).ref)===null||t===void 0||t.call(e)}unref(){var e,t;this.hasRef=!1,(t=(e=this.timerId).unref)===null||t===void 0||t.call(e)}getEndTime(){return this.endTime}};Hs.BackoffTimeout=Xl});var Gs=w(js=>{"use strict";Object.defineProperty(js,"__esModule",{value:!0});js.ChildLoadBalancerHandler=void 0;var Z_=Jr(),eS=ut(),tS="child_load_balancer_helper",Ql=class{constructor(e,t){this.channelControlHelper=e,this.options=t,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(i){this.parent=i,this.child=null}createSubchannel(i,n){return this.parent.channelControlHelper.createSubchannel(i,n)}updateState(i,n){var s;if(this.calledByPendingChild()){if(i===eS.ConnectivityState.CONNECTING)return;(s=this.parent.currentChild)===null||s===void 0||s.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(i,n)}requestReresolution(){var i;let n=(i=this.parent.pendingChild)!==null&&i!==void 0?i:this.parent.currentChild;this.child===n&&this.parent.channelControlHelper.requestReresolution()}setChild(i){this.child=i}addChannelzChild(i){this.parent.channelControlHelper.addChannelzChild(i)}removeChannelzChild(i){this.parent.channelControlHelper.removeChannelzChild(i)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,i){let n;if(this.currentChild===null||this.latestConfig===null||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let s=new this.ChildPolicyHelper(this),a=(0,Z_.createLoadBalancer)(t,s,this.options);s.setChild(a),this.currentChild===null?(this.currentChild=a,n=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=a,n=this.pendingChild)}else this.pendingChild===null?n=this.currentChild:n=this.pendingChild;this.latestConfig=t,n.updateAddressList(e,t,i)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return tS}};js.ChildLoadBalancerHandler=Ql});var ip=w(Ws=>{"use strict";Object.defineProperty(Ws,"__esModule",{value:!0});Ws.ResolvingLoadBalancer=void 0;var rS=Jr(),iS=$l(),Ze=ut(),nS=Ht(),_n=Cr(),sS=yn(),Zl=re(),aS=Ve(),oS=we(),lS=re(),cS=rt(),uS=Gs(),hS="resolving_load_balancer";function rp(r){oS.trace(lS.LogVerbosity.DEBUG,hS,r)}var dS=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function fS(r,e,t,i){for(let n of t.name)switch(i){case"EMPTY":if(!n.service&&!n.method)return!0;break;case"SERVICE":if(n.service===r&&!n.method)return!0;break;case"SERVICE_AND_METHOD":if(n.service===r&&n.method===e)return!0}return!1}function pS(r,e,t,i){for(let n of t)if(fS(r,e,n,i))return n;return null}function gS(r){return function(t,i){var n,s;let a=t.split("/").filter(c=>c.length>0),o=(n=a[0])!==null&&n!==void 0?n:"",l=(s=a[1])!==null&&s!==void 0?s:"";if(r&&r.methodConfig)for(let c of dS){let p=pS(o,l,r.methodConfig,c);if(p)return{methodConfig:p,pickInformation:{},status:Zl.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:Zl.Status.OK,dynamicFilterFactories:[]}}}var ec=class{constructor(e,t,i,n,s){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=n,this.onFailedResolution=s,this.latestChildState=Ze.ConnectivityState.IDLE,this.latestChildPicker=new _n.QueuePicker(this),this.currentState=Ze.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,i["grpc.service_config"]?this.defaultServiceConfig=(0,iS.validateServiceConfig)(JSON.parse(i["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(Ze.ConnectivityState.IDLE,new _n.QueuePicker(this)),this.childLoadBalancer=new uS.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(rp("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(o,l)=>{this.latestChildState=o,this.latestChildPicker=l,this.updateState(o,l)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)},i),this.innerResolver=(0,nS.createResolver)(e,{onSuccessfulResolution:(o,l,c,p,m)=>{var S;this.backoffTimeout.stop(),this.backoffTimeout.reset();let O=null;l===null?c===null?(this.previousServiceConfig=null,O=this.defaultServiceConfig):this.previousServiceConfig===null?this.handleResolutionFailure(c):O=this.previousServiceConfig:(O=l,this.previousServiceConfig=l);let N=(S=O?.loadBalancingConfig)!==null&&S!==void 0?S:[],k=(0,rS.selectLbConfigFromList)(N,!0);if(k===null){this.handleResolutionFailure({code:Zl.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new aS.Metadata});return}this.childLoadBalancer.updateAddressList(o,k,m);let I=O??this.defaultServiceConfig;this.onSuccessfulResolution(I,p??gS(I))},onError:o=>{this.handleResolutionFailure(o)}},i);let a={initialDelay:i["grpc.initial_reconnect_backoff_ms"],maxDelay:i["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new sS.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},a),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===Ze.ConnectivityState.IDLE&&this.updateState(Ze.ConnectivityState.CONNECTING,this.latestChildPicker),this.backoffTimeout.runOnce()}updateState(e,t){rp((0,cS.uriToString)(this.target)+" "+Ze.ConnectivityState[this.currentState]+" -> "+Ze.ConnectivityState[e]),e===Ze.ConnectivityState.IDLE&&(t=new _n.QueuePicker(this,t)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===Ze.ConnectivityState.IDLE&&(this.updateState(Ze.ConnectivityState.TRANSIENT_FAILURE,new _n.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===Ze.ConnectivityState.IDLE||this.currentState===Ze.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw new Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=Ze.ConnectivityState.IDLE,this.latestChildPicker=new _n.QueuePicker(this),this.currentState=Ze.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}};Ws.ResolvingLoadBalancer=ec});var np=w(Ci=>{"use strict";Object.defineProperty(Ci,"__esModule",{value:!0});Ci.channelOptionsEqual=Ci.recognizedOptions=void 0;Ci.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0,"grpc.lb.ring_hash.ring_size_cap":!0};function mS(r,e){let t=Object.keys(r).sort(),i=Object.keys(e).sort();if(t.length!==i.length)return!1;for(let n=0;n<t.length;n+=1)if(t[n]!==i[n]||r[t[n]]!==e[i[n]])return!1;return!0}Ci.channelOptionsEqual=mS});var Tt=w(Be=>{"use strict";Object.defineProperty(Be,"__esModule",{value:!0});Be.EndpointMap=Be.endpointHasAddress=Be.endpointToString=Be.endpointEqual=Be.stringToSubchannelAddress=Be.subchannelAddressToString=Be.subchannelAddressEqual=Be.isTcpSubchannelAddress=void 0;var sp=require("net");function En(r){return"port"in r}Be.isTcpSubchannelAddress=En;function $s(r,e){return!r&&!e?!0:!r||!e?!1:En(r)?En(e)&&r.host===e.host&&r.port===e.port:!En(e)&&r.path===e.path}Be.subchannelAddressEqual=$s;function ap(r){return En(r)?(0,sp.isIPv6)(r.host)?"["+r.host+"]:"+r.port:r.host+":"+r.port:r.path}Be.subchannelAddressToString=ap;var vS=443;function yS(r,e){return(0,sp.isIP)(r)?{host:r,port:e??vS}:{path:r}}Be.stringToSubchannelAddress=yS;function _S(r,e){if(r.addresses.length!==e.addresses.length)return!1;for(let t=0;t<r.addresses.length;t++)if(!$s(r.addresses[t],e.addresses[t]))return!1;return!0}Be.endpointEqual=_S;function SS(r){return"["+r.addresses.map(ap).join(", ")+"]"}Be.endpointToString=SS;function op(r,e){for(let t of r.addresses)if($s(t,e))return!0;return!1}Be.endpointHasAddress=op;function Sn(r,e){if(r.addresses.length!==e.addresses.length)return!1;for(let t of r.addresses){let i=!1;for(let n of e.addresses)if($s(t,n)){i=!0;break}if(!i)return!1}return!0}var tc=class{constructor(){this.map=new Set}get size(){return this.map.size}getForSubchannelAddress(e){for(let t of this.map)if(op(t.key,e))return t.value}deleteMissing(e){let t=[];for(let i of this.map){let n=!1;for(let s of e)Sn(s,i.key)&&(n=!0);n||(t.push(i.value),this.map.delete(i))}return t}get(e){for(let t of this.map)if(Sn(e,t.key))return t.value}set(e,t){for(let i of this.map)if(Sn(e,i.key)){i.value=t;return}this.map.add({key:e,value:t})}delete(e){for(let t of this.map)if(Sn(e,t.key)){this.map.delete(t);return}}has(e){for(let t of this.map)if(Sn(e,t.key))return!0;return!1}clear(){this.map.clear()}*keys(){for(let e of this.map)yield e.key}*values(){for(let e of this.map)yield e.value}*entries(){for(let e of this.map)yield[e.key,e.value]}};Be.EndpointMap=tc});var lp=w(cc=>{"use strict";Object.defineProperty(cc,"t",{value:!0});var Vs=class{constructor(e,t,i=1){this.i=void 0,this.h=void 0,this.o=void 0,this.u=e,this.l=t,this.p=i}I(){let e=this,t=e.o.o===e;if(t&&e.p===1)e=e.h;else if(e.i)for(e=e.i;e.h;)e=e.h;else{if(t)return e.o;let i=e.o;for(;i.i===e;)e=i,i=e.o;e=i}return e}B(){let e=this;if(e.h){for(e=e.h;e.i;)e=e.i;return e}else{let t=e.o;for(;t.h===e;)e=t,t=e.o;return e.h!==t?t:e}}_(){let e=this.o,t=this.h,i=t.i;return e.o===this?e.o=t:e.i===this?e.i=t:e.h=t,t.o=e,t.i=this,this.o=t,this.h=i,i&&(i.o=this),t}g(){let e=this.o,t=this.i,i=t.h;return e.o===this?e.o=t:e.i===this?e.i=t:e.h=t,t.o=e,t.h=this,this.o=t,this.i=i,i&&(i.o=this),t}},rc=class extends Vs{constructor(){super(...arguments),this.M=1}_(){let e=super._();return this.O(),e.O(),e}g(){let e=super.g();return this.O(),e.O(),e}O(){this.M=1,this.i&&(this.M+=this.i.M),this.h&&(this.M+=this.h.M)}},ic=class{constructor(e=0){this.iteratorType=e}equals(e){return this.T===e.T}},nc=class{constructor(){this.m=0}get length(){return this.m}size(){return this.m}empty(){return this.m===0}},sc=class extends nc{};function Xr(){throw new RangeError("Iterator access denied!")}var ac=class extends sc{constructor(e=function(i,n){return i<n?-1:i>n?1:0},t=!1){super(),this.v=void 0,this.A=e,this.enableIndex=t,this.N=t?rc:Vs,this.C=new this.N}R(e,t){let i=this.C;for(;e;){let n=this.A(e.u,t);if(n<0)e=e.h;else if(n>0)i=e,e=e.i;else return e}return i}K(e,t){let i=this.C;for(;e;)this.A(e.u,t)<=0?e=e.h:(i=e,e=e.i);return i}L(e,t){let i=this.C;for(;e;){let n=this.A(e.u,t);if(n<0)i=e,e=e.h;else if(n>0)e=e.i;else return e}return i}k(e,t){let i=this.C;for(;e;)this.A(e.u,t)<0?(i=e,e=e.h):e=e.i;return i}P(e){for(;;){let t=e.o;if(t===this.C)return;if(e.p===1){e.p=0;return}if(e===t.i){let i=t.h;if(i.p===1)i.p=0,t.p=1,t===this.v?this.v=t._():t._();else if(i.h&&i.h.p===1){i.p=t.p,t.p=0,i.h.p=0,t===this.v?this.v=t._():t._();return}else i.i&&i.i.p===1?(i.p=1,i.i.p=0,i.g()):(i.p=1,e=t)}else{let i=t.i;if(i.p===1)i.p=0,t.p=1,t===this.v?this.v=t.g():t.g();else if(i.i&&i.i.p===1){i.p=t.p,t.p=0,i.i.p=0,t===this.v?this.v=t.g():t.g();return}else i.h&&i.h.p===1?(i.p=1,i.h.p=0,i._()):(i.p=1,e=t)}}}S(e){if(this.m===1){this.clear();return}let t=e;for(;t.i||t.h;){if(t.h)for(t=t.h;t.i;)t=t.i;else t=t.i;let n=e.u;e.u=t.u,t.u=n;let s=e.l;e.l=t.l,t.l=s,e=t}this.C.i===t?this.C.i=t.o:this.C.h===t&&(this.C.h=t.o),this.P(t);let i=t.o;if(t===i.i?i.i=void 0:i.h=void 0,this.m-=1,this.v.p=0,this.enableIndex)for(;i!==this.C;)i.M-=1,i=i.o}U(e){let t=typeof e=="number"?e:void 0,i=typeof e=="function"?e:void 0,n=typeof e>"u"?[]:void 0,s=0,a=this.v,o=[];for(;o.length||a;)if(a)o.push(a),a=a.i;else{if(a=o.pop(),s===t)return a;n&&n.push(a),i&&i(a,s,this),s+=1,a=a.h}return n}j(e){for(;;){let t=e.o;if(t.p===0)return;let i=t.o;if(t===i.i){let n=i.h;if(n&&n.p===1){if(n.p=t.p=0,i===this.v)return;i.p=1,e=i;continue}else if(e===t.h){if(e.p=0,e.i&&(e.i.o=t),e.h&&(e.h.o=i),t.h=e.i,i.i=e.h,e.i=t,e.h=i,i===this.v)this.v=e,this.C.o=e;else{let s=i.o;s.i===i?s.i=e:s.h=e}e.o=i.o,t.o=e,i.o=e,i.p=1}else{t.p=0,i===this.v?this.v=i.g():i.g(),i.p=1;return}}else{let n=i.i;if(n&&n.p===1){if(n.p=t.p=0,i===this.v)return;i.p=1,e=i;continue}else if(e===t.i){if(e.p=0,e.i&&(e.i.o=i),e.h&&(e.h.o=t),i.h=e.i,t.i=e.h,e.i=i,e.h=t,i===this.v)this.v=e,this.C.o=e;else{let s=i.o;s.i===i?s.i=e:s.h=e}e.o=i.o,t.o=e,i.o=e,i.p=1}else{t.p=0,i===this.v?this.v=i._():i._(),i.p=1;return}}this.enableIndex&&(t.O(),i.O(),e.O());return}}q(e,t,i){if(this.v===void 0)return this.m+=1,this.v=new this.N(e,t,0),this.v.o=this.C,this.C.o=this.C.i=this.C.h=this.v,this.m;let n,s=this.C.i,a=this.A(s.u,e);if(a===0)return s.l=t,this.m;if(a>0)s.i=new this.N(e,t),s.i.o=s,n=s.i,this.C.i=n;else{let o=this.C.h,l=this.A(o.u,e);if(l===0)return o.l=t,this.m;if(l<0)o.h=new this.N(e,t),o.h.o=o,n=o.h,this.C.h=n;else{if(i!==void 0){let c=i.T;if(c!==this.C){let p=this.A(c.u,e);if(p===0)return c.l=t,this.m;if(p>0){let m=c.I(),S=this.A(m.u,e);if(S===0)return m.l=t,this.m;S<0&&(n=new this.N(e,t),m.h===void 0?(m.h=n,n.o=m):(c.i=n,n.o=c))}}}if(n===void 0)for(n=this.v;;){let c=this.A(n.u,e);if(c>0){if(n.i===void 0){n.i=new this.N(e,t),n.i.o=n,n=n.i;break}n=n.i}else if(c<0){if(n.h===void 0){n.h=new this.N(e,t),n.h.o=n,n=n.h;break}n=n.h}else return n.l=t,this.m}}}if(this.enableIndex){let o=n.o;for(;o!==this.C;)o.M+=1,o=o.o}return this.j(n),this.m+=1,this.m}H(e,t){for(;e;){let i=this.A(e.u,t);if(i<0)e=e.h;else if(i>0)e=e.i;else return e}return e||this.C}clear(){this.m=0,this.v=void 0,this.C.o=void 0,this.C.i=this.C.h=void 0}updateKeyByIterator(e,t){let i=e.T;if(i===this.C&&Xr(),this.m===1)return i.u=t,!0;let n=i.B().u;if(i===this.C.i)return this.A(n,t)>0?(i.u=t,!0):!1;let s=i.I().u;return i===this.C.h?this.A(s,t)<0?(i.u=t,!0):!1:this.A(s,t)>=0||this.A(n,t)<=0?!1:(i.u=t,!0)}eraseElementByPos(e){if(e<0||e>this.m-1)throw new RangeError;let t=this.U(e);return this.S(t),this.m}eraseElementByKey(e){if(this.m===0)return!1;let t=this.H(this.v,e);return t===this.C?!1:(this.S(t),!0)}eraseElementByIterator(e){let t=e.T;t===this.C&&Xr();let i=t.h===void 0;return e.iteratorType===0?i&&e.next():(!i||t.i===void 0)&&e.next(),this.S(t),e}getHeight(){if(this.m===0)return 0;function e(t){return t?Math.max(e(t.i),e(t.h))+1:0}return e(this.v)}},oc=class extends ic{constructor(e,t,i){super(i),this.T=e,this.C=t,this.iteratorType===0?(this.pre=function(){return this.T===this.C.i&&Xr(),this.T=this.T.I(),this},this.next=function(){return this.T===this.C&&Xr(),this.T=this.T.B(),this}):(this.pre=function(){return this.T===this.C.h&&Xr(),this.T=this.T.B(),this},this.next=function(){return this.T===this.C&&Xr(),this.T=this.T.I(),this})}get index(){let e=this.T,t=this.C.o;if(e===this.C)return t?t.M-1:0;let i=0;for(e.i&&(i+=e.i.M);e!==t;){let n=e.o;e===n.h&&(i+=1,n.i&&(i+=n.i.M)),e=n}return i}isAccessible(){return this.T!==this.C}},bt=class r extends oc{constructor(e,t,i,n){super(e,t,n),this.container=i}get pointer(){this.T===this.C&&Xr();let e=this;return new Proxy([],{get(t,i){return i==="0"?e.T.u:i==="1"?e.T.l:(t[0]=e.T.u,t[1]=e.T.l,t[i])},set(t,i,n){if(i!=="1")throw new TypeError("prop must be 1");return e.T.l=n,!0}})}copy(){return new r(this.T,this.C,this.container,this.iteratorType)}},lc=class extends ac{constructor(e=[],t,i){super(t,i);let n=this;e.forEach(function(s){n.setElement(s[0],s[1])})}begin(){return new bt(this.C.i||this.C,this.C,this)}end(){return new bt(this.C,this.C,this)}rBegin(){return new bt(this.C.h||this.C,this.C,this,1)}rEnd(){return new bt(this.C,this.C,this,1)}front(){if(this.m===0)return;let e=this.C.i;return[e.u,e.l]}back(){if(this.m===0)return;let e=this.C.h;return[e.u,e.l]}lowerBound(e){let t=this.R(this.v,e);return new bt(t,this.C,this)}upperBound(e){let t=this.K(this.v,e);return new bt(t,this.C,this)}reverseLowerBound(e){let t=this.L(this.v,e);return new bt(t,this.C,this)}reverseUpperBound(e){let t=this.k(this.v,e);return new bt(t,this.C,this)}forEach(e){this.U(function(t,i,n){e([t.u,t.l],i,n)})}setElement(e,t,i){return this.q(e,t,i)}getElementByPos(e){if(e<0||e>this.m-1)throw new RangeError;let t=this.U(e);return[t.u,t.l]}find(e){let t=this.H(this.v,e);return new bt(t,this.C,this)}getElementByKey(e){return this.H(this.v,e).l}union(e){let t=this;return e.forEach(function(i){t.setElement(i[0],i[1])}),this.m}*[Symbol.iterator](){let e=this.m,t=this.U();for(let i=0;i<e;++i){let n=t[i];yield[n.u,n.l]}}};cc.OrderedMap=lc});var Ks=w(wi=>{"use strict";Object.defineProperty(wi,"__esModule",{value:!0});wi.addAdminServicesToServer=wi.registerAdminService=void 0;var cp=[];function ES(r,e){cp.push({getServiceDefinition:r,getHandlers:e})}wi.registerAdminService=ES;function CS(r){for(let{getServiceDefinition:e,getHandlers:t}of cp)r.addService(e(),t())}wi.addAdminServicesToServer=CS});var up=w(dt=>{"use strict";Object.defineProperty(dt,"__esModule",{value:!0});dt.ClientDuplexStreamImpl=dt.ClientWritableStreamImpl=dt.ClientReadableStreamImpl=dt.ClientUnaryCallImpl=dt.callErrorFromStatus=void 0;var wS=require("events"),pc=require("stream"),Cn=re();function TS(r,e){let t=`${r.code} ${Cn.Status[r.code]}: ${r.details}`,n=`${new Error(t).stack}
for call at
${e}`;return Object.assign(new Error(t),r,{stack:n})}dt.callErrorFromStatus=TS;var uc=class extends wS.EventEmitter{constructor(){super()}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Cn.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}};dt.ClientUnaryCallImpl=uc;var hc=class extends pc.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Cn.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}};dt.ClientReadableStreamImpl=hc;var dc=class extends pc.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Cn.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_write(e,t,i){var n;let s={callback:i},a=Number(t);Number.isNaN(a)||(s.flags=a),(n=this.call)===null||n===void 0||n.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};dt.ClientWritableStreamImpl=dc;var fc=class extends pc.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Cn.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}_write(e,t,i){var n;let s={callback:i},a=Number(t);Number.isNaN(a)||(s.flags=a),(n=this.call)===null||n===void 0||n.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};dt.ClientDuplexStreamImpl=fc});var hp=w(Ti=>{"use strict";Object.defineProperty(Ti,"__esModule",{value:!0});Ti.InterceptingListenerImpl=Ti.isInterceptingListener=void 0;function bS(r){return r.onReceiveMetadata!==void 0&&r.onReceiveMetadata.length===1}Ti.isInterceptingListener=bS;var gc=class{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,t=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(t),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,t=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=t,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(t),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,t=>{this.processingMetadata||this.processingMessage?this.pendingStatus=t:this.nextListener.onReceiveStatus(t)})}};Ti.InterceptingListenerImpl=gc});var Cc=w(ft=>{"use strict";Object.defineProperty(ft,"__esModule",{value:!0});ft.getInterceptingCall=ft.InterceptingCall=ft.RequesterBuilder=ft.ListenerBuilder=ft.InterceptorConfigurationError=void 0;var RS=Ve(),dp=hp(),fp=re(),pp=Ps(),Tn=class r extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,r)}};ft.InterceptorConfigurationError=Tn;var vc=class{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}};ft.ListenerBuilder=vc;var yc=class{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}};ft.RequesterBuilder=yc;var mc={onReceiveMetadata:(r,e)=>{e(r)},onReceiveMessage:(r,e)=>{e(r)},onReceiveStatus:(r,e)=>{e(r)}},wn={start:(r,e,t)=>{t(r,e)},sendMessage:(r,e)=>{e(r)},halfClose:r=>{r()},cancel:r=>{r()}},_c=class{constructor(e,t){var i,n,s,a;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:(i=t.start)!==null&&i!==void 0?i:wn.start,sendMessage:(n=t.sendMessage)!==null&&n!==void 0?n:wn.sendMessage,halfClose:(s=t.halfClose)!==null&&s!==void 0?s:wn.halfClose,cancel:(a=t.cancel)!==null&&a!==void 0?a:wn.cancel}:this.requester=wn}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var i,n,s,a,o,l;let c={onReceiveMetadata:(n=(i=t?.onReceiveMetadata)===null||i===void 0?void 0:i.bind(t))!==null&&n!==void 0?n:p=>{},onReceiveMessage:(a=(s=t?.onReceiveMessage)===null||s===void 0?void 0:s.bind(t))!==null&&a!==void 0?a:p=>{},onReceiveStatus:(l=(o=t?.onReceiveStatus)===null||o===void 0?void 0:o.bind(t))!==null&&l!==void 0?l:p=>{}};this.processingMetadata=!0,this.requester.start(e,c,(p,m)=>{var S,O,N;this.processingMetadata=!1;let k;if((0,dp.isInterceptingListener)(m))k=m;else{let I={onReceiveMetadata:(S=m.onReceiveMetadata)!==null&&S!==void 0?S:mc.onReceiveMetadata,onReceiveMessage:(O=m.onReceiveMessage)!==null&&O!==void 0?O:mc.onReceiveMessage,onReceiveStatus:(N=m.onReceiveStatus)!==null&&N!==void 0?N:mc.onReceiveStatus};k=new dp.InterceptingListenerImpl(I,c)}this.nextCall.start(p,k),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,i=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,i),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}};ft.InterceptingCall=_c;function OS(r,e,t){var i,n;let s=(i=t.deadline)!==null&&i!==void 0?i:1/0,a=t.host,o=(n=t.parent)!==null&&n!==void 0?n:null,l=t.propagate_flags,c=t.credentials,p=r.createCall(e,s,a,o,l);return c&&p.setCredentials(c),p}var Ys=class{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let i;try{i=this.methodDefinition.requestSerialize(t)}catch(n){this.call.cancelWithStatus(fp.Status.INTERNAL,`Request message serialization failure: ${(0,pp.getErrorMessage)(n)}`);return}this.call.sendMessageWithContext(e,i)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let i=null;this.call.start(e,{onReceiveMetadata:n=>{var s;(s=t?.onReceiveMetadata)===null||s===void 0||s.call(t,n)},onReceiveMessage:n=>{var s;let a;try{a=this.methodDefinition.responseDeserialize(n)}catch(o){i={code:fp.Status.INTERNAL,details:`Response message parsing error: ${(0,pp.getErrorMessage)(o)}`,metadata:new RS.Metadata},this.call.cancelWithStatus(i.code,i.details);return}(s=t?.onReceiveMessage)===null||s===void 0||s.call(t,a)},onReceiveStatus:n=>{var s,a;i?(s=t?.onReceiveStatus)===null||s===void 0||s.call(t,i):(a=t?.onReceiveStatus)===null||a===void 0||a.call(t,n)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}},Sc=class extends Ys{constructor(e,t){super(e,t)}start(e,t){var i,n;let s=!1,a={onReceiveMetadata:(n=(i=t?.onReceiveMetadata)===null||i===void 0?void 0:i.bind(t))!==null&&n!==void 0?n:o=>{},onReceiveMessage:o=>{var l;s=!0,(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,o)},onReceiveStatus:o=>{var l,c;s||(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,null),(c=t?.onReceiveStatus)===null||c===void 0||c.call(t,o)}};super.start(e,a),this.call.startRead()}},Ec=class extends Ys{};function kS(r,e,t){let i=OS(r,t.path,e);return t.responseStream?new Ec(i,t):new Sc(i,t)}function AS(r,e,t,i){if(r.clientInterceptors.length>0&&r.clientInterceptorProviders.length>0)throw new Tn("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(r.callInterceptors.length>0&&r.callInterceptorProviders.length>0)throw new Tn("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let n=[];r.callInterceptors.length>0||r.callInterceptorProviders.length>0?n=[].concat(r.callInterceptors,r.callInterceptorProviders.map(o=>o(e))).filter(o=>o):n=[].concat(r.clientInterceptors,r.clientInterceptorProviders.map(o=>o(e))).filter(o=>o);let s=Object.assign({},t,{method_definition:e});return n.reduceRight((o,l)=>c=>l(c,o),o=>kS(i,o,e))(s)}ft.getInterceptingCall=AS});var bc=w(Xs=>{"use strict";Object.defineProperty(Xs,"__esModule",{value:!0});Xs.Client=void 0;var jt=up(),MS=Rc(),PS=ut(),wr=re(),bi=Ve(),Js=Cc(),Rt=Symbol(),Ri=Symbol(),Oi=Symbol(),ar=Symbol();function wc(r){return typeof r=="function"}function ki(r){var e;return((e=r.stack)===null||e===void 0?void 0:e.split(`
`).slice(1).join(`
`))||"no stack trace available"}var Tc=class{constructor(e,t,i={}){var n,s;if(i=Object.assign({},i),this[Ri]=(n=i.interceptors)!==null&&n!==void 0?n:[],delete i.interceptors,this[Oi]=(s=i.interceptor_providers)!==null&&s!==void 0?s:[],delete i.interceptor_providers,this[Ri].length>0&&this[Oi].length>0)throw new Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[ar]=i.callInvocationTransformer,delete i.callInvocationTransformer,i.channelOverride)this[Rt]=i.channelOverride;else if(i.channelFactoryOverride){let a=i.channelFactoryOverride;delete i.channelFactoryOverride,this[Rt]=a(e,t,i)}else this[Rt]=new MS.ChannelImplementation(e,t,i)}close(){this[Rt].close()}getChannel(){return this[Rt]}waitForReady(e,t){let i=n=>{if(n){t(new Error("Failed to connect before the deadline"));return}let s;try{s=this[Rt].getConnectivityState(!0)}catch{t(new Error("The channel has been closed"));return}if(s===PS.ConnectivityState.READY)t();else try{this[Rt].watchConnectivityState(s,e,i)}catch{t(new Error("The channel has been closed"))}};setImmediate(i)}checkOptionalUnaryResponseArguments(e,t,i){if(wc(e))return{metadata:new bi.Metadata,options:{},callback:e};if(wc(t))return e instanceof bi.Metadata?{metadata:e,options:{},callback:t}:{metadata:new bi.Metadata,options:e,callback:t};if(!(e instanceof bi.Metadata&&t instanceof Object&&wc(i)))throw new Error("Incorrect arguments passed");return{metadata:e,options:t,callback:i}}makeUnaryRequest(e,t,i,n,s,a,o){var l,c;let p=this.checkOptionalUnaryResponseArguments(s,a,o),m={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:i},S={argument:n,metadata:p.metadata,call:new jt.ClientUnaryCallImpl,channel:this[Rt],methodDefinition:m,callOptions:p.options,callback:p.callback};this[ar]&&(S=this[ar](S));let O=S.call,N={clientInterceptors:this[Ri],clientInterceptorProviders:this[Oi],callInterceptors:(l=S.callOptions.interceptors)!==null&&l!==void 0?l:[],callInterceptorProviders:(c=S.callOptions.interceptor_providers)!==null&&c!==void 0?c:[]},k=(0,Js.getInterceptingCall)(N,S.methodDefinition,S.callOptions,S.channel);O.call=k;let I=null,A=!1,D=new Error;return k.start(S.metadata,{onReceiveMetadata:j=>{O.emit("metadata",j)},onReceiveMessage(j){I!==null&&k.cancelWithStatus(wr.Status.INTERNAL,"Too many responses received"),I=j},onReceiveStatus(j){if(!A){if(A=!0,j.code===wr.Status.OK)if(I===null){let L=ki(D);S.callback((0,jt.callErrorFromStatus)({code:wr.Status.INTERNAL,details:"No message received",metadata:j.metadata},L))}else S.callback(null,I);else{let L=ki(D);S.callback((0,jt.callErrorFromStatus)(j,L))}D=null,O.emit("status",j)}}}),k.sendMessage(n),k.halfClose(),O}makeClientStreamRequest(e,t,i,n,s,a){var o,l;let c=this.checkOptionalUnaryResponseArguments(n,s,a),p={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:i},m={metadata:c.metadata,call:new jt.ClientWritableStreamImpl(t),channel:this[Rt],methodDefinition:p,callOptions:c.options,callback:c.callback};this[ar]&&(m=this[ar](m));let S=m.call,O={clientInterceptors:this[Ri],clientInterceptorProviders:this[Oi],callInterceptors:(o=m.callOptions.interceptors)!==null&&o!==void 0?o:[],callInterceptorProviders:(l=m.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},N=(0,Js.getInterceptingCall)(O,m.methodDefinition,m.callOptions,m.channel);S.call=N;let k=null,I=!1,A=new Error;return N.start(m.metadata,{onReceiveMetadata:D=>{S.emit("metadata",D)},onReceiveMessage(D){k!==null&&N.cancelWithStatus(wr.Status.INTERNAL,"Too many responses received"),k=D},onReceiveStatus(D){if(!I){if(I=!0,D.code===wr.Status.OK)if(k===null){let j=ki(A);m.callback((0,jt.callErrorFromStatus)({code:wr.Status.INTERNAL,details:"No message received",metadata:D.metadata},j))}else m.callback(null,k);else{let j=ki(A);m.callback((0,jt.callErrorFromStatus)(D,j))}A=null,S.emit("status",D)}}}),S}checkMetadataAndOptions(e,t){let i,n;return e instanceof bi.Metadata?(i=e,t?n=t:n={}):(e?n=e:n={},i=new bi.Metadata),{metadata:i,options:n}}makeServerStreamRequest(e,t,i,n,s,a){var o,l;let c=this.checkMetadataAndOptions(s,a),p={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:i},m={argument:n,metadata:c.metadata,call:new jt.ClientReadableStreamImpl(i),channel:this[Rt],methodDefinition:p,callOptions:c.options};this[ar]&&(m=this[ar](m));let S=m.call,O={clientInterceptors:this[Ri],clientInterceptorProviders:this[Oi],callInterceptors:(o=m.callOptions.interceptors)!==null&&o!==void 0?o:[],callInterceptorProviders:(l=m.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},N=(0,Js.getInterceptingCall)(O,m.methodDefinition,m.callOptions,m.channel);S.call=N;let k=!1,I=new Error;return N.start(m.metadata,{onReceiveMetadata(A){S.emit("metadata",A)},onReceiveMessage(A){S.push(A)},onReceiveStatus(A){if(!k){if(k=!0,S.push(null),A.code!==wr.Status.OK){let D=ki(I);S.emit("error",(0,jt.callErrorFromStatus)(A,D))}I=null,S.emit("status",A)}}}),N.sendMessage(n),N.halfClose(),S}makeBidiStreamRequest(e,t,i,n,s){var a,o;let l=this.checkMetadataAndOptions(n,s),c={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:i},p={metadata:l.metadata,call:new jt.ClientDuplexStreamImpl(t,i),channel:this[Rt],methodDefinition:c,callOptions:l.options};this[ar]&&(p=this[ar](p));let m=p.call,S={clientInterceptors:this[Ri],clientInterceptorProviders:this[Oi],callInterceptors:(a=p.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(o=p.callOptions.interceptor_providers)!==null&&o!==void 0?o:[]},O=(0,Js.getInterceptingCall)(S,p.methodDefinition,p.callOptions,p.channel);m.call=O;let N=!1,k=new Error;return O.start(p.metadata,{onReceiveMetadata(I){m.emit("metadata",I)},onReceiveMessage(I){m.push(I)},onReceiveStatus(I){if(!N){if(N=!0,m.push(null),I.code!==wr.Status.OK){let A=ki(k);m.emit("error",(0,jt.callErrorFromStatus)(I,A))}k=null,m.emit("status",I)}}}),m}};Xs.Client=Tc});var kc=w(Ai=>{"use strict";Object.defineProperty(Ai,"__esModule",{value:!0});Ai.loadPackageDefinition=Ai.makeClientConstructor=void 0;var bn=bc(),xS={unary:bn.Client.prototype.makeUnaryRequest,server_stream:bn.Client.prototype.makeServerStreamRequest,client_stream:bn.Client.prototype.makeClientStreamRequest,bidi:bn.Client.prototype.makeBidiStreamRequest};function Oc(r){return["__proto__","prototype","constructor"].includes(r)}function gp(r,e,t){t||(t={});class i extends bn.Client{}return Object.keys(r).forEach(n=>{if(Oc(n))return;let s=r[n],a;if(typeof n=="string"&&n.charAt(0)==="$")throw new Error("Method names cannot start with $");s.requestStream?s.responseStream?a="bidi":a="client_stream":s.responseStream?a="server_stream":a="unary";let o=s.requestSerialize,l=s.responseDeserialize,c=NS(xS[a],s.path,o,l);i.prototype[n]=c,Object.assign(i.prototype[n],s),s.originalName&&!Oc(s.originalName)&&(i.prototype[s.originalName]=i.prototype[n])}),i.service=r,i.serviceName=e,i}Ai.makeClientConstructor=gp;function NS(r,e,t,i){return function(...n){return r.call(this,e,t,i,...n)}}function IS(r){return"format"in r}function DS(r){let e={};for(let t in r)if(Object.prototype.hasOwnProperty.call(r,t)){let i=r[t],n=t.split(".");if(n.some(o=>Oc(o)))continue;let s=n[n.length-1],a=e;for(let o of n.slice(0,-1))a[o]||(a[o]={}),a=a[o];IS(i)?a[s]=i:a[s]=gp(i,s,{})}return e}Ai.loadPackageDefinition=DS});var Up=w((pk,Bp)=>{var qS=1/0,LS="[object Symbol]",FS=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,BS=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Zs="\\ud800-\\udfff",wp="\\u0300-\\u036f\\ufe20-\\ufe23",Tp="\\u20d0-\\u20f0",bp="\\u2700-\\u27bf",Rp="a-z\\xdf-\\xf6\\xf8-\\xff",US="\\xac\\xb1\\xd7\\xf7",zS="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",HS="\\u2000-\\u206f",jS=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Op="A-Z\\xc0-\\xd6\\xd8-\\xde",kp="\\ufe0e\\ufe0f",Ap=US+zS+HS+jS,Mc="['\u2019]",GS="["+Zs+"]",mp="["+Ap+"]",Qs="["+wp+Tp+"]",Mp="\\d+",WS="["+bp+"]",Pp="["+Rp+"]",xp="[^"+Zs+Ap+Mp+bp+Rp+Op+"]",Ac="\\ud83c[\\udffb-\\udfff]",$S="(?:"+Qs+"|"+Ac+")",Np="[^"+Zs+"]",Pc="(?:\\ud83c[\\udde6-\\uddff]){2}",xc="[\\ud800-\\udbff][\\udc00-\\udfff]",Mi="["+Op+"]",Ip="\\u200d",vp="(?:"+Pp+"|"+xp+")",VS="(?:"+Mi+"|"+xp+")",yp="(?:"+Mc+"(?:d|ll|m|re|s|t|ve))?",_p="(?:"+Mc+"(?:D|LL|M|RE|S|T|VE))?",Dp=$S+"?",qp="["+kp+"]?",KS="(?:"+Ip+"(?:"+[Np,Pc,xc].join("|")+")"+qp+Dp+")*",Lp=qp+Dp+KS,YS="(?:"+[WS,Pc,xc].join("|")+")"+Lp,JS="(?:"+[Np+Qs+"?",Qs,Pc,xc,GS].join("|")+")",XS=RegExp(Mc,"g"),QS=RegExp(Qs,"g"),ZS=RegExp(Ac+"(?="+Ac+")|"+JS+Lp,"g"),eE=RegExp([Mi+"?"+Pp+"+"+yp+"(?="+[mp,Mi,"$"].join("|")+")",VS+"+"+_p+"(?="+[mp,Mi+vp,"$"].join("|")+")",Mi+"?"+vp+"+"+yp,Mi+"+"+_p,Mp,YS].join("|"),"g"),tE=RegExp("["+Ip+Zs+wp+Tp+kp+"]"),rE=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,iE={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"ss"},nE=typeof global=="object"&&global&&global.Object===Object&&global,sE=typeof self=="object"&&self&&self.Object===Object&&self,aE=nE||sE||Function("return this")();function oE(r,e,t,i){var n=-1,s=r?r.length:0;for(i&&s&&(t=r[++n]);++n<s;)t=e(t,r[n],n,r);return t}function lE(r){return r.split("")}function cE(r){return r.match(FS)||[]}function uE(r){return function(e){return r?.[e]}}var hE=uE(iE);function Fp(r){return tE.test(r)}function dE(r){return rE.test(r)}function fE(r){return Fp(r)?pE(r):lE(r)}function pE(r){return r.match(ZS)||[]}function gE(r){return r.match(eE)||[]}var mE=Object.prototype,vE=mE.toString,Sp=aE.Symbol,Ep=Sp?Sp.prototype:void 0,Cp=Ep?Ep.toString:void 0;function yE(r,e,t){var i=-1,n=r.length;e<0&&(e=-e>n?0:n+e),t=t>n?n:t,t<0&&(t+=n),n=e>t?0:t-e>>>0,e>>>=0;for(var s=Array(n);++i<n;)s[i]=r[i+e];return s}function _E(r){if(typeof r=="string")return r;if(TE(r))return Cp?Cp.call(r):"";var e=r+"";return e=="0"&&1/r==-qS?"-0":e}function SE(r,e,t){var i=r.length;return t=t===void 0?i:t,!e&&t>=i?r:yE(r,e,t)}function EE(r){return function(e){e=ea(e);var t=Fp(e)?fE(e):void 0,i=t?t[0]:e.charAt(0),n=t?SE(t,1).join(""):e.slice(1);return i[r]()+n}}function CE(r){return function(e){return oE(AE(OE(e).replace(XS,"")),r,"")}}function wE(r){return!!r&&typeof r=="object"}function TE(r){return typeof r=="symbol"||wE(r)&&vE.call(r)==LS}function ea(r){return r==null?"":_E(r)}var bE=CE(function(r,e,t){return e=e.toLowerCase(),r+(t?RE(e):e)});function RE(r){return kE(ea(r).toLowerCase())}function OE(r){return r=ea(r),r&&r.replace(BS,hE).replace(QS,"")}var kE=EE("toUpperCase");function AE(r,e,t){return r=ea(r),e=t?void 0:e,e===void 0?dE(r)?gE(r):cE(r):r.match(e)||[]}Bp.exports=bE});var Nc=w((gk,zp)=>{"use strict";zp.exports=ME;function ME(r,e){for(var t=new Array(arguments.length-1),i=0,n=2,s=!0;n<arguments.length;)t[i++]=arguments[n++];return new Promise(function(o,l){t[i]=function(p){if(s)if(s=!1,p)l(p);else{for(var m=new Array(arguments.length-1),S=0;S<m.length;)m[S++]=arguments[S];o.apply(null,m)}};try{r.apply(e||null,t)}catch(c){s&&(s=!1,l(c))}})}});var Wp=w(Gp=>{"use strict";var ta=Gp;ta.length=function(e){var t=e.length;if(!t)return 0;for(var i=0;--t%4>1&&e.charAt(t)==="=";)++i;return Math.ceil(e.length*3)/4-i};var Pi=new Array(64),jp=new Array(123);for(Ot=0;Ot<64;)jp[Pi[Ot]=Ot<26?Ot+65:Ot<52?Ot+71:Ot<62?Ot-4:Ot-59|43]=Ot++;var Ot;ta.encode=function(e,t,i){for(var n=null,s=[],a=0,o=0,l;t<i;){var c=e[t++];switch(o){case 0:s[a++]=Pi[c>>2],l=(c&3)<<4,o=1;break;case 1:s[a++]=Pi[l|c>>4],l=(c&15)<<2,o=2;break;case 2:s[a++]=Pi[l|c>>6],s[a++]=Pi[c&63],o=0;break}a>8191&&((n||(n=[])).push(String.fromCharCode.apply(String,s)),a=0)}return o&&(s[a++]=Pi[l],s[a++]=61,o===1&&(s[a++]=61)),n?(a&&n.push(String.fromCharCode.apply(String,s.slice(0,a))),n.join("")):String.fromCharCode.apply(String,s.slice(0,a))};var Hp="invalid encoding";ta.decode=function(e,t,i){for(var n=i,s=0,a,o=0;o<e.length;){var l=e.charCodeAt(o++);if(l===61&&s>1)break;if((l=jp[l])===void 0)throw Error(Hp);switch(s){case 0:a=l,s=1;break;case 1:t[i++]=a<<2|(l&48)>>4,a=l,s=2;break;case 2:t[i++]=(a&15)<<4|(l&60)>>2,a=l,s=3;break;case 3:t[i++]=(a&3)<<6|l,s=0;break}}if(s===1)throw Error(Hp);return i-n};ta.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var Vp=w((vk,$p)=>{"use strict";$p.exports=ra;function ra(){this._listeners={}}ra.prototype.on=function(e,t,i){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:i||this}),this};ra.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var i=this._listeners[e],n=0;n<i.length;)i[n].fn===t?i.splice(n,1):++n;return this};ra.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var i=[],n=1;n<arguments.length;)i.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,i)}return this}});var eg=w((yk,Zp)=>{"use strict";Zp.exports=Kp(Kp);function Kp(r){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),t=new Uint8Array(e.buffer),i=t[3]===128;function n(l,c,p){e[0]=l,c[p]=t[0],c[p+1]=t[1],c[p+2]=t[2],c[p+3]=t[3]}function s(l,c,p){e[0]=l,c[p]=t[3],c[p+1]=t[2],c[p+2]=t[1],c[p+3]=t[0]}r.writeFloatLE=i?n:s,r.writeFloatBE=i?s:n;function a(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],e[0]}function o(l,c){return t[3]=l[c],t[2]=l[c+1],t[1]=l[c+2],t[0]=l[c+3],e[0]}r.readFloatLE=i?a:o,r.readFloatBE=i?o:a}():function(){function e(i,n,s,a){var o=n<0?1:0;if(o&&(n=-n),n===0)i(1/n>0?0:2147483648,s,a);else if(isNaN(n))i(2143289344,s,a);else if(n>34028234663852886e22)i((o<<31|2139095040)>>>0,s,a);else if(n<11754943508222875e-54)i((o<<31|Math.round(n/1401298464324817e-60))>>>0,s,a);else{var l=Math.floor(Math.log(n)/Math.LN2),c=Math.round(n*Math.pow(2,-l)*8388608)&8388607;i((o<<31|l+127<<23|c)>>>0,s,a)}}r.writeFloatLE=e.bind(null,Yp),r.writeFloatBE=e.bind(null,Jp);function t(i,n,s){var a=i(n,s),o=(a>>31)*2+1,l=a>>>23&255,c=a&8388607;return l===255?c?NaN:o*(1/0):l===0?o*1401298464324817e-60*c:o*Math.pow(2,l-150)*(c+8388608)}r.readFloatLE=t.bind(null,Xp),r.readFloatBE=t.bind(null,Qp)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),t=new Uint8Array(e.buffer),i=t[7]===128;function n(l,c,p){e[0]=l,c[p]=t[0],c[p+1]=t[1],c[p+2]=t[2],c[p+3]=t[3],c[p+4]=t[4],c[p+5]=t[5],c[p+6]=t[6],c[p+7]=t[7]}function s(l,c,p){e[0]=l,c[p]=t[7],c[p+1]=t[6],c[p+2]=t[5],c[p+3]=t[4],c[p+4]=t[3],c[p+5]=t[2],c[p+6]=t[1],c[p+7]=t[0]}r.writeDoubleLE=i?n:s,r.writeDoubleBE=i?s:n;function a(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],t[4]=l[c+4],t[5]=l[c+5],t[6]=l[c+6],t[7]=l[c+7],e[0]}function o(l,c){return t[7]=l[c],t[6]=l[c+1],t[5]=l[c+2],t[4]=l[c+3],t[3]=l[c+4],t[2]=l[c+5],t[1]=l[c+6],t[0]=l[c+7],e[0]}r.readDoubleLE=i?a:o,r.readDoubleBE=i?o:a}():function(){function e(i,n,s,a,o,l){var c=a<0?1:0;if(c&&(a=-a),a===0)i(0,o,l+n),i(1/a>0?0:2147483648,o,l+s);else if(isNaN(a))i(0,o,l+n),i(2146959360,o,l+s);else if(a>17976931348623157e292)i(0,o,l+n),i((c<<31|2146435072)>>>0,o,l+s);else{var p;if(a<22250738585072014e-324)p=a/5e-324,i(p>>>0,o,l+n),i((c<<31|p/4294967296)>>>0,o,l+s);else{var m=Math.floor(Math.log(a)/Math.LN2);m===1024&&(m=1023),p=a*Math.pow(2,-m),i(p*4503599627370496>>>0,o,l+n),i((c<<31|m+1023<<20|p*1048576&1048575)>>>0,o,l+s)}}}r.writeDoubleLE=e.bind(null,Yp,0,4),r.writeDoubleBE=e.bind(null,Jp,4,0);function t(i,n,s,a,o){var l=i(a,o+n),c=i(a,o+s),p=(c>>31)*2+1,m=c>>>20&2047,S=4294967296*(c&1048575)+l;return m===2047?S?NaN:p*(1/0):m===0?p*5e-324*S:p*Math.pow(2,m-1075)*(S+4503599627370496)}r.readDoubleLE=t.bind(null,Xp,0,4),r.readDoubleBE=t.bind(null,Qp,4,0)}(),r}function Yp(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}function Jp(r,e,t){e[t]=r>>>24,e[t+1]=r>>>16&255,e[t+2]=r>>>8&255,e[t+3]=r&255}function Xp(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16|r[e+3]<<24)>>>0}function Qp(r,e){return(r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3])>>>0}});var Ic=w((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(r){}return null}});var rg=w(tg=>{"use strict";var Dc=tg;Dc.length=function(e){for(var t=0,i=0,n=0;n<e.length;++n)i=e.charCodeAt(n),i<128?t+=1:i<2048?t+=2:(i&64512)===55296&&(e.charCodeAt(n+1)&64512)===56320?(++n,t+=4):t+=3;return t};Dc.read=function(e,t,i){var n=i-t;if(n<1)return"";for(var s=null,a=[],o=0,l;t<i;)l=e[t++],l<128?a[o++]=l:l>191&&l<224?a[o++]=(l&31)<<6|e[t++]&63:l>239&&l<365?(l=((l&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,a[o++]=55296+(l>>10),a[o++]=56320+(l&1023)):a[o++]=(l&15)<<12|(e[t++]&63)<<6|e[t++]&63,o>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,a)),o=0);return s?(o&&s.push(String.fromCharCode.apply(String,a.slice(0,o))),s.join("")):String.fromCharCode.apply(String,a.slice(0,o))};Dc.write=function(e,t,i){for(var n=i,s,a,o=0;o<e.length;++o)s=e.charCodeAt(o),s<128?t[i++]=s:s<2048?(t[i++]=s>>6|192,t[i++]=s&63|128):(s&64512)===55296&&((a=e.charCodeAt(o+1))&64512)===56320?(s=65536+((s&1023)<<10)+(a&1023),++o,t[i++]=s>>18|240,t[i++]=s>>12&63|128,t[i++]=s>>6&63|128,t[i++]=s&63|128):(t[i++]=s>>12|224,t[i++]=s>>6&63|128,t[i++]=s&63|128);return i-n}});var ng=w((Sk,ig)=>{"use strict";ig.exports=PE;function PE(r,e,t){var i=t||8192,n=i>>>1,s=null,a=i;return function(l){if(l<1||l>n)return r(l);a+l>i&&(s=r(i),a=0);var c=e.call(s,a,a+=l);return a&7&&(a=(a|7)+1),c}}});var ag=w((Ek,sg)=>{"use strict";sg.exports=Ue;var Rn=Gt();function Ue(r,e){this.lo=r>>>0,this.hi=e>>>0}var Qr=Ue.zero=new Ue(0,0);Qr.toNumber=function(){return 0};Qr.zzEncode=Qr.zzDecode=function(){return this};Qr.length=function(){return 1};var xE=Ue.zeroHash="\0\0\0\0\0\0\0\0";Ue.fromNumber=function(e){if(e===0)return Qr;var t=e<0;t&&(e=-e);var i=e>>>0,n=(e-i)/4294967296>>>0;return t&&(n=~n>>>0,i=~i>>>0,++i>4294967295&&(i=0,++n>4294967295&&(n=0))),new Ue(i,n)};Ue.from=function(e){if(typeof e=="number")return Ue.fromNumber(e);if(Rn.isString(e))if(Rn.Long)e=Rn.Long.fromString(e);else return Ue.fromNumber(parseInt(e,10));return e.low||e.high?new Ue(e.low>>>0,e.high>>>0):Qr};Ue.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,i=~this.hi>>>0;return t||(i=i+1>>>0),-(t+i*4294967296)}return this.lo+this.hi*4294967296};Ue.prototype.toLong=function(e){return Rn.Long?new Rn.Long(this.lo|0,this.hi|0,!!e):{low:this.lo|0,high:this.hi|0,unsigned:!!e}};var Tr=String.prototype.charCodeAt;Ue.fromHash=function(e){return e===xE?Qr:new Ue((Tr.call(e,0)|Tr.call(e,1)<<8|Tr.call(e,2)<<16|Tr.call(e,3)<<24)>>>0,(Tr.call(e,4)|Tr.call(e,5)<<8|Tr.call(e,6)<<16|Tr.call(e,7)<<24)>>>0)};Ue.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};Ue.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};Ue.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};Ue.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,i=this.hi>>>24;return i===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:i<128?9:10}});var Gt=w(qc=>{"use strict";var G=qc;G.asPromise=Nc();G.base64=Wp();G.EventEmitter=Vp();G.float=eg();G.inquire=Ic();G.utf8=rg();G.pool=ng();G.LongBits=ag();G.isNode=!!(typeof global<"u"&&global&&global.process&&global.process.versions&&global.process.versions.node);G.global=G.isNode&&global||typeof window<"u"&&window||typeof self<"u"&&self||qc;G.emptyArray=Object.freeze?Object.freeze([]):[];G.emptyObject=Object.freeze?Object.freeze({}):{};G.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};G.isString=function(e){return typeof e=="string"||e instanceof String};G.isObject=function(e){return e&&typeof e=="object"};G.isset=G.isSet=function(e,t){var i=e[t];return i!=null&&e.hasOwnProperty(t)?typeof i!="object"||(Array.isArray(i)?i.length:Object.keys(i).length)>0:!1};G.Buffer=function(){try{var r=G.inquire("buffer").Buffer;return r.prototype.utf8Write?r:null}catch{return null}}();G._Buffer_from=null;G._Buffer_allocUnsafe=null;G.newBuffer=function(e){return typeof e=="number"?G.Buffer?G._Buffer_allocUnsafe(e):new G.Array(e):G.Buffer?G._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};G.Array=typeof Uint8Array<"u"?Uint8Array:Array;G.Long=G.global.dcodeIO&&G.global.dcodeIO.Long||G.global.Long||G.inquire("long");G.key2Re=/^true|false|0|1$/;G.key32Re=/^-?(?:0|[1-9][0-9]*)$/;G.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;G.longToHash=function(e){return e?G.LongBits.from(e).toHash():G.LongBits.zeroHash};G.longFromHash=function(e,t){var i=G.LongBits.fromHash(e);return G.Long?G.Long.fromBits(i.lo,i.hi,t):i.toNumber(!!t)};function og(r,e,t){for(var i=Object.keys(e),n=0;n<i.length;++n)(r[i[n]]===void 0||!t)&&(r[i[n]]=e[i[n]]);return r}G.merge=og;G.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function lg(r){function e(t,i){if(!(this instanceof e))return new e(t,i);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),i&&og(this,i)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return r},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}G.newError=lg;G.ProtocolError=lg("ProtocolError");G.oneOfGetter=function(e){for(var t={},i=0;i<e.length;++i)t[e[i]]=1;return function(){for(var n=Object.keys(this),s=n.length-1;s>-1;--s)if(t[n[s]]===1&&this[n[s]]!==void 0&&this[n[s]]!==null)return n[s]}};G.oneOfSetter=function(e){return function(t){for(var i=0;i<e.length;++i)e[i]!==t&&delete this[e[i]]}};G.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};G._configure=function(){var r=G.Buffer;if(!r){G._Buffer_from=G._Buffer_allocUnsafe=null;return}G._Buffer_from=r.from!==Uint8Array.from&&r.from||function(t,i){return new r(t,i)},G._Buffer_allocUnsafe=r.allocUnsafe||function(t){return new r(t)}}});var na=w((wk,dg)=>{"use strict";dg.exports=ae;var pt=Gt(),Lc,ia=pt.LongBits,cg=pt.base64,ug=pt.utf8;function On(r,e,t){this.fn=r,this.len=e,this.next=void 0,this.val=t}function Bc(){}function NE(r){this.head=r.head,this.tail=r.tail,this.len=r.len,this.next=r.states}function ae(){this.len=0,this.head=new On(Bc,0,0),this.tail=this.head,this.states=null}var hg=function(){return pt.Buffer?function(){return(ae.create=function(){return new Lc})()}:function(){return new ae}};ae.create=hg();ae.alloc=function(e){return new pt.Array(e)};pt.Array!==Array&&(ae.alloc=pt.pool(ae.alloc,pt.Array.prototype.subarray));ae.prototype._push=function(e,t,i){return this.tail=this.tail.next=new On(e,t,i),this.len+=t,this};function Uc(r,e,t){e[t]=r&255}function IE(r,e,t){for(;r>127;)e[t++]=r&127|128,r>>>=7;e[t]=r}function zc(r,e){this.len=r,this.next=void 0,this.val=e}zc.prototype=Object.create(On.prototype);zc.prototype.fn=IE;ae.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new zc((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};ae.prototype.int32=function(e){return e<0?this._push(Hc,10,ia.fromNumber(e)):this.uint32(e)};ae.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function Hc(r,e,t){for(;r.hi;)e[t++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)e[t++]=r.lo&127|128,r.lo=r.lo>>>7;e[t++]=r.lo}ae.prototype.uint64=function(e){var t=ia.from(e);return this._push(Hc,t.length(),t)};ae.prototype.int64=ae.prototype.uint64;ae.prototype.sint64=function(e){var t=ia.from(e).zzEncode();return this._push(Hc,t.length(),t)};ae.prototype.bool=function(e){return this._push(Uc,1,e?1:0)};function Fc(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}ae.prototype.fixed32=function(e){return this._push(Fc,4,e>>>0)};ae.prototype.sfixed32=ae.prototype.fixed32;ae.prototype.fixed64=function(e){var t=ia.from(e);return this._push(Fc,4,t.lo)._push(Fc,4,t.hi)};ae.prototype.sfixed64=ae.prototype.fixed64;ae.prototype.float=function(e){return this._push(pt.float.writeFloatLE,4,e)};ae.prototype.double=function(e){return this._push(pt.float.writeDoubleLE,8,e)};var DE=pt.Array.prototype.set?function(e,t,i){t.set(e,i)}:function(e,t,i){for(var n=0;n<e.length;++n)t[i+n]=e[n]};ae.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(Uc,1,0);if(pt.isString(e)){var i=ae.alloc(t=cg.length(e));cg.decode(e,i,0),e=i}return this.uint32(t)._push(DE,t,e)};ae.prototype.string=function(e){var t=ug.length(e);return t?this.uint32(t)._push(ug.write,t,e):this._push(Uc,1,0)};ae.prototype.fork=function(){return this.states=new NE(this),this.head=this.tail=new On(Bc,0,0),this.len=0,this};ae.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new On(Bc,0,0),this.len=0),this};ae.prototype.ldelim=function(){var e=this.head,t=this.tail,i=this.len;return this.reset().uint32(i),i&&(this.tail.next=e.next,this.tail=t,this.len+=i),this};ae.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),i=0;e;)e.fn(e.val,t,i),i+=e.len,e=e.next;return t};ae._configure=function(r){Lc=r,ae.create=hg(),Lc._configure()}});var gg=w((Tk,pg)=>{"use strict";pg.exports=Wt;var fg=na();(Wt.prototype=Object.create(fg.prototype)).constructor=Wt;var br=Gt();function Wt(){fg.call(this)}Wt._configure=function(){Wt.alloc=br._Buffer_allocUnsafe,Wt.writeBytesBuffer=br.Buffer&&br.Buffer.prototype instanceof Uint8Array&&br.Buffer.prototype.set.name==="set"?function(e,t,i){t.set(e,i)}:function(e,t,i){if(e.copy)e.copy(t,i,0,e.length);else for(var n=0;n<e.length;)t[i++]=e[n++]}};Wt.prototype.bytes=function(e){br.isString(e)&&(e=br._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(Wt.writeBytesBuffer,t,e),this};function qE(r,e,t){r.length<40?br.utf8.write(r,e,t):e.utf8Write?e.utf8Write(r,t):e.write(r,t)}Wt.prototype.string=function(e){var t=br.Buffer.byteLength(e);return this.uint32(t),t&&this._push(qE,t,e),this};Wt._configure()});var aa=w((bk,Sg)=>{"use strict";Sg.exports=ke;var kt=Gt(),Gc,yg=kt.LongBits,LE=kt.utf8;function At(r,e){return RangeError("index out of range: "+r.pos+" + "+(e||1)+" > "+r.len)}function ke(r){this.buf=r,this.pos=0,this.len=r.length}var mg=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new ke(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new ke(e);throw Error("illegal buffer")},_g=function(){return kt.Buffer?function(t){return(ke.create=function(n){return kt.Buffer.isBuffer(n)?new Gc(n):mg(n)})(t)}:mg};ke.create=_g();ke.prototype._slice=kt.Array.prototype.subarray||kt.Array.prototype.slice;ke.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,At(this,10);return e}}();ke.prototype.int32=function(){return this.uint32()|0};ke.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function jc(){var r=new yg(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r;if(r.lo=(r.lo|(this.buf[this.pos]&127)<<28)>>>0,r.hi=(r.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return r;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw At(this);if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r}return r.lo=(r.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,r}if(this.len-this.pos>4){for(;e<5;++e)if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}else for(;e<5;++e){if(this.pos>=this.len)throw At(this);if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}throw Error("invalid varint encoding")}ke.prototype.bool=function(){return this.uint32()!==0};function sa(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}ke.prototype.fixed32=function(){if(this.pos+4>this.len)throw At(this,4);return sa(this.buf,this.pos+=4)};ke.prototype.sfixed32=function(){if(this.pos+4>this.len)throw At(this,4);return sa(this.buf,this.pos+=4)|0};function vg(){if(this.pos+8>this.len)throw At(this,8);return new yg(sa(this.buf,this.pos+=4),sa(this.buf,this.pos+=4))}ke.prototype.float=function(){if(this.pos+4>this.len)throw At(this,4);var e=kt.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};ke.prototype.double=function(){if(this.pos+8>this.len)throw At(this,4);var e=kt.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};ke.prototype.bytes=function(){var e=this.uint32(),t=this.pos,i=this.pos+e;if(i>this.len)throw At(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,i);if(t===i){var n=kt.Buffer;return n?n.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,i)};ke.prototype.string=function(){var e=this.bytes();return LE.read(e,0,e.length)};ke.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw At(this,e);this.pos+=e}else do if(this.pos>=this.len)throw At(this);while(this.buf[this.pos++]&128);return this};ke.prototype.skipType=function(r){switch(r){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(r=this.uint32()&7)!==4;)this.skipType(r);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+r+" at offset "+this.pos)}return this};ke._configure=function(r){Gc=r,ke.create=_g(),Gc._configure();var e=kt.Long?"toLong":"toNumber";kt.merge(ke.prototype,{int64:function(){return jc.call(this)[e](!1)},uint64:function(){return jc.call(this)[e](!0)},sint64:function(){return jc.call(this).zzDecode()[e](!1)},fixed64:function(){return vg.call(this)[e](!0)},sfixed64:function(){return vg.call(this)[e](!1)}})}});var Tg=w((Rk,wg)=>{"use strict";wg.exports=Zr;var Cg=aa();(Zr.prototype=Object.create(Cg.prototype)).constructor=Zr;var Eg=Gt();function Zr(r){Cg.call(this,r)}Zr._configure=function(){Eg.Buffer&&(Zr.prototype._slice=Eg.Buffer.prototype.slice)};Zr.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};Zr._configure()});var Rg=w((Ok,bg)=>{"use strict";bg.exports=kn;var Wc=Gt();(kn.prototype=Object.create(Wc.EventEmitter.prototype)).constructor=kn;function kn(r,e,t){if(typeof r!="function")throw TypeError("rpcImpl must be a function");Wc.EventEmitter.call(this),this.rpcImpl=r,this.requestDelimited=!!e,this.responseDelimited=!!t}kn.prototype.rpcCall=function r(e,t,i,n,s){if(!n)throw TypeError("request must be specified");var a=this;if(!s)return Wc.asPromise(r,a,e,t,i,n);if(!a.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return a.rpcImpl(e,t[a.requestDelimited?"encodeDelimited":"encode"](n).finish(),function(l,c){if(l)return a.emit("error",l,e),s(l);if(c===null){a.end(!0);return}if(!(c instanceof i))try{c=i[a.responseDelimited?"decodeDelimited":"decode"](c)}catch(p){return a.emit("error",p,e),s(p)}return a.emit("data",c,e),s(null,c)})}catch(o){a.emit("error",o,e),setTimeout(function(){s(o)},0);return}};kn.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var $c=w(Og=>{"use strict";var FE=Og;FE.Service=Rg()});var Vc=w((Ak,kg)=>{"use strict";kg.exports={}});var Pg=w(Mg=>{"use strict";var et=Mg;et.build="minimal";et.Writer=na();et.BufferWriter=gg();et.Reader=aa();et.BufferReader=Tg();et.util=Gt();et.rpc=$c();et.roots=Vc();et.configure=Ag;function Ag(){et.util._configure(),et.Writer._configure(et.BufferWriter),et.Reader._configure(et.BufferReader)}Ag()});var Ng=w((Pk,xg)=>{"use strict";xg.exports=Kc;function Kc(r,e){typeof r=="string"&&(e=r,r=void 0);var t=[];function i(s){if(typeof s!="string"){var a=n();if(Kc.verbose&&console.log("codegen: "+a),a="return "+a,s){for(var o=Object.keys(s),l=new Array(o.length+1),c=new Array(o.length),p=0;p<o.length;)l[p]=o[p],c[p]=s[o[p++]];return l[p]=a,Function.apply(null,l).apply(null,c)}return Function(a)()}for(var m=new Array(arguments.length-1),S=0;S<m.length;)m[S]=arguments[++S];if(S=0,s=s.replace(/%([%dfijs])/g,function(N,k){var I=m[S++];switch(k){case"d":case"f":return String(Number(I));case"i":return String(Math.floor(I));case"j":return JSON.stringify(I);case"s":return String(I)}return"%"}),S!==m.length)throw Error("parameter count mismatch");return t.push(s),i}function n(s){return"function "+(s||e||"")+"("+(r&&r.join(",")||"")+`){
  `+t.join(`
  `)+`
}`}return i.toString=n,i}Kc.verbose=!1});var Dg=w((xk,Ig)=>{"use strict";Ig.exports=An;var BE=Nc(),UE=Ic(),Yc=UE("fs");function An(r,e,t){return typeof e=="function"?(t=e,e={}):e||(e={}),t?!e.xhr&&Yc&&Yc.readFile?Yc.readFile(r,function(n,s){return n&&typeof XMLHttpRequest<"u"?An.xhr(r,e,t):n?t(n):t(null,e.binary?s:s.toString("utf8"))}):An.xhr(r,e,t):BE(An,this,r,e)}An.xhr=function(e,t,i){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState===4){if(n.status!==0&&n.status!==200)return i(Error("status "+n.status));if(t.binary){var a=n.response;if(!a){a=[];for(var o=0;o<n.responseText.length;++o)a.push(n.responseText.charCodeAt(o)&255)}return i(null,typeof Uint8Array<"u"?new Uint8Array(a):a)}return i(null,n.responseText)}},t.binary&&("overrideMimeType"in n&&n.overrideMimeType("text/plain; charset=x-user-defined"),n.responseType="arraybuffer"),n.open("GET",e),n.send()}});var Fg=w(Lg=>{"use strict";var Xc=Lg,qg=Xc.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},Jc=Xc.normalize=function(e){e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/");var t=e.split("/"),i=qg(e),n="";i&&(n=t.shift()+"/");for(var s=0;s<t.length;)t[s]===".."?s>0&&t[s-1]!==".."?t.splice(--s,2):i?t.splice(s,1):++s:t[s]==="."?t.splice(s,1):++s;return n+t.join("/")};Xc.resolve=function(e,t,i){return i||(t=Jc(t)),qg(t)?t:(i||(e=Jc(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?Jc(e+"/"+t):t)}});var ei=w(Bg=>{"use strict";var Mn=Bg,zE=ze(),HE=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function Pn(r,e){var t=0,i={};for(e|=0;t<r.length;)i[HE[t+e]]=r[t++];return i}Mn.basic=Pn([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]);Mn.defaults=Pn([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",zE.emptyArray,null]);Mn.long=Pn([0,0,0,1,1],7);Mn.mapKey=Pn([0,0,0,5,5,0,0,0,1,1,0,2],2);Mn.packed=Pn([1,5,0,0,0,5,5,0,0,0,1,1,0])});var Rr=w((Dk,Hg)=>{"use strict";Hg.exports=gt;var oa=ti();((gt.prototype=Object.create(oa.prototype)).constructor=gt).className="Field";var Ug=Mt(),zg=ei(),Pe=ze(),Qc,jE=/^required|optional|repeated$/;gt.fromJSON=function(e,t){return new gt(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)};function gt(r,e,t,i,n,s,a){if(Pe.isObject(i)?(a=n,s=i,i=n=void 0):Pe.isObject(n)&&(a=s,s=n,n=void 0),oa.call(this,r,s),!Pe.isInteger(e)||e<0)throw TypeError("id must be a non-negative integer");if(!Pe.isString(t))throw TypeError("type must be a string");if(i!==void 0&&!jE.test(i=i.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(n!==void 0&&!Pe.isString(n))throw TypeError("extend must be a string");i==="proto3_optional"&&(i="optional"),this.rule=i&&i!=="optional"?i:void 0,this.type=t,this.id=e,this.extend=n||void 0,this.required=i==="required",this.optional=!this.required,this.repeated=i==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=Pe.Long?zg.long[t]!==void 0:!1,this.bytes=t==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=a}Object.defineProperty(gt.prototype,"packed",{get:function(){return this._packed===null&&(this._packed=this.getOption("packed")!==!1),this._packed}});gt.prototype.setOption=function(e,t,i){return e==="packed"&&(this._packed=null),oa.prototype.setOption.call(this,e,t,i)};gt.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Pe.toObject(["rule",this.rule!=="optional"&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};gt.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=zg.defaults[this.type])===void 0?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof Qc?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&this.options.default!=null&&(this.typeDefault=this.options.default,this.resolvedType instanceof Ug&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&((this.options.packed===!0||this.options.packed!==void 0&&this.resolvedType&&!(this.resolvedType instanceof Ug))&&delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=Pe.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){var e;Pe.base64.test(this.typeDefault)?Pe.base64.decode(this.typeDefault,e=Pe.newBuffer(Pe.base64.length(this.typeDefault)),0):Pe.utf8.write(this.typeDefault,e=Pe.newBuffer(Pe.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=Pe.emptyObject:this.repeated?this.defaultValue=Pe.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof Qc&&(this.parent.ctor.prototype[this.name]=this.defaultValue),oa.prototype.resolve.call(this)};gt.d=function(e,t,i,n){return typeof t=="function"?t=Pe.decorateType(t).name:t&&typeof t=="object"&&(t=Pe.decorateEnum(t).name),function(a,o){Pe.decorateType(a.constructor).add(new gt(o,e,t,i,{default:n}))}};gt._configure=function(e){Qc=e}});var xi=w((qk,Wg)=>{"use strict";Wg.exports=mt;var ca=ti();((mt.prototype=Object.create(ca.prototype)).constructor=mt).className="OneOf";var jg=Rr(),la=ze();function mt(r,e,t,i){if(Array.isArray(e)||(t=e,e=void 0),ca.call(this,r,t),!(e===void 0||Array.isArray(e)))throw TypeError("fieldNames must be an Array");this.oneof=e||[],this.fieldsArray=[],this.comment=i}mt.fromJSON=function(e,t){return new mt(e,t.oneof,t.options,t.comment)};mt.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return la.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])};function Gg(r){if(r.parent)for(var e=0;e<r.fieldsArray.length;++e)r.fieldsArray[e].parent||r.parent.add(r.fieldsArray[e])}mt.prototype.add=function(e){if(!(e instanceof jg))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,Gg(this),this};mt.prototype.remove=function(e){if(!(e instanceof jg))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),t=this.oneof.indexOf(e.name),t>-1&&this.oneof.splice(t,1),e.partOf=null,this};mt.prototype.onAdd=function(e){ca.prototype.onAdd.call(this,e);for(var t=this,i=0;i<this.oneof.length;++i){var n=e.get(this.oneof[i]);n&&!n.partOf&&(n.partOf=t,t.fieldsArray.push(n))}Gg(this)};mt.prototype.onRemove=function(e){for(var t=0,i;t<this.fieldsArray.length;++t)(i=this.fieldsArray[t]).parent&&i.parent.remove(i);ca.prototype.onRemove.call(this,e)};mt.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(n,s){la.decorateType(n.constructor).add(new mt(s,e)),Object.defineProperty(n,s,{get:la.oneOfGetter(e),set:la.oneOfSetter(e)})}}});var Di=w((Lk,Yg)=>{"use strict";Yg.exports=ce;var Zc=ti();((ce.prototype=Object.create(Zc.prototype)).constructor=ce).className="Namespace";var $g=Rr(),ua=ze(),GE=xi(),Ni,xn,Ii;ce.fromJSON=function(e,t){return new ce(e,t.options).addJSON(t.nested)};function Vg(r,e){if(r&&r.length){for(var t={},i=0;i<r.length;++i)t[r[i].name]=r[i].toJSON(e);return t}}ce.arrayToJSON=Vg;ce.isReservedId=function(e,t){if(e){for(var i=0;i<e.length;++i)if(typeof e[i]!="string"&&e[i][0]<=t&&e[i][1]>t)return!0}return!1};ce.isReservedName=function(e,t){if(e){for(var i=0;i<e.length;++i)if(e[i]===t)return!0}return!1};function ce(r,e){Zc.call(this,r,e),this.nested=void 0,this._nestedArray=null}function Kg(r){return r._nestedArray=null,r}Object.defineProperty(ce.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=ua.toArray(this.nested))}});ce.prototype.toJSON=function(e){return ua.toObject(["options",this.options,"nested",Vg(this.nestedArray,e)])};ce.prototype.addJSON=function(e){var t=this;if(e)for(var i=Object.keys(e),n=0,s;n<i.length;++n)s=e[i[n]],t.add((s.fields!==void 0?Ni.fromJSON:s.values!==void 0?Ii.fromJSON:s.methods!==void 0?xn.fromJSON:s.id!==void 0?$g.fromJSON:ce.fromJSON)(i[n],s));return this};ce.prototype.get=function(e){return this.nested&&this.nested[e]||null};ce.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof Ii)return this.nested[e].values;throw Error("no such enum: "+e)};ce.prototype.add=function(e){if(!(e instanceof $g&&e.extend!==void 0||e instanceof Ni||e instanceof GE||e instanceof Ii||e instanceof xn||e instanceof ce))throw TypeError("object must be a valid nested object");if(!this.nested)this.nested={};else{var t=this.get(e.name);if(t)if(t instanceof ce&&e instanceof ce&&!(t instanceof Ni||t instanceof xn)){for(var i=t.nestedArray,n=0;n<i.length;++n)e.add(i[n]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}return this.nested[e.name]=e,e.onAdd(this),Kg(this)};ce.prototype.remove=function(e){if(!(e instanceof Zc))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),Kg(this)};ce.prototype.define=function(e,t){if(ua.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&e[0]==="")throw Error("path must be relative");for(var i=this;e.length>0;){var n=e.shift();if(i.nested&&i.nested[n]){if(i=i.nested[n],!(i instanceof ce))throw Error("path conflicts with non-namespace objects")}else i.add(i=new ce(n))}return t&&i.addJSON(t),i};ce.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof ce?e[t++].resolveAll():e[t++].resolve();return this.resolve()};ce.prototype.lookup=function(e,t,i){if(typeof t=="boolean"?(i=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),ua.isString(e)&&e.length){if(e===".")return this.root;e=e.split(".")}else if(!e.length)return this;if(e[0]==="")return this.root.lookup(e.slice(1),t);var n=this.get(e[0]);if(n){if(e.length===1){if(!t||t.indexOf(n.constructor)>-1)return n}else if(n instanceof ce&&(n=n.lookup(e.slice(1),t,!0)))return n}else for(var s=0;s<this.nestedArray.length;++s)if(this._nestedArray[s]instanceof ce&&(n=this._nestedArray[s].lookup(e,t,!0)))return n;return this.parent===null||i?null:this.parent.lookup(e,t)};ce.prototype.lookupType=function(e){var t=this.lookup(e,[Ni]);if(!t)throw Error("no such type: "+e);return t};ce.prototype.lookupEnum=function(e){var t=this.lookup(e,[Ii]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t};ce.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[Ni,Ii]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t};ce.prototype.lookupService=function(e){var t=this.lookup(e,[xn]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t};ce._configure=function(r,e,t){Ni=r,xn=e,Ii=t}});var ha=w((Fk,Jg)=>{"use strict";Jg.exports=or;var eu=Rr();((or.prototype=Object.create(eu.prototype)).constructor=or).className="MapField";var WE=ei(),Nn=ze();function or(r,e,t,i,n,s){if(eu.call(this,r,e,i,void 0,void 0,n,s),!Nn.isString(t))throw TypeError("keyType must be a string");this.keyType=t,this.resolvedKeyType=null,this.map=!0}or.fromJSON=function(e,t){return new or(e,t.id,t.keyType,t.type,t.options,t.comment)};or.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Nn.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};or.prototype.resolve=function(){if(this.resolved)return this;if(WE.mapKey[this.keyType]===void 0)throw Error("invalid key type: "+this.keyType);return eu.prototype.resolve.call(this)};or.d=function(e,t,i){return typeof i=="function"?i=Nn.decorateType(i).name:i&&typeof i=="object"&&(i=Nn.decorateEnum(i).name),function(s,a){Nn.decorateType(s.constructor).add(new or(a,e,t,i))}}});var da=w((Bk,Xg)=>{"use strict";Xg.exports=ri;var tu=ti();((ri.prototype=Object.create(tu.prototype)).constructor=ri).className="Method";var qi=ze();function ri(r,e,t,i,n,s,a,o,l){if(qi.isObject(n)?(a=n,n=s=void 0):qi.isObject(s)&&(a=s,s=void 0),!(e===void 0||qi.isString(e)))throw TypeError("type must be a string");if(!qi.isString(t))throw TypeError("requestType must be a string");if(!qi.isString(i))throw TypeError("responseType must be a string");tu.call(this,r,a),this.type=e||"rpc",this.requestType=t,this.requestStream=n?!0:void 0,this.responseType=i,this.responseStream=s?!0:void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=o,this.parsedOptions=l}ri.fromJSON=function(e,t){return new ri(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)};ri.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return qi.toObject(["type",this.type!=="rpc"&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])};ri.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),tu.prototype.resolve.call(this))}});var fa=w((Uk,Zg)=>{"use strict";Zg.exports=vt;var Or=Di();((vt.prototype=Object.create(Or.prototype)).constructor=vt).className="Service";var ru=da(),In=ze(),$E=$c();function vt(r,e){Or.call(this,r,e),this.methods={},this._methodsArray=null}vt.fromJSON=function(e,t){var i=new vt(e,t.options);if(t.methods)for(var n=Object.keys(t.methods),s=0;s<n.length;++s)i.add(ru.fromJSON(n[s],t.methods[n[s]]));return t.nested&&i.addJSON(t.nested),i.comment=t.comment,i};vt.prototype.toJSON=function(e){var t=Or.prototype.toJSON.call(this,e),i=e?!!e.keepComments:!1;return In.toObject(["options",t&&t.options||void 0,"methods",Or.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",i?this.comment:void 0])};Object.defineProperty(vt.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=In.toArray(this.methods))}});function Qg(r){return r._methodsArray=null,r}vt.prototype.get=function(e){return this.methods[e]||Or.prototype.get.call(this,e)};vt.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return Or.prototype.resolve.call(this)};vt.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof ru?(this.methods[e.name]=e,e.parent=this,Qg(this)):Or.prototype.add.call(this,e)};vt.prototype.remove=function(e){if(e instanceof ru){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,Qg(this)}return Or.prototype.remove.call(this,e)};vt.prototype.create=function(e,t,i){for(var n=new $E.Service(e,t,i),s=0,a;s<this.methodsArray.length;++s){var o=In.lcFirst((a=this._methodsArray[s]).resolve().name).replace(/[^$\w_]/g,"");n[o]=In.codegen(["r","c"],In.isReserved(o)?o+"_":o)("return this.rpcCall(m,q,s,r,c)")({m:a,q:a.resolvedRequestType.ctor,s:a.resolvedResponseType.ctor})}return n}});var pa=w((zk,em)=>{"use strict";em.exports=$t;var VE=Gt();function $t(r){if(r)for(var e=Object.keys(r),t=0;t<e.length;++t)this[e[t]]=r[e[t]]}$t.create=function(e){return this.$type.create(e)};$t.encode=function(e,t){return this.$type.encode(e,t)};$t.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)};$t.decode=function(e){return this.$type.decode(e)};$t.decodeDelimited=function(e){return this.$type.decodeDelimited(e)};$t.verify=function(e){return this.$type.verify(e)};$t.fromObject=function(e){return this.$type.fromObject(e)};$t.toObject=function(e,t){return this.$type.toObject(e,t)};$t.prototype.toJSON=function(){return this.$type.toObject(this,VE.toJSONOptions)}});var iu=w((Hk,rm)=>{"use strict";rm.exports=JE;var KE=Mt(),lr=ei(),tm=ze();function YE(r){return"missing required '"+r.name+"'"}function JE(r){var e=tm.codegen(["r","l"],r.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(r.fieldsArray.filter(function(o){return o.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");r.group&&e("if((t&7)===4)")("break"),e("switch(t>>>3){");for(var t=0;t<r.fieldsArray.length;++t){var i=r._fieldsArray[t].resolve(),n=i.resolvedType instanceof KE?"int32":i.type,s="m"+tm.safeProp(i.name);e("case %i: {",i.id),i.map?(e("if(%s===util.emptyObject)",s)("%s={}",s)("var c2 = r.uint32()+r.pos"),lr.defaults[i.keyType]!==void 0?e("k=%j",lr.defaults[i.keyType]):e("k=null"),lr.defaults[n]!==void 0?e("value=%j",lr.defaults[n]):e("value=null"),e("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",i.keyType)("case 2:"),lr.basic[n]===void 0?e("value=types[%i].decode(r,r.uint32())",t):e("value=r.%s()",n),e("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),lr.long[i.keyType]!==void 0?e('%s[typeof k==="object"?util.longToHash(k):k]=value',s):e("%s[k]=value",s)):i.repeated?(e("if(!(%s&&%s.length))",s,s)("%s=[]",s),lr.packed[n]!==void 0&&e("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,n)("}else"),lr.basic[n]===void 0?e(i.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,t):e("%s.push(r.%s())",s,n)):lr.basic[n]===void 0?e(i.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,t):e("%s=r.%s()",s,n),e("break")("}")}for(e("default:")("r.skipType(t&7)")("break")("}")("}"),t=0;t<r._fieldsArray.length;++t){var a=r._fieldsArray[t];a.required&&e("if(!m.hasOwnProperty(%j))",a.name)("throw util.ProtocolError(%j,{instance:m})",YE(a))}return e("return m")}});var au=w((jk,im)=>{"use strict";im.exports=ZE;var XE=Mt(),nu=ze();function yt(r,e){return r.name+": "+e+(r.repeated&&e!=="array"?"[]":r.map&&e!=="object"?"{k:"+r.keyType+"}":"")+" expected"}function su(r,e,t,i){if(e.resolvedType)if(e.resolvedType instanceof XE){r("switch(%s){",i)("default:")("return%j",yt(e,"enum value"));for(var n=Object.keys(e.resolvedType.values),s=0;s<n.length;++s)r("case %i:",e.resolvedType.values[n[s]]);r("break")("}")}else r("{")("var e=types[%i].verify(%s);",t,i)("if(e)")("return%j+e",e.name+".")("}");else switch(e.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":r("if(!util.isInteger(%s))",i)("return%j",yt(e,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":r("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",i,i,i,i)("return%j",yt(e,"integer|Long"));break;case"float":case"double":r('if(typeof %s!=="number")',i)("return%j",yt(e,"number"));break;case"bool":r('if(typeof %s!=="boolean")',i)("return%j",yt(e,"boolean"));break;case"string":r("if(!util.isString(%s))",i)("return%j",yt(e,"string"));break;case"bytes":r('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',i,i,i)("return%j",yt(e,"buffer"));break}return r}function QE(r,e,t){switch(e.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":r("if(!util.key32Re.test(%s))",t)("return%j",yt(e,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":r("if(!util.key64Re.test(%s))",t)("return%j",yt(e,"integer|Long key"));break;case"bool":r("if(!util.key2Re.test(%s))",t)("return%j",yt(e,"boolean key"));break}return r}function ZE(r){var e=nu.codegen(["m"],r.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),t=r.oneofsArray,i={};t.length&&e("var p={}");for(var n=0;n<r.fieldsArray.length;++n){var s=r._fieldsArray[n].resolve(),a="m"+nu.safeProp(s.name);if(s.optional&&e("if(%s!=null&&m.hasOwnProperty(%j)){",a,s.name),s.map)e("if(!util.isObject(%s))",a)("return%j",yt(s,"object"))("var k=Object.keys(%s)",a)("for(var i=0;i<k.length;++i){"),QE(e,s,"k[i]"),su(e,s,n,a+"[k[i]]")("}");else if(s.repeated)e("if(!Array.isArray(%s))",a)("return%j",yt(s,"array"))("for(var i=0;i<%s.length;++i){",a),su(e,s,n,a+"[i]")("}");else{if(s.partOf){var o=nu.safeProp(s.partOf.name);i[s.partOf.name]===1&&e("if(p%s===1)",o)("return%j",s.partOf.name+": multiple values"),i[s.partOf.name]=1,e("p%s=1",o)}su(e,s,n,a)}s.optional&&e("}")}return e("return null")}});var cu=w(sm=>{"use strict";var nm=sm,Dn=Mt(),Vt=ze();function ou(r,e,t,i){var n=!1;if(e.resolvedType)if(e.resolvedType instanceof Dn){r("switch(d%s){",i);for(var s=e.resolvedType.values,a=Object.keys(s),o=0;o<a.length;++o)s[a[o]]===e.typeDefault&&!n&&(r("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',i,i,i),e.repeated||r("break"),n=!0),r("case%j:",a[o])("case %i:",s[a[o]])("m%s=%j",i,s[a[o]])("break");r("}")}else r('if(typeof d%s!=="object")',i)("throw TypeError(%j)",e.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",i,t,i);else{var l=!1;switch(e.type){case"double":case"float":r("m%s=Number(d%s)",i,i);break;case"uint32":case"fixed32":r("m%s=d%s>>>0",i,i);break;case"int32":case"sint32":case"sfixed32":r("m%s=d%s|0",i,i);break;case"uint64":l=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":r("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",i,i,l)('else if(typeof d%s==="string")',i)("m%s=parseInt(d%s,10)",i,i)('else if(typeof d%s==="number")',i)("m%s=d%s",i,i)('else if(typeof d%s==="object")',i)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",i,i,i,l?"true":"");break;case"bytes":r('if(typeof d%s==="string")',i)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",i,i,i)("else if(d%s.length >= 0)",i)("m%s=d%s",i,i);break;case"string":r("m%s=String(d%s)",i,i);break;case"bool":r("m%s=Boolean(d%s)",i,i);break}}return r}nm.fromObject=function(e){var t=e.fieldsArray,i=Vt.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return i("return new this.ctor");i("var m=new this.ctor");for(var n=0;n<t.length;++n){var s=t[n].resolve(),a=Vt.safeProp(s.name);s.map?(i("if(d%s){",a)('if(typeof d%s!=="object")',a)("throw TypeError(%j)",s.fullName+": object expected")("m%s={}",a)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",a),ou(i,s,n,a+"[ks[i]]")("}")("}")):s.repeated?(i("if(d%s){",a)("if(!Array.isArray(d%s))",a)("throw TypeError(%j)",s.fullName+": array expected")("m%s=[]",a)("for(var i=0;i<d%s.length;++i){",a),ou(i,s,n,a+"[i]")("}")("}")):(s.resolvedType instanceof Dn||i("if(d%s!=null){",a),ou(i,s,n,a),s.resolvedType instanceof Dn||i("}"))}return i("return m")};function lu(r,e,t,i){if(e.resolvedType)e.resolvedType instanceof Dn?r("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",i,t,i,i,t,i,i):r("d%s=types[%i].toObject(m%s,o)",i,t,i);else{var n=!1;switch(e.type){case"double":case"float":r("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",i,i,i,i);break;case"uint64":n=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":r('if(typeof m%s==="number")',i)("d%s=o.longs===String?String(m%s):m%s",i,i,i)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",i,i,i,i,n?"true":"",i);break;case"bytes":r("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",i,i,i,i,i);break;default:r("d%s=m%s",i,i);break}}return r}nm.toObject=function(e){var t=e.fieldsArray.slice().sort(Vt.compareFieldsById);if(!t.length)return Vt.codegen()("return {}");for(var i=Vt.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),n=[],s=[],a=[],o=0;o<t.length;++o)t[o].partOf||(t[o].resolve().repeated?n:t[o].map?s:a).push(t[o]);if(n.length){for(i("if(o.arrays||o.defaults){"),o=0;o<n.length;++o)i("d%s=[]",Vt.safeProp(n[o].name));i("}")}if(s.length){for(i("if(o.objects||o.defaults){"),o=0;o<s.length;++o)i("d%s={}",Vt.safeProp(s[o].name));i("}")}if(a.length){for(i("if(o.defaults){"),o=0;o<a.length;++o){var l=a[o],c=Vt.safeProp(l.name);if(l.resolvedType instanceof Dn)i("d%s=o.enums===String?%j:%j",c,l.resolvedType.valuesById[l.typeDefault],l.typeDefault);else if(l.long)i("if(util.Long){")("var n=new util.Long(%i,%i,%j)",l.typeDefault.low,l.typeDefault.high,l.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",c)("}else")("d%s=o.longs===String?%j:%i",c,l.typeDefault.toString(),l.typeDefault.toNumber());else if(l.bytes){var p="["+Array.prototype.slice.call(l.typeDefault).join(",")+"]";i("if(o.bytes===String)d%s=%j",c,String.fromCharCode.apply(String,l.typeDefault))("else{")("d%s=%s",c,p)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",c,c)("}")}else i("d%s=%j",c,l.typeDefault)}i("}")}var m=!1;for(o=0;o<t.length;++o){var l=t[o],S=e._fieldsArray.indexOf(l),c=Vt.safeProp(l.name);l.map?(m||(m=!0,i("var ks2")),i("if(m%s&&(ks2=Object.keys(m%s)).length){",c,c)("d%s={}",c)("for(var j=0;j<ks2.length;++j){"),lu(i,l,S,c+"[ks2[j]]")("}")):l.repeated?(i("if(m%s&&m%s.length){",c,c)("d%s=[]",c)("for(var j=0;j<m%s.length;++j){",c),lu(i,l,S,c+"[j]")("}")):(i("if(m%s!=null&&m.hasOwnProperty(%j)){",c,l.name),lu(i,l,S,c),l.partOf&&i("if(o.oneofs)")("d%s=%j",Vt.safeProp(l.partOf.name),l.name)),i("}")}return i("return d")}});var uu=w(am=>{"use strict";var eC=am,tC=pa();eC[".google.protobuf.Any"]={fromObject:function(r){if(r&&r["@type"]){var e=r["@type"].substring(r["@type"].lastIndexOf("/")+1),t=this.lookup(e);if(t){var i=r["@type"].charAt(0)==="."?r["@type"].slice(1):r["@type"];return i.indexOf("/")===-1&&(i="/"+i),this.create({type_url:i,value:t.encode(t.fromObject(r)).finish()})}}return this.fromObject(r)},toObject:function(r,e){var t="type.googleapis.com/",i="",n="";if(e&&e.json&&r.type_url&&r.value){n=r.type_url.substring(r.type_url.lastIndexOf("/")+1),i=r.type_url.substring(0,r.type_url.lastIndexOf("/")+1);var s=this.lookup(n);s&&(r=s.decode(r.value))}if(!(r instanceof this.ctor)&&r instanceof tC){var a=r.$type.toObject(r,e),o=r.$type.fullName[0]==="."?r.$type.fullName.slice(1):r.$type.fullName;return i===""&&(i=t),n=i+o,a["@type"]=n,a}return this.toObject(r,e)}}});var va=w(($k,lm)=>{"use strict";lm.exports=me;var Pt=Di();((me.prototype=Object.create(Pt.prototype)).constructor=me).className="Type";var rC=Mt(),fu=xi(),ga=Rr(),iC=ha(),nC=fa(),hu=pa(),du=aa(),sC=na(),Ke=ze(),aC=pu(),oC=iu(),lC=au(),om=cu(),cC=uu();function me(r,e){Pt.call(this,r,e),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}Object.defineProperties(me.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var r=Object.keys(this.fields),e=0;e<r.length;++e){var t=this.fields[r[e]],i=t.id;if(this._fieldsById[i])throw Error("duplicate id "+i+" in "+this);this._fieldsById[i]=t}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=Ke.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=Ke.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=me.generateConstructor(this)())},set:function(r){var e=r.prototype;e instanceof hu||((r.prototype=new hu).constructor=r,Ke.merge(r.prototype,e)),r.$type=r.prototype.$type=this,Ke.merge(r,hu,!0),this._ctor=r;for(var t=0;t<this.fieldsArray.length;++t)this._fieldsArray[t].resolve();var i={};for(t=0;t<this.oneofsArray.length;++t)i[this._oneofsArray[t].resolve().name]={get:Ke.oneOfGetter(this._oneofsArray[t].oneof),set:Ke.oneOfSetter(this._oneofsArray[t].oneof)};t&&Object.defineProperties(r.prototype,i)}}});me.generateConstructor=function(e){for(var t=Ke.codegen(["p"],e.name),i=0,n;i<e.fieldsArray.length;++i)(n=e._fieldsArray[i]).map?t("this%s={}",Ke.safeProp(n.name)):n.repeated&&t("this%s=[]",Ke.safeProp(n.name));return t("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")};function ma(r){return r._fieldsById=r._fieldsArray=r._oneofsArray=null,delete r.encode,delete r.decode,delete r.verify,r}me.fromJSON=function(e,t){var i=new me(e,t.options);i.extensions=t.extensions,i.reserved=t.reserved;for(var n=Object.keys(t.fields),s=0;s<n.length;++s)i.add((typeof t.fields[n[s]].keyType<"u"?iC.fromJSON:ga.fromJSON)(n[s],t.fields[n[s]]));if(t.oneofs)for(n=Object.keys(t.oneofs),s=0;s<n.length;++s)i.add(fu.fromJSON(n[s],t.oneofs[n[s]]));if(t.nested)for(n=Object.keys(t.nested),s=0;s<n.length;++s){var a=t.nested[n[s]];i.add((a.id!==void 0?ga.fromJSON:a.fields!==void 0?me.fromJSON:a.values!==void 0?rC.fromJSON:a.methods!==void 0?nC.fromJSON:Pt.fromJSON)(n[s],a))}return t.extensions&&t.extensions.length&&(i.extensions=t.extensions),t.reserved&&t.reserved.length&&(i.reserved=t.reserved),t.group&&(i.group=!0),t.comment&&(i.comment=t.comment),i};me.prototype.toJSON=function(e){var t=Pt.prototype.toJSON.call(this,e),i=e?!!e.keepComments:!1;return Ke.toObject(["options",t&&t.options||void 0,"oneofs",Pt.arrayToJSON(this.oneofsArray,e),"fields",Pt.arrayToJSON(this.fieldsArray.filter(function(n){return!n.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",i?this.comment:void 0])};me.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var i=this.oneofsArray;for(t=0;t<i.length;)i[t++].resolve();return Pt.prototype.resolveAll.call(this)};me.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null};me.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof ga&&e.extend===void 0){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),ma(this)}return e instanceof fu?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),ma(this)):Pt.prototype.add.call(this,e)};me.prototype.remove=function(e){if(e instanceof ga&&e.extend===void 0){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),ma(this)}if(e instanceof fu){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),ma(this)}return Pt.prototype.remove.call(this,e)};me.prototype.isReservedId=function(e){return Pt.isReservedId(this.reserved,e)};me.prototype.isReservedName=function(e){return Pt.isReservedName(this.reserved,e)};me.prototype.create=function(e){return new this.ctor(e)};me.prototype.setup=function(){for(var e=this.fullName,t=[],i=0;i<this.fieldsArray.length;++i)t.push(this._fieldsArray[i].resolve().resolvedType);this.encode=aC(this)({Writer:sC,types:t,util:Ke}),this.decode=oC(this)({Reader:du,types:t,util:Ke}),this.verify=lC(this)({types:t,util:Ke}),this.fromObject=om.fromObject(this)({types:t,util:Ke}),this.toObject=om.toObject(this)({types:t,util:Ke});var n=cC[e];if(n){var s=Object.create(this);s.fromObject=this.fromObject,this.fromObject=n.fromObject.bind(s),s.toObject=this.toObject,this.toObject=n.toObject.bind(s)}return this};me.prototype.encode=function(e,t){return this.setup().encode(e,t)};me.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()};me.prototype.decode=function(e,t){return this.setup().decode(e,t)};me.prototype.decodeDelimited=function(e){return e instanceof du||(e=du.create(e)),this.decode(e,e.uint32())};me.prototype.verify=function(e){return this.setup().verify(e)};me.prototype.fromObject=function(e){return this.setup().fromObject(e)};me.prototype.toObject=function(e,t){return this.setup().toObject(e,t)};me.d=function(e){return function(i){Ke.decorateType(i,e)}}});var Sa=w((Vk,fm)=>{"use strict";fm.exports=it;var _a=Di();((it.prototype=Object.create(_a.prototype)).constructor=it).className="Root";var mu=Rr(),um=Mt(),uC=xi(),kr=ze(),hm,gu,qn;function it(r){_a.call(this,"",r),this.deferred=[],this.files=[]}it.fromJSON=function(e,t){return t||(t=new it),e.options&&t.setOptions(e.options),t.addJSON(e.nested)};it.prototype.resolvePath=kr.path.resolve;it.prototype.fetch=kr.fetch;function dm(){}it.prototype.load=function r(e,t,i){typeof t=="function"&&(i=t,t=void 0);var n=this;if(!i)return kr.asPromise(r,n,e,t);var s=i===dm;function a(O,N){if(i){if(s)throw O;var k=i;i=null,k(O,N)}}function o(O){var N=O.lastIndexOf("google/protobuf/");if(N>-1){var k=O.substring(N);if(k in qn)return k}return null}function l(O,N){try{if(kr.isString(N)&&N.charAt(0)==="{"&&(N=JSON.parse(N)),!kr.isString(N))n.setOptions(N.options).addJSON(N.nested);else{gu.filename=O;var k=gu(N,n,t),I,A=0;if(k.imports)for(;A<k.imports.length;++A)(I=o(k.imports[A])||n.resolvePath(O,k.imports[A]))&&c(I);if(k.weakImports)for(A=0;A<k.weakImports.length;++A)(I=o(k.weakImports[A])||n.resolvePath(O,k.weakImports[A]))&&c(I,!0)}}catch(D){a(D)}!s&&!p&&a(null,n)}function c(O,N){if(O=o(O)||O,!(n.files.indexOf(O)>-1)){if(n.files.push(O),O in qn){s?l(O,qn[O]):(++p,setTimeout(function(){--p,l(O,qn[O])}));return}if(s){var k;try{k=kr.fs.readFileSync(O).toString("utf8")}catch(I){N||a(I);return}l(O,k)}else++p,n.fetch(O,function(I,A){if(--p,!!i){if(I){N?p||a(null,n):a(I);return}l(O,A)}})}}var p=0;kr.isString(e)&&(e=[e]);for(var m=0,S;m<e.length;++m)(S=n.resolvePath("",e[m]))&&c(S);if(s)return n;p||a(null,n)};it.prototype.loadSync=function(e,t){if(!kr.isNode)throw Error("not supported");return this.load(e,t,dm)};it.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return _a.prototype.resolveAll.call(this)};var ya=/^[A-Z]/;function cm(r,e){var t=e.parent.lookup(e.extend);if(t){var i=new mu(e.fullName,e.id,e.type,e.rule,void 0,e.options);return t.get(i.name)||(i.declaringField=e,e.extensionField=i,t.add(i)),!0}return!1}it.prototype._handleAdd=function(e){if(e instanceof mu)e.extend!==void 0&&!e.extensionField&&(cm(this,e)||this.deferred.push(e));else if(e instanceof um)ya.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof uC)){if(e instanceof hm)for(var t=0;t<this.deferred.length;)cm(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var i=0;i<e.nestedArray.length;++i)this._handleAdd(e._nestedArray[i]);ya.test(e.name)&&(e.parent[e.name]=e)}};it.prototype._handleRemove=function(e){if(e instanceof mu){if(e.extend!==void 0)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof um)ya.test(e.name)&&delete e.parent[e.name];else if(e instanceof _a){for(var i=0;i<e.nestedArray.length;++i)this._handleRemove(e._nestedArray[i]);ya.test(e.name)&&delete e.parent[e.name]}};it._configure=function(r,e,t){hm=r,gu=e,qn=t}});var ze=w((Kk,gm)=>{"use strict";var Ae=gm.exports=Gt(),pm=Vc(),vu,yu;Ae.codegen=Ng();Ae.fetch=Dg();Ae.path=Fg();Ae.fs=Ae.inquire("fs");Ae.toArray=function(e){if(e){for(var t=Object.keys(e),i=new Array(t.length),n=0;n<t.length;)i[n]=e[t[n++]];return i}return[]};Ae.toObject=function(e){for(var t={},i=0;i<e.length;){var n=e[i++],s=e[i++];s!==void 0&&(t[n]=s)}return t};var hC=/\\/g,dC=/"/g;Ae.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)};Ae.safeProp=function(e){return!/^[$\w_]+$/.test(e)||Ae.isReserved(e)?'["'+e.replace(hC,"\\\\").replace(dC,'\\"')+'"]':"."+e};Ae.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var fC=/_([a-z])/g;Ae.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(fC,function(t,i){return i.toUpperCase()})};Ae.compareFieldsById=function(e,t){return e.id-t.id};Ae.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(Ae.decorateRoot.remove(e.$type),e.$type.name=t,Ae.decorateRoot.add(e.$type)),e.$type;vu||(vu=va());var i=new vu(t||e.name);return Ae.decorateRoot.add(i),i.ctor=e,Object.defineProperty(e,"$type",{value:i,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:i,enumerable:!1}),i};var pC=0;Ae.decorateEnum=function(e){if(e.$type)return e.$type;yu||(yu=Mt());var t=new yu("Enum"+pC++,e);return Ae.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t};Ae.setProperty=function(e,t,i){function n(s,a,o){var l=a.shift();if(l==="__proto__"||l==="prototype")return s;if(a.length>0)s[l]=n(s[l]||{},a,o);else{var c=s[l];c&&(o=[].concat(c).concat(o)),s[l]=o}return s}if(typeof e!="object")throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return t=t.split("."),n(e,t,i)};Object.defineProperty(Ae,"decorateRoot",{get:function(){return pm.decorated||(pm.decorated=new(Sa()))}})});var ti=w((Yk,mm)=>{"use strict";mm.exports=nt;nt.className="ReflectionObject";var Ea=ze(),Ca;function nt(r,e){if(!Ea.isString(r))throw TypeError("name must be a string");if(e&&!Ea.isObject(e))throw TypeError("options must be an object");this.options=e,this.parsedOptions=null,this.name=r,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(nt.prototype,{root:{get:function(){for(var r=this;r.parent!==null;)r=r.parent;return r}},fullName:{get:function(){for(var r=[this.name],e=this.parent;e;)r.unshift(e.name),e=e.parent;return r.join(".")}}});nt.prototype.toJSON=function(){throw Error()};nt.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof Ca&&t._handleAdd(this)};nt.prototype.onRemove=function(e){var t=e.root;t instanceof Ca&&t._handleRemove(this),this.parent=null,this.resolved=!1};nt.prototype.resolve=function(){return this.resolved?this:(this.root instanceof Ca&&(this.resolved=!0),this)};nt.prototype.getOption=function(e){if(this.options)return this.options[e]};nt.prototype.setOption=function(e,t,i){return(!i||!this.options||this.options[e]===void 0)&&((this.options||(this.options={}))[e]=t),this};nt.prototype.setParsedOption=function(e,t,i){this.parsedOptions||(this.parsedOptions=[]);var n=this.parsedOptions;if(i){var s=n.find(function(l){return Object.prototype.hasOwnProperty.call(l,e)});if(s){var a=s[e];Ea.setProperty(a,i,t)}else s={},s[e]=Ea.setProperty({},i,t),n.push(s)}else{var o={};o[e]=t,n.push(o)}return this};nt.prototype.setOptions=function(e,t){if(e)for(var i=Object.keys(e),n=0;n<i.length;++n)this.setOption(i[n],e[i[n]],t);return this};nt.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e};nt._configure=function(r){Ca=r}});var Mt=w((Jk,_m)=>{"use strict";_m.exports=Kt;var vm=ti();((Kt.prototype=Object.create(vm.prototype)).constructor=Kt).className="Enum";var ym=Di(),wa=ze();function Kt(r,e,t,i,n,s){if(vm.call(this,r,t),e&&typeof e!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=i,this.comments=n||{},this.valuesOptions=s,this.reserved=void 0,e)for(var a=Object.keys(e),o=0;o<a.length;++o)typeof e[a[o]]=="number"&&(this.valuesById[this.values[a[o]]=e[a[o]]]=a[o])}Kt.fromJSON=function(e,t){var i=new Kt(e,t.values,t.options,t.comment,t.comments);return i.reserved=t.reserved,i};Kt.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return wa.toObject(["options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])};Kt.prototype.add=function(e,t,i,n){if(!wa.isString(e))throw TypeError("name must be a string");if(!wa.isInteger(t))throw TypeError("id must be an integer");if(this.values[e]!==void 0)throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(this.valuesById[t]!==void 0){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return n&&(this.valuesOptions===void 0&&(this.valuesOptions={}),this.valuesOptions[e]=n||null),this.comments[e]=i||null,this};Kt.prototype.remove=function(e){if(!wa.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(t==null)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this};Kt.prototype.isReservedId=function(e){return ym.isReservedId(this.reserved,e)};Kt.prototype.isReservedName=function(e){return ym.isReservedName(this.reserved,e)}});var pu=w((Xk,Em)=>{"use strict";Em.exports=mC;var gC=Mt(),_u=ei(),Su=ze();function Sm(r,e,t,i){return e.resolvedType.group?r("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",t,i,(e.id<<3|3)>>>0,(e.id<<3|4)>>>0):r("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",t,i,(e.id<<3|2)>>>0)}function mC(r){for(var e=Su.codegen(["m","w"],r.name+"$encode")("if(!w)")("w=Writer.create()"),t,i,n=r.fieldsArray.slice().sort(Su.compareFieldsById),t=0;t<n.length;++t){var s=n[t].resolve(),a=r._fieldsArray.indexOf(s),o=s.resolvedType instanceof gC?"int32":s.type,l=_u.basic[o];i="m"+Su.safeProp(s.name),s.map?(e("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",i,s.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",i)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(s.id<<3|2)>>>0,8|_u.mapKey[s.keyType],s.keyType),l===void 0?e("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",a,i):e(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|l,o,i),e("}")("}")):s.repeated?(e("if(%s!=null&&%s.length){",i,i),s.packed&&_u.packed[o]!==void 0?e("w.uint32(%i).fork()",(s.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",i)("w.%s(%s[i])",o,i)("w.ldelim()"):(e("for(var i=0;i<%s.length;++i)",i),l===void 0?Sm(e,s,a,i+"[i]"):e("w.uint32(%i).%s(%s[i])",(s.id<<3|l)>>>0,o,i)),e("}")):(s.optional&&e("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",i,s.name),l===void 0?Sm(e,s,a,i):e("w.uint32(%i).%s(%s)",(s.id<<3|l)>>>0,o,i))}return e("return w")}});var wm=w((Qk,Cm)=>{"use strict";var ie=Cm.exports=Pg();ie.build="light";function vC(r,e,t){return typeof e=="function"?(t=e,e=new ie.Root):e||(e=new ie.Root),e.load(r,t)}ie.load=vC;function yC(r,e){return e||(e=new ie.Root),e.loadSync(r)}ie.loadSync=yC;ie.encoder=pu();ie.decoder=iu();ie.verifier=au();ie.converter=cu();ie.ReflectionObject=ti();ie.Namespace=Di();ie.Root=Sa();ie.Enum=Mt();ie.Type=va();ie.Field=Rr();ie.OneOf=xi();ie.MapField=ha();ie.Service=fa();ie.Method=da();ie.Message=pa();ie.wrappers=uu();ie.types=ei();ie.util=ze();ie.ReflectionObject._configure(ie.Root);ie.Namespace._configure(ie.Type,ie.Service,ie.Enum);ie.Root._configure(ie.Type);ie.Field._configure(ie.Type)});var Cu=w((Zk,Rm)=>{"use strict";Rm.exports=bm;var Eu=/[\s{}=;:[\],'"()<>]/g,_C=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,SC=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,EC=/^ *[*/]+ */,CC=/^\s*\*?\/*/,wC=/\n/g,TC=/\s/,bC=/\\(.?)/g,RC={0:"\0",r:"\r",n:`
`,t:"	"};function Tm(r){return r.replace(bC,function(e,t){switch(t){case"\\":case"":return t;default:return RC[t]||""}})}bm.unescape=Tm;function bm(r,e){r=r.toString();var t=0,i=r.length,n=1,s=0,a={},o=[],l=null;function c(L){return Error("illegal "+L+" (line "+n+")")}function p(){var L=l==="'"?SC:_C;L.lastIndex=t-1;var U=L.exec(r);if(!U)throw c("string");return t=L.lastIndex,I(l),l=null,Tm(U[1])}function m(L){return r.charAt(L)}function S(L,U,F){var V={type:r.charAt(L++),lineEmpty:!1,leading:F},Q;e?Q=2:Q=3;var q=L-Q,Y;do if(--q<0||(Y=r.charAt(q))===`
`){V.lineEmpty=!0;break}while(Y===" "||Y==="	");for(var R=r.substring(L,U).split(wC),J=0;J<R.length;++J)R[J]=R[J].replace(e?CC:EC,"").trim();V.text=R.join(`
`).trim(),a[n]=V,s=n}function O(L){var U=N(L),F=r.substring(L,U),V=/^\s*\/\//.test(F);return V}function N(L){for(var U=L;U<i&&m(U)!==`
`;)U++;return U}function k(){if(o.length>0)return o.shift();if(l)return p();var L,U,F,V,Q,q=t===0;do{if(t===i)return null;for(L=!1;TC.test(F=m(t));)if(F===`
`&&(q=!0,++n),++t===i)return null;if(m(t)==="/"){if(++t===i)throw c("comment");if(m(t)==="/")if(e){if(V=t,Q=!1,O(t-1)){Q=!0;do if(t=N(t),t===i||(t++,!q))break;while(O(t))}else t=Math.min(i,N(t)+1);Q&&(S(V,t,q),q=!0),n++,L=!0}else{for(Q=m(V=t+1)==="/";m(++t)!==`
`;)if(t===i)return null;++t,Q&&(S(V,t-1,q),q=!0),++n,L=!0}else if((F=m(t))==="*"){V=t+1,Q=e||m(V)==="*";do{if(F===`
`&&++n,++t===i)throw c("comment");U=F,F=m(t)}while(U!=="*"||F!=="/");++t,Q&&(S(V,t-2,q),q=!0),L=!0}else return"/"}}while(L);var Y=t;Eu.lastIndex=0;var R=Eu.test(m(Y++));if(!R)for(;Y<i&&!Eu.test(m(Y));)++Y;var J=r.substring(t,t=Y);return(J==='"'||J==="'")&&(l=J),J}function I(L){o.push(L)}function A(){if(!o.length){var L=k();if(L===null)return null;I(L)}return o[0]}function D(L,U){var F=A(),V=F===L;if(V)return k(),!0;if(!U)throw c("token '"+F+"', '"+L+"' expected");return!1}function j(L){var U=null,F;return L===void 0?(F=a[n-1],delete a[n-1],F&&(e||F.type==="*"||F.lineEmpty)&&(U=F.leading?F.text:null)):(s<L&&A(),F=a[L],delete a[L],F&&!F.lineEmpty&&(e||F.type==="/")&&(U=F.leading?null:F.text)),U}return Object.defineProperty({next:k,peek:A,push:I,skip:D,cmnt:j},"line",{get:function(){return n}})}});var xm=w((eA,Pm)=>{"use strict";Pm.exports=cr;cr.filename=null;cr.defaults={keepCase:!1};var OC=Cu(),Om=Sa(),km=va(),Am=Rr(),kC=ha(),Mm=xi(),AC=Mt(),MC=fa(),PC=da(),wu=ei(),Tu=ze(),xC=/^[1-9][0-9]*$/,NC=/^-?[1-9][0-9]*$/,IC=/^0[x][0-9a-fA-F]+$/,DC=/^-?0[x][0-9a-fA-F]+$/,qC=/^0[0-7]+$/,LC=/^-?0[0-7]+$/,FC=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,Yt=/^[a-zA-Z_][a-zA-Z_0-9]*$/,Jt=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,BC=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function cr(r,e,t){e instanceof Om||(t=e,e=new Om),t||(t=cr.defaults);var i=t.preferTrailingComment||!1,n=OC(r,t.alternateCommentMode||!1),s=n.next,a=n.push,o=n.peek,l=n.skip,c=n.cmnt,p=!0,m,S,O,N,k=!1,I=e,A=t.keepCase?function(u){return u}:Tu.camelCase;function D(u,h,d){var v=cr.filename;return d||(cr.filename=null),Error("illegal "+(h||"token")+" '"+u+"' ("+(v?v+", ":"")+"line "+n.line+")")}function j(){var u=[],h;do{if((h=s())!=='"'&&h!=="'")throw D(h);u.push(s()),l(h),h=o()}while(h==='"'||h==="'");return u.join("")}function L(u){var h=s();switch(h){case"'":case'"':return a(h),j();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return F(h,!0)}catch{if(u&&Jt.test(h))return h;throw D(h,"value")}}function U(u,h){var d,v;do h&&((d=o())==='"'||d==="'")?u.push(j()):u.push([v=V(s()),l("to",!0)?V(s()):v]);while(l(",",!0));var g={options:void 0};g.setOption=function(y,C){this.options===void 0&&(this.options={}),this.options[y]=C},J(g,function(C){if(C==="option")he(g,C),l(";");else throw D(C)},function(){Oe(g)})}function F(u,h){var d=1;switch(u.charAt(0)==="-"&&(d=-1,u=u.substring(1)),u){case"inf":case"INF":case"Inf":return d*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(xC.test(u))return d*parseInt(u,10);if(IC.test(u))return d*parseInt(u,16);if(qC.test(u))return d*parseInt(u,8);if(FC.test(u))return d*parseFloat(u);throw D(u,"number",h)}function V(u,h){switch(u){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!h&&u.charAt(0)==="-")throw D(u,"id");if(NC.test(u))return parseInt(u,10);if(DC.test(u))return parseInt(u,16);if(LC.test(u))return parseInt(u,8);throw D(u,"id")}function Q(){if(m!==void 0)throw D("package");if(m=s(),!Jt.test(m))throw D(m,"name");I=I.define(m),l(";")}function q(){var u=o(),h;switch(u){case"weak":h=O||(O=[]),s();break;case"public":s();default:h=S||(S=[]);break}u=j(),l(";"),h.push(u)}function Y(){if(l("="),N=j(),k=N==="proto3",!k&&N!=="proto2")throw D(N,"syntax");l(";")}function R(u,h){switch(h){case"option":return he(u,h),l(";"),!0;case"message":return M(u,h),!0;case"enum":return te(u,h),!0;case"service":return Ce(u,h),!0;case"extend":return Ie(u,h),!0}return!1}function J(u,h,d){var v=n.line;if(u&&(typeof u.comment!="string"&&(u.comment=c()),u.filename=cr.filename),l("{",!0)){for(var g;(g=s())!=="}";)h(g);l(";",!0)}else d&&d(),l(";"),u&&(typeof u.comment!="string"||i)&&(u.comment=c(v)||u.comment)}function M(u,h){if(!Yt.test(h=s()))throw D(h,"type name");var d=new km(h);J(d,function(g){if(!R(d,g))switch(g){case"map":X(d,g);break;case"required":case"repeated":f(d,g);break;case"optional":k?f(d,"proto3_optional"):f(d,"optional");break;case"oneof":oe(d,g);break;case"extensions":U(d.extensions||(d.extensions=[]));break;case"reserved":U(d.reserved||(d.reserved=[]),!0);break;default:if(!k||!Jt.test(g))throw D(g);a(g),f(d,"optional");break}}),u.add(d)}function f(u,h,d){var v=s();if(v==="group"){z(u,h);return}for(;v.endsWith(".")||o().startsWith(".");)v+=s();if(!Jt.test(v))throw D(v,"type");var g=s();if(!Yt.test(g))throw D(g,"name");g=A(g),l("=");var y=new Am(g,V(s()),v,h,d);if(J(y,function(E){if(E==="option")he(y,E),l(";");else throw D(E)},function(){Oe(y)}),h==="proto3_optional"){var C=new Mm("_"+g);y.setOption("proto3_optional",!0),C.add(y),u.add(C)}else u.add(y);!k&&y.repeated&&(wu.packed[v]!==void 0||wu.basic[v]===void 0)&&y.setOption("packed",!1,!0)}function z(u,h){var d=s();if(!Yt.test(d))throw D(d,"name");var v=Tu.lcFirst(d);d===v&&(d=Tu.ucFirst(d)),l("=");var g=V(s()),y=new km(d);y.group=!0;var C=new Am(v,g,d,h);C.filename=cr.filename,J(y,function(E){switch(E){case"option":he(y,E),l(";");break;case"required":case"repeated":f(y,E);break;case"optional":k?f(y,"proto3_optional"):f(y,"optional");break;case"message":M(y,E);break;case"enum":te(y,E);break;default:throw D(E)}}),u.add(y).add(C)}function X(u){l("<");var h=s();if(wu.mapKey[h]===void 0)throw D(h,"type");l(",");var d=s();if(!Jt.test(d))throw D(d,"type");l(">");var v=s();if(!Yt.test(v))throw D(v,"name");l("=");var g=new kC(A(v),V(s()),h,d);J(g,function(C){if(C==="option")he(g,C),l(";");else throw D(C)},function(){Oe(g)}),u.add(g)}function oe(u,h){if(!Yt.test(h=s()))throw D(h,"name");var d=new Mm(A(h));J(d,function(g){g==="option"?(he(d,g),l(";")):(a(g),f(d,"optional"))}),u.add(d)}function te(u,h){if(!Yt.test(h=s()))throw D(h,"name");var d=new AC(h);J(d,function(g){switch(g){case"option":he(d,g),l(";");break;case"reserved":U(d.reserved||(d.reserved=[]),!0);break;default:ue(d,g)}}),u.add(d)}function ue(u,h){if(!Yt.test(h))throw D(h,"name");l("=");var d=V(s(),!0),v={options:void 0};v.setOption=function(g,y){this.options===void 0&&(this.options={}),this.options[g]=y},J(v,function(y){if(y==="option")he(v,y),l(";");else throw D(y)},function(){Oe(v)}),u.add(h,d,v.comment,v.options)}function he(u,h){var d=l("(",!0);if(!Jt.test(h=s()))throw D(h,"name");var v=h,g=v,y;d&&(l(")"),v="("+v+")",g=v,h=o(),BC.test(h)&&(y=h.slice(1),v+=h,s())),l("=");var C=Ee(u,v);P(u,g,C,y)}function Ee(u,h){if(l("{",!0)){for(var d={};!l("}",!0);){if(!Yt.test(ge=s()))throw D(ge,"name");if(ge===null)throw D(ge,"end of input");var v,g=ge;if(l(":",!0),o()==="{")v=Ee(u,h+"."+ge);else if(o()==="["){v=[];var y;if(l("[",!0)){do y=L(!0),v.push(y);while(l(",",!0));l("]"),typeof y<"u"&&_e(u,h+"."+ge,y)}}else v=L(!0),_e(u,h+"."+ge,v);var C=d[g];C&&(v=[].concat(C).concat(v)),d[g]=v,l(",",!0),l(";",!0)}return d}var _=L(!0);return _e(u,h,_),_}function _e(u,h,d){u.setOption&&u.setOption(h,d)}function P(u,h,d,v){u.setParsedOption&&u.setParsedOption(h,d,v)}function Oe(u){if(l("[",!0)){do he(u,"option");while(l(",",!0));l("]")}return u}function Ce(u,h){if(!Yt.test(h=s()))throw D(h,"service name");var d=new MC(h);J(d,function(g){if(!R(d,g))if(g==="rpc")Ne(d,g);else throw D(g)}),u.add(d)}function Ne(u,h){var d=c(),v=h;if(!Yt.test(h=s()))throw D(h,"name");var g=h,y,C,_,E;if(l("("),l("stream",!0)&&(C=!0),!Jt.test(h=s())||(y=h,l(")"),l("returns"),l("("),l("stream",!0)&&(E=!0),!Jt.test(h=s())))throw D(h);_=h,l(")");var b=new PC(g,v,y,_,C,E);b.comment=d,J(b,function(x){if(x==="option")he(b,x),l(";");else throw D(x)}),u.add(b)}function Ie(u,h){if(!Jt.test(h=s()))throw D(h,"reference");var d=h;J(null,function(g){switch(g){case"required":case"repeated":f(u,g,d);break;case"optional":k?f(u,"proto3_optional",d):f(u,"optional",d);break;default:if(!k||!Jt.test(g))throw D(g);a(g),f(u,"optional",d);break}})}for(var ge;(ge=s())!==null;)switch(ge){case"package":if(!p)throw D(ge);Q();break;case"import":if(!p)throw D(ge);q();break;case"syntax":if(!p)throw D(ge);Y();break;case"option":he(I,ge),l(";");break;default:if(R(I,ge)){p=!1;continue}throw D(ge)}return cr.filename=null,{package:m,imports:S,weakImports:O,syntax:N,root:e}}});var Dm=w((tA,Im)=>{"use strict";Im.exports=xt;var UC=/\/|\./;function xt(r,e){UC.test(r)||(r="google/protobuf/"+r+".proto",e={nested:{google:{nested:{protobuf:{nested:e}}}}}),xt[r]=e}xt("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}});var Nm;xt("duration",{Duration:Nm={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}});xt("timestamp",{Timestamp:Nm});xt("empty",{Empty:{fields:{}}});xt("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}});xt("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}});xt("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}});xt.get=function(e){return xt[e]||null}});var Lm=w((rA,qm)=>{"use strict";var Ar=qm.exports=wm();Ar.build="full";Ar.tokenize=Cu();Ar.parse=xm();Ar.common=Dm();Ar.Root._configure(Ar.Type,Ar.parse,Ar.common)});var Ta=w((iA,Fm)=>{"use strict";Fm.exports=Lm()});var bu=w((nA,zC)=>{zC.exports={nested:{google:{nested:{protobuf:{nested:{FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}}}}}}}}});var jm=w((Z,Hm)=>{"use strict";var Qe=Ta();Hm.exports=Z=Qe.descriptor=Qe.Root.fromJSON(bu()).lookup(".google.protobuf");var Bm=Qe.Namespace,Ln=Qe.Root,ur=Qe.Enum,Mr=Qe.Type,Pr=Qe.Field,HC=Qe.MapField,ba=Qe.OneOf,Fn=Qe.Service,Ra=Qe.Method;Ln.fromDescriptor=function(e){typeof e.length=="number"&&(e=Z.FileDescriptorSet.decode(e));var t=new Ln;if(e.file)for(var i,n,s=0,a;s<e.file.length;++s){if(n=t,(i=e.file[s]).package&&i.package.length&&(n=t.define(i.package)),i.name&&i.name.length&&t.files.push(n.filename=i.name),i.messageType)for(a=0;a<i.messageType.length;++a)n.add(Mr.fromDescriptor(i.messageType[a],i.syntax));if(i.enumType)for(a=0;a<i.enumType.length;++a)n.add(ur.fromDescriptor(i.enumType[a]));if(i.extension)for(a=0;a<i.extension.length;++a)n.add(Pr.fromDescriptor(i.extension[a]));if(i.service)for(a=0;a<i.service.length;++a)n.add(Fn.fromDescriptor(i.service[a]));var o=Li(i.options,Z.FileOptions);if(o){var l=Object.keys(o);for(a=0;a<l.length;++a)n.setOption(l[a],o[l[a]])}}return t};Ln.prototype.toDescriptor=function(e){var t=Z.FileDescriptorSet.create();return Um(this,t.file,e),t};function Um(r,e,t){var i=Z.FileDescriptorProto.create({name:r.filename||(r.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});t&&(i.syntax=t),r instanceof Ln||(i.package=r.fullName.substring(1));for(var n=0,s;n<r.nestedArray.length;++n)(s=r._nestedArray[n])instanceof Mr?i.messageType.push(s.toDescriptor(t)):s instanceof ur?i.enumType.push(s.toDescriptor()):s instanceof Pr?i.extension.push(s.toDescriptor(t)):s instanceof Fn?i.service.push(s.toDescriptor()):s instanceof Bm&&Um(s,e,t);i.options=Fi(r.options,Z.FileOptions),i.messageType.length+i.enumType.length+i.extension.length+i.service.length&&e.push(i)}var jC=0;Mr.fromDescriptor=function(e,t){typeof e.length=="number"&&(e=Z.DescriptorProto.decode(e));var i=new Mr(e.name.length?e.name:"Type"+jC++,Li(e.options,Z.MessageOptions)),n;if(e.oneofDecl)for(n=0;n<e.oneofDecl.length;++n)i.add(ba.fromDescriptor(e.oneofDecl[n]));if(e.field)for(n=0;n<e.field.length;++n){var s=Pr.fromDescriptor(e.field[n],t);i.add(s),e.field[n].hasOwnProperty("oneofIndex")&&i.oneofsArray[e.field[n].oneofIndex].add(s)}if(e.extension)for(n=0;n<e.extension.length;++n)i.add(Pr.fromDescriptor(e.extension[n],t));if(e.nestedType)for(n=0;n<e.nestedType.length;++n)i.add(Mr.fromDescriptor(e.nestedType[n],t)),e.nestedType[n].options&&e.nestedType[n].options.mapEntry&&i.setOption("map_entry",!0);if(e.enumType)for(n=0;n<e.enumType.length;++n)i.add(ur.fromDescriptor(e.enumType[n]));if(e.extensionRange&&e.extensionRange.length)for(i.extensions=[],n=0;n<e.extensionRange.length;++n)i.extensions.push([e.extensionRange[n].start,e.extensionRange[n].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(i.reserved=[],e.reservedRange)for(n=0;n<e.reservedRange.length;++n)i.reserved.push([e.reservedRange[n].start,e.reservedRange[n].end]);if(e.reservedName)for(n=0;n<e.reservedName.length;++n)i.reserved.push(e.reservedName[n])}return i};Mr.prototype.toDescriptor=function(e){var t=Z.DescriptorProto.create({name:this.name}),i;for(i=0;i<this.fieldsArray.length;++i){var n;if(t.field.push(n=this._fieldsArray[i].toDescriptor(e)),this._fieldsArray[i]instanceof HC){var s=Ru(this._fieldsArray[i].keyType,this._fieldsArray[i].resolvedKeyType),a=Ru(this._fieldsArray[i].type,this._fieldsArray[i].resolvedType),o=a===11||a===14?this._fieldsArray[i].resolvedType&&zm(this.parent,this._fieldsArray[i].resolvedType)||this._fieldsArray[i].type:void 0;t.nestedType.push(Z.DescriptorProto.create({name:n.typeName,field:[Z.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),Z.FieldDescriptorProto.create({name:"value",number:2,label:1,type:a,typeName:o})],options:Z.MessageOptions.create({mapEntry:!0})}))}}for(i=0;i<this.oneofsArray.length;++i)t.oneofDecl.push(this._oneofsArray[i].toDescriptor());for(i=0;i<this.nestedArray.length;++i)this._nestedArray[i]instanceof Pr?t.field.push(this._nestedArray[i].toDescriptor(e)):this._nestedArray[i]instanceof Mr?t.nestedType.push(this._nestedArray[i].toDescriptor(e)):this._nestedArray[i]instanceof ur&&t.enumType.push(this._nestedArray[i].toDescriptor());if(this.extensions)for(i=0;i<this.extensions.length;++i)t.extensionRange.push(Z.DescriptorProto.ExtensionRange.create({start:this.extensions[i][0],end:this.extensions[i][1]}));if(this.reserved)for(i=0;i<this.reserved.length;++i)typeof this.reserved[i]=="string"?t.reservedName.push(this.reserved[i]):t.reservedRange.push(Z.DescriptorProto.ReservedRange.create({start:this.reserved[i][0],end:this.reserved[i][1]}));return t.options=Fi(this.options,Z.MessageOptions),t};var GC=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;Pr.fromDescriptor=function(e,t){if(typeof e.length=="number"&&(e=Z.DescriptorProto.decode(e)),typeof e.number!="number")throw Error("missing field id");var i;e.typeName&&e.typeName.length?i=e.typeName:i=YC(e.type);var n;switch(e.label){case 1:n=void 0;break;case 2:n="required";break;case 3:n="repeated";break;default:throw Error("illegal label: "+e.label)}var s=e.extendee;e.extendee!==void 0&&(s=s.length?s:void 0);var a=new Pr(e.name.length?e.name:"field"+e.number,e.number,i,n,s);if(a.options=Li(e.options,Z.FieldOptions),e.defaultValue&&e.defaultValue.length){var o=e.defaultValue;switch(o){case"true":case"TRUE":o=!0;break;case"false":case"FALSE":o=!1;break;default:var l=GC.exec(o);l&&(o=parseInt(o));break}a.setOption("default",o)}return JC(e.type)&&(t==="proto3"?e.options&&!e.options.packed&&a.setOption("packed",!1):e.options&&e.options.packed||a.setOption("packed",!1)),a};Pr.prototype.toDescriptor=function(e){var t=Z.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)t.type=11,t.typeName=Qe.util.ucFirst(this.name),t.label=3;else{switch(t.type=Ru(this.type,this.resolve().resolvedType)){case 10:case 11:case 14:t.typeName=this.resolvedType?zm(this.parent,this.resolvedType):this.type;break}switch(this.rule){case"repeated":t.label=3;break;case"required":t.label=2;break;default:t.label=1;break}}if(t.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(t.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(t.options=Fi(this.options,Z.FieldOptions),this.options.default!=null&&(t.defaultValue=String(this.options.default))),e==="proto3"?this.packed||((t.options||(t.options=Z.FieldOptions.create())).packed=!1):this.packed&&((t.options||(t.options=Z.FieldOptions.create())).packed=!0),t};var WC=0;ur.fromDescriptor=function(e){typeof e.length=="number"&&(e=Z.EnumDescriptorProto.decode(e));var t={};if(e.value)for(var i=0;i<e.value.length;++i){var n=e.value[i].name,s=e.value[i].number||0;t[n&&n.length?n:"NAME"+s]=s}return new ur(e.name&&e.name.length?e.name:"Enum"+WC++,t,Li(e.options,Z.EnumOptions))};ur.prototype.toDescriptor=function(){for(var e=[],t=0,i=Object.keys(this.values);t<i.length;++t)e.push(Z.EnumValueDescriptorProto.create({name:i[t],number:this.values[i[t]]}));return Z.EnumDescriptorProto.create({name:this.name,value:e,options:Fi(this.options,Z.EnumOptions)})};var $C=0;ba.fromDescriptor=function(e){return typeof e.length=="number"&&(e=Z.OneofDescriptorProto.decode(e)),new ba(e.name&&e.name.length?e.name:"oneof"+$C++)};ba.prototype.toDescriptor=function(){return Z.OneofDescriptorProto.create({name:this.name})};var VC=0;Fn.fromDescriptor=function(e){typeof e.length=="number"&&(e=Z.ServiceDescriptorProto.decode(e));var t=new Fn(e.name&&e.name.length?e.name:"Service"+VC++,Li(e.options,Z.ServiceOptions));if(e.method)for(var i=0;i<e.method.length;++i)t.add(Ra.fromDescriptor(e.method[i]));return t};Fn.prototype.toDescriptor=function(){for(var e=[],t=0;t<this.methodsArray.length;++t)e.push(this._methodsArray[t].toDescriptor());return Z.ServiceDescriptorProto.create({name:this.name,method:e,options:Fi(this.options,Z.ServiceOptions)})};var KC=0;Ra.fromDescriptor=function(e){return typeof e.length=="number"&&(e=Z.MethodDescriptorProto.decode(e)),new Ra(e.name&&e.name.length?e.name:"Method"+KC++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,Li(e.options,Z.MethodOptions))};Ra.prototype.toDescriptor=function(){return Z.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:Fi(this.options,Z.MethodOptions)})};function YC(r){switch(r){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+r)}function JC(r){switch(r){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function Ru(r,e){switch(r){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(e instanceof ur)return 14;if(e instanceof Mr)return e.group?10:11;throw Error("illegal type: "+r)}function Li(r,e){if(r){for(var t=[],i=0,n,s,a;i<e.fieldsArray.length;++i)(s=(n=e._fieldsArray[i]).name)!=="uninterpretedOption"&&r.hasOwnProperty(s)&&(a=r[s],n.resolvedType instanceof ur&&typeof a=="number"&&n.resolvedType.valuesById[a]!==void 0&&(a=n.resolvedType.valuesById[a]),t.push(XC(s),a));return t.length?Qe.util.toObject(t):void 0}}function Fi(r,e){if(r){for(var t=[],i=0,n=Object.keys(r),s,a;i<n.length;++i)if(a=r[s=n[i]],s!=="default"){var o=e.fields[s];!o&&!(o=e.fields[s=Qe.util.camelCase(s)])||t.push(s,a)}return t.length?e.fromObject(Qe.util.toObject(t)):void 0}}function zm(r,e){var t=r.fullName.split("."),i=e.fullName.split("."),n=0,s=0,a=i.length-1;if(!(r instanceof Ln)&&e instanceof Bm)for(;n<t.length&&s<a&&t[n]===i[s];){var o=e.lookup(t[n++],!0);if(o!==null&&o!==e)break;++s}else for(;n<t.length&&s<a&&t[n]===i[s];++n,++s);return i.slice(s).join(".")}function XC(r){return r.substring(0,1)+r.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}});var Gm=w((sA,QC)=>{QC.exports={nested:{google:{nested:{protobuf:{nested:{Api:{fields:{name:{type:"string",id:1},methods:{rule:"repeated",type:"Method",id:2},options:{rule:"repeated",type:"Option",id:3},version:{type:"string",id:4},sourceContext:{type:"SourceContext",id:5},mixins:{rule:"repeated",type:"Mixin",id:6},syntax:{type:"Syntax",id:7}}},Method:{fields:{name:{type:"string",id:1},requestTypeUrl:{type:"string",id:2},requestStreaming:{type:"bool",id:3},responseTypeUrl:{type:"string",id:4},responseStreaming:{type:"bool",id:5},options:{rule:"repeated",type:"Option",id:6},syntax:{type:"Syntax",id:7}}},Mixin:{fields:{name:{type:"string",id:1},root:{type:"string",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}}}}}}}}});var Wm=w((aA,ZC)=>{ZC.exports={nested:{google:{nested:{protobuf:{nested:{SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var $m=w((oA,ew)=>{ew.exports={nested:{google:{nested:{protobuf:{nested:{Type:{fields:{name:{type:"string",id:1},fields:{rule:"repeated",type:"Field",id:2},oneofs:{rule:"repeated",type:"string",id:3},options:{rule:"repeated",type:"Option",id:4},sourceContext:{type:"SourceContext",id:5},syntax:{type:"Syntax",id:6}}},Field:{fields:{kind:{type:"Kind",id:1},cardinality:{type:"Cardinality",id:2},number:{type:"int32",id:3},name:{type:"string",id:4},typeUrl:{type:"string",id:6},oneofIndex:{type:"int32",id:7},packed:{type:"bool",id:8},options:{rule:"repeated",type:"Option",id:9},jsonName:{type:"string",id:10},defaultValue:{type:"string",id:11}},nested:{Kind:{values:{TYPE_UNKNOWN:0,TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Cardinality:{values:{CARDINALITY_UNKNOWN:0,CARDINALITY_OPTIONAL:1,CARDINALITY_REQUIRED:2,CARDINALITY_REPEATED:3}}}},Enum:{fields:{name:{type:"string",id:1},enumvalue:{rule:"repeated",type:"EnumValue",id:2},options:{rule:"repeated",type:"Option",id:3},sourceContext:{type:"SourceContext",id:4},syntax:{type:"Syntax",id:5}}},EnumValue:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{rule:"repeated",type:"Option",id:3}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var Jm=w(xr=>{"use strict";Object.defineProperty(xr,"__esModule",{value:!0});xr.addCommonProtos=xr.loadProtosWithOptionsSync=xr.loadProtosWithOptions=void 0;var Vm=require("fs"),Km=require("path"),Bi=Ta();function Ym(r,e){let t=r.resolvePath;r.resolvePath=(i,n)=>{if(Km.isAbsolute(n))return n;for(let s of e){let a=Km.join(s,n);try{return Vm.accessSync(a,Vm.constants.R_OK),a}catch{continue}}return process.emitWarning(`${n} not found in any of the include paths ${e}`),t(i,n)}}async function tw(r,e){let t=new Bi.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))return Promise.reject(new Error("The includeDirs option must be an array"));Ym(t,e.includeDirs)}let i=await t.load(r,e);return i.resolveAll(),i}xr.loadProtosWithOptions=tw;function rw(r,e){let t=new Bi.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))throw new Error("The includeDirs option must be an array");Ym(t,e.includeDirs)}let i=t.loadSync(r,e);return i.resolveAll(),i}xr.loadProtosWithOptionsSync=rw;function iw(){let r=Gm(),e=bu(),t=Wm(),i=$m();Bi.common("api",r.nested.google.nested.protobuf.nested),Bi.common("descriptor",e.nested.google.nested.protobuf.nested),Bi.common("source_context",t.nested.google.nested.protobuf.nested),Bi.common("type",i.nested.google.nested.protobuf.nested)}xr.addCommonProtos=iw});var Zm=w((Qm,Ou)=>{var Xm=function(r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var e=null;try{e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function t(M,f,z){this.low=M|0,this.high=f|0,this.unsigned=!!z}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0});function i(M){return(M&&M.__isLong__)===!0}function n(M){var f=Math.clz32(M&-M);return M?31-f:f}t.isLong=i;var s={},a={};function o(M,f){var z,X,oe;return f?(M>>>=0,(oe=0<=M&&M<256)&&(X=a[M],X)?X:(z=c(M,0,!0),oe&&(a[M]=z),z)):(M|=0,(oe=-128<=M&&M<128)&&(X=s[M],X)?X:(z=c(M,M<0?-1:0,!1),oe&&(s[M]=z),z))}t.fromInt=o;function l(M,f){if(isNaN(M))return f?L:j;if(f){if(M<0)return L;if(M>=I)return q}else{if(M<=-A)return Y;if(M+1>=A)return Q}return M<0?l(-M,f).neg():c(M%k|0,M/k|0,f)}t.fromNumber=l;function c(M,f,z){return new t(M,f,z)}t.fromBits=c;var p=Math.pow;function m(M,f,z){if(M.length===0)throw Error("empty string");if(typeof f=="number"?(z=f,f=!1):f=!!f,M==="NaN"||M==="Infinity"||M==="+Infinity"||M==="-Infinity")return f?L:j;if(z=z||10,z<2||36<z)throw RangeError("radix");var X;if((X=M.indexOf("-"))>0)throw Error("interior hyphen");if(X===0)return m(M.substring(1),f,z).neg();for(var oe=l(p(z,8)),te=j,ue=0;ue<M.length;ue+=8){var he=Math.min(8,M.length-ue),Ee=parseInt(M.substring(ue,ue+he),z);if(he<8){var _e=l(p(z,he));te=te.mul(_e).add(l(Ee))}else te=te.mul(oe),te=te.add(l(Ee))}return te.unsigned=f,te}t.fromString=m;function S(M,f){return typeof M=="number"?l(M,f):typeof M=="string"?m(M,f):c(M.low,M.high,typeof f=="boolean"?f:M.unsigned)}t.fromValue=S;var O=65536,N=1<<24,k=O*O,I=k*k,A=I/2,D=o(N),j=o(0);t.ZERO=j;var L=o(0,!0);t.UZERO=L;var U=o(1);t.ONE=U;var F=o(1,!0);t.UONE=F;var V=o(-1);t.NEG_ONE=V;var Q=c(-1,2147483647,!1);t.MAX_VALUE=Q;var q=c(-1,-1,!0);t.MAX_UNSIGNED_VALUE=q;var Y=c(0,-2147483648,!1);t.MIN_VALUE=Y;var R=t.prototype;R.toInt=function(){return this.unsigned?this.low>>>0:this.low},R.toNumber=function(){return this.unsigned?(this.high>>>0)*k+(this.low>>>0):this.high*k+(this.low>>>0)},R.toString=function(f){if(f=f||10,f<2||36<f)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Y)){var z=l(f),X=this.div(z),oe=X.mul(z).sub(this);return X.toString(f)+oe.toInt().toString(f)}else return"-"+this.neg().toString(f);for(var te=l(p(f,6),this.unsigned),ue=this,he="";;){var Ee=ue.div(te),_e=ue.sub(Ee.mul(te)).toInt()>>>0,P=_e.toString(f);if(ue=Ee,ue.isZero())return P+he;for(;P.length<6;)P="0"+P;he=""+P+he}},R.getHighBits=function(){return this.high},R.getHighBitsUnsigned=function(){return this.high>>>0},R.getLowBits=function(){return this.low},R.getLowBitsUnsigned=function(){return this.low>>>0},R.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Y)?64:this.neg().getNumBitsAbs();for(var f=this.high!=0?this.high:this.low,z=31;z>0&&!(f&1<<z);z--);return this.high!=0?z+33:z+1},R.isZero=function(){return this.high===0&&this.low===0},R.eqz=R.isZero,R.isNegative=function(){return!this.unsigned&&this.high<0},R.isPositive=function(){return this.unsigned||this.high>=0},R.isOdd=function(){return(this.low&1)===1},R.isEven=function(){return(this.low&1)===0},R.equals=function(f){return i(f)||(f=S(f)),this.unsigned!==f.unsigned&&this.high>>>31===1&&f.high>>>31===1?!1:this.high===f.high&&this.low===f.low},R.eq=R.equals,R.notEquals=function(f){return!this.eq(f)},R.neq=R.notEquals,R.ne=R.notEquals,R.lessThan=function(f){return this.comp(f)<0},R.lt=R.lessThan,R.lessThanOrEqual=function(f){return this.comp(f)<=0},R.lte=R.lessThanOrEqual,R.le=R.lessThanOrEqual,R.greaterThan=function(f){return this.comp(f)>0},R.gt=R.greaterThan,R.greaterThanOrEqual=function(f){return this.comp(f)>=0},R.gte=R.greaterThanOrEqual,R.ge=R.greaterThanOrEqual,R.compare=function(f){if(i(f)||(f=S(f)),this.eq(f))return 0;var z=this.isNegative(),X=f.isNegative();return z&&!X?-1:!z&&X?1:this.unsigned?f.high>>>0>this.high>>>0||f.high===this.high&&f.low>>>0>this.low>>>0?-1:1:this.sub(f).isNegative()?-1:1},R.comp=R.compare,R.negate=function(){return!this.unsigned&&this.eq(Y)?Y:this.not().add(U)},R.neg=R.negate,R.add=function(f){i(f)||(f=S(f));var z=this.high>>>16,X=this.high&65535,oe=this.low>>>16,te=this.low&65535,ue=f.high>>>16,he=f.high&65535,Ee=f.low>>>16,_e=f.low&65535,P=0,Oe=0,Ce=0,Ne=0;return Ne+=te+_e,Ce+=Ne>>>16,Ne&=65535,Ce+=oe+Ee,Oe+=Ce>>>16,Ce&=65535,Oe+=X+he,P+=Oe>>>16,Oe&=65535,P+=z+ue,P&=65535,c(Ce<<16|Ne,P<<16|Oe,this.unsigned)},R.subtract=function(f){return i(f)||(f=S(f)),this.add(f.neg())},R.sub=R.subtract,R.multiply=function(f){if(this.isZero())return this;if(i(f)||(f=S(f)),e){var z=e.mul(this.low,this.high,f.low,f.high);return c(z,e.get_high(),this.unsigned)}if(f.isZero())return this.unsigned?L:j;if(this.eq(Y))return f.isOdd()?Y:j;if(f.eq(Y))return this.isOdd()?Y:j;if(this.isNegative())return f.isNegative()?this.neg().mul(f.neg()):this.neg().mul(f).neg();if(f.isNegative())return this.mul(f.neg()).neg();if(this.lt(D)&&f.lt(D))return l(this.toNumber()*f.toNumber(),this.unsigned);var X=this.high>>>16,oe=this.high&65535,te=this.low>>>16,ue=this.low&65535,he=f.high>>>16,Ee=f.high&65535,_e=f.low>>>16,P=f.low&65535,Oe=0,Ce=0,Ne=0,Ie=0;return Ie+=ue*P,Ne+=Ie>>>16,Ie&=65535,Ne+=te*P,Ce+=Ne>>>16,Ne&=65535,Ne+=ue*_e,Ce+=Ne>>>16,Ne&=65535,Ce+=oe*P,Oe+=Ce>>>16,Ce&=65535,Ce+=te*_e,Oe+=Ce>>>16,Ce&=65535,Ce+=ue*Ee,Oe+=Ce>>>16,Ce&=65535,Oe+=X*P+oe*_e+te*Ee+ue*he,Oe&=65535,c(Ne<<16|Ie,Oe<<16|Ce,this.unsigned)},R.mul=R.multiply,R.divide=function(f){if(i(f)||(f=S(f)),f.isZero())throw Error("division by zero");if(e){if(!this.unsigned&&this.high===-2147483648&&f.low===-1&&f.high===-1)return this;var z=(this.unsigned?e.div_u:e.div_s)(this.low,this.high,f.low,f.high);return c(z,e.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?L:j;var X,oe,te;if(this.unsigned){if(f.unsigned||(f=f.toUnsigned()),f.gt(this))return L;if(f.gt(this.shru(1)))return F;te=L}else{if(this.eq(Y)){if(f.eq(U)||f.eq(V))return Y;if(f.eq(Y))return U;var ue=this.shr(1);return X=ue.div(f).shl(1),X.eq(j)?f.isNegative()?U:V:(oe=this.sub(f.mul(X)),te=X.add(oe.div(f)),te)}else if(f.eq(Y))return this.unsigned?L:j;if(this.isNegative())return f.isNegative()?this.neg().div(f.neg()):this.neg().div(f).neg();if(f.isNegative())return this.div(f.neg()).neg();te=j}for(oe=this;oe.gte(f);){X=Math.max(1,Math.floor(oe.toNumber()/f.toNumber()));for(var he=Math.ceil(Math.log(X)/Math.LN2),Ee=he<=48?1:p(2,he-48),_e=l(X),P=_e.mul(f);P.isNegative()||P.gt(oe);)X-=Ee,_e=l(X,this.unsigned),P=_e.mul(f);_e.isZero()&&(_e=U),te=te.add(_e),oe=oe.sub(P)}return te},R.div=R.divide,R.modulo=function(f){if(i(f)||(f=S(f)),e){var z=(this.unsigned?e.rem_u:e.rem_s)(this.low,this.high,f.low,f.high);return c(z,e.get_high(),this.unsigned)}return this.sub(this.div(f).mul(f))},R.mod=R.modulo,R.rem=R.modulo,R.not=function(){return c(~this.low,~this.high,this.unsigned)},R.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},R.clz=R.countLeadingZeros,R.countTrailingZeros=function(){return this.low?n(this.low):n(this.high)+32},R.ctz=R.countTrailingZeros,R.and=function(f){return i(f)||(f=S(f)),c(this.low&f.low,this.high&f.high,this.unsigned)},R.or=function(f){return i(f)||(f=S(f)),c(this.low|f.low,this.high|f.high,this.unsigned)},R.xor=function(f){return i(f)||(f=S(f)),c(this.low^f.low,this.high^f.high,this.unsigned)},R.shiftLeft=function(f){return i(f)&&(f=f.toInt()),(f&=63)===0?this:f<32?c(this.low<<f,this.high<<f|this.low>>>32-f,this.unsigned):c(0,this.low<<f-32,this.unsigned)},R.shl=R.shiftLeft,R.shiftRight=function(f){return i(f)&&(f=f.toInt()),(f&=63)===0?this:f<32?c(this.low>>>f|this.high<<32-f,this.high>>f,this.unsigned):c(this.high>>f-32,this.high>=0?0:-1,this.unsigned)},R.shr=R.shiftRight,R.shiftRightUnsigned=function(f){return i(f)&&(f=f.toInt()),(f&=63)===0?this:f<32?c(this.low>>>f|this.high<<32-f,this.high>>>f,this.unsigned):f===32?c(this.high,0,this.unsigned):c(this.high>>>f-32,0,this.unsigned)},R.shru=R.shiftRightUnsigned,R.shr_u=R.shiftRightUnsigned,R.rotateLeft=function(f){var z;return i(f)&&(f=f.toInt()),(f&=63)===0?this:f===32?c(this.high,this.low,this.unsigned):f<32?(z=32-f,c(this.low<<f|this.high>>>z,this.high<<f|this.low>>>z,this.unsigned)):(f-=32,z=32-f,c(this.high<<f|this.low>>>z,this.low<<f|this.high>>>z,this.unsigned))},R.rotl=R.rotateLeft,R.rotateRight=function(f){var z;return i(f)&&(f=f.toInt()),(f&=63)===0?this:f===32?c(this.high,this.low,this.unsigned):f<32?(z=32-f,c(this.high<<z|this.low>>>f,this.low<<z|this.high>>>f,this.unsigned)):(f-=32,z=32-f,c(this.low<<z|this.high>>>f,this.high<<z|this.low>>>f,this.unsigned))},R.rotr=R.rotateRight,R.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},R.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},R.toBytes=function(f){return f?this.toBytesLE():this.toBytesBE()},R.toBytesLE=function(){var f=this.high,z=this.low;return[z&255,z>>>8&255,z>>>16&255,z>>>24,f&255,f>>>8&255,f>>>16&255,f>>>24]},R.toBytesBE=function(){var f=this.high,z=this.low;return[f>>>24,f>>>16&255,f>>>8&255,f&255,z>>>24,z>>>16&255,z>>>8&255,z&255]},t.fromBytes=function(f,z,X){return X?t.fromBytesLE(f,z):t.fromBytesBE(f,z)},t.fromBytesLE=function(f,z){return new t(f[0]|f[1]<<8|f[2]<<16|f[3]<<24,f[4]|f[5]<<8|f[6]<<16|f[7]<<24,z)},t.fromBytesBE=function(f,z){return new t(f[4]<<24|f[5]<<16|f[6]<<8|f[7],f[0]<<24|f[1]<<16|f[2]<<8|f[3],z)};var J=t;return r.default=J,"default"in r?r.default:r}({});typeof define=="function"&&define.amd?define([],function(){return Xm}):typeof Ou=="object"&&typeof Qm=="object"&&(Ou.exports=Xm)});var Pu=w(qe=>{"use strict";Object.defineProperty(qe,"__esModule",{value:!0});qe.loadFileDescriptorSetFromObject=qe.loadFileDescriptorSetFromBuffer=qe.fromJSON=qe.loadSync=qe.load=qe.IdempotencyLevel=qe.isAnyExtension=qe.Long=void 0;var nw=Up(),Xt=Ta(),Au=jm(),Mu=Jm(),sw=Zm();qe.Long=sw;function aw(r){return"@type"in r&&typeof r["@type"]=="string"}qe.isAnyExtension=aw;var rv;(function(r){r.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",r.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",r.IDEMPOTENT="IDEMPOTENT"})(rv=qe.IdempotencyLevel||(qe.IdempotencyLevel={}));var iv={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function ow(r,e){return r===""?e:r+"."+e}function lw(r){return r instanceof Xt.Service||r instanceof Xt.Type||r instanceof Xt.Enum}function cw(r){return r instanceof Xt.Namespace||r instanceof Xt.Root}function nv(r,e){let t=ow(e,r.name);return lw(r)?[[t,r]]:cw(r)&&typeof r.nested<"u"?Object.keys(r.nested).map(i=>nv(r.nested[i],t)).reduce((i,n)=>i.concat(n),[]):[]}function ev(r,e){return function(i){return r.toObject(r.decode(i),e)}}function tv(r){return function(t){if(Array.isArray(t))throw new Error(`Failed to serialize message: expected object with ${r.name} structure, got array instead`);let i=r.fromObject(t);return r.encode(i).finish()}}function uw(r){return(r||[]).reduce((e,t)=>{for(let[i,n]of Object.entries(t))switch(i){case"uninterpreted_option":e.uninterpreted_option.push(t.uninterpreted_option);break;default:e[i]=n}return e},{deprecated:!1,idempotency_level:rv.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}function hw(r,e,t,i){let n=r.resolvedRequestType,s=r.resolvedResponseType;return{path:"/"+e+"/"+r.name,requestStream:!!r.requestStream,responseStream:!!r.responseStream,requestSerialize:tv(n),requestDeserialize:ev(n,t),responseSerialize:tv(s),responseDeserialize:ev(s,t),originalName:nw(r.name),requestType:ku(n,i),responseType:ku(s,i),options:uw(r.parsedOptions)}}function dw(r,e,t,i){let n={};for(let s of r.methodsArray)n[s.name]=hw(s,e,t,i);return n}function ku(r,e){let t=r.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:t.$type.toObject(t,iv),fileDescriptorProtos:e}}function fw(r,e){let t=r.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:t.$type.toObject(t,iv),fileDescriptorProtos:e}}function pw(r,e,t,i){if(r instanceof Xt.Service)return dw(r,e,t,i);if(r instanceof Xt.Type)return ku(r,i);if(r instanceof Xt.Enum)return fw(r,i);throw new Error("Type mismatch in reflection object handling")}function Oa(r,e){let t={};r.resolveAll();let n=r.toDescriptor("proto3").file.map(s=>Buffer.from(Au.FileDescriptorProto.encode(s).finish()));for(let[s,a]of nv(r,""))t[s]=pw(a,s,e,n);return t}function sv(r,e){e=e||{};let t=Xt.Root.fromDescriptor(r);return t.resolveAll(),Oa(t,e)}function gw(r,e){return(0,Mu.loadProtosWithOptions)(r,e).then(t=>Oa(t,e))}qe.load=gw;function mw(r,e){let t=(0,Mu.loadProtosWithOptionsSync)(r,e);return Oa(t,e)}qe.loadSync=mw;function vw(r,e){e=e||{};let t=Xt.Root.fromJSON(r);return t.resolveAll(),Oa(t,e)}qe.fromJSON=vw;function yw(r,e){let t=Au.FileDescriptorSet.decode(r);return sv(t,e)}qe.loadFileDescriptorSetFromBuffer=yw;function _w(r,e){let t=Au.FileDescriptorSet.fromObject(r);return sv(t,e)}qe.loadFileDescriptorSetFromObject=_w;(0,Mu.addCommonProtos)()});var ni=w(de=>{"use strict";Object.defineProperty(de,"__esModule",{value:!0});de.setup=de.getChannelzServiceDefinition=de.getChannelzHandlers=de.unregisterChannelzRef=de.registerChannelzSocket=de.registerChannelzServer=de.registerChannelzSubchannel=de.registerChannelzChannel=de.ChannelzCallTrackerStub=de.ChannelzCallTracker=de.ChannelzChildrenTrackerStub=de.ChannelzChildrenTracker=de.ChannelzTrace=de.ChannelzTraceStub=void 0;var av=require("net"),ii=lp(),Bn=ut(),Un=re(),Sw=Tt(),Ew=Ks(),Cw=kc();function xu(r){return{channel_id:r.id,name:r.name}}function Lu(r){return{subchannel_id:r.id,name:r.name}}function ww(r){return{server_id:r.id}}function Pa(r){return{socket_id:r.id,name:r.name}}var ov=32,Fu=100,Nu=class{constructor(){this.events=[],this.creationTimestamp=new Date,this.eventsLogged=0}addTrace(){}getTraceMessage(){return{creation_timestamp:Qt(this.creationTimestamp),num_events_logged:this.eventsLogged,events:[]}}};de.ChannelzTraceStub=Nu;var Iu=class{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,i){let n=new Date;this.events.push({description:t,severity:e,timestamp:n,childChannel:i?.kind==="channel"?i:void 0,childSubchannel:i?.kind==="subchannel"?i:void 0}),this.events.length>=ov*2&&(this.events=this.events.slice(ov)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:Qt(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:Qt(e.timestamp),channel_ref:e.childChannel?xu(e.childChannel):null,subchannel_ref:e.childSubchannel?Lu(e.childSubchannel):null}))}}};de.ChannelzTrace=Iu;var Aa=class{constructor(){this.channelChildren=new ii.OrderedMap,this.subchannelChildren=new ii.OrderedMap,this.socketChildren=new ii.OrderedMap,this.trackerMap={channel:this.channelChildren,subchannel:this.subchannelChildren,socket:this.socketChildren}}refChild(e){let t=this.trackerMap[e.kind],i=t.find(e.id);i.equals(t.end())?t.setElement(e.id,{ref:e,count:1},i):i.pointer[1].count+=1}unrefChild(e){let t=this.trackerMap[e.kind],i=t.getElementByKey(e.id);i!==void 0&&(i.count-=1,i.count===0&&t.eraseElementByKey(e.id))}getChildLists(){return{channels:this.channelChildren,subchannels:this.subchannelChildren,sockets:this.socketChildren}}};de.ChannelzChildrenTracker=Aa;var Du=class extends Aa{refChild(){}unrefChild(){}};de.ChannelzChildrenTrackerStub=Du;var Ma=class{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}};de.ChannelzCallTracker=Ma;var qu=class extends Ma{addCallStarted(){}addCallSucceeded(){}addCallFailed(){}};de.ChannelzCallTrackerStub=qu;var hr={channel:new ii.OrderedMap,subchannel:new ii.OrderedMap,server:new ii.OrderedMap,socket:new ii.OrderedMap},xa=r=>{let e=1;function t(){return e++}let i=hr[r];return(n,s,a)=>{let o=t(),l={id:o,name:n,kind:r};return a&&i.setElement(o,{ref:l,getInfo:s}),l}};de.registerChannelzChannel=xa("channel");de.registerChannelzSubchannel=xa("subchannel");de.registerChannelzServer=xa("server");de.registerChannelzSocket=xa("socket");function Tw(r){hr[r.kind].eraseElementByKey(r.id)}de.unregisterChannelzRef=Tw;function bw(r){let e=Number.parseInt(r,16);return[e/256|0,e%256]}function lv(r){if(r==="")return[];let e=r.split(":").map(i=>bw(i));return[].concat(...e)}function Rw(r){if((0,av.isIPv4)(r))return Buffer.from(Uint8Array.from(r.split(".").map(e=>Number.parseInt(e))));if((0,av.isIPv6)(r)){let e,t,i=r.indexOf("::");i===-1?(e=r,t=""):(e=r.substring(0,i),t=r.substring(i+2));let n=Buffer.from(lv(e)),s=Buffer.from(lv(t)),a=Buffer.alloc(16-n.length-s.length,0);return Buffer.concat([n,a,s])}else return null}function uv(r){switch(r){case Bn.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case Bn.ConnectivityState.IDLE:return{state:"IDLE"};case Bn.ConnectivityState.READY:return{state:"READY"};case Bn.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case Bn.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function Qt(r){if(!r)return null;let e=r.getTime();return{seconds:e/1e3|0,nanos:e%1e3*1e6}}function hv(r){let e=r.getInfo(),t=[],i=[];return e.children.channels.forEach(n=>{t.push(xu(n[1].ref))}),e.children.subchannels.forEach(n=>{i.push(Lu(n[1].ref))}),{ref:xu(r.ref),data:{target:e.target,state:uv(e.state),calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:Qt(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},channel_ref:t,subchannel_ref:i}}function Ow(r,e){let t=parseInt(r.request.channel_id,10),i=hr.channel.getElementByKey(t);if(i===void 0){e({code:Un.Status.NOT_FOUND,details:"No channel data found for id "+t});return}e(null,{channel:hv(i)})}function kw(r,e){let t=parseInt(r.request.max_results,10)||Fu,i=[],n=parseInt(r.request.start_channel_id,10),s=hr.channel,a;for(a=s.lowerBound(n);!a.equals(s.end())&&i.length<t;a=a.next())i.push(hv(a.pointer[1]));e(null,{channel:i,end:a.equals(s.end())})}function dv(r){let e=r.getInfo(),t=[];return e.listenerChildren.sockets.forEach(i=>{t.push(Pa(i[1].ref))}),{ref:ww(r.ref),data:{calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:Qt(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},listen_socket:t}}function Aw(r,e){let t=parseInt(r.request.server_id,10),n=hr.server.getElementByKey(t);if(n===void 0){e({code:Un.Status.NOT_FOUND,details:"No server data found for id "+t});return}e(null,{server:dv(n)})}function Mw(r,e){let t=parseInt(r.request.max_results,10)||Fu,i=parseInt(r.request.start_server_id,10),n=hr.server,s=[],a;for(a=n.lowerBound(i);!a.equals(n.end())&&s.length<t;a=a.next())s.push(dv(a.pointer[1]));e(null,{server:s,end:a.equals(n.end())})}function Pw(r,e){let t=parseInt(r.request.subchannel_id,10),i=hr.subchannel.getElementByKey(t);if(i===void 0){e({code:Un.Status.NOT_FOUND,details:"No subchannel data found for id "+t});return}let n=i.getInfo(),s=[];n.children.sockets.forEach(o=>{s.push(Pa(o[1].ref))});let a={ref:Lu(i.ref),data:{target:n.target,state:uv(n.state),calls_started:n.callTracker.callsStarted,calls_succeeded:n.callTracker.callsSucceeded,calls_failed:n.callTracker.callsFailed,last_call_started_timestamp:Qt(n.callTracker.lastCallStartedTimestamp),trace:n.trace.getTraceMessage()},socket_ref:s};e(null,{subchannel:a})}function cv(r){var e;return(0,Sw.isTcpSubchannelAddress)(r)?{address:"tcpip_address",tcpip_address:{ip_address:(e=Rw(r.host))!==null&&e!==void 0?e:void 0,port:r.port}}:{address:"uds_address",uds_address:{filename:r.path}}}function xw(r,e){var t,i,n,s,a;let o=parseInt(r.request.socket_id,10),l=hr.socket.getElementByKey(o);if(l===void 0){e({code:Un.Status.NOT_FOUND,details:"No socket data found for id "+o});return}let c=l.getInfo(),p=c.security?{model:"tls",tls:{cipher_suite:c.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:(t=c.security.cipherSuiteStandardName)!==null&&t!==void 0?t:void 0,other_name:(i=c.security.cipherSuiteOtherName)!==null&&i!==void 0?i:void 0,local_certificate:(n=c.security.localCertificate)!==null&&n!==void 0?n:void 0,remote_certificate:(s=c.security.remoteCertificate)!==null&&s!==void 0?s:void 0}}:null,m={ref:Pa(l.ref),local:c.localAddress?cv(c.localAddress):null,remote:c.remoteAddress?cv(c.remoteAddress):null,remote_name:(a=c.remoteName)!==null&&a!==void 0?a:void 0,security:p,data:{keep_alives_sent:c.keepAlivesSent,streams_started:c.streamsStarted,streams_succeeded:c.streamsSucceeded,streams_failed:c.streamsFailed,last_local_stream_created_timestamp:Qt(c.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:Qt(c.lastRemoteStreamCreatedTimestamp),messages_received:c.messagesReceived,messages_sent:c.messagesSent,last_message_received_timestamp:Qt(c.lastMessageReceivedTimestamp),last_message_sent_timestamp:Qt(c.lastMessageSentTimestamp),local_flow_control_window:c.localFlowControlWindow?{value:c.localFlowControlWindow}:null,remote_flow_control_window:c.remoteFlowControlWindow?{value:c.remoteFlowControlWindow}:null}};e(null,{socket:m})}function Nw(r,e){let t=parseInt(r.request.server_id,10),i=hr.server.getElementByKey(t);if(i===void 0){e({code:Un.Status.NOT_FOUND,details:"No server data found for id "+t});return}let n=parseInt(r.request.start_socket_id,10),s=parseInt(r.request.max_results,10)||Fu,o=i.getInfo().sessionChildren.sockets,l=[],c;for(c=o.lowerBound(n);!c.equals(o.end())&&l.length<s;c=c.next())l.push(Pa(c.pointer[1].ref));e(null,{socket_ref:l,end:c.equals(o.end())})}function fv(){return{GetChannel:Ow,GetTopChannels:kw,GetServer:Aw,GetServers:Mw,GetSubchannel:Pw,GetSocket:xw,GetServerSockets:Nw}}de.getChannelzHandlers=fv;var ka=null;function pv(){if(ka)return ka;let r=Pu().loadSync,e=r("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return ka=(0,Cw.loadPackageDefinition)(e).grpc.channelz.v1.Channelz.service,ka}de.getChannelzServiceDefinition=pv;function Iw(){(0,Ew.registerAdminService)(pv,fv)}de.setup=Iw});var gv=w(Ia=>{"use strict";Object.defineProperty(Ia,"__esModule",{value:!0});Ia.Subchannel=void 0;var ve=ut(),Dw=yn(),Bu=we(),Na=re(),qw=rt(),Lw=Tt(),Zt=ni(),Fw="subchannel",Bw=~(1<<31),Uu=class{constructor(e,t,i,n,s){var a;this.channelTarget=e,this.subchannelAddress=t,this.options=i,this.credentials=n,this.connector=s,this.connectivityState=ve.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0;let o={initialDelay:i["grpc.initial_reconnect_backoff_ms"],maxDelay:i["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new Dw.BackoffTimeout(()=>{this.handleBackoffTimer()},o),this.backoffTimeout.unref(),this.subchannelAddressString=(0,Lw.subchannelAddressToString)(t),this.keepaliveTime=(a=i["grpc.keepalive_time_ms"])!==null&&a!==void 0?a:-1,i["grpc.enable_channelz"]===0?(this.channelzEnabled=!1,this.channelzTrace=new Zt.ChannelzTraceStub,this.callTracker=new Zt.ChannelzCallTrackerStub,this.childrenTracker=new Zt.ChannelzChildrenTrackerStub,this.streamTracker=new Zt.ChannelzCallTrackerStub):(this.channelzTrace=new Zt.ChannelzTrace,this.callTracker=new Zt.ChannelzCallTracker,this.childrenTracker=new Zt.ChannelzChildrenTracker,this.streamTracker=new Zt.ChannelzCallTracker),this.channelzRef=(0,Zt.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(i,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){Bu.trace(Na.LogVerbosity.DEBUG,Fw,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){Bu.trace(Na.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([ve.ConnectivityState.TRANSIENT_FAILURE],ve.ConnectivityState.CONNECTING):this.transitionToState([ve.ConnectivityState.TRANSIENT_FAILURE],ve.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,Bw);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(t=>{this.transitionToState([ve.ConnectivityState.CONNECTING],ve.ConnectivityState.READY)?(this.transport=t,this.channelzEnabled&&this.childrenTracker.refChild(t.getChannelzRef()),t.addDisconnectListener(i=>{this.transitionToState([ve.ConnectivityState.READY],ve.ConnectivityState.IDLE),i&&this.keepaliveTime>0&&(this.keepaliveTime*=2,Bu.log(Na.LogVerbosity.ERROR,`Connection to ${(0,qw.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):t.shutdown()},t=>{this.transitionToState([ve.ConnectivityState.CONNECTING],ve.ConnectivityState.TRANSIENT_FAILURE,`${t}`)})}transitionToState(e,t,i){var n,s;if(e.indexOf(this.connectivityState)===-1)return!1;this.trace(ve.ConnectivityState[this.connectivityState]+" -> "+ve.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+ve.ConnectivityState[t]);let a=this.connectivityState;switch(this.connectivityState=t,t){case ve.ConnectivityState.READY:this.stopBackoff();break;case ve.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case ve.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(n=this.transport)===null||n===void 0||n.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case ve.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(s=this.transport)===null||s===void 0||s.shutdown(),this.transport=null;break;default:throw new Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let o of this.stateListeners)o(this,a,t,this.keepaliveTime,i);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,this.refcount===0&&(this.channelzTrace.addTrace("CT_INFO","Shutting down"),(0,Zt.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([ve.ConnectivityState.CONNECTING,ve.ConnectivityState.READY],ve.ConnectivityState.IDLE)}))}unrefIfOneRef(){return this.refcount===1?(this.unref(),!0):!1}createCall(e,t,i,n){if(!this.transport)throw new Error("Cannot create call, subchannel not READY");let s;return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),s={onCallEnd:a=>{a.code===Na.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):s={},this.transport.createCall(e,t,i,n,s)}startConnecting(){process.nextTick(()=>{this.transitionToState([ve.ConnectivityState.IDLE],ve.ConnectivityState.CONNECTING)||this.connectivityState===ve.ConnectivityState.TRANSIENT_FAILURE&&(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([ve.ConnectivityState.TRANSIENT_FAILURE],ve.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}isHealthy(){return!0}addHealthStateWatcher(e){}removeHealthStateWatcher(e){}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}};Ia.Subchannel=Uu});var Gu=w(Dr=>{"use strict";Object.defineProperty(Dr,"__esModule",{value:!0});Dr.setup=Dr.DEFAULT_PORT=void 0;var mv=Ht(),yv=require("dns"),_v=require("util"),Uw=$l(),zu=re(),Hu=Ve(),zw=we(),Hw=re(),Nr=rt(),vv=require("net"),jw=yn(),Gw="dns_resolver";function Ir(r){zw.trace(Hw.LogVerbosity.DEBUG,Gw,r)}Dr.DEFAULT_PORT=443;var Ww=3e4,$w=_v.promisify(yv.resolveTxt),Vw=_v.promisify(yv.lookup),ju=class{constructor(e,t,i){var n,s,a;this.target=e,this.listener=t,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,Ir("Resolver constructed for target "+(0,Nr.uriToString)(e));let o=(0,Nr.splitHostPort)(e.path);o===null?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,vv.isIPv4)(o.host)||(0,vv.isIPv6)(o.host)?(this.ipResult=[{addresses:[{host:o.host,port:(n=o.port)!==null&&n!==void 0?n:Dr.DEFAULT_PORT}]}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=o.host,this.port=(s=o.port)!==null&&s!==void 0?s:Dr.DEFAULT_PORT),this.percentage=Math.random()*100,i["grpc.service_config_disable_resolution"]===1&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:zu.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,Nr.uriToString)(this.target)}`,metadata:new Hu.Metadata};let l={initialDelay:i["grpc.initial_reconnect_backoff_ms"],maxDelay:i["grpc.max_reconnect_backoff_ms"]};this.backoff=new jw.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},l),this.backoff.unref(),this.minTimeBetweenResolutionsMs=(a=i["grpc.dns_min_time_between_resolutions_ms"])!==null&&a!==void 0?a:Ww,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(this.ipResult!==null){this.returnedIpResult||(Ir("Returning IP address for target "+(0,Nr.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(this.dnsHostname===null)Ir("Failed to parse DNS address "+(0,Nr.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:zu.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,Nr.uriToString)(this.target)}`,metadata:new Hu.Metadata})}),this.stopNextResolutionTimer();else{if(this.pendingLookupPromise!==null)return;Ir("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=Vw(e,{all:!0}),this.pendingLookupPromise.then(t=>{if(this.pendingLookupPromise===null)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let i=t.map(s=>({host:s.address,port:+this.port}));this.latestLookupResult=i.map(s=>({addresses:[s]}));let n="["+i.map(s=>s.host+":"+s.port).join(",")+"]";if(Ir("Resolved addresses for target "+(0,Nr.uriToString)(this.target)+": "+n),this.latestLookupResult.length===0){this.listener.onError(this.defaultResolutionError);return}this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},t=>{this.pendingLookupPromise!==null&&(Ir("Resolution error for target "+(0,Nr.uriToString)(this.target)+": "+t.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&this.pendingTxtPromise===null&&(this.pendingTxtPromise=$w(e),this.pendingTxtPromise.then(t=>{if(this.pendingTxtPromise!==null){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,Uw.extractAndSelectServiceConfig)(t,this.percentage)}catch(i){this.latestServiceConfigError={code:zu.Status.UNAVAILABLE,details:`Parsing service config failed with error ${i.message}`,metadata:new Hu.Metadata}}this.latestLookupResult!==null&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},t=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs),(t=(e=this.nextResolutionTimer).unref)===null||t===void 0||t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){this.pendingLookupPromise===null&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){this.pendingLookupPromise===null&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?Ir('resolution update delayed by "min time between resolutions" rate limit'):Ir("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}};function Kw(){(0,mv.registerResolver)("dns",ju),(0,mv.registerDefaultScheme)("dns")}Dr.setup=Kw});var Wu=w(Hi=>{"use strict";Object.defineProperty(Hi,"__esModule",{value:!0});Hi.getProxiedConnection=Hi.mapProxyName=void 0;var zn=we(),Ui=re(),Yw=Ht(),Jw=require("http"),Xw=require("tls"),Qw=we(),Sv=Tt(),zi=rt(),Zw=require("url"),eT=Gu(),tT="proxy";function qr(r){Qw.trace(Ui.LogVerbosity.DEBUG,tT,r)}function rT(){let r="",e="";if(process.env.grpc_proxy)e="grpc_proxy",r=process.env.grpc_proxy;else if(process.env.https_proxy)e="https_proxy",r=process.env.https_proxy;else if(process.env.http_proxy)e="http_proxy",r=process.env.http_proxy;else return{};let t;try{t=new Zw.URL(r)}catch{return(0,zn.log)(Ui.LogVerbosity.ERROR,`cannot parse value of "${e}" env var`),{}}if(t.protocol!=="http:")return(0,zn.log)(Ui.LogVerbosity.ERROR,`"${t.protocol}" scheme not supported in proxy URI`),{};let i=null;t.username&&(t.password?((0,zn.log)(Ui.LogVerbosity.INFO,"userinfo found in proxy URI"),i=`${t.username}:${t.password}`):i=t.username);let n=t.hostname,s=t.port;s===""&&(s="80");let a={address:`${n}:${s}`};return i&&(a.creds=i),qr("Proxy server "+a.address+" set by environment variable "+e),a}function iT(){let r=process.env.no_grpc_proxy,e="no_grpc_proxy";return r||(r=process.env.no_proxy,e="no_proxy"),r?(qr("No proxy server list set by environment variable "+e),r.split(",")):[]}function nT(r,e){var t;let i={target:r,extraOptions:{}};if(((t=e["grpc.enable_http_proxy"])!==null&&t!==void 0?t:1)===0||r.scheme==="unix")return i;let n=rT();if(!n.address)return i;let s=(0,zi.splitHostPort)(r.path);if(!s)return i;let a=s.host;for(let l of iT())if(l===a)return qr("Not using proxy for target in no_proxy list: "+(0,zi.uriToString)(r)),i;let o={"grpc.http_connect_target":(0,zi.uriToString)(r)};return n.creds&&(o["grpc.http_connect_creds"]=n.creds),{target:{scheme:"dns",path:n.address},extraOptions:o}}Hi.mapProxyName=nT;function sT(r,e,t){var i;if(!("grpc.http_connect_target"in e))return Promise.resolve({});let n=e["grpc.http_connect_target"],s=(0,zi.parseUri)(n);if(s===null)return Promise.resolve({});let a=(0,zi.splitHostPort)(s.path);if(a===null)return Promise.resolve({});let o=`${a.host}:${(i=a.port)!==null&&i!==void 0?i:eT.DEFAULT_PORT}`,l={method:"CONNECT",path:o},c={Host:o};(0,Sv.isTcpSubchannelAddress)(r)?(l.host=r.host,l.port=r.port):l.socketPath=r.path,"grpc.http_connect_creds"in e&&(c["Proxy-Authorization"]="Basic "+Buffer.from(e["grpc.http_connect_creds"]).toString("base64")),l.headers=c;let p=(0,Sv.subchannelAddressToString)(r);return qr("Using proxy "+p+" to connect to "+l.path),new Promise((m,S)=>{let O=Jw.request(l);O.once("connect",(N,k,I)=>{var A;if(O.removeAllListeners(),k.removeAllListeners(),N.statusCode===200)if(qr("Successfully connected to "+l.path+" through proxy "+p),"secureContext"in t){let D=(0,Yw.getDefaultAuthority)(s),j=(0,zi.splitHostPort)(D),L=(A=j?.host)!==null&&A!==void 0?A:D,U=Xw.connect(Object.assign({host:L,servername:L,socket:k},t),()=>{qr("Successfully established a TLS connection to "+l.path+" through proxy "+p),m({socket:U,realTarget:s})});U.on("error",F=>{qr("Failed to establish a TLS connection to "+l.path+" through proxy "+p+" with error "+F.message),S()})}else qr("Successfully established a plaintext connection to "+l.path+" through proxy "+p),m({socket:k,realTarget:s});else(0,zn.log)(Ui.LogVerbosity.ERROR,"Failed to connect to "+l.path+" through proxy "+p+" with status "+N.statusCode),S()}),O.once("error",N=>{O.removeAllListeners(),(0,zn.log)(Ui.LogVerbosity.ERROR,"Failed to connect to proxy "+p+" with error "+N.message),S()}),O.end()})}Hi.getProxiedConnection=sT});var Vu=w(Da=>{"use strict";Object.defineProperty(Da,"__esModule",{value:!0});Da.StreamDecoder=void 0;var er;(function(r){r[r.NO_DATA=0]="NO_DATA",r[r.READING_SIZE=1]="READING_SIZE",r[r.READING_MESSAGE=2]="READING_MESSAGE"})(er||(er={}));var $u=class{constructor(){this.readState=er.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t=0,i,n=[];for(;t<e.length;)switch(this.readState){case er.NO_DATA:this.readCompressFlag=e.slice(t,t+1),t+=1,this.readState=er.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case er.READING_SIZE:if(i=Math.min(e.length-t,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,t,t+i),this.readSizeRemaining-=i,t+=i,this.readSizeRemaining===0)if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=er.READING_MESSAGE;else{let s=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=er.NO_DATA,n.push(s)}break;case er.READING_MESSAGE:if(i=Math.min(e.length-t,this.readMessageRemaining),this.readPartialMessage.push(e.slice(t,t+i)),this.readMessageRemaining-=i,t+=i,this.readMessageRemaining===0){let s=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),a=Buffer.concat(s,this.readMessageSize+5);this.readState=er.NO_DATA,n.push(a)}break;default:throw new Error("Unexpected read state")}return n}};Da.StreamDecoder=$u});var Cv=w(qa=>{"use strict";Object.defineProperty(qa,"__esModule",{value:!0});qa.Http2SubchannelCall=void 0;var dr=require("http2"),aT=require("os"),ye=re(),fr=Ve(),oT=Vu(),lT=we(),cT=re(),uT="subchannel_call";function hT(r){for(let[e,t]of Object.entries(aT.constants.errno))if(t===r)return e;return"Unknown system error "+r}function Ev(r){let e=`Received HTTP status code ${r}`,t;switch(r){case 400:t=ye.Status.INTERNAL;break;case 401:t=ye.Status.UNAUTHENTICATED;break;case 403:t=ye.Status.PERMISSION_DENIED;break;case 404:t=ye.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:t=ye.Status.UNAVAILABLE;break;default:t=ye.Status.UNKNOWN}return{code:t,details:e,metadata:new fr.Metadata}}var Ku=class{constructor(e,t,i,n,s){this.http2Stream=e,this.callEventTracker=t,this.listener=i,this.transport=n,this.callId=s,this.decoder=new oT.StreamDecoder,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.finalStatus=null,this.internalError=null,this.serverEndedCall=!1,e.on("response",(a,o)=>{let l="";for(let c of Object.keys(a))l+="		"+c+": "+a[c]+`
`;if(this.trace(`Received server headers:
`+l),this.httpStatusCode=a[":status"],o&dr.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(a);else{let c;try{c=fr.Metadata.fromHttp2Headers(a)}catch(p){this.endCall({code:ye.Status.UNKNOWN,details:p.message,metadata:new fr.Metadata});return}this.listener.onReceiveMetadata(c)}}),e.on("trailers",a=>{this.handleTrailers(a)}),e.on("data",a=>{if(this.statusOutput)return;this.trace("receive HTTP/2 data frame of length "+a.length);let o=this.decoder.write(a);for(let l of o)this.trace("parsed message of length "+l.length),this.callEventTracker.addMessageReceived(),this.tryPush(l)}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{this.serverEndedCall=!0,process.nextTick(()=>{var a;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),((a=this.finalStatus)===null||a===void 0?void 0:a.code)===ye.Status.OK)return;let o,l="";switch(e.rstCode){case dr.constants.NGHTTP2_NO_ERROR:if(this.finalStatus!==null)return;if(this.httpStatusCode&&this.httpStatusCode!==200){let c=Ev(this.httpStatusCode);o=c.code,l=c.details}else o=ye.Status.INTERNAL,l=`Received RST_STREAM with code ${e.rstCode} (Call ended without gRPC status)`;break;case dr.constants.NGHTTP2_REFUSED_STREAM:o=ye.Status.UNAVAILABLE,l="Stream refused by server";break;case dr.constants.NGHTTP2_CANCEL:o=ye.Status.CANCELLED,l="Call cancelled";break;case dr.constants.NGHTTP2_ENHANCE_YOUR_CALM:o=ye.Status.RESOURCE_EXHAUSTED,l="Bandwidth exhausted or memory limit exceeded";break;case dr.constants.NGHTTP2_INADEQUATE_SECURITY:o=ye.Status.PERMISSION_DENIED,l="Protocol not secure enough";break;case dr.constants.NGHTTP2_INTERNAL_ERROR:o=ye.Status.INTERNAL,this.internalError===null?l=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:this.internalError.code==="ECONNRESET"||this.internalError.code==="ETIMEDOUT"?(o=ye.Status.UNAVAILABLE,l=this.internalError.message):l=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:o=ye.Status.INTERNAL,l=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:o,details:l,metadata:new fr.Metadata,rstCode:e.rstCode})})}),e.on("error",a=>{a.code!=="ERR_HTTP2_STREAM_ERROR"&&(this.trace("Node error event: message="+a.message+" code="+a.code+" errno="+hT(a.errno)+" syscall="+a.syscall),this.internalError=a),this.callEventTracker.onStreamEnd(!1)})}getDeadlineInfo(){return[`remote_addr=${this.getPeer()}`]}onDisconnect(){this.endCall({code:ye.Status.UNAVAILABLE,details:"Connection dropped",metadata:new fr.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){lT.trace(cT.LogVerbosity.DEBUG,uT,"["+this.callId+"] "+e)}endCall(e){(this.finalStatus===null||this.finalStatus.code===ye.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){this.finalStatus!==null&&(this.finalStatus.code!==ye.Status.OK||this.readsClosed&&this.unpushedReadMessages.length===0&&!this.isReadFilterPending&&!this.isPushPending)&&this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,!this.statusOutput&&(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){this.serverEndedCall=!0,this.callEventTracker.onStreamEnd(!0);let t="";for(let a of Object.keys(e))t+="		"+a+": "+e[a]+`
`;this.trace(`Received server trailers:
`+t);let i;try{i=fr.Metadata.fromHttp2Headers(e)}catch{i=new fr.Metadata}let n=i.getMap(),s;if(typeof n["grpc-status"]=="string"){let a=Number(n["grpc-status"]);this.trace("received status code "+a+" from server"),i.remove("grpc-status");let o="";if(typeof n["grpc-message"]=="string"){try{o=decodeURI(n["grpc-message"])}catch{o=n["grpc-message"]}i.remove("grpc-message"),this.trace('received status details string "'+o+'" from server')}s={code:a,details:o,metadata:i}}else this.httpStatusCode?(s=Ev(this.httpStatusCode),s.metadata=i):s={code:ye.Status.UNKNOWN,details:"No status information received",metadata:i};this.endCall(s)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed)if(this.serverEndedCall)this.http2Stream.end();else{let t;((e=this.finalStatus)===null||e===void 0?void 0:e.code)===ye.Status.OK?t=dr.constants.NGHTTP2_NO_ERROR:t=dr.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new fr.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(this.finalStatus!==null&&this.finalStatus.code!==ye.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let i=n=>{process.nextTick(()=>{var s;let a=ye.Status.UNAVAILABLE;n?.code==="ERR_STREAM_WRITE_AFTER_END"&&(a=ye.Status.INTERNAL),n&&this.cancelWithStatus(a,`Write error: ${n.message}`),(s=e.callback)===null||s===void 0||s.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,i)}catch(n){this.endCall({code:ye.Status.UNAVAILABLE,details:`Write failed with error ${n.message}`,metadata:new fr.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}};qa.Http2SubchannelCall=Ku});var Yu=w(La=>{"use strict";Object.defineProperty(La,"__esModule",{value:!0});La.getNextCallNumber=void 0;var dT=0;function fT(){return dT++}La.getNextCallNumber=fT});var bv=w(Ua=>{"use strict";Object.defineProperty(Ua,"__esModule",{value:!0});Ua.Http2SubchannelConnector=void 0;var Zu=require("http2"),wv=require("tls"),Fa=ni(),Hn=re(),pT=Wu(),Gi=we(),Tv=Ht(),Ba=Tt(),ji=rt(),gT=require("net"),mT=Cv(),vT=Yu(),Ju="transport",yT="transport_flowctrl",_T=Al().version,{HTTP2_HEADER_AUTHORITY:ST,HTTP2_HEADER_CONTENT_TYPE:ET,HTTP2_HEADER_METHOD:CT,HTTP2_HEADER_PATH:wT,HTTP2_HEADER_TE:TT,HTTP2_HEADER_USER_AGENT:bT}=Zu.constants,RT=2e4,OT=Buffer.from("too_many_pings","ascii"),Xu=class{constructor(e,t,i,n){this.session=e,this.remoteName=n,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=RT,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,Ba.subchannelAddressToString)(t),i["grpc.enable_channelz"]===0?(this.channelzEnabled=!1,this.streamTracker=new Fa.ChannelzCallTrackerStub):this.streamTracker=new Fa.ChannelzCallTracker,this.channelzRef=(0,Fa.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[i["grpc.primary_user_agent"],`grpc-node-js/${_T}`,i["grpc.secondary_user_agent"]].filter(s=>s).join(" "),"grpc.keepalive_time_ms"in i&&(this.keepaliveTimeMs=i["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in i&&(this.keepaliveTimeoutMs=i["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in i?this.keepaliveWithoutCalls=i["grpc.keepalive_permit_without_calls"]===1:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(s,a,o)=>{let l=!1;s===Zu.constants.NGHTTP2_ENHANCE_YOUR_CALM&&o&&o.equals(OT)&&(l=!0),this.trace("connection closed by GOAWAY with code "+s+" and data "+o?.toString()),this.reportDisconnectToOwner(l)}),e.once("error",s=>{this.trace("connection closed with error "+s.message)}),Gi.isTracerEnabled(Ju)&&(e.on("remoteSettings",s=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))}),e.on("localSettings",s=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,i;let n=this.session.socket,s=n.remoteAddress?(0,Ba.stringToSubchannelAddress)(n.remoteAddress,n.remotePort):null,a=n.localAddress?(0,Ba.stringToSubchannelAddress)(n.localAddress,n.localPort):null,o;if(this.session.encrypted){let c=n,p=c.getCipher(),m=c.getCertificate(),S=c.getPeerCertificate();o={cipherSuiteStandardName:(e=p.standardName)!==null&&e!==void 0?e:null,cipherSuiteOtherName:p.standardName?null:p.name,localCertificate:m&&"raw"in m?m.raw:null,remoteCertificate:S&&"raw"in S?S.raw:null}}else o=null;return{remoteAddress:s,localAddress:a,security:o,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:(t=this.session.state.localWindowSize)!==null&&t!==void 0?t:null,remoteFlowControlWindow:(i=this.session.state.remoteWindowSize)!==null&&i!==void 0?i:null}}trace(e){Gi.trace(Hn.LogVerbosity.DEBUG,Ju,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){Gi.trace(Hn.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){Gi.trace(Hn.LogVerbosity.DEBUG,yT,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){Gi.trace(Hn.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),(t=(e=this.keepaliveTimeoutId).unref)===null||t===void 0||t.call(e));try{this.session.ping((i,n,s)=>{i&&(this.keepaliveTrace("Ping failed with error "+i.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch{this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):!this.keepaliveTimerId&&!this.keepaliveTimeoutId&&(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs),(t=(e=this.keepaliveTimerId).unref)===null||t===void 0||t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),this.activeCalls.size===0&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),this.activeCalls.size===1&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,i,n,s){let a=e.toHttp2Headers();a[ST]=t,a[bT]=this.userAgent,a[ET]="application/grpc",a[CT]="POST",a[wT]=i,a[TT]="trailers";let o;try{o=this.session.request(a)}catch(p){throw this.handleDisconnect(),p}this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed);let l,c;return this.channelzEnabled?(this.streamTracker.addCallStarted(),l={addMessageSent:()=>{var p;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,(p=s.addMessageSent)===null||p===void 0||p.call(s)},addMessageReceived:()=>{var p;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,(p=s.addMessageReceived)===null||p===void 0||p.call(s)},onCallEnd:p=>{var m;(m=s.onCallEnd)===null||m===void 0||m.call(s,p),this.removeActiveCall(c)},onStreamEnd:p=>{var m;p?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),(m=s.onStreamEnd)===null||m===void 0||m.call(s,p)}}):l={addMessageSent:()=>{var p;(p=s.addMessageSent)===null||p===void 0||p.call(s)},addMessageReceived:()=>{var p;(p=s.addMessageReceived)===null||p===void 0||p.call(s)},onCallEnd:p=>{var m;(m=s.onCallEnd)===null||m===void 0||m.call(s,p),this.removeActiveCall(c)},onStreamEnd:p=>{var m;(m=s.onStreamEnd)===null||m===void 0||m.call(s,p)}},c=new mT.Http2SubchannelCall(o,l,n,this,(0,vT.getNextCallNumber)()),this.addActiveCall(c),c}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}shutdown(){this.session.close(),(0,Fa.unregisterChannelzRef)(this.channelzRef)}},Qu=class{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){Gi.trace(Hn.LogVerbosity.DEBUG,Ju,(0,ji.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,i,n){return this.isShutdown?Promise.reject():new Promise((s,a)=>{var o,l,c,p;let m;n.realTarget?(m=(0,ji.uriToString)(n.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,ji.uriToString)(n.realTarget))):(m=null,this.trace("creating HTTP/2 session to "+(0,Ba.subchannelAddressToString)(e)));let S=(0,Tv.getDefaultAuthority)((o=n.realTarget)!==null&&o!==void 0?o:this.channelTarget),O=t._getConnectionOptions()||{};O.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in i?O.maxSessionMemory=i["grpc-node.max_session_memory"]:O.maxSessionMemory=Number.MAX_SAFE_INTEGER;let N="http://";if("secureContext"in O){if(N="https://",i["grpc.ssl_target_name_override"]){let A=i["grpc.ssl_target_name_override"],D=(l=O.checkServerIdentity)!==null&&l!==void 0?l:wv.checkServerIdentity;O.checkServerIdentity=(j,L)=>D(A,L),O.servername=A}else{let A=(p=(c=(0,ji.splitHostPort)(S))===null||c===void 0?void 0:c.host)!==null&&p!==void 0?p:"localhost";O.servername=A}n.socket&&(O.createConnection=(A,D)=>n.socket)}else O.createConnection=(A,D)=>n.socket?n.socket:gT.connect(e);O=Object.assign(Object.assign(Object.assign({},O),e),{enableTrace:i["grpc-node.tls_enable_trace"]===1});let k=Zu.connect(N+S,O);this.session=k;let I="Failed to connect";k.unref(),k.once("connect",()=>{k.removeAllListeners(),s(new Xu(k,e,i,m)),this.session=null}),k.once("close",()=>{this.session=null,setImmediate(()=>{a(`${I} (${new Date().toISOString()})`)})}),k.once("error",A=>{I=A.message,this.trace("connection failed with error "+I)})})}connect(e,t,i){var n,s,a;if(this.isShutdown)return Promise.reject();let o=t._getConnectionOptions()||{};if("secureContext"in o){if(o.ALPNProtocols=["h2"],i["grpc.ssl_target_name_override"]){let l=i["grpc.ssl_target_name_override"],c=(n=o.checkServerIdentity)!==null&&n!==void 0?n:wv.checkServerIdentity;o.checkServerIdentity=(p,m)=>c(l,m),o.servername=l}else if("grpc.http_connect_target"in i){let l=(0,Tv.getDefaultAuthority)((s=(0,ji.parseUri)(i["grpc.http_connect_target"]))!==null&&s!==void 0?s:{path:"localhost"}),c=(0,ji.splitHostPort)(l);o.servername=(a=c?.host)!==null&&a!==void 0?a:l}i["grpc-node.tls_enable_trace"]&&(o.enableTrace=!0)}return(0,pT.getProxiedConnection)(e,i,o).then(l=>this.createSession(e,t,i,l))}shutdown(){var e;this.isShutdown=!0,(e=this.session)===null||e===void 0||e.close(),this.session=null}};Ua.Http2SubchannelConnector=Qu});var Rv=w(Wi=>{"use strict";Object.defineProperty(Wi,"__esModule",{value:!0});Wi.getSubchannelPool=Wi.SubchannelPool=void 0;var kT=np(),AT=gv(),MT=Tt(),PT=rt(),xT=bv(),NT=1e4,jn=class{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let n=this.pool[t].filter(s=>!s.subchannel.unrefIfOneRef());n.length>0&&(e=!1),this.pool[t]=n}e&&this.cleanupTimer!==null&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;this.cleanupTimer===null&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},NT),(t=(e=this.cleanupTimer).unref)===null||t===void 0||t.call(e))}getOrCreateSubchannel(e,t,i,n){this.ensureCleanupTask();let s=(0,PT.uriToString)(e);if(s in this.pool){let o=this.pool[s];for(let l of o)if((0,MT.subchannelAddressEqual)(t,l.subchannelAddress)&&(0,kT.channelOptionsEqual)(i,l.channelArguments)&&n._equals(l.channelCredentials))return l.subchannel}let a=new AT.Subchannel(e,t,i,n,new xT.Http2SubchannelConnector(e));return s in this.pool||(this.pool[s]=[]),this.pool[s].push({subchannelAddress:t,channelArguments:i,channelCredentials:n,subchannel:a}),a.ref(),a}};Wi.SubchannelPool=jn;var IT=new jn;function DT(r){return r?IT:new jn}Wi.getSubchannelPool=DT});var th=w($i=>{"use strict";Object.defineProperty($i,"__esModule",{value:!0});$i.FilterStackFactory=$i.FilterStack=void 0;var za=class{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let i=0;i<this.filters.length;i++)t=this.filters[i].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let i=this.filters.length-1;i>=0;i--)t=this.filters[i].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let i=0;i<this.filters.length;i++)t=this.filters[i].sendMessage(t);return t}receiveMessage(e){let t=e;for(let i=this.filters.length-1;i>=0;i--)t=this.filters[i].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let i=this.filters.length-1;i>=0;i--)t=this.filters[i].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}};$i.FilterStack=za;var eh=class r{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new r([...this.factories])}createFilter(){return new za(this.factories.map(e=>e.createFilter()))}};$i.FilterStackFactory=eh});var rh=w(Ha=>{"use strict";Object.defineProperty(Ha,"__esModule",{value:!0});Ha.CompressionAlgorithms=void 0;var Ov;(function(r){r[r.identity=0]="identity",r[r.deflate=1]="deflate",r[r.gzip=2]="gzip"})(Ov||(Ha.CompressionAlgorithms=Ov={}))});var Ga=w(ja=>{"use strict";Object.defineProperty(ja,"__esModule",{value:!0});ja.BaseFilter=void 0;var ih=class{async sendMetadata(e){return e}receiveMetadata(e){return e}async sendMessage(e){return e}async receiveMessage(e){return e}receiveTrailers(e){return e}};ja.BaseFilter=ih});var Mv=w(Ki=>{"use strict";Object.defineProperty(Ki,"__esModule",{value:!0});Ki.CompressionFilterFactory=Ki.CompressionFilter=void 0;var Wa=require("zlib"),Av=rh(),qT=re(),LT=Ga(),FT=we(),BT=r=>typeof r=="number"&&typeof Av.CompressionAlgorithms[r]=="string",Vi=class{async writeMessage(e,t){let i=e;t&&(i=await this.compressMessage(i));let n=Buffer.allocUnsafe(i.length+5);return n.writeUInt8(t?1:0,0),n.writeUInt32BE(i.length,1),i.copy(n,5),n}async readMessage(e){let t=e.readUInt8(0)===1,i=e.slice(5);return t&&(i=await this.decompressMessage(i)),i}},si=class extends Vi{async compressMessage(e){return e}async writeMessage(e,t){let i=Buffer.allocUnsafe(e.length+5);return i.writeUInt8(0,0),i.writeUInt32BE(e.length,1),e.copy(i,5),i}decompressMessage(e){return Promise.reject(new Error('Received compressed message but "grpc-encoding" header was identity'))}},nh=class extends Vi{compressMessage(e){return new Promise((t,i)=>{Wa.deflate(e,(n,s)=>{n?i(n):t(s)})})}decompressMessage(e){return new Promise((t,i)=>{Wa.inflate(e,(n,s)=>{n?i(n):t(s)})})}},sh=class extends Vi{compressMessage(e){return new Promise((t,i)=>{Wa.gzip(e,(n,s)=>{n?i(n):t(s)})})}decompressMessage(e){return new Promise((t,i)=>{Wa.unzip(e,(n,s)=>{n?i(n):t(s)})})}},ah=class extends Vi{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(new Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(new Error(`Compression method not supported: ${this.compressionName}`))}};function kv(r){switch(r){case"identity":return new si;case"deflate":return new nh;case"gzip":return new sh;default:return new ah(r)}}var $a=class extends LT.BaseFilter{constructor(e,t){var i;super(),this.sharedFilterConfig=t,this.sendCompression=new si,this.receiveCompression=new si,this.currentCompressionAlgorithm="identity";let n=e["grpc.default_compression_algorithm"];if(n!==void 0)if(BT(n)){let s=Av.CompressionAlgorithms[n],a=(i=t.serverSupportedEncodingHeader)===null||i===void 0?void 0:i.split(",");(!a||a.includes(s))&&(this.currentCompressionAlgorithm=s,this.sendCompression=kv(this.currentCompressionAlgorithm))}else FT.log(qT.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${n}`)}async sendMetadata(e){let t=await e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),this.currentCompressionAlgorithm==="identity"?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let n=t[0];typeof n=="string"&&(this.receiveCompression=kv(n))}e.remove("grpc-encoding");let i=e.get("grpc-accept-encoding")[0];return i&&(this.sharedFilterConfig.serverSupportedEncodingHeader=i,i.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new si,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}async sendMessage(e){var t;let i=await e,n;return this.sendCompression instanceof si?n=!1:n=(((t=i.flags)!==null&&t!==void 0?t:0)&2)===0,{message:await this.sendCompression.writeMessage(i.message,n),flags:i.flags}}async receiveMessage(e){return this.receiveCompression.readMessage(await e)}};Ki.CompressionFilter=$a;var oh=class{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new $a(this.options,this.sharedFilterConfig)}};Ki.CompressionFilterFactory=oh});var xv=w(Yi=>{"use strict";Object.defineProperty(Yi,"__esModule",{value:!0});Yi.MaxMessageSizeFilterFactory=Yi.MaxMessageSizeFilter=void 0;var UT=Ga(),Va=re(),Pv=Ve(),Ka=class extends UT.BaseFilter{constructor(e){super(),this.maxSendMessageSize=Va.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=Va.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,"grpc.max_send_message_length"in e&&(this.maxSendMessageSize=e["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in e&&(this.maxReceiveMessageSize=e["grpc.max_receive_message_length"])}async sendMessage(e){if(this.maxSendMessageSize===-1)return e;{let t=await e;if(t.message.length>this.maxSendMessageSize)throw{code:Va.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${t.message.length} vs. ${this.maxSendMessageSize})`,metadata:new Pv.Metadata};return t}}async receiveMessage(e){if(this.maxReceiveMessageSize===-1)return e;{let t=await e;if(t.length>this.maxReceiveMessageSize)throw{code:Va.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${t.length} vs. ${this.maxReceiveMessageSize})`,metadata:new Pv.Metadata};return t}}};Yi.MaxMessageSizeFilter=Ka;var lh=class{constructor(e){this.options=e}createFilter(){return new Ka(this.options)}};Yi.MaxMessageSizeFilterFactory=lh});var Gn=w(_t=>{"use strict";Object.defineProperty(_t,"__esModule",{value:!0});_t.formatDateDifference=_t.deadlineToString=_t.getRelativeTimeout=_t.getDeadlineTimeoutString=_t.minDeadline=void 0;function zT(...r){let e=1/0;for(let t of r){let i=t instanceof Date?t.getTime():t;i<e&&(e=i)}return e}_t.minDeadline=zT;var HT=[["m",1],["S",1e3],["M",60*1e3],["H",60*60*1e3]];function jT(r){let e=new Date().getTime();r instanceof Date&&(r=r.getTime());let t=Math.max(r-e,0);for(let[i,n]of HT){let s=t/n;if(s<1e8)return String(Math.ceil(s))+i}throw new Error("Deadline is too far in the future")}_t.getDeadlineTimeoutString=jT;var GT=2147483647;function WT(r){let e=r instanceof Date?r.getTime():r,t=new Date().getTime(),i=e-t;return i<0?0:i>GT?1/0:i}_t.getRelativeTimeout=WT;function $T(r){if(r instanceof Date)return r.toISOString();{let e=new Date(r);return Number.isNaN(e.getTime())?""+r:e.toISOString()}}_t.deadlineToString=$T;function VT(r,e){return((e.getTime()-r.getTime())/1e3).toFixed(3)+"s"}_t.formatDateDifference=VT});var Ja=w(Ya=>{"use strict";Object.defineProperty(Ya,"__esModule",{value:!0});Ya.restrictControlPlaneStatusCode=void 0;var tr=re(),KT=[tr.Status.OK,tr.Status.INVALID_ARGUMENT,tr.Status.NOT_FOUND,tr.Status.ALREADY_EXISTS,tr.Status.FAILED_PRECONDITION,tr.Status.ABORTED,tr.Status.OUT_OF_RANGE,tr.Status.DATA_LOSS];function YT(r,e){return KT.includes(r)?{code:tr.Status.INTERNAL,details:`Invalid status from control plane: ${r} ${tr.Status[r]} ${e}`}:{code:r,details:e}}Ya.restrictControlPlaneStatusCode=YT});var Dv=w(Za=>{"use strict";Object.defineProperty(Za,"__esModule",{value:!0});Za.LoadBalancingCall=void 0;var Nv=ut(),Xa=re(),Iv=Gn(),Qa=Ve(),Wn=Cr(),JT=rt(),XT=we(),ch=Ja(),QT=require("http2"),ZT="load_balancing_call",uh=class{constructor(e,t,i,n,s,a,o){var l,c;this.channel=e,this.callConfig=t,this.methodName=i,this.host=n,this.credentials=s,this.deadline=a,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null,this.childStartTime=null;let p=this.methodName.split("/"),m="";p.length>=2&&(m=p[1]);let S=(c=(l=(0,JT.splitHostPort)(this.host))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";this.serviceUrl=`https://${S}/${m}`,this.startTime=new Date}getDeadlineInfo(){var e,t;let i=[];return this.childStartTime?(this.childStartTime>this.startTime&&(!((e=this.metadata)===null||e===void 0)&&e.getOptions().waitForReady&&i.push("wait_for_ready"),i.push(`LB pick: ${(0,Iv.formatDateDifference)(this.startTime,this.childStartTime)}`)),i.push(...this.child.getDeadlineInfo()),i):(!((t=this.metadata)===null||t===void 0)&&t.getOptions().waitForReady&&i.push("wait_for_ready"),i.push("Waiting for LB pick"),i)}trace(e){XT.trace(Xa.LogVerbosity.DEBUG,ZT,"["+this.callNumber+"] "+e)}outputStatus(e,t){var i,n;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'" start time='+this.startTime.toISOString());let s=Object.assign(Object.assign({},e),{progress:t});(i=this.listener)===null||i===void 0||i.onReceiveStatus(s),(n=this.onCallEnded)===null||n===void 0||n.call(this,s.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw new Error("doPick called before start");this.trace("Pick called");let i=this.metadata.clone(),n=this.channel.doPick(i,this.callConfig.pickInformation),s=n.subchannel?"("+n.subchannel.getChannelzRef().id+") "+n.subchannel.getAddress():""+n.subchannel;switch(this.trace("Pick result: "+Wn.PickResultType[n.pickResultType]+" subchannel: "+s+" status: "+((e=n.status)===null||e===void 0?void 0:e.code)+" "+((t=n.status)===null||t===void 0?void 0:t.details)),n.pickResultType){case Wn.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(l=>{var c,p,m;if(this.ended){this.trace("Credentials metadata generation finished after call ended");return}if(i.merge(l),i.get("authorization").length>1&&this.outputStatus({code:Xa.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new Qa.Metadata},"PROCESSED"),n.subchannel.getConnectivityState()!==Nv.ConnectivityState.READY){this.trace("Picked subchannel "+s+" has state "+Nv.ConnectivityState[n.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&i.set("grpc-timeout",(0,Iv.getDeadlineTimeoutString)(this.deadline));try{this.child=n.subchannel.getRealSubchannel().createCall(i,this.host,this.methodName,{onReceiveMetadata:S=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(S)},onReceiveMessage:S=>{this.trace("Received message"),this.listener.onReceiveMessage(S)},onReceiveStatus:S=>{this.trace("Received status"),S.rstCode===QT.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(S,"REFUSED"):this.outputStatus(S,"PROCESSED")}}),this.childStartTime=new Date}catch(S){this.trace("Failed to start call on picked subchannel "+s+" with error "+S.message),this.outputStatus({code:Xa.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+S.message,metadata:new Qa.Metadata},"NOT_STARTED");return}(p=(c=this.callConfig).onCommitted)===null||p===void 0||p.call(c),(m=n.onCallStarted)===null||m===void 0||m.call(n),this.onCallEnded=n.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},l=>{let{code:c,details:p}=(0,ch.restrictControlPlaneStatusCode)(typeof l.code=="number"?l.code:Xa.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${l.message}`);this.outputStatus({code:c,details:p,metadata:new Qa.Metadata},"PROCESSED")});break;case Wn.PickResultType.DROP:let{code:a,details:o}=(0,ch.restrictControlPlaneStatusCode)(n.status.code,n.status.details);setImmediate(()=>{this.outputStatus({code:a,details:o,metadata:n.status.metadata},"DROP")});break;case Wn.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:l,details:c}=(0,ch.restrictControlPlaneStatusCode)(n.status.code,n.status.details);setImmediate(()=>{this.outputStatus({code:l,details:c,metadata:n.status.metadata},"PROCESSED")})}break;case Wn.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var i;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(i=this.child)===null||i===void 0||i.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new Qa.Metadata},"PROCESSED")}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw new Error("Method not implemented.")}getCallNumber(){return this.callNumber}};Za.LoadBalancingCall=uh});var Lv=w(eo=>{"use strict";Object.defineProperty(eo,"__esModule",{value:!0});eo.ResolvingCall=void 0;var ai=re(),oi=Gn(),qv=Ve(),eb=we(),tb=Ja(),rb="resolving_call",hh=class{constructor(e,t,i,n,s,a){this.channel=e,this.method=t,this.filterStackFactory=n,this.credentials=s,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadlineStartTime=null,this.configReceivedTime=null,this.childStartTime=null,this.deadline=i.deadline,this.host=i.host,i.parentCall&&(i.flags&ai.Propagate.CANCELLATION&&i.parentCall.on("cancelled",()=>{this.cancelWithStatus(ai.Status.CANCELLED,"Cancelled by parent call")}),i.flags&ai.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+i.parentCall.getDeadline()),this.deadline=(0,oi.minDeadline)(this.deadline,i.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){eb.trace(ai.LogVerbosity.DEBUG,rb,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.deadlineStartTime=new Date,this.trace("Deadline: "+(0,oi.deadlineToString)(this.deadline));let e=(0,oi.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{if(!this.deadlineStartTime){this.cancelWithStatus(ai.Status.DEADLINE_EXCEEDED,"Deadline exceeded");return}let i=[],n=new Date;i.push(`Deadline exceeded after ${(0,oi.formatDateDifference)(this.deadlineStartTime,n)}`),this.configReceivedTime?(this.configReceivedTime>this.deadlineStartTime&&i.push(`name resolution: ${(0,oi.formatDateDifference)(this.deadlineStartTime,this.configReceivedTime)}`),this.childStartTime?this.childStartTime>this.configReceivedTime&&i.push(`metadata filters: ${(0,oi.formatDateDifference)(this.configReceivedTime,this.childStartTime)}`):i.push("waiting for metadata filters")):i.push("waiting for name resolution"),this.child&&i.push(...this.child.getDeadlineInfo()),this.cancelWithStatus(ai.Status.DEADLINE_EXCEEDED,i.join(","))};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(i=>i(t)),process.nextTick(()=>{var i;(i=this.listener)===null||i===void 0||i.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw new Error("sendMessageonChild called with child not populated");let i=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(n=>{this.writeFilterPending=!1,i.sendMessageWithContext(e,n.message),this.pendingHalfClose&&i.halfClose()},n=>{this.cancelWithStatus(n.code,n.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw new Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if(e.type==="NONE"){this.channel.queueCallForConfig(this);return}else if(e.type==="ERROR"){this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error);return}this.configReceivedTime=new Date;let t=e.config;if(t.status!==ai.Status.OK){let{code:i,details:n}=(0,tb.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:i,details:n,metadata:new qv.Metadata});return}if(t.methodConfig.timeout){let i=new Date;i.setSeconds(i.getSeconds()+t.methodConfig.timeout.seconds),i.setMilliseconds(i.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,oi.minDeadline)(this.deadline,i),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(i=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.childStartTime=new Date,this.child.start(i,{onReceiveMetadata:n=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(n))},onReceiveMessage:n=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(n).then(s=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(s),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},s=>{this.cancelWithStatus(s.code,s.details)})},onReceiveStatus:n=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=n:this.outputStatus(n)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},i=>{this.outputStatus(i)})}reportResolverError(e){var t;!((t=this.metadata)===null||t===void 0)&&t.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var i;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(i=this.child)===null||i===void 0||i.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new qv.Metadata})}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}};eo.ResolvingCall=hh});var Fv=w(Lr=>{"use strict";Object.defineProperty(Lr,"__esModule",{value:!0});Lr.RetryingCall=Lr.MessageBufferTracker=Lr.RetryThrottler=void 0;var to=re(),ib=Gn(),nb=Ve(),sb=we(),ab="retrying_call",fh=class{constructor(e,t,i){this.maxTokens=e,this.tokenRatio=t,i?this.tokens=i.tokens*(e/i.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}};Lr.RetryThrottler=fh;var ph=class{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var i;let n=(i=this.allocatedPerCall.get(t))!==null&&i!==void 0?i:0;return this.limitPerCall-n<e||this.totalLimit-this.totalAllocated<e?!1:(this.allocatedPerCall.set(t,n+e),this.totalAllocated+=e,!0)}free(e,t){var i;if(this.totalAllocated<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let n=(i=this.allocatedPerCall.get(t))!==null&&i!==void 0?i:0;if(n<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${n}`);this.allocatedPerCall.set(t,n-e)}freeAll(e){var t;let i=(t=this.allocatedPerCall.get(e))!==null&&t!==void 0?t:0;if(this.totalAllocated<i)throw new Error(`Invalid buffer allocation state: call ${e} allocated ${i} > total allocated ${this.totalAllocated}`);this.totalAllocated-=i,this.allocatedPerCall.delete(e)}};Lr.MessageBufferTracker=ph;var dh="grpc-previous-rpc-attempts",gh=class{constructor(e,t,i,n,s,a,o,l,c){if(this.channel=e,this.callConfig=t,this.methodName=i,this.host=n,this.credentials=s,this.deadline=a,this.callNumber=o,this.bufferTracker=l,this.retryThrottler=c,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";let p=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(p.initialBackoff.substring(0,p.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY";this.startTime=new Date}getDeadlineInfo(){if(this.underlyingCalls.length===0)return[];let e=[],t=this.underlyingCalls[this.underlyingCalls.length-1];return this.underlyingCalls.length>1&&e.push(`previous attempts: ${this.underlyingCalls.length-1}`),t.startTime>this.startTime&&e.push(`time to current attempt start: ${(0,ib.formatDateDifference)(this.startTime,t.startTime)}`),e.push(...t.call.getDeadlineInfo()),e}getCallNumber(){return this.callNumber}trace(e){sb.trace(to.LogVerbosity.DEBUG,ab,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'" start time='+this.startTime.toISOString()),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;(t=this.listener)===null||t===void 0||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new nb.Metadata});for(let{call:i}of this.underlyingCalls)i.cancelWithStatus(e,t)}getPeer(){return this.committedCallIndex!==null?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return(t=this.writeBuffer[e-this.writeBufferOffset])!==null&&t!==void 0?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if(this.state!=="COMMITTED")return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let i=this.getBufferEntry(t);i.allocated&&this.bufferTracker.free(i.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if(this.state!=="COMMITTED"&&this.underlyingCalls[e].state!=="COMPLETED"){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&this.underlyingCalls[t].state!=="COMPLETED"&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(to.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if(this.state==="COMMITTED")return;let e=-1,t=-1;for(let[i,n]of this.underlyingCalls.entries())n.state==="ACTIVE"&&n.nextMessageToSend>e&&(e=n.nextMessageToSend,t=i);t===-1?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(i=>i===t||i.toString().toLowerCase()===to.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=(e=this.callConfig)===null||e===void 0?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let i=Math.random()*this.nextRetryBackoffSec*1e3,n=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,n),i}maybeRetryCall(e,t){if(this.state!=="RETRY"){t(!1);return}let i=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(i.maxAttempts,5)){t(!1);return}let n;if(e===null)n=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else n=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var s,a;if(this.state!=="RETRY"){t(!1);return}(!((a=(s=this.retryThrottler)===null||s===void 0?void 0:s.canRetryCall())!==null&&a!==void 0)||a)&&(t(!0),this.attempts+=1,this.startNewAttempt())},n)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,i){var n,s,a;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList((n=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)!==null&&n!==void 0?n:[],e.code)){(s=this.retryThrottler)===null||s===void 0||s.addCallFailed();let o;if(i===null)o=0;else if(i<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else o=i;setTimeout(()=>{this.maybeStartHedgingAttempt(),this.countActiveCalls()===0&&(this.commitCall(t),this.reportStatus(e))},o)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?((a=this.retryThrottler)===null||a===void 0||a.addCallFailed(),this.maybeRetryCall(i,o=>{o||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e));break}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(t.length===0)return null;try{return parseInt(t[0])}catch{return-1}}handleChildStatus(e,t){var i;if(this.underlyingCalls[t].state==="COMPLETED")return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===to.Status.OK){(i=this.retryThrottler)===null||i===void 0||i.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if(this.state==="COMMITTED"){this.reportStatus(e);return}let n=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,n):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,n);break}}maybeStartHedgingAttempt(){if(this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,i;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let n=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(n.maxAttempts,5))return;let s=(e=n.hedgingDelay)!==null&&e!==void 0?e:"0s",a=Number(s.substring(0,s.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},a*1e3),(i=(t=this.hedgingTimer).unref)===null||i===void 0||i.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0,startTime:new Date});let i=this.attempts-1,n=this.initialMetadata.clone();i>0&&n.set(dh,`${i}`);let s=!1;e.start(n,{onReceiveMetadata:a=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),s=!0,i>0&&a.set(dh,`${i}`),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMetadata(a)},onReceiveMessage:a=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMessage(a)},onReceiveStatus:a=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!s&&i>0&&a.metadata.set(dh,`${i}`),this.handleChildStatus(a,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,i;let n=this.underlyingCalls[e],s=n.nextMessageToSend;(i=(t=this.getBufferEntry(s)).callback)===null||i===void 0||i.call(t),this.clearSentMessages(),n.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if(t.state!=="COMPLETED"&&this.getBufferEntry(t.nextMessageToSend)){let i=this.getBufferEntry(t.nextMessageToSend);switch(i.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:n=>{this.handleChildWriteCompleted(e)}},i.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose();break;case"FREED":break}}}sendMessageWithContext(e,t){var i;this.trace("write() called with message of length "+t.length);let n={message:t,flags:e.flags},s=this.getNextBufferIndex(),a={entryType:"MESSAGE",message:n,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(a),a.allocated){(i=e.callback)===null||i===void 0||i.call(e);for(let[o,l]of this.underlyingCalls.entries())l.state==="ACTIVE"&&l.nextMessageToSend===s&&l.call.sendMessageWithContext({callback:c=>{this.handleChildWriteCompleted(o)}},t)}else{if(this.commitCallWithMostMessages(),this.committedCallIndex===null)return;let o=this.underlyingCalls[this.committedCallIndex];a.callback=e.callback,o.state==="ACTIVE"&&o.nextMessageToSend===s&&o.call.sendMessageWithContext({callback:l=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){this.trace("startRead called"),this.readStarted=!0;for(let e of this.underlyingCalls)e?.state==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1});for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw new Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}};Lr.RetryingCall=gh});var io=w(ro=>{"use strict";Object.defineProperty(ro,"__esModule",{value:!0});ro.BaseSubchannelWrapper=void 0;var mh=class{constructor(e){this.child=e,this.healthy=!0,this.healthListeners=new Set,e.addHealthStateWatcher(t=>{this.healthy&&this.updateHealthListeners()})}updateHealthListeners(){for(let e of this.healthListeners)e(this.isHealthy())}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}isHealthy(){return this.healthy&&this.child.isHealthy()}addHealthStateWatcher(e){this.healthListeners.add(e)}removeHealthStateWatcher(e){this.healthListeners.delete(e)}setHealthy(e){e!==this.healthy&&(this.healthy=e,this.child.isHealthy()&&this.updateHealthListeners())}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}};ro.BaseSubchannelWrapper=mh});var zv=w(ao=>{"use strict";Object.defineProperty(ao,"__esModule",{value:!0});ao.InternalChannel=void 0;var ob=Ls(),lb=ip(),cb=Rv(),Bv=Cr(),$n=re(),ub=th(),hb=Mv(),Uv=Ht(),vh=we(),db=xv(),fb=Wu(),no=rt(),rr=ut(),Vn=ni(),pb=Dv(),gb=Gn(),mb=Lv(),yh=Yu(),vb=Ja(),_h=Fv(),yb=io(),_b=2147483647,Sb=1e3,Eb=30*60*1e3,so=new Map,Cb=1<<24,wb=1<<20,Sh=class extends yb.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(i,n,s,a)=>{t.throttleKeepalive(a)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}},Eh=class{constructor(e,t,i){var n,s,a,o,l,c,p,m;if(this.credentials=t,this.options=i,this.connectivityState=rr.ConnectivityState.IDLE,this.currentPicker=new Bv.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new Vn.ChannelzCallTracker,this.childrenTracker=new Vn.ChannelzChildrenTracker,this.randomChannelId=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER),typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof ob.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(i&&typeof i!="object")throw new TypeError("Channel options must be an object");this.originalTarget=e;let S=(0,no.parseUri)(e);if(S===null)throw new Error(`Could not parse target name "${e}"`);let O=(0,Uv.mapUriDefaultScheme)(S);if(O===null)throw new Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},_b),(s=(n=this.callRefTimer).unref)===null||s===void 0||s.call(n),this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new Vn.ChannelzTrace,this.channelzRef=(0,Vn.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,Uv.getDefaultAuthority)(O);let N=(0,fb.mapProxyName)(O,i);this.target=N.target,this.options=Object.assign({},this.options,N.extraOptions),this.subchannelPool=(0,cb.getSubchannelPool)(((a=i["grpc.use_local_subchannel_pool"])!==null&&a!==void 0?a:0)===0),this.retryBufferTracker=new _h.MessageBufferTracker((o=i["grpc.retry_buffer_size"])!==null&&o!==void 0?o:Cb,(l=i["grpc.per_rpc_retry_buffer_size"])!==null&&l!==void 0?l:wb),this.keepaliveTime=(c=i["grpc.keepalive_time_ms"])!==null&&c!==void 0?c:-1,this.idleTimeoutMs=Math.max((p=i["grpc.client_idle_timeout_ms"])!==null&&p!==void 0?p:Eb,Sb);let k={createSubchannel:(A,D)=>{let j=this.subchannelPool.getOrCreateSubchannel(this.target,A,Object.assign({},this.options,D),this.credentials);j.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",j.getChannelzRef());let L=new Sh(j,this);return this.wrappedSubchannels.add(L),L},updateState:(A,D)=>{this.currentPicker=D;let j=this.pickQueue.slice();this.pickQueue=[],j.length>0&&this.callRefTimerUnref();for(let L of j)L.doPick();this.updateState(A)},requestReresolution:()=>{throw new Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:A=>{this.channelzEnabled&&this.childrenTracker.refChild(A)},removeChannelzChild:A=>{this.channelzEnabled&&this.childrenTracker.unrefChild(A)}};this.resolvingLoadBalancer=new lb.ResolvingLoadBalancer(this.target,k,i,(A,D)=>{A.retryThrottling?so.set(this.getTarget(),new _h.RetryThrottler(A.retryThrottling.maxTokens,A.retryThrottling.tokenRatio,so.get(this.getTarget()))):so.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=D,this.currentResolutionError=null,process.nextTick(()=>{let j=this.configSelectionQueue;this.configSelectionQueue=[],j.length>0&&this.callRefTimerUnref();for(let L of j)L.getConfig()})},A=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+A.code+' and details "'+A.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),this.configSelector===null&&(this.currentResolutionError=Object.assign(Object.assign({},(0,vb.restrictControlPlaneStatusCode)(A.code,A.details)),{metadata:A.metadata}));let D=this.configSelectionQueue;this.configSelectionQueue=[],D.length>0&&this.callRefTimerUnref();for(let j of D)j.reportResolverError(A)}),this.filterStackFactory=new ub.FilterStackFactory([new db.MaxMessageSizeFilterFactory(this.options),new hb.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(i,void 0,2));let I=new Error;(0,vh.trace)($n.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+`) Channel constructed 
`+((m=I.stack)===null||m===void 0?void 0:m.substring(I.stack.indexOf(`
`)+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,vh.trace)(t??$n.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,no.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,i,n;!((t=(e=this.callRefTimer).hasRef)===null||t===void 0)&&t.call(e)||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(n=(i=this.callRefTimer).ref)===null||n===void 0||n.call(i))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(t=(e=this.callRefTimer).unref)===null||t===void 0||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(i=>i===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){(0,vh.trace)($n.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,no.uriToString)(this.target)+" "+rr.ConnectivityState[this.connectivityState]+" -> "+rr.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+rr.ConnectivityState[e]),this.connectivityState=e;let t=this.connectivityStateWatchers.slice();for(let i of t)e!==i.currentState&&(i.timer&&clearTimeout(i.timer),this.removeConnectivityStateWatcher(i),i.callback());e!==rr.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime){this.keepaliveTime=e;for(let t of this.wrappedSubchannels)t.throttleKeepalive(e)}}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return this.resolvingLoadBalancer.exitIdle(),this.configSelector?{type:"SUCCESS",config:this.configSelector(e,t,this.randomChannelId)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(rr.ConnectivityState.IDLE),this.currentPicker=new Bv.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(e){var t,i;this.idleTimer=setTimeout(()=>{if(this.callCount>0){this.startIdleTimeout(this.idleTimeoutMs);return}let s=new Date().valueOf()-this.lastActivityTimestamp.valueOf();s>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-s)},e),(i=(t=this.idleTimer).unref)===null||i===void 0||i.call(t)}maybeStartIdleTimer(){this.connectivityState!==rr.ConnectivityState.SHUTDOWN&&!this.idleTimer&&this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(e){this.channelzEnabled&&(e.code===$n.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,i,n,s){let a=(0,yh.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+a+'] method="'+t+'"'),new pb.LoadBalancingCall(this,e,t,i,n,s,a)}createRetryingCall(e,t,i,n,s){let a=(0,yh.getNextCallNumber)();return this.trace("createRetryingCall ["+a+'] method="'+t+'"'),new _h.RetryingCall(this,e,t,i,n,s,a,this.retryBufferTracker,so.get(this.getTarget()))}createInnerCall(e,t,i,n,s){return this.options["grpc.enable_retries"]===0?this.createLoadBalancingCall(e,t,i,n,s):this.createRetryingCall(e,t,i,n,s)}createResolvingCall(e,t,i,n,s){let a=(0,yh.getNextCallNumber)();this.trace("createResolvingCall ["+a+'] method="'+e+'", deadline='+(0,gb.deadlineToString)(t));let o={deadline:t,flags:s??$n.Propagate.DEFAULTS,host:i??this.defaultAuthority,parentCall:n},l=new mb.ResolvingCall(this,e,o,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),a);return this.onCallStart(),l.addStatusWatcher(c=>{this.onCallEnd(c)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(rr.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,Vn.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,no.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,i){if(this.connectivityState===rr.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");let n=null;if(t!==1/0){let a=t instanceof Date?t:new Date(t),o=new Date;if(t===-1/0||a<=o){process.nextTick(i,new Error("Deadline passed without connectivity state change"));return}n=setTimeout(()=>{this.removeConnectivityStateWatcher(s),i(new Error("Deadline passed without connectivity state change"))},a.getTime()-o.getTime())}let s={currentState:e,callback:i,timer:n};this.connectivityStateWatchers.push(s)}getChannelzRef(){return this.channelzRef}createCall(e,t,i,n,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===rr.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");return this.createResolvingCall(e,t,i,n,s)}};ao.InternalChannel=Eh});var Rc=w(oo=>{"use strict";Object.defineProperty(oo,"__esModule",{value:!0});oo.ChannelImplementation=void 0;var Tb=Ls(),bb=zv(),Ch=class{constructor(e,t,i){if(typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof Tb.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(i&&typeof i!="object")throw new TypeError("Channel options must be an object");this.internalChannel=new bb.InternalChannel(e,t,i)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,i){this.internalChannel.watchConnectivityState(e,t,i)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,i,n,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,i,n,s)}};oo.ChannelImplementation=Ch});var jv=w(St=>{"use strict";Object.defineProperty(St,"__esModule",{value:!0});St.ServerDuplexStreamImpl=St.ServerWritableStreamImpl=St.ServerReadableStreamImpl=St.ServerUnaryCallImpl=St.serverErrorToStatus=void 0;var Rb=require("events"),Oh=require("stream"),kh=re(),Hv=Ve();function Ah(r,e){var t;let i={code:kh.Status.UNKNOWN,details:"message"in r?r.message:"Unknown Error",metadata:(t=e??r.metadata)!==null&&t!==void 0?t:null};return"code"in r&&typeof r.code=="number"&&Number.isInteger(r.code)&&(i.code=r.code,"details"in r&&typeof r.details=="string"&&(i.details=r.details)),i}St.serverErrorToStatus=Ah;var wh=class extends Rb.EventEmitter{constructor(e,t,i,n){super(),this.path=e,this.call=t,this.metadata=i,this.request=n,this.cancelled=!1}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.path}};St.ServerUnaryCallImpl=wh;var Th=class extends Oh.Readable{constructor(e,t,i){super({objectMode:!0}),this.path=e,this.call=t,this.metadata=i,this.cancelled=!1}_read(e){this.call.startRead()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.path}};St.ServerReadableStreamImpl=Th;var bh=class extends Oh.Writable{constructor(e,t,i,n){super({objectMode:!0}),this.path=e,this.call=t,this.metadata=i,this.request=n,this.pendingStatus={code:kh.Status.OK,details:"OK"},this.cancelled=!1,this.trailingMetadata=new Hv.Metadata,this.on("error",s=>{this.pendingStatus=Ah(s),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.path}_write(e,t,i){this.call.sendMessage(e,i)}_final(e){var t;e(null),this.call.sendStatus(Object.assign(Object.assign({},this.pendingStatus),{metadata:(t=this.pendingStatus.metadata)!==null&&t!==void 0?t:this.trailingMetadata}))}end(e){return e&&(this.trailingMetadata=e),super.end()}};St.ServerWritableStreamImpl=bh;var Rh=class extends Oh.Duplex{constructor(e,t,i){super({objectMode:!0}),this.path=e,this.call=t,this.metadata=i,this.pendingStatus={code:kh.Status.OK,details:"OK"},this.cancelled=!1,this.trailingMetadata=new Hv.Metadata,this.on("error",n=>{this.pendingStatus=Ah(n),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.path}_read(e){this.call.startRead()}_write(e,t,i){this.call.sendMessage(e,i)}_final(e){var t;e(null),this.call.sendStatus(Object.assign(Object.assign({},this.pendingStatus),{metadata:(t=this.pendingStatus.metadata)!==null&&t!==void 0?t:this.trailingMetadata}))}end(e){return e&&(this.trailingMetadata=e),super.end()}};St.ServerDuplexStreamImpl=Rh});var xh=w(lo=>{"use strict";Object.defineProperty(lo,"__esModule",{value:!0});lo.ServerCredentials=void 0;var Gv=Hl(),Kn=class{static createInsecure(){return new Mh}static createSsl(e,t,i=!1){var n;if(e!==null&&!Buffer.isBuffer(e))throw new TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw new TypeError("keyCertPairs must be an array");if(typeof i!="boolean")throw new TypeError("checkClientCertificate must be a boolean");let s=[],a=[];for(let o=0;o<t.length;o++){let l=t[o];if(l===null||typeof l!="object")throw new TypeError(`keyCertPair[${o}] must be an object`);if(!Buffer.isBuffer(l.private_key))throw new TypeError(`keyCertPair[${o}].private_key must be a Buffer`);if(!Buffer.isBuffer(l.cert_chain))throw new TypeError(`keyCertPair[${o}].cert_chain must be a Buffer`);s.push(l.cert_chain),a.push(l.private_key)}return new Ph({ca:(n=e??(0,Gv.getDefaultRootsData)())!==null&&n!==void 0?n:void 0,cert:s,key:a,requestCert:i,ciphers:Gv.CIPHER_SUITES})}};lo.ServerCredentials=Kn;var Mh=class r extends Kn{_isSecure(){return!1}_getSettings(){return null}_equals(e){return e instanceof r}},Ph=class r extends Kn{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}_equals(e){if(this===e)return!0;if(!(e instanceof r))return!1;if(Buffer.isBuffer(this.options.ca)&&Buffer.isBuffer(e.options.ca)){if(!this.options.ca.equals(e.options.ca))return!1}else if(this.options.ca!==e.options.ca)return!1;if(Array.isArray(this.options.cert)&&Array.isArray(e.options.cert)){if(this.options.cert.length!==e.options.cert.length)return!1;for(let t=0;t<this.options.cert.length;t++){let i=this.options.cert[t],n=e.options.cert[t];if(Buffer.isBuffer(i)&&Buffer.isBuffer(n)){if(!i.equals(n))return!1}else if(i!==n)return!1}}else if(this.options.cert!==e.options.cert)return!1;if(Array.isArray(this.options.key)&&Array.isArray(e.options.key)){if(this.options.key.length!==e.options.key.length)return!1;for(let t=0;t<this.options.key.length;t++){let i=this.options.key[t],n=e.options.key[t];if(Buffer.isBuffer(i)&&Buffer.isBuffer(n)){if(!i.equals(n))return!1}else if(i!==n)return!1}}else if(this.options.key!==e.options.key)return!1;return this.options.requestCert===e.options.requestCert}}});var Bh=w(tt=>{"use strict";Object.defineProperty(tt,"__esModule",{value:!0});tt.getServerInterceptingCall=tt.BaseServerInterceptingCall=tt.ServerInterceptingCall=tt.ResponderBuilder=tt.isInterceptingServerListener=tt.ServerListenerBuilder=void 0;var Wv=Ve(),st=re(),Ji=require("http2"),$v=Ps(),Jv=require("zlib"),Xv=require("util"),Ob=Vu(),Qv=we(),kb=(0,Xv.promisify)(Jv.unzip),Ab=(0,Xv.promisify)(Jv.inflate),Zv="server_call";function li(r){Qv.trace(st.LogVerbosity.DEBUG,Zv,r)}var Ih=class{constructor(){this.metadata=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveHalfClose(e){return this.halfClose=e,this}withOnCancel(e){return this.cancel=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveHalfClose:this.halfClose,onCancel:this.cancel}}};tt.ServerListenerBuilder=Ih;function Mb(r){return r.onReceiveMetadata!==void 0&&r.onReceiveMetadata.length===1}tt.isInterceptingServerListener=Mb;var Dh=class{constructor(e,t){this.listener=e,this.nextListener=t,this.cancelled=!1,this.processingMetadata=!1,this.hasPendingMessage=!1,this.pendingMessage=null,this.processingMessage=!1,this.hasPendingHalfClose=!1}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingHalfClose(){this.hasPendingHalfClose&&(this.nextListener.onReceiveHalfClose(),this.hasPendingHalfClose=!1)}onReceiveMetadata(e){this.cancelled||(this.processingMetadata=!0,this.listener.onReceiveMetadata(e,t=>{this.processingMetadata=!1,!this.cancelled&&(this.nextListener.onReceiveMetadata(t),this.processPendingMessage(),this.processPendingHalfClose())}))}onReceiveMessage(e){this.cancelled||(this.processingMessage=!0,this.listener.onReceiveMessage(e,t=>{this.processingMessage=!1,!this.cancelled&&(this.processingMetadata?(this.pendingMessage=t,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(t),this.processPendingHalfClose()))}))}onReceiveHalfClose(){this.cancelled||this.listener.onReceiveHalfClose(()=>{this.cancelled||(this.processingMetadata||this.processingMessage?this.hasPendingHalfClose=!0:this.nextListener.onReceiveHalfClose())})}onCancel(){this.cancelled=!0,this.listener.onCancel(),this.nextListener.onCancel()}},qh=class{constructor(){this.start=void 0,this.metadata=void 0,this.message=void 0,this.status=void 0}withStart(e){return this.start=e,this}withSendMetadata(e){return this.metadata=e,this}withSendMessage(e){return this.message=e,this}withSendStatus(e){return this.status=e,this}build(){return{start:this.start,sendMetadata:this.metadata,sendMessage:this.message,sendStatus:this.status}}};tt.ResponderBuilder=qh;var co={onReceiveMetadata:(r,e)=>{e(r)},onReceiveMessage:(r,e)=>{e(r)},onReceiveHalfClose:r=>{r()},onCancel:()=>{}},uo={start:r=>{r()},sendMetadata:(r,e)=>{e(r)},sendMessage:(r,e)=>{e(r)},sendStatus:(r,e)=>{e(r)}},Lh=class{constructor(e,t){var i,n,s,a;this.nextCall=e,this.processingMetadata=!1,this.processingMessage=!1,this.pendingMessage=null,this.pendingMessageCallback=null,this.pendingStatus=null,this.responder={start:(i=t?.start)!==null&&i!==void 0?i:uo.start,sendMetadata:(n=t?.sendMetadata)!==null&&n!==void 0?n:uo.sendMetadata,sendMessage:(s=t?.sendMessage)!==null&&s!==void 0?s:uo.sendMessage,sendStatus:(a=t?.sendStatus)!==null&&a!==void 0?a:uo.sendStatus}}processPendingMessage(){this.pendingMessageCallback&&(this.nextCall.sendMessage(this.pendingMessage,this.pendingMessageCallback),this.pendingMessage=null,this.pendingMessageCallback=null)}processPendingStatus(){this.pendingStatus&&(this.nextCall.sendStatus(this.pendingStatus),this.pendingStatus=null)}start(e){this.responder.start(t=>{var i,n,s,a;let o={onReceiveMetadata:(i=t?.onReceiveMetadata)!==null&&i!==void 0?i:co.onReceiveMetadata,onReceiveMessage:(n=t?.onReceiveMessage)!==null&&n!==void 0?n:co.onReceiveMessage,onReceiveHalfClose:(s=t?.onReceiveHalfClose)!==null&&s!==void 0?s:co.onReceiveHalfClose,onCancel:(a=t?.onCancel)!==null&&a!==void 0?a:co.onCancel},l=new Dh(o,e);this.nextCall.start(l)})}sendMetadata(e){this.processingMetadata=!0,this.responder.sendMetadata(e,t=>{this.processingMetadata=!1,this.nextCall.sendMetadata(t),this.processPendingMessage(),this.processPendingStatus()})}sendMessage(e,t){this.processingMessage=!0,this.responder.sendMessage(e,i=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=i,this.pendingMessageCallback=t):this.nextCall.sendMessage(i,t)})}sendStatus(e){this.responder.sendStatus(e,t=>{this.processingMetadata||this.processingMessage?this.pendingStatus=t:this.nextCall.sendStatus(t)})}startRead(){this.nextCall.startRead()}getPeer(){return this.nextCall.getPeer()}getDeadline(){return this.nextCall.getDeadline()}};tt.ServerInterceptingCall=Lh;var ey="grpc-accept-encoding",Fh="grpc-encoding",Vv="grpc-message",Kv="grpc-status",Nh="grpc-timeout",Pb=/(\d{1,8})\s*([HMSmun])/,xb={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},Nb={[ey]:"identity,deflate,gzip",[Fh]:"identity"},Yv={[Ji.constants.HTTP2_HEADER_STATUS]:Ji.constants.HTTP_STATUS_OK,[Ji.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},Ib={waitForTrailers:!0},ho=class{constructor(e,t,i,n,s){this.stream=e,this.callEventTracker=i,this.handler=n,this.listener=null,this.deadlineTimer=null,this.deadline=1/0,this.maxSendMessageSize=st.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=st.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.cancelled=!1,this.metadataSent=!1,this.wantTrailers=!1,this.cancelNotified=!1,this.incomingEncoding="identity",this.decoder=new Ob.StreamDecoder,this.readQueue=[],this.isReadPending=!1,this.receivedHalfClose=!1,this.streamEnded=!1,this.stream.once("error",c=>{}),this.stream.once("close",()=>{var c;li("Request to method "+((c=this.handler)===null||c===void 0?void 0:c.path)+" stream closed with rstCode "+this.stream.rstCode),this.callEventTracker&&!this.streamEnded&&(this.streamEnded=!0,this.callEventTracker.onStreamEnd(!1),this.callEventTracker.onCallEnd({code:st.Status.CANCELLED,details:"Stream closed before sending status",metadata:null})),this.notifyOnCancel()}),this.stream.on("data",c=>{this.handleDataFrame(c)}),this.stream.pause(),this.stream.on("end",()=>{this.handleEndEvent()}),"grpc.max_send_message_length"in s&&(this.maxSendMessageSize=s["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in s&&(this.maxReceiveMessageSize=s["grpc.max_receive_message_length"]);let a=Wv.Metadata.fromHttp2Headers(t);Qv.isTracerEnabled(Zv)&&li("Request to "+this.handler.path+" received headers "+JSON.stringify(a.toJSON()));let o=a.get(Nh);o.length>0&&this.handleTimeoutHeader(o[0]);let l=a.get(Fh);l.length>0&&(this.incomingEncoding=l[0]),a.remove(Nh),a.remove(Fh),a.remove(ey),a.remove(Ji.constants.HTTP2_HEADER_ACCEPT_ENCODING),a.remove(Ji.constants.HTTP2_HEADER_TE),a.remove(Ji.constants.HTTP2_HEADER_CONTENT_TYPE),this.metadata=a}handleTimeoutHeader(e){let t=e.toString().match(Pb);if(t===null){let s={code:st.Status.INTERNAL,details:`Invalid ${Nh} value "${e}"`,metadata:null};process.nextTick(()=>{this.sendStatus(s)});return}let i=+t[1]*xb[t[2]]|0,n=new Date;this.deadline=n.setMilliseconds(n.getMilliseconds()+i),this.deadlineTimer=setTimeout(()=>{let s={code:st.Status.DEADLINE_EXCEEDED,details:"Deadline exceeded",metadata:null};this.sendStatus(s)},i)}checkCancelled(){return!this.cancelled&&(this.stream.destroyed||this.stream.closed)&&(this.notifyOnCancel(),this.cancelled=!0),this.cancelled}notifyOnCancel(){this.cancelNotified||(this.cancelNotified=!0,this.cancelled=!0,process.nextTick(()=>{var e;(e=this.listener)===null||e===void 0||e.onCancel()}),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.resume())}maybeSendMetadata(){this.metadataSent||this.sendMetadata(new Wv.Metadata)}serializeMessage(e){let t=this.handler.serialize(e),i=t.byteLength,n=Buffer.allocUnsafe(i+5);return n.writeUInt8(0,0),n.writeUInt32BE(i,1),t.copy(n,5),n}decompressMessage(e,t){switch(t){case"deflate":return Ab(e.subarray(5));case"gzip":return kb(e.subarray(5));case"identity":return e.subarray(5);default:return Promise.reject({code:st.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`})}}async decompressAndMaybePush(e){if(e.type!=="COMPRESSED")throw new Error(`Invalid queue entry type: ${e.type}`);let i=e.compressedMessage.readUInt8(0)===1?this.incomingEncoding:"identity",n=await this.decompressMessage(e.compressedMessage,i);try{e.parsedMessage=this.handler.deserialize(n)}catch(s){this.sendStatus({code:st.Status.INTERNAL,details:`Error deserializing request: ${s.message}`});return}e.type="READABLE",this.maybePushNextMessage()}maybePushNextMessage(){if(this.listener&&this.isReadPending&&this.readQueue.length>0&&this.readQueue[0].type!=="COMPRESSED"){this.isReadPending=!1;let e=this.readQueue.shift();e.type==="READABLE"?this.listener.onReceiveMessage(e.parsedMessage):this.listener.onReceiveHalfClose()}}handleDataFrame(e){var t;if(this.checkCancelled())return;li("Request to "+this.handler.path+" received data frame of size "+e.length);let i=this.decoder.write(e);for(let n of i){if(this.stream.pause(),this.maxReceiveMessageSize!==-1&&n.length-5>this.maxReceiveMessageSize){this.sendStatus({code:st.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${n.length-5} vs. ${this.maxReceiveMessageSize})`,metadata:null});return}let s={type:"COMPRESSED",compressedMessage:n,parsedMessage:null};this.readQueue.push(s),this.decompressAndMaybePush(s),(t=this.callEventTracker)===null||t===void 0||t.addMessageReceived()}}handleEndEvent(){this.readQueue.push({type:"HALF_CLOSE",compressedMessage:null,parsedMessage:null}),this.receivedHalfClose=!0,this.maybePushNextMessage()}start(e){li("Request to "+this.handler.path+" start called"),!this.checkCancelled()&&(this.listener=e,e.onReceiveMetadata(this.metadata))}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,i=Object.assign(Object.assign(Object.assign({},Yv),Nb),t);this.stream.respond(i,Ib)}sendMessage(e,t){if(this.checkCancelled())return;let i;try{i=this.serializeMessage(e)}catch(n){this.sendStatus({code:st.Status.INTERNAL,details:`Error serializing response: ${(0,$v.getErrorMessage)(n)}`,metadata:null});return}if(this.maxSendMessageSize!==-1&&i.length-5>this.maxSendMessageSize){this.sendStatus({code:st.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${i.length} vs. ${this.maxSendMessageSize})`,metadata:null});return}this.maybeSendMetadata(),li("Request to "+this.handler.path+" sent data frame of size "+i.length),this.stream.write(i,n=>{var s;if(n){this.sendStatus({code:st.Status.INTERNAL,details:`Error writing message: ${(0,$v.getErrorMessage)(n)}`,metadata:null});return}(s=this.callEventTracker)===null||s===void 0||s.addMessageSent(),t()})}sendStatus(e){var t,i;if(!this.checkCancelled())if(li("Request to method "+((t=this.handler)===null||t===void 0?void 0:t.path)+" ended with status code: "+st.Status[e.code]+" details: "+e.details),this.metadataSent)this.wantTrailers?this.notifyOnCancel():(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var n;this.callEventTracker&&!this.streamEnded&&(this.streamEnded=!0,this.callEventTracker.onStreamEnd(!0),this.callEventTracker.onCallEnd(e));let s=Object.assign({[Kv]:e.code,[Vv]:encodeURI(e.details)},(n=e.metadata)===null||n===void 0?void 0:n.toHttp2Headers());this.stream.sendTrailers(s),this.notifyOnCancel()}),this.stream.end());else{this.callEventTracker&&!this.streamEnded&&(this.streamEnded=!0,this.callEventTracker.onStreamEnd(!0),this.callEventTracker.onCallEnd(e));let n=Object.assign(Object.assign({[Kv]:e.code,[Vv]:encodeURI(e.details)},Yv),(i=e.metadata)===null||i===void 0?void 0:i.toHttp2Headers());this.stream.respond(n,{endStream:!0}),this.notifyOnCancel()}}startRead(){li("Request to "+this.handler.path+" startRead called"),!this.checkCancelled()&&(this.isReadPending=!0,this.readQueue.length===0?this.receivedHalfClose||this.stream.resume():this.maybePushNextMessage())}getPeer(){var e;let t=(e=this.stream.session)===null||e===void 0?void 0:e.socket;return t?.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}};tt.BaseServerInterceptingCall=ho;function Db(r,e,t,i,n,s){let a={path:n.path,requestStream:n.type==="clientStream"||n.type==="bidi",responseStream:n.type==="serverStream"||n.type==="bidi",requestDeserialize:n.deserialize,responseSerialize:n.serialize},o=new ho(e,t,i,n,s);return r.reduce((l,c)=>c(a,l),o)}tt.getServerInterceptingCall=Db});var ay=w(Br=>{"use strict";var qb=Br&&Br.__runInitializers||function(r,e,t){for(var i=arguments.length>2,n=0;n<e.length;n++)t=i?e[n].call(r,t):e[n].call(r);return i?t:void 0},Lb=Br&&Br.__esDecorate||function(r,e,t,i,n,s){function a(A){if(A!==void 0&&typeof A!="function")throw new TypeError("Function expected");return A}for(var o=i.kind,l=o==="getter"?"get":o==="setter"?"set":"value",c=!e&&r?i.static?r:r.prototype:null,p=e||(c?Object.getOwnPropertyDescriptor(c,i.name):{}),m,S=!1,O=t.length-1;O>=0;O--){var N={};for(var k in i)N[k]=k==="access"?{}:i[k];for(var k in i.access)N.access[k]=i.access[k];N.addInitializer=function(A){if(S)throw new TypeError("Cannot add initializers after decoration has completed");s.push(a(A||null))};var I=(0,t[O])(o==="accessor"?{get:p.get,set:p.set}:p[l],N);if(o==="accessor"){if(I===void 0)continue;if(I===null||typeof I!="object")throw new TypeError("Object expected");(m=a(I.get))&&(p.get=m),(m=a(I.set))&&(p.set=m),(m=a(I.init))&&n.unshift(m)}else(m=a(I))&&(o==="field"?n.unshift(m):p[l]=m)}c&&Object.defineProperty(c,i.name,p),S=!0};Object.defineProperty(Br,"__esModule",{value:!0});Br.Server=void 0;var at=require("http2"),Fb=require("util"),He=re(),Qi=jv(),Bb=xh(),ty=Ht(),Uh=we(),Fr=Tt(),Nt=rt(),Ge=ni(),ry=Bh(),Xi=~(1<<31),zh=~(1<<31),Ub=2e4,iy=~(1<<31),{HTTP2_HEADER_PATH:ny}=at.constants,zb="server",sy=Buffer.from("max_age");function Hb(){}function jb(r){return function(e,t){return Fb.deprecate(e,r)}}function Hh(r){return{code:He.Status.UNIMPLEMENTED,details:`The server does not implement the method ${r}`}}function Gb(r,e){let t=Hh(e);switch(r){case"unary":return(i,n)=>{n(t,null)};case"clientStream":return(i,n)=>{n(t,null)};case"serverStream":return i=>{i.emit("error",t)};case"bidi":return i=>{i.emit("error",t)};default:throw new Error(`Invalid handlerType ${r}`)}}var Wb=(()=>{var r;let e=[],t;return r=class{constructor(n){var s,a,o,l,c,p;this.boundPorts=(qb(this,e),new Map),this.http2Servers=new Map,this.sessionIdleTimeouts=new Map,this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.options=n??{},this.options["grpc.enable_channelz"]===0?(this.channelzEnabled=!1,this.channelzTrace=new Ge.ChannelzTraceStub,this.callTracker=new Ge.ChannelzCallTrackerStub,this.listenerChildrenTracker=new Ge.ChannelzChildrenTrackerStub,this.sessionChildrenTracker=new Ge.ChannelzChildrenTrackerStub):(this.channelzTrace=new Ge.ChannelzTrace,this.callTracker=new Ge.ChannelzCallTracker,this.listenerChildrenTracker=new Ge.ChannelzChildrenTracker,this.sessionChildrenTracker=new Ge.ChannelzChildrenTracker),this.channelzRef=(0,Ge.registerChannelzServer)("server",()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=(s=this.options["grpc.max_connection_age_ms"])!==null&&s!==void 0?s:Xi,this.maxConnectionAgeGraceMs=(a=this.options["grpc.max_connection_age_grace_ms"])!==null&&a!==void 0?a:Xi,this.keepaliveTimeMs=(o=this.options["grpc.keepalive_time_ms"])!==null&&o!==void 0?o:zh,this.keepaliveTimeoutMs=(l=this.options["grpc.keepalive_timeout_ms"])!==null&&l!==void 0?l:Ub,this.sessionIdleTimeout=(c=this.options["grpc.max_connection_idle_ms"])!==null&&c!==void 0?c:iy,this.commonServerOptions={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER},"grpc-node.max_session_memory"in this.options?this.commonServerOptions.maxSessionMemory=this.options["grpc-node.max_session_memory"]:this.commonServerOptions.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(this.commonServerOptions.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]}),this.interceptors=(p=this.options.interceptors)!==null&&p!==void 0?p:[],this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfo(n){var s,a,o;let l=this.sessions.get(n),c=n.socket,p=c.remoteAddress?(0,Fr.stringToSubchannelAddress)(c.remoteAddress,c.remotePort):null,m=c.localAddress?(0,Fr.stringToSubchannelAddress)(c.localAddress,c.localPort):null,S;if(n.encrypted){let N=c,k=N.getCipher(),I=N.getCertificate(),A=N.getPeerCertificate();S={cipherSuiteStandardName:(s=k.standardName)!==null&&s!==void 0?s:null,cipherSuiteOtherName:k.standardName?null:k.name,localCertificate:I&&"raw"in I?I.raw:null,remoteCertificate:A&&"raw"in A?A.raw:null}}else S=null;return{remoteAddress:p,localAddress:m,security:S,remoteName:null,streamsStarted:l.streamTracker.callsStarted,streamsSucceeded:l.streamTracker.callsSucceeded,streamsFailed:l.streamTracker.callsFailed,messagesSent:l.messagesSent,messagesReceived:l.messagesReceived,keepAlivesSent:l.keepAlivesSent,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:l.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:l.lastMessageSentTimestamp,lastMessageReceivedTimestamp:l.lastMessageReceivedTimestamp,localFlowControlWindow:(a=n.state.localWindowSize)!==null&&a!==void 0?a:null,remoteFlowControlWindow:(o=n.state.remoteWindowSize)!==null&&o!==void 0?o:null}}trace(n){Uh.trace(He.LogVerbosity.DEBUG,zb,"("+this.channelzRef.id+") "+n)}addProtoService(){throw new Error("Not implemented. Use addService() instead")}addService(n,s){if(n===null||typeof n!="object"||s===null||typeof s!="object")throw new Error("addService() requires two objects as arguments");let a=Object.keys(n);if(a.length===0)throw new Error("Cannot add an empty service to a server");a.forEach(o=>{let l=n[o],c;l.requestStream?l.responseStream?c="bidi":c="clientStream":l.responseStream?c="serverStream":c="unary";let p=s[o],m;if(p===void 0&&typeof l.originalName=="string"&&(p=s[l.originalName]),p!==void 0?m=p.bind(s):m=Gb(c,o),this.register(l.path,m,l.responseSerialize,l.requestDeserialize,c)===!1)throw new Error(`Method handler for ${l.path} already provided.`)})}removeService(n){if(n===null||typeof n!="object")throw new Error("removeService() requires object as argument");Object.keys(n).forEach(a=>{let o=n[a];this.unregister(o.path)})}bind(n,s){throw new Error("Not implemented. Use bindAsync() instead")}registerListenerToChannelz(n){return(0,Ge.registerChannelzSocket)((0,Fr.subchannelAddressToString)(n),()=>({localAddress:n,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled)}createHttp2Server(n){let s;if(n._isSecure()){let a=Object.assign(this.commonServerOptions,n._getSettings());a.enableTrace=this.options["grpc-node.tls_enable_trace"]===1,s=at.createSecureServer(a),s.on("secureConnection",o=>{o.on("error",l=>{this.trace("An incoming TLS connection closed with error: "+l.message)})})}else s=at.createServer(this.commonServerOptions);return s.setTimeout(0,Hb),this._setupHandlers(s),s}bindOneAddress(n,s){this.trace("Attempting to bind "+(0,Fr.subchannelAddressToString)(n));let a=this.createHttp2Server(s.credentials);return new Promise((o,l)=>{let c=p=>{this.trace("Failed to bind "+(0,Fr.subchannelAddressToString)(n)+" with error "+p.message),o({port:"port"in n?n.port:1,error:p.message})};a.once("error",c),a.listen(n,()=>{let p=a.address(),m;typeof p=="string"?m={path:p}:m={host:p.address,port:p.port};let S=this.registerListenerToChannelz(m);this.listenerChildrenTracker.refChild(S),this.http2Servers.set(a,{channelzRef:S,sessions:new Set}),s.listeningServers.add(a),this.trace("Successfully bound "+(0,Fr.subchannelAddressToString)(m)),o({port:"port"in m?m.port:1}),a.removeListener("error",c)})})}async bindManyPorts(n,s){if(n.length===0)return{count:0,port:0,errors:[]};if((0,Fr.isTcpSubchannelAddress)(n[0])&&n[0].port===0){let a=await this.bindOneAddress(n[0],s);if(a.error){let o=await this.bindManyPorts(n.slice(1),s);return Object.assign(Object.assign({},o),{errors:[a.error,...o.errors]})}else{let o=n.slice(1).map(p=>(0,Fr.isTcpSubchannelAddress)(p)?{host:p.host,port:a.port}:p),l=await Promise.all(o.map(p=>this.bindOneAddress(p,s))),c=[a,...l];return{count:c.filter(p=>p.error===void 0).length,port:a.port,errors:c.filter(p=>p.error).map(p=>p.error)}}}else{let a=await Promise.all(n.map(o=>this.bindOneAddress(o,s)));return{count:a.filter(o=>o.error===void 0).length,port:a[0].port,errors:a.filter(o=>o.error).map(o=>o.error)}}}async bindAddressList(n,s){let a=await this.bindManyPorts(n,s);if(a.count>0)return a.count<n.length&&Uh.log(He.LogVerbosity.INFO,`WARNING Only ${a.count} addresses added out of total ${n.length} resolved`),a.port;{let o=`No address added out of total ${n.length} resolved`;throw Uh.log(He.LogVerbosity.ERROR,o),new Error(`${o} errors: [${a.errors.join(",")}]`)}}resolvePort(n){return new Promise((s,a)=>{let o={onSuccessfulResolution:(c,p,m)=>{o.onSuccessfulResolution=()=>{};let S=[].concat(...c.map(O=>O.addresses));if(S.length===0){a(new Error(`No addresses resolved for port ${n}`));return}s(S)},onError:c=>{a(new Error(c.details))}};(0,ty.createResolver)(n,o,this.options).updateResolution()})}async bindPort(n,s){let a=await this.resolvePort(n);if(s.cancelled)throw this.completeUnbind(s),new Error("bindAsync operation cancelled by unbind call");let o=await this.bindAddressList(a,s);if(s.cancelled)throw this.completeUnbind(s),new Error("bindAsync operation cancelled by unbind call");return o}normalizePort(n){let s=(0,Nt.parseUri)(n);if(s===null)throw new Error(`Could not parse port "${n}"`);let a=(0,ty.mapUriDefaultScheme)(s);if(a===null)throw new Error(`Could not get a default scheme for port "${n}"`);return a}bindAsync(n,s,a){if(this.shutdown)throw new Error("bindAsync called after shutdown");if(typeof n!="string")throw new TypeError("port must be a string");if(s===null||!(s instanceof Bb.ServerCredentials))throw new TypeError("creds must be a ServerCredentials object");if(typeof a!="function")throw new TypeError("callback must be a function");this.trace("bindAsync port="+n);let o=this.normalizePort(n),l=(S,O)=>{process.nextTick(()=>a(S,O))},c=this.boundPorts.get((0,Nt.uriToString)(o));if(c){if(!s._equals(c.credentials)){l(new Error(`${n} already bound with incompatible credentials`),0);return}c.cancelled=!1,c.completionPromise?c.completionPromise.then(S=>a(null,S),S=>a(S,0)):l(null,c.portNumber);return}c={mapKey:(0,Nt.uriToString)(o),originalUri:o,completionPromise:null,cancelled:!1,portNumber:0,credentials:s,listeningServers:new Set};let p=(0,Nt.splitHostPort)(o.path),m=this.bindPort(o,c);c.completionPromise=m,p?.port===0?m.then(S=>{let O={scheme:o.scheme,authority:o.authority,path:(0,Nt.combineHostPort)({host:p.host,port:S})};c.mapKey=(0,Nt.uriToString)(O),c.completionPromise=null,c.portNumber=S,this.boundPorts.set(c.mapKey,c),a(null,S)},S=>{a(S,0)}):(this.boundPorts.set(c.mapKey,c),m.then(S=>{c.completionPromise=null,c.portNumber=S,a(null,S)},S=>{a(S,0)}))}closeServer(n,s){this.trace("Closing server with address "+JSON.stringify(n.address()));let a=this.http2Servers.get(n);n.close(()=>{a&&(this.listenerChildrenTracker.unrefChild(a.channelzRef),(0,Ge.unregisterChannelzRef)(a.channelzRef)),this.http2Servers.delete(n),s?.()})}closeSession(n,s){var a;this.trace("Closing session initiated by "+((a=n.socket)===null||a===void 0?void 0:a.remoteAddress));let o=this.sessions.get(n),l=()=>{o&&(this.sessionChildrenTracker.unrefChild(o.ref),(0,Ge.unregisterChannelzRef)(o.ref)),s?.()};n.closed?queueMicrotask(l):n.close(l)}completeUnbind(n){for(let s of n.listeningServers){let a=this.http2Servers.get(s);if(this.closeServer(s,()=>{n.listeningServers.delete(s)}),a)for(let o of a.sessions)this.closeSession(o)}this.boundPorts.delete(n.mapKey)}unbind(n){this.trace("unbind port="+n);let s=this.normalizePort(n),a=(0,Nt.splitHostPort)(s.path);if(a?.port===0)throw new Error("Cannot unbind port 0");let o=this.boundPorts.get((0,Nt.uriToString)(s));o&&(this.trace("unbinding "+o.mapKey+" originally bound as "+(0,Nt.uriToString)(o.originalUri)),o.completionPromise?o.cancelled=!0:this.completeUnbind(o))}drain(n,s){var a,o;this.trace("drain port="+n+" graceTimeMs="+s);let l=this.normalizePort(n),c=(0,Nt.splitHostPort)(l.path);if(c?.port===0)throw new Error("Cannot drain port 0");let p=this.boundPorts.get((0,Nt.uriToString)(l));if(!p)return;let m=new Set;for(let S of p.listeningServers){let O=this.http2Servers.get(S);if(O)for(let N of O.sessions)m.add(N),this.closeSession(N,()=>{m.delete(N)})}(o=(a=setTimeout(()=>{for(let S of m)S.destroy(at.constants.NGHTTP2_CANCEL)},s)).unref)===null||o===void 0||o.call(a)}forceShutdown(){for(let n of this.boundPorts.values())n.cancelled=!0;this.boundPorts.clear();for(let n of this.http2Servers.keys())this.closeServer(n);this.sessions.forEach((n,s)=>{this.closeSession(s),s.destroy(at.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),(0,Ge.unregisterChannelzRef)(this.channelzRef),this.shutdown=!0}register(n,s,a,o,l){return this.handlers.has(n)?!1:(this.handlers.set(n,{func:s,serialize:a,deserialize:o,type:l,path:n}),!0)}unregister(n){return this.handlers.delete(n)}start(){if(this.http2Servers.size===0||[...this.http2Servers.keys()].every(n=>!n.listening))throw new Error("server must be bound in order to start");if(this.started===!0)throw new Error("server is already started");this.started=!0}tryShutdown(n){var s;let a=c=>{(0,Ge.unregisterChannelzRef)(this.channelzRef),n(c)},o=0;function l(){o--,o===0&&a()}this.shutdown=!0;for(let[c,p]of this.http2Servers.entries()){o++;let m=p.channelzRef.name;this.trace("Waiting for server "+m+" to close"),this.closeServer(c,()=>{this.trace("Server "+m+" finished closing"),l()});for(let S of p.sessions.keys()){o++;let O=(s=S.socket)===null||s===void 0?void 0:s.remoteAddress;this.trace("Waiting for session "+O+" to close"),this.closeSession(S,()=>{this.trace("Session "+O+" finished closing"),l()})}}o===0&&a()}addHttp2Port(){throw new Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(n,s){let a=s[at.constants.HTTP2_HEADER_CONTENT_TYPE];return typeof a!="string"||!a.startsWith("application/grpc")?(n.respond({[at.constants.HTTP2_HEADER_STATUS]:at.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1):!0}_retrieveHandler(n){this.trace("Received call to method "+n+" at address "+this.serverAddressString);let s=this.handlers.get(n);return s===void 0?(this.trace("No handler registered for method "+n+". Sending UNIMPLEMENTED status."),null):s}_respondWithError(n,s,a=null){var o,l;let c=Object.assign({"grpc-status":(o=n.code)!==null&&o!==void 0?o:He.Status.INTERNAL,"grpc-message":n.details,[at.constants.HTTP2_HEADER_STATUS]:at.constants.HTTP_STATUS_OK,[at.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},(l=n.metadata)===null||l===void 0?void 0:l.toHttp2Headers());s.respond(c,{endStream:!0}),this.callTracker.addCallFailed(),a?.streamTracker.addCallFailed()}_channelzHandler(n,s){this.onStreamOpened(n);let a=this.sessions.get(n.session);if(this.callTracker.addCallStarted(),a?.streamTracker.addCallStarted(),!this._verifyContentType(n,s)){this.callTracker.addCallFailed(),a?.streamTracker.addCallFailed();return}let o=s[ny],l=this._retrieveHandler(o);if(!l){this._respondWithError(Hh(o),n,a);return}let c={addMessageSent:()=>{a&&(a.messagesSent+=1,a.lastMessageSentTimestamp=new Date)},addMessageReceived:()=>{a&&(a.messagesReceived+=1,a.lastMessageReceivedTimestamp=new Date)},onCallEnd:m=>{m.code===He.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()},onStreamEnd:m=>{a&&(m?a.streamTracker.addCallSucceeded():a.streamTracker.addCallFailed())}},p=(0,ry.getServerInterceptingCall)(this.interceptors,n,s,c,l,this.options);this._runHandlerForCall(p,l)||(this.callTracker.addCallFailed(),a?.streamTracker.addCallFailed(),p.sendStatus({code:He.Status.INTERNAL,details:`Unknown handler type: ${l.type}`}))}_streamHandler(n,s){if(this.onStreamOpened(n),this._verifyContentType(n,s)!==!0)return;let a=s[ny],o=this._retrieveHandler(a);if(!o){this._respondWithError(Hh(a),n,null);return}let l=(0,ry.getServerInterceptingCall)(this.interceptors,n,s,null,o,this.options);this._runHandlerForCall(l,o)||l.sendStatus({code:He.Status.INTERNAL,details:`Unknown handler type: ${o.type}`})}_runHandlerForCall(n,s){let{type:a}=s;if(a==="unary")$b(n,s);else if(a==="clientStream")Vb(n,s);else if(a==="serverStream")Kb(n,s);else if(a==="bidi")Yb(n,s);else return!1;return!0}_setupHandlers(n){if(n===null)return;let s=n.address(),a="null";s&&(typeof s=="string"?a=s:a=s.address+":"+s.port),this.serverAddressString=a;let o=this.channelzEnabled?this._channelzHandler:this._streamHandler,l=this.channelzEnabled?this._channelzSessionHandler(n):this._sessionHandler(n);n.on("stream",o.bind(this)),n.on("session",l)}_sessionHandler(n){return s=>{var a,o,l;(a=this.http2Servers.get(n))===null||a===void 0||a.sessions.add(s);let c=null,p=null,m=null,S=null,O=!1,N=this.enableIdleTimeout(s);if(this.maxConnectionAgeMs!==Xi){let k=this.maxConnectionAgeMs/10,I=Math.random()*k*2-k;c=setTimeout(()=>{var A,D;O=!0,this.trace("Connection dropped by max connection age: "+((A=s.socket)===null||A===void 0?void 0:A.remoteAddress));try{s.goaway(at.constants.NGHTTP2_NO_ERROR,~(1<<31),sy)}catch{s.destroy();return}s.close(),this.maxConnectionAgeGraceMs!==Xi&&(p=setTimeout(()=>{s.destroy()},this.maxConnectionAgeGraceMs),(D=p.unref)===null||D===void 0||D.call(p))},this.maxConnectionAgeMs+I),(o=c.unref)===null||o===void 0||o.call(c)}this.keepaliveTimeMs<zh&&(m=setInterval(()=>{var k;S=setTimeout(()=>{O=!0,s.close()},this.keepaliveTimeoutMs),(k=S.unref)===null||k===void 0||k.call(S);try{s.ping((I,A,D)=>{S&&clearTimeout(S),I&&(O=!0,this.trace("Connection dropped due to error of a ping frame "+I.message+" return in "+A),s.close())})}catch{clearTimeout(S),s.destroy()}},this.keepaliveTimeMs),(l=m.unref)===null||l===void 0||l.call(m)),s.on("close",()=>{var k,I;O||this.trace(`Connection dropped by client ${(k=s.socket)===null||k===void 0?void 0:k.remoteAddress}`),c&&clearTimeout(c),p&&clearTimeout(p),m&&(clearInterval(m),S&&clearTimeout(S)),N!==null&&(clearTimeout(N.timeout),this.sessionIdleTimeouts.delete(s)),(I=this.http2Servers.get(n))===null||I===void 0||I.sessions.delete(s)})}}_channelzSessionHandler(n){return s=>{var a,o,l,c,p;let m=(0,Ge.registerChannelzSocket)((o=(a=s.socket)===null||a===void 0?void 0:a.remoteAddress)!==null&&o!==void 0?o:"unknown",this.getChannelzSessionInfo.bind(this,s),this.channelzEnabled),S={ref:m,streamTracker:new Ge.ChannelzCallTracker,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};(l=this.http2Servers.get(n))===null||l===void 0||l.sessions.add(s),this.sessions.set(s,S);let O=`${s.socket.remoteAddress}:${s.socket.remotePort}`;this.channelzTrace.addTrace("CT_INFO","Connection established by client "+O),this.trace("Connection established by client "+O),this.sessionChildrenTracker.refChild(m);let N=null,k=null,I=null,A=null,D=!1,j=this.enableIdleTimeout(s);if(this.maxConnectionAgeMs!==Xi){let L=this.maxConnectionAgeMs/10,U=Math.random()*L*2-L;N=setTimeout(()=>{var F;D=!0,this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+O);try{s.goaway(at.constants.NGHTTP2_NO_ERROR,~(1<<31),sy)}catch{s.destroy();return}s.close(),this.maxConnectionAgeGraceMs!==Xi&&(k=setTimeout(()=>{s.destroy()},this.maxConnectionAgeGraceMs),(F=k.unref)===null||F===void 0||F.call(k))},this.maxConnectionAgeMs+U),(c=N.unref)===null||c===void 0||c.call(N)}this.keepaliveTimeMs<zh&&(I=setInterval(()=>{var L;A=setTimeout(()=>{D=!0,this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+O),s.close()},this.keepaliveTimeoutMs),(L=A.unref)===null||L===void 0||L.call(A);try{s.ping((U,F,V)=>{A&&clearTimeout(A),U&&(D=!0,this.channelzTrace.addTrace("CT_INFO","Connection dropped due to error of a ping frame "+U.message+" return in "+F),s.close())}),S.keepAlivesSent+=1}catch{clearTimeout(A),s.destroy()}},this.keepaliveTimeMs),(p=I.unref)===null||p===void 0||p.call(I)),s.on("close",()=>{var L;D||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+O),this.sessionChildrenTracker.unrefChild(m),(0,Ge.unregisterChannelzRef)(m),N&&clearTimeout(N),k&&clearTimeout(k),I&&(clearInterval(I),A&&clearTimeout(A)),j!==null&&(clearTimeout(j.timeout),this.sessionIdleTimeouts.delete(s)),(L=this.http2Servers.get(n))===null||L===void 0||L.sessions.delete(s),this.sessions.delete(s)})}}enableIdleTimeout(n){var s,a;if(this.sessionIdleTimeout>=iy)return null;let o={activeStreams:0,lastIdle:Date.now(),onClose:this.onStreamClose.bind(this,n),timeout:setTimeout(this.onIdleTimeout,this.sessionIdleTimeout,this,n)};(a=(s=o.timeout).unref)===null||a===void 0||a.call(s),this.sessionIdleTimeouts.set(n,o);let{socket:l}=n;return this.trace("Enable idle timeout for "+l.remoteAddress+":"+l.remotePort),o}onIdleTimeout(n,s){let{socket:a}=s,o=n.sessionIdleTimeouts.get(s);o!==void 0&&o.activeStreams===0&&Date.now()-o.lastIdle>=n.sessionIdleTimeout&&(n.trace("Session idle timeout triggered for "+a?.remoteAddress+":"+a?.remotePort+" last idle at "+o.lastIdle),n.closeSession(s))}onStreamOpened(n){let s=n.session,a=this.sessionIdleTimeouts.get(s);a&&(a.activeStreams+=1,n.once("close",a.onClose))}onStreamClose(n){var s,a;let o=this.sessionIdleTimeouts.get(n);o&&(o.activeStreams-=1,o.activeStreams===0&&(o.lastIdle=Date.now(),o.timeout.refresh(),this.trace("Session onStreamClose"+((s=n.socket)===null||s===void 0?void 0:s.remoteAddress)+":"+((a=n.socket)===null||a===void 0?void 0:a.remotePort)+" at "+o.lastIdle)))}},(()=>{let i=typeof Symbol=="function"&&Symbol.metadata?Object.create(null):void 0;t=[jb("Calling start() is no longer necessary. It can be safely omitted.")],Lb(r,null,t,{kind:"method",name:"start",static:!1,private:!1,access:{has:n=>"start"in n,get:n=>n.start},metadata:i},null,e),i&&Object.defineProperty(r,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:i})})(),r})();Br.Server=Wb;async function $b(r,e){let t;function i(a,o,l,c){if(a){r.sendStatus((0,Qi.serverErrorToStatus)(a,l));return}r.sendMessage(o,()=>{r.sendStatus({code:He.Status.OK,details:"OK",metadata:l??null})})}let n,s=null;r.start({onReceiveMetadata(a){n=a,r.startRead()},onReceiveMessage(a){if(s){r.sendStatus({code:He.Status.UNIMPLEMENTED,details:`Received a second request message for server streaming method ${e.path}`,metadata:null});return}s=a,r.startRead()},onReceiveHalfClose(){if(!s){r.sendStatus({code:He.Status.UNIMPLEMENTED,details:`Received no request message for server streaming method ${e.path}`,metadata:null});return}t=new Qi.ServerWritableStreamImpl(e.path,r,n,s);try{e.func(t,i)}catch(a){r.sendStatus({code:He.Status.UNKNOWN,details:`Server method handler threw error ${a.message}`,metadata:null})}},onCancel(){t&&(t.cancelled=!0,t.emit("cancelled","cancelled"))}})}function Vb(r,e){let t;function i(n,s,a,o){if(n){r.sendStatus((0,Qi.serverErrorToStatus)(n,a));return}r.sendMessage(s,()=>{r.sendStatus({code:He.Status.OK,details:"OK",metadata:a??null})})}r.start({onReceiveMetadata(n){t=new Qi.ServerDuplexStreamImpl(e.path,r,n);try{e.func(t,i)}catch(s){r.sendStatus({code:He.Status.UNKNOWN,details:`Server method handler threw error ${s.message}`,metadata:null})}},onReceiveMessage(n){t.push(n)},onReceiveHalfClose(){t.push(null)},onCancel(){t&&(t.cancelled=!0,t.emit("cancelled","cancelled"),t.destroy())}})}function Kb(r,e){let t,i,n=null;r.start({onReceiveMetadata(s){i=s,r.startRead()},onReceiveMessage(s){if(n){r.sendStatus({code:He.Status.UNIMPLEMENTED,details:`Received a second request message for server streaming method ${e.path}`,metadata:null});return}n=s,r.startRead()},onReceiveHalfClose(){if(!n){r.sendStatus({code:He.Status.UNIMPLEMENTED,details:`Received no request message for server streaming method ${e.path}`,metadata:null});return}t=new Qi.ServerWritableStreamImpl(e.path,r,i,n);try{e.func(t)}catch(s){r.sendStatus({code:He.Status.UNKNOWN,details:`Server method handler threw error ${s.message}`,metadata:null})}},onCancel(){t&&(t.cancelled=!0,t.emit("cancelled","cancelled"),t.destroy())}})}function Yb(r,e){let t;r.start({onReceiveMetadata(i){t=new Qi.ServerDuplexStreamImpl(e.path,r,i);try{e.func(t)}catch(n){r.sendStatus({code:He.Status.UNKNOWN,details:`Server method handler threw error ${n.message}`,metadata:null})}},onReceiveMessage(i){t.push(i)},onReceiveHalfClose(){t.push(null)},onCancel(){t&&(t.cancelled=!0,t.emit("cancelled","cancelled"),t.destroy())}})}});var oy=w(fo=>{"use strict";Object.defineProperty(fo,"__esModule",{value:!0});fo.StatusBuilder=void 0;var jh=class{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return this.code!==null&&(e.code=this.code),this.details!==null&&(e.details=this.details),this.metadata!==null&&(e.metadata=this.metadata),e}};fo.StatusBuilder=jh});var Gh=w(Ur=>{"use strict";Object.defineProperty(Ur,"__esModule",{value:!0});Ur.isDuration=Ur.durationToMs=Ur.msToDuration=void 0;function Jb(r){return{seconds:r/1e3|0,nanos:r%1e3*1e6|0}}Ur.msToDuration=Jb;function Xb(r){return r.seconds*1e3+r.nanos/1e6|0}Ur.durationToMs=Xb;function Qb(r){return typeof r.seconds=="number"&&typeof r.nanos=="number"}Ur.isDuration=Qb});var po=w(Et=>{"use strict";Object.defineProperty(Et,"__esModule",{value:!0});Et.setup=Et.LeafLoadBalancer=Et.PickFirstLoadBalancer=Et.shuffled=Et.PickFirstLoadBalancingConfig=void 0;var $h=Jr(),Le=ut(),Zi=Cr(),Zb=we(),e1=re(),ly=Tt(),cy=require("net"),t1="pick_first";function Wh(r){Zb.trace(e1.LogVerbosity.DEBUG,t1,r)}var Yn="pick_first",r1=250,en=class r{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return Yn}toJsonObject(){return{[Yn]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&typeof e.shuffleAddressList!="boolean")throw new Error("pick_first config field shuffleAddressList must be a boolean if provided");return new r(e.shuffleAddressList===!0)}};Et.PickFirstLoadBalancingConfig=en;var Vh=class{constructor(e){this.subchannel=e}pick(e){return{pickResultType:Zi.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}};function uy(r){let e=r.slice();for(let t=e.length-1;t>1;t--){let i=Math.floor(Math.random()*(t+1)),n=e[t];e[t]=e[i],e[i]=n}return e}Et.shuffled=uy;function i1(r){let e=[],t=[],i=[],n=(0,ly.isTcpSubchannelAddress)(r[0])&&(0,cy.isIPv6)(r[0].host);for(let o of r)(0,ly.isTcpSubchannelAddress)(o)&&(0,cy.isIPv6)(o.host)?t.push(o):i.push(o);let s=n?t:i,a=n?i:t;for(let o=0;o<Math.max(s.length,a.length);o++)o<s.length&&e.push(s[o]),o<a.length&&e.push(a[o]);return e}var hy="grpc-node.internal.pick-first.report_health_status",Jn=class{constructor(e,t){this.channelControlHelper=e,this.children=[],this.currentState=Le.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(i,n,s,a,o)=>{this.onSubchannelStateUpdate(i,n,s,o)},this.pickedSubchannelHealthListener=()=>this.calculateAndReportNewState(),this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout),this.reportHealthStatus=t[hy]}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.reportHealthStatus&&!this.currentPick.isHealthy()?this.updateState(Le.ConnectivityState.TRANSIENT_FAILURE,new Zi.UnavailablePicker({details:`Picked subchannel ${this.currentPick.getAddress()} is unhealthy`})):this.updateState(Le.ConnectivityState.READY,new Vh(this.currentPick)):this.children.length===0?this.updateState(Le.ConnectivityState.IDLE,new Zi.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(Le.ConnectivityState.TRANSIENT_FAILURE,new Zi.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(Le.ConnectivityState.CONNECTING,new Zi.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){this.stickyTransientFailureMode=!0;for(let{subchannel:e}of this.children)e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(this.currentPick!==null){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef()),this.reportHealthStatus&&e.removeHealthStateWatcher(this.pickedSubchannelHealthListener)}}onSubchannelStateUpdate(e,t,i,n){var s;if(!((s=this.currentPick)===null||s===void 0)&&s.realSubchannelEquals(e)){i!==Le.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[a,o]of this.children.entries())if(e.realSubchannelEquals(o.subchannel)){i===Le.ConnectivityState.READY&&this.pickSubchannel(o.subchannel),i===Le.ConnectivityState.TRANSIENT_FAILURE&&(o.hasReportedTransientFailure=!0,n&&(this.lastError=n),this.maybeEnterStickyTransientFailureMode(),a===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(a+1)),o.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,i]of this.children.entries())if(t>=e){let n=i.subchannel.getConnectivityState();if(n===Le.ConnectivityState.IDLE||n===Le.ConnectivityState.CONNECTING){this.startConnecting(t);return}}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,i;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===Le.ConnectivityState.IDLE&&(Wh("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var n;(n=this.children[e])===null||n===void 0||n.subchannel.startConnecting()})),this.connectionDelayTimeout=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},r1),(i=(t=this.connectionDelayTimeout).unref)===null||i===void 0||i.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(Wh("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,this.removeCurrentPick(),this.currentPick=e,e.ref(),this.reportHealthStatus&&e.addHealthStateWatcher(this.pickedSubchannelHealthListener),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){Wh(Le.ConnectivityState[this.currentState]+" -> "+Le.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)this.currentPick&&e.subchannel.realSubchannelEquals(this.currentPick)||e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(e){let t=e.map(i=>({subchannel:this.channelControlHelper.createSubchannel(i,{}),hasReportedTransientFailure:!1}));for(let{subchannel:i}of t)i.ref(),this.channelControlHelper.addChannelzChild(i.getChannelzRef());this.resetSubchannelList(),this.children=t;for(let{subchannel:i}of this.children)if(i.addConnectivityStateListener(this.subchannelStateListener),i.getConnectivityState()===Le.ConnectivityState.READY){this.pickSubchannel(i);return}for(let i of this.children)i.subchannel.getConnectivityState()===Le.ConnectivityState.TRANSIENT_FAILURE&&(i.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(e,t){if(!(t instanceof en))return;t.getShuffleAddressList()&&(e=uy(e));let i=[].concat(...e.map(s=>s.addresses));if(i.length===0)throw new Error("No addresses in endpoint list passed to pick_first");let n=i1(i);this.latestAddressList=n,this.connectToAddressList(n)}exitIdle(){this.currentState===Le.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return Yn}};Et.PickFirstLoadBalancer=Jn;var n1=new en(!1),Kh=class{constructor(e,t,i){this.endpoint=e,this.latestState=Le.ConnectivityState.IDLE;let n=(0,$h.createChildChannelControlHelper)(t,{updateState:(s,a)=>{this.latestState=s,this.latestPicker=a,t.updateState(s,a)}});this.pickFirstBalancer=new Jn(n,Object.assign(Object.assign({},i),{[hy]:!0})),this.latestPicker=new Zi.QueuePicker(this.pickFirstBalancer)}startConnecting(){this.pickFirstBalancer.updateAddressList([this.endpoint],n1)}updateEndpoint(e){this.endpoint=e,this.latestState!==Le.ConnectivityState.IDLE&&this.startConnecting()}getConnectivityState(){return this.latestState}getPicker(){return this.latestPicker}getEndpoint(){return this.endpoint}exitIdle(){this.pickFirstBalancer.exitIdle()}destroy(){this.pickFirstBalancer.destroy()}};Et.LeafLoadBalancer=Kh;function s1(){(0,$h.registerLoadBalancerType)(Yn,Jn,en),(0,$h.registerDefaultLoadBalancerType)(Yn)}Et.setup=s1});var Jh=w(K=>{"use strict";Object.defineProperty(K,"__esModule",{value:!0});K.BaseSubchannelWrapper=K.registerAdminService=K.FilterStackFactory=K.BaseFilter=K.PickResultType=K.QueuePicker=K.UnavailablePicker=K.ChildLoadBalancerHandler=K.EndpointMap=K.endpointHasAddress=K.endpointToString=K.subchannelAddressToString=K.LeafLoadBalancer=K.isLoadBalancerNameRegistered=K.parseLoadBalancingConfig=K.selectLbConfigFromList=K.registerLoadBalancerType=K.createChildChannelControlHelper=K.BackoffTimeout=K.durationToMs=K.uriToString=K.createResolver=K.registerResolver=K.log=K.trace=void 0;var dy=we();Object.defineProperty(K,"trace",{enumerable:!0,get:function(){return dy.trace}});Object.defineProperty(K,"log",{enumerable:!0,get:function(){return dy.log}});var fy=Ht();Object.defineProperty(K,"registerResolver",{enumerable:!0,get:function(){return fy.registerResolver}});Object.defineProperty(K,"createResolver",{enumerable:!0,get:function(){return fy.createResolver}});var a1=rt();Object.defineProperty(K,"uriToString",{enumerable:!0,get:function(){return a1.uriToString}});var o1=Gh();Object.defineProperty(K,"durationToMs",{enumerable:!0,get:function(){return o1.durationToMs}});var l1=yn();Object.defineProperty(K,"BackoffTimeout",{enumerable:!0,get:function(){return l1.BackoffTimeout}});var Xn=Jr();Object.defineProperty(K,"createChildChannelControlHelper",{enumerable:!0,get:function(){return Xn.createChildChannelControlHelper}});Object.defineProperty(K,"registerLoadBalancerType",{enumerable:!0,get:function(){return Xn.registerLoadBalancerType}});Object.defineProperty(K,"selectLbConfigFromList",{enumerable:!0,get:function(){return Xn.selectLbConfigFromList}});Object.defineProperty(K,"parseLoadBalancingConfig",{enumerable:!0,get:function(){return Xn.parseLoadBalancingConfig}});Object.defineProperty(K,"isLoadBalancerNameRegistered",{enumerable:!0,get:function(){return Xn.isLoadBalancerNameRegistered}});var c1=po();Object.defineProperty(K,"LeafLoadBalancer",{enumerable:!0,get:function(){return c1.LeafLoadBalancer}});var go=Tt();Object.defineProperty(K,"subchannelAddressToString",{enumerable:!0,get:function(){return go.subchannelAddressToString}});Object.defineProperty(K,"endpointToString",{enumerable:!0,get:function(){return go.endpointToString}});Object.defineProperty(K,"endpointHasAddress",{enumerable:!0,get:function(){return go.endpointHasAddress}});Object.defineProperty(K,"EndpointMap",{enumerable:!0,get:function(){return go.EndpointMap}});var u1=Gs();Object.defineProperty(K,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return u1.ChildLoadBalancerHandler}});var Yh=Cr();Object.defineProperty(K,"UnavailablePicker",{enumerable:!0,get:function(){return Yh.UnavailablePicker}});Object.defineProperty(K,"QueuePicker",{enumerable:!0,get:function(){return Yh.QueuePicker}});Object.defineProperty(K,"PickResultType",{enumerable:!0,get:function(){return Yh.PickResultType}});var h1=Ga();Object.defineProperty(K,"BaseFilter",{enumerable:!0,get:function(){return h1.BaseFilter}});var d1=th();Object.defineProperty(K,"FilterStackFactory",{enumerable:!0,get:function(){return d1.FilterStackFactory}});var f1=Ks();Object.defineProperty(K,"registerAdminService",{enumerable:!0,get:function(){return f1.registerAdminService}});var p1=io();Object.defineProperty(K,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return p1.BaseSubchannelWrapper}})});var py=w(mo=>{"use strict";Object.defineProperty(mo,"__esModule",{value:!0});mo.setup=void 0;var g1=Ht(),Xh=class{constructor(e,t,i){this.listener=t,this.hasReturnedResult=!1,this.endpoints=[];let n;e.authority===""?n="/"+e.path:n=e.path,this.endpoints=[{addresses:[{path:n}]}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.endpoints,null,null,null,{}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return"localhost"}};function m1(){(0,g1.registerResolver)("unix",Xh)}mo.setup=m1});var _y=w(_o=>{"use strict";Object.defineProperty(_o,"__esModule",{value:!0});_o.setup=void 0;var gy=require("net"),vo=re(),Qh=Ve(),my=Ht(),vy=rt(),v1=we(),y1="ip_resolver";function yy(r){v1.trace(vo.LogVerbosity.DEBUG,y1,r)}var Zh="ipv4",ed="ipv6",_1=443,yo=class{constructor(e,t,i){var n;this.listener=t,this.endpoints=[],this.error=null,this.hasReturnedResult=!1,yy("Resolver constructed for target "+(0,vy.uriToString)(e));let s=[];if(!(e.scheme===Zh||e.scheme===ed)){this.error={code:vo.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new Qh.Metadata};return}let a=e.path.split(",");for(let o of a){let l=(0,vy.splitHostPort)(o);if(l===null){this.error={code:vo.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${o}`,metadata:new Qh.Metadata};return}if(e.scheme===Zh&&!(0,gy.isIPv4)(l.host)||e.scheme===ed&&!(0,gy.isIPv6)(l.host)){this.error={code:vo.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${o}`,metadata:new Qh.Metadata};return}s.push({host:l.host,port:(n=l.port)!==null&&n!==void 0?n:_1})}this.endpoints=s.map(o=>({addresses:[o]})),yy("Parsed "+e.scheme+" address list "+s)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.endpoints,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}};function S1(){(0,my.registerResolver)(Zh,yo),(0,my.registerResolver)(ed,yo)}_o.setup=S1});var wy=w(tn=>{"use strict";Object.defineProperty(tn,"__esModule",{value:!0});tn.setup=tn.RoundRobinLoadBalancer=void 0;var Cy=Jr(),ot=ut(),td=Cr(),E1=we(),C1=re(),Sy=Tt(),w1=po(),T1="round_robin";function Ey(r){E1.trace(C1.LogVerbosity.DEBUG,T1,r)}var So="round_robin",rd=class r{getLoadBalancerName(){return So}constructor(){}toJsonObject(){return{[So]:{}}}static createFromJson(e){return new r}},id=class{constructor(e,t=0){this.children=e,this.nextIndex=t}pick(e){let t=this.children[this.nextIndex].picker;return this.nextIndex=(this.nextIndex+1)%this.children.length,t.pick(e)}peekNextEndpoint(){return this.children[this.nextIndex].endpoint}},Eo=class{constructor(e,t){this.channelControlHelper=e,this.options=t,this.children=[],this.currentState=ot.ConnectivityState.IDLE,this.currentReadyPicker=null,this.updatesPaused=!1,this.lastError=null,this.childChannelControlHelper=(0,Cy.createChildChannelControlHelper)(e,{updateState:(i,n)=>{this.calculateAndUpdateState()}})}countChildrenWithState(e){return this.children.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(!this.updatesPaused){if(this.countChildrenWithState(ot.ConnectivityState.READY)>0){let e=this.children.filter(i=>i.getConnectivityState()===ot.ConnectivityState.READY),t=0;if(this.currentReadyPicker!==null){let i=this.currentReadyPicker.peekNextEndpoint();t=e.findIndex(n=>(0,Sy.endpointEqual)(n.getEndpoint(),i)),t<0&&(t=0)}this.updateState(ot.ConnectivityState.READY,new id(e.map(i=>({endpoint:i.getEndpoint(),picker:i.getPicker()})),t))}else this.countChildrenWithState(ot.ConnectivityState.CONNECTING)>0?this.updateState(ot.ConnectivityState.CONNECTING,new td.QueuePicker(this)):this.countChildrenWithState(ot.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(ot.ConnectivityState.TRANSIENT_FAILURE,new td.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(ot.ConnectivityState.IDLE,new td.QueuePicker(this));for(let e of this.children)e.getConnectivityState()===ot.ConnectivityState.IDLE&&e.exitIdle()}}updateState(e,t){Ey(ot.ConnectivityState[this.currentState]+" -> "+ot.ConnectivityState[e]),e===ot.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)e.destroy()}updateAddressList(e,t){this.resetSubchannelList(),Ey("Connect to endpoint list "+e.map(Sy.endpointToString)),this.updatesPaused=!0,this.children=e.map(i=>new w1.LeafLoadBalancer(i,this.childChannelControlHelper,this.options));for(let i of this.children)i.startConnecting();this.updatesPaused=!1,this.calculateAndUpdateState()}exitIdle(){}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return So}};tn.RoundRobinLoadBalancer=Eo;function b1(){(0,Cy.registerLoadBalancerType)(So,Eo,rd)}tn.setup=b1});var Ry=w(zr=>{"use strict";var nd;Object.defineProperty(zr,"__esModule",{value:!0});zr.setup=zr.OutlierDetectionLoadBalancer=zr.OutlierDetectionLoadBalancingConfig=void 0;var R1=ut(),Ty=re(),ci=Gh(),by=Jh(),O1=Jr(),k1=Gs(),A1=Cr(),sd=Tt(),M1=io(),P1=we(),x1="outlier_detection";function We(r){P1.trace(Ty.LogVerbosity.DEBUG,x1,r)}var hd="outlier_detection",N1=((nd=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)!==null&&nd!==void 0?nd:"true")==="true",I1={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},D1={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function rn(r,e,t,i){if(e in r&&r[e]!==void 0&&typeof r[e]!==t){let n=i?`${i}.${e}`:e;throw new Error(`outlier detection config ${n} parse error: expected ${t}, got ${typeof r[e]}`)}}function ad(r,e,t){let i=t?`${t}.${e}`:e;if(e in r&&r[e]!==void 0){if(!(0,ci.isDuration)(r[e]))throw new Error(`outlier detection config ${i} parse error: expected Duration, got ${typeof r[e]}`);if(!(r[e].seconds>=0&&r[e].seconds<=315576e6&&r[e].nanos>=0&&r[e].nanos<=999999999))throw new Error(`outlier detection config ${i} parse error: values out of range for non-negative Duaration`)}}function Co(r,e,t){let i=t?`${t}.${e}`:e;if(rn(r,e,"number",t),e in r&&r[e]!==void 0&&!(r[e]>=0&&r[e]<=100))throw new Error(`outlier detection config ${i} parse error: value out of range for percentage (0-100)`)}var Qn=class r{constructor(e,t,i,n,s,a,o){if(this.childPolicy=o,o.getLoadBalancerName()==="pick_first")throw new Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=e??1e4,this.baseEjectionTimeMs=t??3e4,this.maxEjectionTimeMs=i??3e5,this.maxEjectionPercent=n??10,this.successRateEjection=s?Object.assign(Object.assign({},I1),s):null,this.failurePercentageEjection=a?Object.assign(Object.assign({},D1),a):null}getLoadBalancerName(){return hd}toJsonObject(){var e,t;return{outlier_detection:{interval:(0,ci.msToDuration)(this.intervalMs),base_ejection_time:(0,ci.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,ci.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:(e=this.successRateEjection)!==null&&e!==void 0?e:void 0,failure_percentage_ejection:(t=this.failurePercentageEjection)!==null&&t!==void 0?t:void 0,child_policy:[this.childPolicy.toJsonObject()]}}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}static createFromJson(e){var t;if(ad(e,"interval"),ad(e,"base_ejection_time"),ad(e,"max_ejection_time"),Co(e,"max_ejection_percent"),"success_rate_ejection"in e&&e.success_rate_ejection!==void 0){if(typeof e.success_rate_ejection!="object")throw new Error("outlier detection config success_rate_ejection must be an object");rn(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),Co(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),rn(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),rn(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e&&e.failure_percentage_ejection!==void 0){if(typeof e.failure_percentage_ejection!="object")throw new Error("outlier detection config failure_percentage_ejection must be an object");Co(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),Co(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),rn(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),rn(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}if(!("child_policy"in e)||!Array.isArray(e.child_policy))throw new Error("outlier detection config child_policy must be an array");let i=(0,O1.selectLbConfigFromList)(e.child_policy);if(!i)throw new Error("outlier detection config child_policy: no valid recognized policy found");return new r(e.interval?(0,ci.durationToMs)(e.interval):null,e.base_ejection_time?(0,ci.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,ci.durationToMs)(e.max_ejection_time):null,(t=e.max_ejection_percent)!==null&&t!==void 0?t:null,e.success_rate_ejection,e.failure_percentage_ejection,i)}};zr.OutlierDetectionLoadBalancingConfig=Qn;var ld=class extends M1.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.refCount=0}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){this.setHealthy(!1)}uneject(){this.setHealthy(!0)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}};function od(){return{success:0,failure:0}}var cd=class{constructor(){this.activeBucket=od(),this.inactiveBucket=od()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=od()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}},ud=class{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType===A1.PickResultType.COMPLETE){let i=t.subchannel,n=i.getMapEntry();if(n){let s=t.onCallEnded;return this.countCalls&&(s=a=>{var o;a===Ty.Status.OK?n.counter.addSuccess():n.counter.addFailure(),(o=t.onCallEnded)===null||o===void 0||o.call(t,a)}),Object.assign(Object.assign({},t),{subchannel:i.getWrappedSubchannel(),onCallEnded:s})}else return Object.assign(Object.assign({},t),{subchannel:i.getWrappedSubchannel()})}else return t}},wo=class{constructor(e,t){this.entryMap=new sd.EndpointMap,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new k1.ChildLoadBalancerHandler((0,by.createChildChannelControlHelper)(e,{createSubchannel:(i,n)=>{let s=e.createSubchannel(i,n),a=this.entryMap.getForSubchannelAddress(i),o=new ld(s,a);return a?.currentEjectionTimestamp!==null&&o.eject(),a?.subchannelWrappers.push(o),o},updateState:(i,n)=>{i===R1.ConnectivityState.READY?e.updateState(i,new ud(n,this.isCountingEnabled())):e.updateState(i,n)}}),t),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return this.latestConfig!==null&&(this.latestConfig.getSuccessRateEjectionConfig()!==null||this.latestConfig.getFailurePercentageEjectionConfig()!==null)}getCurrentEjectionPercent(){let e=0;for(let t of this.entryMap.values())t.currentEjectionTimestamp!==null&&(e+=1);return e*100/this.entryMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;We("Running success rate check");let i=t.request_volume,n=0,s=[];for(let[m,S]of this.entryMap.entries()){let O=S.counter.getLastSuccesses(),N=S.counter.getLastFailures();We("Stats for "+(0,sd.endpointToString)(m)+": successes="+O+" failures="+N+" targetRequestVolume="+i),O+N>=i&&(n+=1,s.push(O/(O+N)))}if(We("Found "+n+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+s+"]"),n<t.minimum_hosts)return;let a=s.reduce((m,S)=>m+S)/s.length,o=0;for(let m of s){let S=m-a;o+=S*S}let l=o/s.length,c=Math.sqrt(l),p=a-c*(t.stdev_factor/1e3);We("stdev="+c+" ejectionThreshold="+p);for(let[m,S]of this.entryMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let O=S.counter.getLastSuccesses(),N=S.counter.getLastFailures();if(O+N<i)continue;let k=O/(O+N);if(We("Checking candidate "+m+" successRate="+k),k<p){let I=Math.random()*100;We("Candidate "+m+" randomNumber="+I+" enforcement_percentage="+t.enforcement_percentage),I<t.enforcement_percentage&&(We("Ejecting candidate "+m),this.eject(S,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;We("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let i=0;for(let n of this.entryMap.values()){let s=n.counter.getLastSuccesses(),a=n.counter.getLastFailures();s+a>=t.request_volume&&(i+=1)}if(!(i<t.minimum_hosts))for(let[n,s]of this.entryMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let a=s.counter.getLastSuccesses(),o=s.counter.getLastFailures();if(We("Candidate successes="+a+" failures="+o),a+o<t.request_volume)continue;if(o*100/(o+a)>t.threshold){let c=Math.random()*100;We("Candidate "+n+" randomNumber="+c+" enforcement_percentage="+t.enforcement_percentage),c<t.enforcement_percentage&&(We("Ejecting candidate "+n),this.eject(s,e))}}}eject(e,t){e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1;for(let i of e.subchannelWrappers)i.eject()}uneject(e){e.currentEjectionTimestamp=null;for(let t of e.subchannelWrappers)t.uneject()}switchAllBuckets(){for(let e of this.entryMap.values())e.counter.switchBuckets()}startTimer(e){var t,i;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),(i=(t=this.ejectionTimer).unref)===null||i===void 0||i.call(t)}runChecks(){let e=new Date;if(We("Ejection timer running"),this.switchAllBuckets(),!!this.latestConfig){this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e);for(let[t,i]of this.entryMap.entries())if(i.currentEjectionTimestamp===null)i.ejectionTimeMultiplier>0&&(i.ejectionTimeMultiplier-=1);else{let n=this.latestConfig.getBaseEjectionTimeMs(),s=this.latestConfig.getMaxEjectionTimeMs(),a=new Date(i.currentEjectionTimestamp.getTime());a.setMilliseconds(a.getMilliseconds()+Math.min(n*i.ejectionTimeMultiplier,Math.max(n,s))),a<new Date&&(We("Unejecting "+t),this.uneject(i))}}}updateAddressList(e,t,i){if(!(t instanceof Qn))return;for(let s of e)this.entryMap.has(s)||(We("Adding map entry for "+(0,sd.endpointToString)(s)),this.entryMap.set(s,{counter:new cd,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));this.entryMap.deleteMissing(e);let n=t.getChildPolicy();if(this.childBalancer.updateAddressList(e,n,i),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig())if(this.timerStartTime){We("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let s=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(s)}else We("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets();else{We("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer);for(let s of this.entryMap.values())this.uneject(s),s.ejectionTimeMultiplier=0}this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return hd}};zr.OutlierDetectionLoadBalancer=wo;function q1(){N1&&(0,by.registerLoadBalancerType)(hd,wo,Qn)}zr.setup=q1});var My=w(H=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0});H.experimental=H.ServerInterceptingCall=H.ResponderBuilder=H.ServerListenerBuilder=H.addAdminServicesToServer=H.getChannelzHandlers=H.getChannelzServiceDefinition=H.InterceptorConfigurationError=H.InterceptingCall=H.RequesterBuilder=H.ListenerBuilder=H.StatusBuilder=H.getClientChannel=H.ServerCredentials=H.Server=H.setLogVerbosity=H.setLogger=H.load=H.loadObject=H.CallCredentials=H.ChannelCredentials=H.waitForClientReady=H.closeClient=H.Channel=H.makeGenericClientConstructor=H.makeClientConstructor=H.loadPackageDefinition=H.Client=H.compressionAlgorithms=H.propagate=H.connectivityState=H.status=H.logVerbosity=H.Metadata=H.credentials=void 0;var To=Ul();Object.defineProperty(H,"CallCredentials",{enumerable:!0,get:function(){return To.CallCredentials}});var L1=Rc();Object.defineProperty(H,"Channel",{enumerable:!0,get:function(){return L1.ChannelImplementation}});var F1=rh();Object.defineProperty(H,"compressionAlgorithms",{enumerable:!0,get:function(){return F1.CompressionAlgorithms}});var B1=ut();Object.defineProperty(H,"connectivityState",{enumerable:!0,get:function(){return B1.ConnectivityState}});var bo=Ls();Object.defineProperty(H,"ChannelCredentials",{enumerable:!0,get:function(){return bo.ChannelCredentials}});var Oy=bc();Object.defineProperty(H,"Client",{enumerable:!0,get:function(){return Oy.Client}});var dd=re();Object.defineProperty(H,"logVerbosity",{enumerable:!0,get:function(){return dd.LogVerbosity}});Object.defineProperty(H,"status",{enumerable:!0,get:function(){return dd.Status}});Object.defineProperty(H,"propagate",{enumerable:!0,get:function(){return dd.Propagate}});var ky=we(),fd=kc();Object.defineProperty(H,"loadPackageDefinition",{enumerable:!0,get:function(){return fd.loadPackageDefinition}});Object.defineProperty(H,"makeClientConstructor",{enumerable:!0,get:function(){return fd.makeClientConstructor}});Object.defineProperty(H,"makeGenericClientConstructor",{enumerable:!0,get:function(){return fd.makeClientConstructor}});var U1=Ve();Object.defineProperty(H,"Metadata",{enumerable:!0,get:function(){return U1.Metadata}});var z1=ay();Object.defineProperty(H,"Server",{enumerable:!0,get:function(){return z1.Server}});var H1=xh();Object.defineProperty(H,"ServerCredentials",{enumerable:!0,get:function(){return H1.ServerCredentials}});var j1=oy();Object.defineProperty(H,"StatusBuilder",{enumerable:!0,get:function(){return j1.StatusBuilder}});H.credentials={combineChannelCredentials:(r,...e)=>e.reduce((t,i)=>t.compose(i),r),combineCallCredentials:(r,...e)=>e.reduce((t,i)=>t.compose(i),r),createInsecure:bo.ChannelCredentials.createInsecure,createSsl:bo.ChannelCredentials.createSsl,createFromSecureContext:bo.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:To.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:To.CallCredentials.createFromGoogleCredential,createEmpty:To.CallCredentials.createEmpty};var G1=r=>r.close();H.closeClient=G1;var W1=(r,e,t)=>r.waitForReady(e,t);H.waitForClientReady=W1;var $1=(r,e)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};H.loadObject=$1;var V1=(r,e,t)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};H.load=V1;var K1=r=>{ky.setLogger(r)};H.setLogger=K1;var Y1=r=>{ky.setLoggerVerbosity(r)};H.setLogVerbosity=Y1;var J1=r=>Oy.Client.prototype.getChannel.call(r);H.getClientChannel=J1;var Ro=Cc();Object.defineProperty(H,"ListenerBuilder",{enumerable:!0,get:function(){return Ro.ListenerBuilder}});Object.defineProperty(H,"RequesterBuilder",{enumerable:!0,get:function(){return Ro.RequesterBuilder}});Object.defineProperty(H,"InterceptingCall",{enumerable:!0,get:function(){return Ro.InterceptingCall}});Object.defineProperty(H,"InterceptorConfigurationError",{enumerable:!0,get:function(){return Ro.InterceptorConfigurationError}});var Ay=ni();Object.defineProperty(H,"getChannelzServiceDefinition",{enumerable:!0,get:function(){return Ay.getChannelzServiceDefinition}});Object.defineProperty(H,"getChannelzHandlers",{enumerable:!0,get:function(){return Ay.getChannelzHandlers}});var X1=Ks();Object.defineProperty(H,"addAdminServicesToServer",{enumerable:!0,get:function(){return X1.addAdminServicesToServer}});var pd=Bh();Object.defineProperty(H,"ServerListenerBuilder",{enumerable:!0,get:function(){return pd.ServerListenerBuilder}});Object.defineProperty(H,"ResponderBuilder",{enumerable:!0,get:function(){return pd.ResponderBuilder}});Object.defineProperty(H,"ServerInterceptingCall",{enumerable:!0,get:function(){return pd.ServerInterceptingCall}});var Q1=Jh();H.experimental=Q1;var Z1=Gu(),eR=py(),tR=_y(),rR=po(),iR=wy(),nR=Ry(),sR=ni();Z1.setup(),eR.setup(),tR.setup(),rR.setup(),iR.setup(),nR.setup(),sR.setup()});var md=w(Oo=>{"use strict";Object.defineProperty(Oo,"__esModule",{value:!0});Oo.ConstantBackoff=void 0;var gd=class{constructor(e){this.interval=e}next(){return aR(this.interval)}};Oo.ConstantBackoff=gd;var aR=r=>({duration:r,next(){return this}})});var Py=w(ko=>{"use strict";Object.defineProperty(ko,"__esModule",{value:!0});ko.DelegateBackoff=void 0;var vd=class{constructor(e){this.fn=e}next(e){return yd(this.fn).next(e)}};ko.DelegateBackoff=vd;var yd=(r,e,t=0)=>({duration:t,next(i){let n=r(i,e);return typeof n=="number"?yd(r,e,n):yd(r,n.state,n.delay)}})});var _d=w(Ct=>{"use strict";Object.defineProperty(Ct,"__esModule",{value:!0});Ct.decorrelatedJitterGenerator=Ct.halfJitterGenerator=Ct.fullJitterGenerator=Ct.noJitterGenerator=void 0;var oR=(r=0,e)=>[Math.min(e.maxDelay,e.initialDelay*2**r),r+1];Ct.noJitterGenerator=oR;var lR=(r,e)=>{let[t,i]=(0,Ct.noJitterGenerator)(r,e);return[Math.floor(Math.random()*t),i]};Ct.fullJitterGenerator=lR;var cR=(r,e)=>{let[t,i]=(0,Ct.noJitterGenerator)(r,e);return[Math.floor((t+Math.random()*t)/2),i]};Ct.halfJitterGenerator=cR;var uR=4,hR=1/1.4,dR=(r,e)=>{let[t,i]=r||[0,0],n=t+Math.random(),s=Math.pow(e.exponent,n)*Math.tanh(Math.sqrt(uR*n)),a=isFinite(s)?Math.max(0,s-i):1/0;return[Math.min(a*hR*e.initialDelay,e.maxDelay),[t+1,s]]};Ct.decorrelatedJitterGenerator=dR});var Iy=w(Ao=>{"use strict";Object.defineProperty(Ao,"__esModule",{value:!0});Ao.ExponentialBackoff=void 0;var fR=_d(),xy={generator:fR.decorrelatedJitterGenerator,maxDelay:3e4,exponent:2,initialDelay:128},Sd=class{constructor(e){this.options=e?{...xy,...e}:xy}next(){return Ny(this.options).next(void 0)}};Ao.ExponentialBackoff=Sd;var Ny=(r,e,t=0,i=-1)=>({duration:t,next(){let[n,s]=r.generator(e,r);return Ny(r,s,n,i+1)}})});var qy=w(Mo=>{"use strict";Object.defineProperty(Mo,"__esModule",{value:!0});Mo.IterableBackoff=void 0;var Ed=class{constructor(e){this.durations=e}next(){return Dy(this.durations,0)}};Mo.IterableBackoff=Ed;var Dy=(r,e)=>({duration:r[e],next(){return e===r.length-1?this:Dy(r,e+1)}})});var Cd=w(It=>{"use strict";var pR=It&&It.__createBinding||(Object.create?function(r,e,t,i){i===void 0&&(i=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,i,n)}:function(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}),Zn=It&&It.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&pR(e,r,t)};Object.defineProperty(It,"__esModule",{value:!0});Zn(md(),It);Zn(Py(),It);Zn(Iy(),It);Zn(_d(),It);Zn(qy(),It)});var xo=w(Po=>{"use strict";Object.defineProperty(Po,"__esModule",{value:!0});Po.TaskCancelledError=void 0;var wd=class extends Error{constructor(e="Operation cancelled"){super(e),this.message=e,this.isTaskCancelledError=!0}};Po.TaskCancelledError=wd});var Hr=w(Ye=>{"use strict";Object.defineProperty(Ye,"__esModule",{value:!0});Ye.MemorizingEventEmitter=Ye.EventEmitter=Ye.onAbort=Ye.Event=Ye.noopDisposable=void 0;var Ly=xo();Ye.noopDisposable={dispose:()=>{}};var gR;(function(r){r.once=(e,t)=>{let i=!1,n;return n=e(s=>{t(s),n?n.dispose():i=!0}),i?(n.dispose(),Ye.noopDisposable):n},r.toPromise=(e,t)=>t?t.aborted?Promise.reject(new Ly.TaskCancelledError):new Promise((i,n)=>{let s=(0,Ye.onAbort)(t)(()=>{a.dispose(),n(new Ly.TaskCancelledError)}),a=r.once(e,o=>{s.dispose(),i(o)})}):new Promise(i=>r.once(e,i))})(gR=Ye.Event||(Ye.Event={}));var mR=r=>{let e=new bd;if(r.aborted)return e.emit(),e.addListener;let t=()=>{e.emit(),r.removeEventListener("abort",t)};return r.addEventListener("abort",t),e.addListener};Ye.onAbort=mR;var es=class{constructor(){this.addListener=e=>this.addListenerInner(e)}get size(){return this.listeners?typeof this.listeners=="function"?1:this.listeners.length:0}emit(e){if(this.listeners)if(typeof this.listeners=="function")this.listeners(e);else for(let t of this.listeners)t(e)}addListenerInner(e){return this.listeners?typeof this.listeners=="function"?this.listeners=[this.listeners,e]:this.listeners.push(e):this.listeners=e,{dispose:()=>this.removeListener(e)}}removeListener(e){if(!this.listeners)return;if(typeof this.listeners=="function"){this.listeners===e&&(this.listeners=void 0);return}let t=this.listeners.indexOf(e);t!==-1&&(this.listeners.length===2?this.listeners=t===0?this.listeners[1]:this.listeners[0]:this.listeners=this.listeners.slice(0,t).concat(this.listeners.slice(t+1)))}};Ye.EventEmitter=es;var Td=class extends es{constructor(){super(...arguments),this.addListener=e=>{let t=this.addListenerInner(e);return this.lastValue&&e(this.lastValue.value),t}}get hasEmitted(){return!!this.lastValue}emit(e){this.lastValue={value:e},super.emit(e)}};Ye.MemorizingEventEmitter=Td;var bd=class extends es{constructor(){super(...arguments),this.addListener=e=>this.lastValue?(e(this.lastValue.value),Ye.noopDisposable):this.addListenerInner(e)}emit(e){this.lastValue={value:e},super.emit(e),this.listeners=void 0}}});var ui=w(pr=>{"use strict";Object.defineProperty(pr,"__esModule",{value:!0});pr.deriveAbortController=pr.abortedSignal=pr.neverAbortedSignal=void 0;var vR=Hr();pr.neverAbortedSignal=new AbortController().signal;var Fy=new AbortController;Fy.abort();pr.abortedSignal=Fy.signal;var yR=r=>{let e=new AbortController;if(!r)return e;if(r.aborted&&e.abort(),r!==pr.neverAbortedSignal){let t=new WeakRef(e);(0,vR.onAbort)(r)(()=>t.deref()?.abort())}return e};pr.deriveAbortController=yR});var sn=w(nn=>{"use strict";Object.defineProperty(nn,"__esModule",{value:!0});nn.ExecuteWrapper=nn.returnOrThrow=void 0;var By=Hr(),_R=r=>{if("error"in r)throw r.error;return"success"in r?r.success:r.value};nn.returnOrThrow=_R;var SR=()=>{if(typeof performance<"u"){let r=performance.now();return()=>performance.now()-r}else{let r=process.hrtime.bigint();return()=>Number(process.hrtime.bigint()-r)/1e6}},Rd=class r{constructor(e=()=>!1,t=()=>!1){this.errorFilter=e,this.resultFilter=t,this.successEmitter=new By.EventEmitter,this.failureEmitter=new By.EventEmitter,this.onSuccess=this.successEmitter.addListener,this.onFailure=this.failureEmitter.addListener}clone(){return new r(this.errorFilter,this.resultFilter)}async invoke(e,...t){let i=this.successEmitter.size||this.failureEmitter.size?SR():null;try{let n=await e(...t);return this.resultFilter(n)?(i&&this.failureEmitter.emit({duration:i(),handled:!0,reason:{value:n}}),{value:n}):(i&&this.successEmitter.emit({duration:i()}),{success:n})}catch(n){let s=n,a=this.errorFilter(s);if(i&&this.failureEmitter.emit({duration:i(),handled:a,reason:{error:s}}),!a)throw s;return{error:s}}}};nn.ExecuteWrapper=Rd});var kd=w(No=>{"use strict";Object.defineProperty(No,"__esModule",{value:!0});No.BrokenCircuitError=void 0;var Od=class extends Error{constructor(e="Execution prevented because the circuit breaker is open"){super(e),this.isBrokenCircuitError=!0}};No.BrokenCircuitError=Od});var Md=w(Io=>{"use strict";Object.defineProperty(Io,"__esModule",{value:!0});Io.BulkheadRejectedError=void 0;var Ad=class extends Error{constructor(e,t){super(`Bulkhead capacity exceeded (0/${e} execution slots, 0/${t} available)`),this.isBulkheadRejectedError=!0}};Io.BulkheadRejectedError=Ad});var xd=w(Do=>{"use strict";Object.defineProperty(Do,"__esModule",{value:!0});Do.IsolatedCircuitError=void 0;var ER=kd(),Pd=class extends ER.BrokenCircuitError{constructor(){super("Execution prevented because the circuit breaker is open"),this.isIsolatedCircuitError=!0}};Do.IsolatedCircuitError=Pd});var Lo=w(je=>{"use strict";var CR=je&&je.__createBinding||(Object.create?function(r,e,t,i){i===void 0&&(i=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,i,n)}:function(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}),qo=je&&je.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&CR(e,r,t)};Object.defineProperty(je,"__esModule",{value:!0});je.isTaskCancelledError=je.isIsolatedCircuitError=je.isBulkheadRejectedError=je.isBrokenCircuitError=void 0;qo(kd(),je);qo(Md(),je);qo(xd(),je);qo(xo(),je);var wR=r=>!!r&&r instanceof Error&&"isBrokenCircuitError"in r;je.isBrokenCircuitError=wR;var TR=r=>!!r&&r instanceof Error&&"isBulkheadRejectedError"in r;je.isBulkheadRejectedError=TR;var bR=r=>!!r&&r instanceof Error&&"isBulkheadRejectedError"in r;je.isIsolatedCircuitError=bR;var RR=r=>!!r&&r instanceof Error&&"isBulkheadRejectedError"in r;je.isTaskCancelledError=RR});var Bo=w(hi=>{"use strict";Object.defineProperty(hi,"__esModule",{value:!0});hi.CircuitBreakerPolicy=hi.CircuitState=void 0;var OR=ui(),Fo=Hr(),Uy=sn(),zy=Lo(),kR=xd(),Se;(function(r){r[r.Closed=0]="Closed",r[r.Open=1]="Open",r[r.HalfOpen=2]="HalfOpen",r[r.Isolated=3]="Isolated"})(Se=hi.CircuitState||(hi.CircuitState={}));var Nd=class{constructor(e,t){this.options=e,this.executor=t,this.breakEmitter=new Fo.EventEmitter,this.resetEmitter=new Fo.EventEmitter,this.halfOpenEmitter=new Fo.EventEmitter,this.stateChangeEmitter=new Fo.EventEmitter,this.innerState={value:Se.Closed},this.onBreak=this.breakEmitter.addListener,this.onReset=this.resetEmitter.addListener,this.onHalfOpen=this.halfOpenEmitter.addListener,this.onStateChange=this.stateChangeEmitter.addListener,this.onSuccess=this.executor.onSuccess,this.onFailure=this.executor.onFailure}get state(){return this.innerState.value}get lastFailure(){return this.innerLastFailure}isolate(){this.innerState.value!==Se.Isolated&&(this.innerState={value:Se.Isolated,counters:0},this.breakEmitter.emit({isolated:!0}),this.stateChangeEmitter.emit(Se.Isolated)),this.innerState.counters++;let e=!1;return{dispose:()=>{e||(e=!0,this.innerState.value===Se.Isolated&&!--this.innerState.counters&&(this.innerState={value:Se.Closed},this.resetEmitter.emit(),this.stateChangeEmitter.emit(Se.Closed)))}}}async execute(e,t=OR.neverAbortedSignal){let i=this.innerState;switch(i.value){case Se.Closed:let n=await this.executor.invoke(e,{signal:t});return"success"in n?this.options.breaker.success(i.value):(this.innerLastFailure=n,this.options.breaker.failure(i.value)&&this.open(n)),(0,Uy.returnOrThrow)(n);case Se.HalfOpen:if(await i.test.catch(()=>{}),this.state===Se.Closed&&t.aborted)throw new zy.TaskCancelledError;return this.execute(e);case Se.Open:if(Date.now()-i.openedAt<this.options.halfOpenAfter)throw new zy.BrokenCircuitError;let s=this.halfOpen(e,t);return this.innerState={value:Se.HalfOpen,test:s},this.stateChangeEmitter.emit(Se.HalfOpen),s;case Se.Isolated:throw new kR.IsolatedCircuitError;default:throw new Error(`Unexpected circuit state ${i}`)}}async halfOpen(e,t){this.halfOpenEmitter.emit();try{let i=await this.executor.invoke(e,{signal:t});return"success"in i?(this.options.breaker.success(Se.HalfOpen),this.close()):(this.innerLastFailure=i,this.options.breaker.failure(Se.HalfOpen),this.open(i)),(0,Uy.returnOrThrow)(i)}catch(i){throw this.close(),i}}open(e){this.state===Se.Isolated||this.state===Se.Open||(this.innerState={value:Se.Open,openedAt:Date.now()},this.breakEmitter.emit(e),this.stateChangeEmitter.emit(Se.Open))}close(){this.state===Se.HalfOpen&&(this.innerState={value:Se.Closed},this.resetEmitter.emit(),this.stateChangeEmitter.emit(Se.Closed))}};hi.CircuitBreakerPolicy=Nd});var jy=w(Uo=>{"use strict";Object.defineProperty(Uo,"__esModule",{value:!0});Uo.SamplingBreaker=void 0;var Hy=Bo(),Id=class{constructor({threshold:e,duration:t,minimumRps:i}){if(this.windows=[],this.currentWindow=0,this.currentFailures=0,this.currentSuccesses=0,e<=0||e>=1)throw new RangeError(`SamplingBreaker threshold should be between (0, 1), got ${e}`);this.threshold=e;let n=Math.max(5,Math.ceil(t/1e3));for(let s=0;s<n;s++)this.windows.push({startedAt:0,failures:0,successes:0});this.windowSize=Math.round(t/n),this.duration=this.windowSize*n,i?this.minimumRpms=i/1e3:this.minimumRpms=5/(e*1e3)}success(e){e===Hy.CircuitState.HalfOpen&&this.resetWindows(),this.push(!0)}failure(e){if(this.push(!1),e!==Hy.CircuitState.Closed)return!0;let t=this.currentSuccesses+this.currentFailures;return t<this.duration*this.minimumRpms?!1:this.currentFailures>this.threshold*t}resetWindows(){this.currentFailures=0,this.currentSuccesses=0;for(let e of this.windows)e.failures=0,e.successes=0,e.startedAt=0}rotateWindow(e){let t=(this.currentWindow+1)%this.windows.length;this.currentFailures-=this.windows[t].failures,this.currentSuccesses-=this.windows[t].successes;let i=this.windows[t]={failures:0,successes:0,startedAt:e};return this.currentWindow=t,i}push(e){let t=Date.now(),i=this.windows[this.currentWindow];t-i.startedAt>=this.windowSize&&(i=this.rotateWindow(t)),e?(i.successes++,this.currentSuccesses++):(i.failures++,this.currentFailures++)}};Uo.SamplingBreaker=Id});var Gy=w(zo=>{"use strict";Object.defineProperty(zo,"__esModule",{value:!0});zo.ConsecutiveBreaker=void 0;var Dd=class{constructor(e){this.threshold=e,this.count=0}success(){this.count=0}failure(){return++this.count>=this.threshold}};zo.ConsecutiveBreaker=Dd});var $y=w(jr=>{"use strict";var AR=jr&&jr.__createBinding||(Object.create?function(r,e,t,i){i===void 0&&(i=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,i,n)}:function(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}),Wy=jr&&jr.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&AR(e,r,t)};Object.defineProperty(jr,"__esModule",{value:!0});Wy(jy(),jr);Wy(Gy(),jr)});var Vy=w(Ho=>{"use strict";Object.defineProperty(Ho,"__esModule",{value:!0});Ho.defer=void 0;var MR=()=>{let r,e,t=new Promise((i,n)=>{r=i,e=n});return{resolve:r,reject:e,promise:t}};Ho.defer=MR});var Ld=w(jo=>{"use strict";Object.defineProperty(jo,"__esModule",{value:!0});jo.BulkheadPolicy=void 0;var PR=ui(),xR=Vy(),NR=Hr(),IR=sn(),DR=Md(),qR=Lo(),qd=class{constructor(e,t){this.capacity=e,this.queueCapacity=t,this.active=0,this.queue=[],this.onRejectEmitter=new NR.EventEmitter,this.executor=new IR.ExecuteWrapper,this.onSuccess=this.executor.onSuccess,this.onFailure=this.executor.onFailure,this.onReject=this.onRejectEmitter.addListener}get executionSlots(){return this.capacity-this.active}get queueSlots(){return this.queueCapacity-this.queue.length}async execute(e,t=PR.neverAbortedSignal){if(t.aborted)throw new qR.TaskCancelledError;if(this.active<this.capacity){this.active++;try{return await e({signal:t})}finally{this.active--,this.dequeue()}}if(this.queue.length<this.queueCapacity){let{resolve:i,reject:n,promise:s}=(0,xR.defer)();return this.queue.push({signal:t,fn:e,resolve:i,reject:n}),s}throw this.onRejectEmitter.emit(),new DR.BulkheadRejectedError(this.capacity,this.queueCapacity)}dequeue(){let e=this.queue.shift();e&&Promise.resolve().then(()=>this.execute(e.fn,e.signal)).then(e.resolve).catch(e.reject)}};jo.BulkheadPolicy=qd});var Bd=w(Go=>{"use strict";Object.defineProperty(Go,"__esModule",{value:!0});Go.FallbackPolicy=void 0;var LR=ui(),Fd=class{constructor(e,t){this.executor=e,this.value=t,this.onSuccess=this.executor.onSuccess,this.onFailure=this.executor.onFailure}async execute(e,t=LR.neverAbortedSignal){let i=await this.executor.invoke(e,{signal:t});return"success"in i?i.success:this.value()}};Go.FallbackPolicy=Fd});var zd=w(Wo=>{"use strict";Object.defineProperty(Wo,"__esModule",{value:!0});Wo.NoopPolicy=void 0;var FR=ui(),Ky=sn(),Ud=class{constructor(){this.executor=new Ky.ExecuteWrapper,this.onSuccess=this.executor.onSuccess,this.onFailure=this.executor.onFailure}async execute(e,t=FR.neverAbortedSignal){return(0,Ky.returnOrThrow)(await this.executor.invoke(e,{signal:t}))}};Wo.NoopPolicy=Ud});var jd=w($o=>{"use strict";Object.defineProperty($o,"__esModule",{value:!0});$o.RetryPolicy=void 0;var BR=md(),UR=ui(),Yy=Hr(),zR=(r,e)=>new Promise(t=>{let i=setTimeout(t,r);e&&i.unref()}),Hd=class r{constructor(e,t){this.options=e,this.executor=t,this.onGiveUpEmitter=new Yy.EventEmitter,this.onRetryEmitter=new Yy.EventEmitter,this.onSuccess=this.executor.onSuccess,this.onFailure=this.executor.onFailure,this.onRetry=this.onRetryEmitter.addListener,this.onGiveUp=this.onGiveUpEmitter.addListener}dangerouslyUnref(){return new r({...this.options,unref:!0},this.executor.clone())}async execute(e,t=UR.neverAbortedSignal){let i=this.options.backoff||new BR.ConstantBackoff(0),n;for(let s=0;;s++){let a=await this.executor.invoke(e,{attempt:s,signal:t});if("success"in a)return a.success;if(!t.aborted&&s<this.options.maxAttempts){let o={attempt:s+1,signal:t,result:a};n=n?n.next(o):i.next(o);let l=n.duration,c=zR(l,!!this.options.unref);this.onRetryEmitter.emit({...a,delay:l}),await c;continue}if(this.onGiveUpEmitter.emit(a),"error"in a)throw a.error;return a.value}}};$o.RetryPolicy=Hd});var Vd=w(di=>{"use strict";Object.defineProperty(di,"__esModule",{value:!0});di.TimeoutPolicy=di.TimeoutStrategy=void 0;var HR=ui(),Gd=Hr(),Wd=sn(),jR=xo(),Jy;(function(r){r.Cooperative="optimistic",r.Aggressive="aggressive"})(Jy=di.TimeoutStrategy||(di.TimeoutStrategy={}));var $d=class r{constructor(e,t,i=new Wd.ExecuteWrapper,n=!1){this.duration=e,this.options=t,this.executor=i,this.unref=n,this.timeoutEmitter=new Gd.EventEmitter,this.onTimeout=this.timeoutEmitter.addListener,this.onFailure=this.executor.onFailure,this.onSuccess=this.executor.onSuccess}dangerouslyUnref(){return new r(this.duration,this.options,this.executor,!0)}async execute(e,t){let i=(0,HR.deriveAbortController)(t),n=setTimeout(()=>i.abort(),this.duration);this.unref&&n.unref();let s={signal:i.signal},a=(0,Gd.onAbort)(i.signal),o=a(()=>this.timeoutEmitter.emit());try{return this.options.strategy===Jy.Cooperative?(0,Wd.returnOrThrow)(await this.executor.invoke(e,s,i.signal)):await this.executor.invoke(async()=>Promise.race([Promise.resolve(e(s,i.signal)),Gd.Event.toPromise(a).then(()=>{throw new jR.TaskCancelledError(`Operation timed out after ${this.duration}ms`)})])).then(Wd.returnOrThrow)}finally{o.dispose(),this.options.abortOnReturn!==!1&&i.abort(),clearTimeout(n)}}};di.TimeoutPolicy=$d});var Xy=w(fe=>{"use strict";Object.defineProperty(fe,"__esModule",{value:!0});fe.fallback=fe.circuitBreaker=fe.retry=fe.wrap=fe.timeout=fe.usePolicy=fe.bulkhead=fe.handleWhenResult=fe.handleResultType=fe.handleWhen=fe.handleType=fe.handleAll=fe.noop=fe.Policy=void 0;var GR=Cd(),WR=Ld(),$R=Bo(),Kd=sn(),VR=Bd(),KR=zd(),YR=jd(),JR=Vd(),Vo=(r,e)=>e?t=>t instanceof r&&e(t):t=>t instanceof r,XR=()=>!0,ts=()=>!1,Gr=class r{constructor(e){this.options=e}orType(e,t){let i=Vo(e,t);return new r({...this.options,errorFilter:n=>this.options.errorFilter(n)||i(n)})}orWhen(e){return new r({...this.options,errorFilter:t=>this.options.errorFilter(t)||e(t)})}orWhenResult(e){return new r({...this.options,resultFilter:t=>this.options.resultFilter(t)||e(t)})}orResultType(e,t){let i=Vo(e,t);return new r({...this.options,resultFilter:n=>this.options.resultFilter(n)||i(n)})}};fe.Policy=Gr;fe.noop=new KR.NoopPolicy;fe.handleAll=new Gr({errorFilter:XR,resultFilter:ts});function QR(r,e){return new Gr({errorFilter:Vo(r,e),resultFilter:ts})}fe.handleType=QR;function ZR(r){return new Gr({errorFilter:r,resultFilter:ts})}fe.handleWhen=ZR;function eO(r,e){return new Gr({errorFilter:ts,resultFilter:Vo(r,e)})}fe.handleResultType=eO;function tO(r){return new Gr({errorFilter:ts,resultFilter:r})}fe.handleWhenResult=tO;function rO(r,e=0){return new WR.BulkheadPolicy(r,e)}fe.bulkhead=rO;function iO(r){return(e,t,i)=>{let n=i.value;if(typeof n!="function")throw new Error(`Can only decorate functions with @cockatiel, got ${typeof n}`);i.value=function(...s){let a=s[s.length-1]instanceof AbortSignal?s.pop():void 0;return r.execute(o=>n.apply(this,[...s,o]),a)}}}fe.usePolicy=iO;function nO(r,e){return new JR.TimeoutPolicy(r,typeof e=="string"?{strategy:e}:e)}fe.timeout=nO;function sO(...r){return{_altReturn:void 0,onFailure:r[0].onFailure,onSuccess:r[0].onSuccess,wrapped:r,execute(e,t){let i=(n,s)=>s===r.length?e(n):r[s].execute(a=>i({...n,...a},s+1),n.signal);return Promise.resolve(i({signal:t},0))}}}fe.wrap=sO;function aO(r,e){return new YR.RetryPolicy({backoff:e.backoff||new GR.ConstantBackoff(0),maxAttempts:e.maxAttempts??1/0},new Kd.ExecuteWrapper(r.options.errorFilter,r.options.resultFilter))}fe.retry=aO;function oO(r,e){return new $R.CircuitBreakerPolicy(e,new Kd.ExecuteWrapper(r.options.errorFilter,r.options.resultFilter))}fe.circuitBreaker=oO;function lO(r,e){return new VR.FallbackPolicy(new Kd.ExecuteWrapper(r.options.errorFilter,r.options.resultFilter),typeof e=="function"?e:()=>e)}fe.fallback=lO});var Yd=w(xe=>{"use strict";var cO=xe&&xe.__createBinding||(Object.create?function(r,e,t,i){i===void 0&&(i=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,i,n)}:function(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}),ir=xe&&xe.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&cO(e,r,t)};Object.defineProperty(xe,"__esModule",{value:!0});xe.EventEmitter=xe.Event=void 0;ir(Cd(),xe);ir($y(),xe);ir(Ld(),xe);ir(Bo(),xe);var Qy=Hr();Object.defineProperty(xe,"Event",{enumerable:!0,get:function(){return Qy.Event}});Object.defineProperty(xe,"EventEmitter",{enumerable:!0,get:function(){return Qy.EventEmitter}});ir(Lo(),xe);ir(Bd(),xe);ir(zd(),xe);ir(Xy(),xe);ir(jd(),xe);ir(Vd(),xe)});var i0=w(an=>{"use strict";Object.defineProperty(an,"__esModule",{value:!0});an.ConnectionPool=an.Host=void 0;var Wr=My(),uO=Pu(),fi=Yd(),Dt=nr(),Ko=wt(),hO=(0,uO.loadSync)(`${__dirname}/../proto/rpc.proto`,{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0}),dO=Wr.loadPackageDefinition(hO),e0=dO.etcdserverpb,Zy="https:";function t0(r){return r.replace(/^https?:\/\//,"")}function r0(r,e,t,i,n){return new Promise((s,a)=>{r[i](n,e,t||{},(o,l)=>{o?a((0,Dt.castGrpcError)(o)):s(l)})})}var Jd=class{constructor(e,t){this.options=e,this.credentials=t,this.awaitingMetadata=null}invalidateMetadata(){this.awaitingMetadata=null}getMetadata(){if(this.awaitingMetadata!==null)return this.awaitingMetadata;let e=typeof this.options.hosts=="string"?[this.options.hosts]:this.options.hosts,t=this.options.auth;if(!t)return Promise.resolve(new Wr.Metadata);let i=(n,s)=>{if(n>=e.length)return this.awaitingMetadata=null,Promise.reject(s);let a=new Wr.Metadata,o=t0(e[n]),l={method:"authenticate",params:{name:t.username,password:t.password},service:"Auth",isStream:!1};return this.getCredentialsFromHost(o,t.username,t.password,(0,Ko.resolveCallOptions)((0,Ko.resolveCallOptions)(void 0,t.callOptions,l),(0,Ko.resolveCallOptions)(void 0,this.options.defaultCallOptions,l),l),this.credentials).then(c=>(a.set("token",c),a)).catch(c=>i(n+1,c))};return this.awaitingMetadata=i(0)}getCredentialsFromHost(e,t,i,n,s){return r0(new e0.Auth(e,s),new Wr.Metadata,n,"authenticate",{name:t,password:i}).then(a=>a.token)}},fO=()=>(0,fi.circuitBreaker)((0,fi.handleWhen)(Dt.isRecoverableError),{halfOpenAfter:5e3,breaker:new fi.ConsecutiveBreaker(3)}),rs=class{constructor(e,t,i,n=fO()){this.channelCredentials=t,this.channelOptions=i,this.faultHandling=n,this.closed=!1,this.cachedServices=Object.create(null),this.host=t0(e)}getServiceClient(e){let t=this.cachedServices[e];if(t)return t;if(this.closed)throw new Dt.ClientClosedError(e);let i=new e0[e](this.host,this.channelCredentials,this.channelOptions);return this.cachedServices[e]=i,i}resetAllServices(){for(let e of Object.values(this.cachedServices))e&&(e.getChannel().getConnectivityState(!1)===Wr.connectivityState.CONNECTING?e.waitForReady(Date.now()+1e3,()=>setImmediate(()=>e.close())):e.close());this.cachedServices=Object.create(null)}close(){this.resetAllServices(),this.closed=!0}};an.Host=rs;var Yo=class r{constructor(e){var t,i,n,s;this.options=e,this.callOptionsFactory=this.options.defaultCallOptions,this.globalPolicy=(i=(t=this.options.faultHandling)===null||t===void 0?void 0:t.global)!==null&&i!==void 0?i:(0,fi.retry)((0,fi.handleWhen)(Dt.isRecoverableError),{maxAttempts:3});let a=this.buildAuthentication(),{hosts:o="127.0.0.1:2379",grpcOptions:l}=this.options;if(typeof o=="string")this.hosts=[new rs(o,a,l,(s=(n=e.faultHandling)===null||n===void 0?void 0:n.host)===null||s===void 0?void 0:s.call(n,o))];else{if(o.length===0)throw new Error("Cannot construct an etcd client with no hosts specified");this.hosts=o.map(c=>{var p,m;return new rs(c,a,l,(m=(p=e.faultHandling)===null||p===void 0?void 0:p.host)===null||m===void 0?void 0:m.call(p,c))})}}mock(e){this.mockImpl=e}unmock(){this.mockImpl=null}close(){this.hosts.forEach(e=>e.close())}async exec(e,t,i,n){if(this.mockImpl)return this.mockImpl.exec(e,t,i);let s=this.shuffledHosts(),a;try{return await this.globalPolicy.execute(()=>this.withConnection(e,async({client:o,metadata:l})=>{let c=(0,Ko.resolveCallOptions)(n,this.callOptionsFactory,{service:e,method:t,params:i,isStream:!1});try{return await r0(o,l,c,t,i)}catch(p){if(p instanceof Dt.EtcdInvalidAuthTokenError)return this.authenticator.invalidateMetadata(),this.exec(e,t,i,n);throw a=p,p}},s))}catch(o){throw(0,fi.isBrokenCircuitError)(o)&&a&&!(0,fi.isBrokenCircuitError)(a)?a:o}}async withConnection(e,t,i=this.shuffledHosts()){if(this.mockImpl)return this.mockImpl.withConnection(e,t);let n=await this.authenticator.getMetadata(),s;for(let a=0;a<this.hosts.length;a++){let o=i.next().value,l=!1;try{return await o.faultHandling.execute(()=>(l=!0,t({resource:o,client:o.getServiceClient(e),metadata:n})))}catch(c){if((0,Dt.isRecoverableError)(c)&&o.resetAllServices(),l)throw(0,Dt.castGrpcError)(c);s=c}}throw s?(0,Dt.castGrpcError)(s):new Dt.ClientRuntimeError("Connection pool has no hosts")}markFailed(e,t){t=(0,Dt.castGrpcError)(t);let i=!1;(0,Dt.isRecoverableError)(t)&&e.resetAllServices(),e.faultHandling.execute(()=>{if(!i)throw i=!0,t}).catch(()=>{})}*shuffledHosts(){let e=this.hosts.slice();for(;;)for(let t=e.length-1;t>=0;t--){let i=r.deterministicOrder?t:Math.floor((t+1)*Math.random());[e[i],e[t]]=[e[t],e[i]],yield e[t]}}buildAuthentication(){let{credentials:e}=this.options,t=Wr.credentials.createInsecure();return e?t=Wr.credentials.createSsl(e.rootCertificate,e.privateKey,e.certChain):this.hasSecureHost()&&(t=Wr.credentials.createSsl()),this.authenticator=new Jd(this.options,t),t}hasSecureHost(){let{hosts:e}=this.options;if(typeof e=="string")return e.startsWith(Zy);let t=e.filter(i=>i.startsWith(Zy)).length;if(t===0)return!1;if(t<e.length)throw new Error("etcd3 cannot be configured with a mix of secure and insecure hosts");return!0}};an.ConnectionPool=Yo;Yo.deterministicOrder=!1});var $r=w(ee=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0});ee.Services=ee.Permission=ee.EventType=ee.DowngradeAction=ee.AlarmAction=ee.AlarmType=ee.FilterType=ee.CompareTarget=ee.CompareResult=ee.SortTarget=ee.SortOrder=ee.AuthClient=ee.MaintenanceClient=ee.ClusterClient=ee.LeaseClient=ee.WatchClient=ee.KVClient=void 0;var Xd=wt(),Jo=class{constructor(e){this.client=e}range(e,t){return this.client.exec("KV","range",e,t)}put(e,t){return this.client.exec("KV","put",e,t)}deleteRange(e,t){return this.client.exec("KV","deleteRange",e,t)}txn(e,t){return this.client.exec("KV","txn",e,t)}compact(e,t){return this.client.exec("KV","compact",e,t)}};ee.KVClient=Jo;var Xo=class{constructor(e){this.client=e}watch(e){return this.client.withConnection("Watch",({resource:t,client:i,metadata:n})=>{let s=(0,Xd.resolveCallOptions)(e,this.client.callOptionsFactory,{service:"Watch",method:"watch",isStream:!0}),a=i.watch(n,s);return a.on("error",o=>a.writable&&this.client.markFailed(t,o)),a})}};ee.WatchClient=Xo;var Qo=class{constructor(e){this.client=e}leaseGrant(e,t){return this.client.exec("Lease","leaseGrant",e,t)}leaseRevoke(e,t){return this.client.exec("Lease","leaseRevoke",e,t)}leaseKeepAlive(e){return this.client.withConnection("Lease",({resource:t,client:i,metadata:n})=>{let s=(0,Xd.resolveCallOptions)(e,this.client.callOptionsFactory,{service:"Lease",method:"leaseKeepAlive",isStream:!0}),a=i.leaseKeepAlive(n,s);return a.on("error",o=>a.writable&&this.client.markFailed(t,o)),a})}leaseTimeToLive(e,t){return this.client.exec("Lease","leaseTimeToLive",e,t)}leaseLeases(e){return this.client.exec("Lease","leaseLeases",{},e)}};ee.LeaseClient=Qo;var Zo=class{constructor(e){this.client=e}memberAdd(e,t){return this.client.exec("Cluster","memberAdd",e,t)}memberRemove(e,t){return this.client.exec("Cluster","memberRemove",e,t)}memberUpdate(e,t){return this.client.exec("Cluster","memberUpdate",e,t)}memberList(e,t){return this.client.exec("Cluster","memberList",e,t)}memberPromote(e,t){return this.client.exec("Cluster","memberPromote",e,t)}};ee.ClusterClient=Zo;var el=class{constructor(e){this.client=e}alarm(e,t){return this.client.exec("Maintenance","alarm",e,t)}status(e){return this.client.exec("Maintenance","status",{},e)}defragment(e){return this.client.exec("Maintenance","defragment",{},e)}hash(e){return this.client.exec("Maintenance","hash",{},e)}hashKV(e,t){return this.client.exec("Maintenance","hashKV",e,t)}snapshot(e){return this.client.withConnection("Maintenance",({resource:t,client:i,metadata:n})=>{let s=(0,Xd.resolveCallOptions)(e,this.client.callOptionsFactory,{service:"Maintenance",method:"snapshot",isStream:!0}),a=i.snapshot(n,s,{});return a.on("error",o=>this.client.markFailed(t,o)),a})}moveLeader(e,t){return this.client.exec("Maintenance","moveLeader",e,t)}downgrade(e,t){return this.client.exec("Maintenance","downgrade",e,t)}};ee.MaintenanceClient=el;var tl=class{constructor(e){this.client=e}authEnable(e){return this.client.exec("Auth","authEnable",{},e)}authDisable(e){return this.client.exec("Auth","authDisable",{},e)}authStatus(e){return this.client.exec("Auth","authStatus",{},e)}authenticate(e,t){return this.client.exec("Auth","authenticate",e,t)}userAdd(e,t){return this.client.exec("Auth","userAdd",e,t)}userGet(e,t){return this.client.exec("Auth","userGet",e,t)}userList(e){return this.client.exec("Auth","userList",{},e)}userDelete(e,t){return this.client.exec("Auth","userDelete",e,t)}userChangePassword(e,t){return this.client.exec("Auth","userChangePassword",e,t)}userGrantRole(e,t){return this.client.exec("Auth","userGrantRole",e,t)}userRevokeRole(e,t){return this.client.exec("Auth","userRevokeRole",e,t)}roleAdd(e,t){return this.client.exec("Auth","roleAdd",e,t)}roleGet(e,t){return this.client.exec("Auth","roleGet",e,t)}roleList(e){return this.client.exec("Auth","roleList",{},e)}roleDelete(e,t){return this.client.exec("Auth","roleDelete",e,t)}roleGrantPermission(e,t){return this.client.exec("Auth","roleGrantPermission",e,t)}roleRevokePermission(e,t){return this.client.exec("Auth","roleRevokePermission",e,t)}};ee.AuthClient=tl;var n0;(function(r){r[r.None=0]="None",r[r.Ascend=1]="Ascend",r[r.Descend=2]="Descend"})(n0||(ee.SortOrder=n0={}));var s0;(function(r){r[r.Key=0]="Key",r[r.Version=1]="Version",r[r.Create=2]="Create",r[r.Mod=3]="Mod",r[r.Value=4]="Value"})(s0||(ee.SortTarget=s0={}));var a0;(function(r){r[r.Equal=0]="Equal",r[r.Greater=1]="Greater",r[r.Less=2]="Less",r[r.NotEqual=3]="NotEqual"})(a0||(ee.CompareResult=a0={}));var o0;(function(r){r[r.Version=0]="Version",r[r.Create=1]="Create",r[r.Mod=2]="Mod",r[r.Value=3]="Value",r[r.Lease=4]="Lease"})(o0||(ee.CompareTarget=o0={}));var l0;(function(r){r[r.Noput=0]="Noput",r[r.Nodelete=1]="Nodelete"})(l0||(ee.FilterType=l0={}));var c0;(function(r){r[r.None=0]="None",r[r.Nospace=1]="Nospace",r[r.Corrupt=2]="Corrupt"})(c0||(ee.AlarmType=c0={}));var u0;(function(r){r[r.Get=0]="Get",r[r.Activate=1]="Activate",r[r.Deactivate=2]="Deactivate"})(u0||(ee.AlarmAction=u0={}));var h0;(function(r){r[r.Validate=0]="Validate",r[r.Enable=1]="Enable",r[r.Cancel=2]="Cancel"})(h0||(ee.DowngradeAction=h0={}));var d0;(function(r){r[r.Put=0]="Put",r[r.Delete=1]="Delete"})(d0||(ee.EventType=d0={}));var f0;(function(r){r[r.Read=0]="Read",r[r.Write=1]="Write",r[r.Readwrite=2]="Readwrite"})(f0||(ee.Permission=f0={}));ee.Services={KV:Jo,Watch:Xo,Lease:Qo,Cluster:Zo,Maintenance:el,Auth:tl}});var on=w(Re=>{"use strict";Object.defineProperty(Re,"__esModule",{value:!0});Re.ComparatorBuilder=Re.PutBuilder=Re.DeleteBuilder=Re.MultiRangeBuilder=Re.SingleRangeBuilder=Re.RangeBuilder=Re.compareTarget=Re.comparator=void 0;var rl=Kr(),qt=$r(),gr=wt(),pO=Buffer.from([]);Re.comparator={"==":qt.CompareResult.Equal,"===":qt.CompareResult.Equal,">":qt.CompareResult.Greater,"<":qt.CompareResult.Less,"!=":qt.CompareResult.NotEqual,"!==":qt.CompareResult.NotEqual};Re.compareTarget={Value:"value",Version:"version",Create:"create_revision",Mod:"mod_revision",Lease:"lease"};function il(r,e,t){if(!(e in r)){let i=Object.keys(r).join('" "');throw new Error(`Unexpected "${String(e)}" in ${t}. Possible values are: "${i}"`)}}var is=class extends gr.PromiseWrap{constructor(e){super(),this.namespace=e,this.request={}}revision(e){return this.request.revision=e,this}serializable(e){return this.request.serializable=e,this}minModRevision(e){return this.request.min_mod_revision=e,this}maxModRevision(e){return this.request.max_mod_revision=e,this}minCreateRevision(e){return this.request.min_create_revision=e,this}maxCreateRevision(e){return this.request.max_create_revision=e,this}options(e){return this.callOptions=e,this}op(){return Promise.resolve({request_range:this.namespace.applyToRequest(this.request)})}};Re.RangeBuilder=is;var Qd=class extends is{constructor(e,t,i){super(t),this.kv=e,this.request.key=(0,gr.toBuffer)(i),this.request.limit=1}json(){return this.string().then(JSON.parse)}string(e="utf8"){return this.exec().then(t=>t.kvs.length===0?null:t.kvs[0].value.toString(e))}number(){return this.string().then(e=>e===null?null:Number(e))}buffer(){return this.exec().then(e=>e.kvs.length===0?null:e.kvs[0].value)}exists(){return this.request.keys_only=!0,this.exec().then(e=>e.count!=="0")}exec(){return this.kv.range(this.namespace.applyToRequest(this.request),this.callOptions)}createPromise(){return this.string()}};Re.SingleRangeBuilder=Qd;var Zd=class extends is{constructor(e,t){super(t),this.kv=e,this.prefix(pO)}prefix(e){return this.inRange(rl.Range.prefix(e))}inRange(e){let t=rl.Range.from(e);return this.request.key=t.start,this.request.range_end=t.end,this}all(){return this.prefix("")}limit(e){return this.request.limit=isFinite(e)?e:0,this}sort(e,t){return il(qt.SortTarget,e,"sort order in client.get().sort(...)"),il(qt.SortOrder,t,"sort order in client.get().sort(...)"),this.request.sort_target=qt.SortTarget[e],this.request.sort_order=qt.SortOrder[t],this}count(){return this.request.count_only=!0,this.exec().then(e=>Number(e.count))}keys(e="utf8"){return this.request.keys_only=!0,this.exec().then(t=>t.kvs.map(i=>i.key.toString(e)))}keyBuffers(){return this.request.keys_only=!0,this.exec().then(e=>e.kvs.map(t=>t.key))}json(){return this.mapValues(e=>JSON.parse(e.toString()))}strings(e="utf8"){return this.mapValues(t=>t.toString(e))}numbers(){return this.mapValues(e=>Number(e.toString()))}buffers(){return this.mapValues(e=>e)}exec(){return this.kv.range(this.namespace.applyToRequest(this.request),this.callOptions).then(e=>{for(let t of e.kvs)t.key=this.namespace.unprefix(t.key);return e})}createPromise(){return this.strings()}mapValues(e){return this.exec().then(t=>{let i={};for(let n of t.kvs)i[n.key.toString()]=e(n.value);return i})}};Re.MultiRangeBuilder=Zd;var ef=class extends gr.PromiseWrap{constructor(e,t){super(),this.kv=e,this.namespace=t,this.request={}}key(e){return this.request.key=(0,gr.toBuffer)(e),this.request.range_end=void 0,this}prefix(e){return this.range(rl.Range.prefix(e))}range(e){return this.request.key=e.start,this.request.range_end=e.end,this}all(){return this.prefix("")}inRange(e){let t=rl.Range.from(e);return this.request.key=t.start,this.request.range_end=t.end,this}getPrevious(){return this.request.prev_kv=!0,this.exec().then(e=>e.prev_kvs)}options(e){return this.callOptions=e,this}exec(){return this.kv.deleteRange(this.namespace.applyToRequest(this.request),this.callOptions)}op(){return Promise.resolve({request_delete_range:this.namespace.applyToRequest(this.request)})}createPromise(){return this.exec()}};Re.DeleteBuilder=ef;var tf=class extends gr.PromiseWrap{constructor(e,t,i){super(),this.kv=e,this.namespace=t,this.request={},this.request.key=(0,gr.toBuffer)(i)}value(e){return this.request.value=(0,gr.toBuffer)(e),this}lease(e){return this.leaseFilter=e,this}ignoreLease(){return this.request.ignore_lease=!0,this}options(e){return this.callOptions=e,this}getPrevious(){return this.request.prev_kv=!0,this.exec().then(e=>({...e.prev_kv,header:e.header}))}touch(){return this.request.value=void 0,this.request.ignore_value=!0,this.exec()}async exec(){return await this.applyLease(),this.kv.put(this.namespace.applyToRequest(this.request),this.callOptions)}async op(){return await this.applyLease(),{request_put:this.namespace.applyToRequest(this.request)}}createPromise(){return this.exec()}async applyLease(){this.leaseFilter&&((typeof this.leaseFilter=="number"||typeof this.leaseFilter=="string")&&(this.request.lease=this.leaseFilter),this.request.lease=await this.leaseFilter)}};Re.PutBuilder=tf;var rf=class{constructor(e,t){this.kv=e,this.namespace=t,this.request={compare:[],success:[],failure:[]}}options(e){return this.callOptions=e,this}and(e,t,i,n){return il(Re.compareTarget,t,"comparison target in client.and(...)"),il(Re.comparator,i,"comparator in client.and(...)"),t==="Value"&&(n=(0,gr.toBuffer)(n)),this.request.compare.push(Promise.resolve({key:this.namespace.applyKey((0,gr.toBuffer)(e)),result:Re.comparator[i],target:qt.CompareTarget[t],[Re.compareTarget[t]]:n})),this}then(...e){return this.request.success=this.mapOperations(e),this}else(...e){return this.request.failure=this.mapOperations(e),this}async commit(){return this.kv.txn({compare:await Promise.all(this.request.compare),failure:await Promise.all(this.request.failure),success:await Promise.all(this.request.success)},this.callOptions)}mapOperations(e){return e.map(t=>typeof t.op=="function"?t.op():Promise.resolve(t))}};Re.ComparatorBuilder=rf});var sl=w((p0,nl)=>{(function(r){"use strict";var e,t=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,i=Math.ceil,n=Math.floor,s="[BigNumber Error] ",a=s+"Number primitive has more than 15 significant digits: ",o=1e14,l=14,c=9007199254740991,p=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],m=1e7,S=1e9;function O(U){var F,V,Q,q=P.prototype={constructor:P,toString:null,valueOf:null},Y=new P(1),R=20,J=4,M=-7,f=21,z=-1e7,X=1e7,oe=!1,te=1,ue=0,he={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"\xA0",suffix:""},Ee="0123456789abcdefghijklmnopqrstuvwxyz",_e=!0;function P(u,h){var d,v,g,y,C,_,E,b,T=this;if(!(T instanceof P))return new P(u,h);if(h==null){if(u&&u._isBigNumber===!0){T.s=u.s,!u.c||u.e>X?T.c=T.e=null:u.e<z?T.c=[T.e=0]:(T.e=u.e,T.c=u.c.slice());return}if((_=typeof u=="number")&&u*0==0){if(T.s=1/u<0?(u=-u,-1):1,u===~~u){for(y=0,C=u;C>=10;C/=10,y++);y>X?T.c=T.e=null:(T.e=y,T.c=[u]);return}b=String(u)}else{if(!t.test(b=String(u)))return Q(T,b,_);T.s=b.charCodeAt(0)==45?(b=b.slice(1),-1):1}(y=b.indexOf("."))>-1&&(b=b.replace(".","")),(C=b.search(/e/i))>0?(y<0&&(y=C),y+=+b.slice(C+1),b=b.substring(0,C)):y<0&&(y=b.length)}else{if(A(h,2,Ee.length,"Base"),h==10&&_e)return T=new P(u),Ie(T,R+T.e+1,J);if(b=String(u),_=typeof u=="number"){if(u*0!=0)return Q(T,b,_,h);if(T.s=1/u<0?(b=b.slice(1),-1):1,P.DEBUG&&b.replace(/^0\.0*|\./,"").length>15)throw Error(a+u)}else T.s=b.charCodeAt(0)===45?(b=b.slice(1),-1):1;for(d=Ee.slice(0,h),y=C=0,E=b.length;C<E;C++)if(d.indexOf(v=b.charAt(C))<0){if(v=="."){if(C>y){y=E;continue}}else if(!g&&(b==b.toUpperCase()&&(b=b.toLowerCase())||b==b.toLowerCase()&&(b=b.toUpperCase()))){g=!0,C=-1,y=0;continue}return Q(T,String(u),_,h)}_=!1,b=V(b,h,10,T.s),(y=b.indexOf("."))>-1?b=b.replace(".",""):y=b.length}for(C=0;b.charCodeAt(C)===48;C++);for(E=b.length;b.charCodeAt(--E)===48;);if(b=b.slice(C,++E)){if(E-=C,_&&P.DEBUG&&E>15&&(u>c||u!==n(u)))throw Error(a+T.s*u);if((y=y-C-1)>X)T.c=T.e=null;else if(y<z)T.c=[T.e=0];else{if(T.e=y,T.c=[],C=(y+1)%l,y<0&&(C+=l),C<E){for(C&&T.c.push(+b.slice(0,C)),E-=l;C<E;)T.c.push(+b.slice(C,C+=l));C=l-(b=b.slice(C)).length}else C-=E;for(;C--;b+="0");T.c.push(+b)}}else T.c=[T.e=0]}P.clone=O,P.ROUND_UP=0,P.ROUND_DOWN=1,P.ROUND_CEIL=2,P.ROUND_FLOOR=3,P.ROUND_HALF_UP=4,P.ROUND_HALF_DOWN=5,P.ROUND_HALF_EVEN=6,P.ROUND_HALF_CEIL=7,P.ROUND_HALF_FLOOR=8,P.EUCLID=9,P.config=P.set=function(u){var h,d;if(u!=null)if(typeof u=="object"){if(u.hasOwnProperty(h="DECIMAL_PLACES")&&(d=u[h],A(d,0,S,h),R=d),u.hasOwnProperty(h="ROUNDING_MODE")&&(d=u[h],A(d,0,8,h),J=d),u.hasOwnProperty(h="EXPONENTIAL_AT")&&(d=u[h],d&&d.pop?(A(d[0],-S,0,h),A(d[1],0,S,h),M=d[0],f=d[1]):(A(d,-S,S,h),M=-(f=d<0?-d:d))),u.hasOwnProperty(h="RANGE"))if(d=u[h],d&&d.pop)A(d[0],-S,-1,h),A(d[1],1,S,h),z=d[0],X=d[1];else if(A(d,-S,S,h),d)z=-(X=d<0?-d:d);else throw Error(s+h+" cannot be zero: "+d);if(u.hasOwnProperty(h="CRYPTO"))if(d=u[h],d===!!d)if(d)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))oe=d;else throw oe=!d,Error(s+"crypto unavailable");else oe=d;else throw Error(s+h+" not true or false: "+d);if(u.hasOwnProperty(h="MODULO_MODE")&&(d=u[h],A(d,0,9,h),te=d),u.hasOwnProperty(h="POW_PRECISION")&&(d=u[h],A(d,0,S,h),ue=d),u.hasOwnProperty(h="FORMAT"))if(d=u[h],typeof d=="object")he=d;else throw Error(s+h+" not an object: "+d);if(u.hasOwnProperty(h="ALPHABET"))if(d=u[h],typeof d=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(d))_e=d.slice(0,10)=="0123456789",Ee=d;else throw Error(s+h+" invalid: "+d)}else throw Error(s+"Object expected: "+u);return{DECIMAL_PLACES:R,ROUNDING_MODE:J,EXPONENTIAL_AT:[M,f],RANGE:[z,X],CRYPTO:oe,MODULO_MODE:te,POW_PRECISION:ue,FORMAT:he,ALPHABET:Ee}},P.isBigNumber=function(u){if(!u||u._isBigNumber!==!0)return!1;if(!P.DEBUG)return!0;var h,d,v=u.c,g=u.e,y=u.s;e:if({}.toString.call(v)=="[object Array]"){if((y===1||y===-1)&&g>=-S&&g<=S&&g===n(g)){if(v[0]===0){if(g===0&&v.length===1)return!0;break e}if(h=(g+1)%l,h<1&&(h+=l),String(v[0]).length==h){for(h=0;h<v.length;h++)if(d=v[h],d<0||d>=o||d!==n(d))break e;if(d!==0)return!0}}}else if(v===null&&g===null&&(y===null||y===1||y===-1))return!0;throw Error(s+"Invalid BigNumber: "+u)},P.maximum=P.max=function(){return Ce(arguments,-1)},P.minimum=P.min=function(){return Ce(arguments,1)},P.random=function(){var u=9007199254740992,h=Math.random()*u&2097151?function(){return n(Math.random()*u)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(d){var v,g,y,C,_,E=0,b=[],T=new P(Y);if(d==null?d=R:A(d,0,S),C=i(d/l),oe)if(crypto.getRandomValues){for(v=crypto.getRandomValues(new Uint32Array(C*=2));E<C;)_=v[E]*131072+(v[E+1]>>>11),_>=9e15?(g=crypto.getRandomValues(new Uint32Array(2)),v[E]=g[0],v[E+1]=g[1]):(b.push(_%1e14),E+=2);E=C/2}else if(crypto.randomBytes){for(v=crypto.randomBytes(C*=7);E<C;)_=(v[E]&31)*281474976710656+v[E+1]*1099511627776+v[E+2]*4294967296+v[E+3]*16777216+(v[E+4]<<16)+(v[E+5]<<8)+v[E+6],_>=9e15?crypto.randomBytes(7).copy(v,E):(b.push(_%1e14),E+=7);E=C/7}else throw oe=!1,Error(s+"crypto unavailable");if(!oe)for(;E<C;)_=h(),_<9e15&&(b[E++]=_%1e14);for(C=b[--E],d%=l,C&&d&&(_=p[l-d],b[E]=n(C/_)*_);b[E]===0;b.pop(),E--);if(E<0)b=[y=0];else{for(y=-1;b[0]===0;b.splice(0,1),y-=l);for(E=1,_=b[0];_>=10;_/=10,E++);E<l&&(y-=l-E)}return T.e=y,T.c=b,T}}(),P.sum=function(){for(var u=1,h=arguments,d=new P(h[0]);u<h.length;)d=d.plus(h[u++]);return d},V=function(){var u="0123456789";function h(d,v,g,y){for(var C,_=[0],E,b=0,T=d.length;b<T;){for(E=_.length;E--;_[E]*=v);for(_[0]+=y.indexOf(d.charAt(b++)),C=0;C<_.length;C++)_[C]>g-1&&(_[C+1]==null&&(_[C+1]=0),_[C+1]+=_[C]/g|0,_[C]%=g)}return _.reverse()}return function(d,v,g,y,C){var _,E,b,T,x,W,$,le,Te=d.indexOf("."),De=R,ne=J;for(Te>=0&&(T=ue,ue=0,d=d.replace(".",""),le=new P(v),W=le.pow(d.length-Te),ue=T,le.c=h(L(k(W.c),W.e,"0"),10,g,u),le.e=le.c.length),$=h(d,v,g,C?(_=Ee,u):(_=u,Ee)),b=T=$.length;$[--T]==0;$.pop());if(!$[0])return _.charAt(0);if(Te<0?--b:(W.c=$,W.e=b,W.s=y,W=F(W,le,De,ne,g),$=W.c,x=W.r,b=W.e),E=b+De+1,Te=$[E],T=g/2,x=x||E<0||$[E+1]!=null,x=ne<4?(Te!=null||x)&&(ne==0||ne==(W.s<0?3:2)):Te>T||Te==T&&(ne==4||x||ne==6&&$[E-1]&1||ne==(W.s<0?8:7)),E<1||!$[0])d=x?L(_.charAt(1),-De,_.charAt(0)):_.charAt(0);else{if($.length=E,x)for(--g;++$[--E]>g;)$[E]=0,E||(++b,$=[1].concat($));for(T=$.length;!$[--T];);for(Te=0,d="";Te<=T;d+=_.charAt($[Te++]));d=L(d,b,_.charAt(0))}return d}}(),F=function(){function u(v,g,y){var C,_,E,b,T=0,x=v.length,W=g%m,$=g/m|0;for(v=v.slice();x--;)E=v[x]%m,b=v[x]/m|0,C=$*E+b*W,_=W*E+C%m*m+T,T=(_/y|0)+(C/m|0)+$*b,v[x]=_%y;return T&&(v=[T].concat(v)),v}function h(v,g,y,C){var _,E;if(y!=C)E=y>C?1:-1;else for(_=E=0;_<y;_++)if(v[_]!=g[_]){E=v[_]>g[_]?1:-1;break}return E}function d(v,g,y,C){for(var _=0;y--;)v[y]-=_,_=v[y]<g[y]?1:0,v[y]=_*C+v[y]-g[y];for(;!v[0]&&v.length>1;v.splice(0,1));}return function(v,g,y,C,_){var E,b,T,x,W,$,le,Te,De,ne,pe,$e,as,vl,yl,Ut,hn,lt=v.s==g.s?1:-1,Je=v.c,be=g.c;if(!Je||!Je[0]||!be||!be[0])return new P(!v.s||!g.s||(Je?be&&Je[0]==be[0]:!be)?NaN:Je&&Je[0]==0||!be?lt*0:lt/0);for(Te=new P(lt),De=Te.c=[],b=v.e-g.e,lt=y+b+1,_||(_=o,b=N(v.e/l)-N(g.e/l),lt=lt/l|0),T=0;be[T]==(Je[T]||0);T++);if(be[T]>(Je[T]||0)&&b--,lt<0)De.push(1),x=!0;else{for(vl=Je.length,Ut=be.length,T=0,lt+=2,W=n(_/(be[0]+1)),W>1&&(be=u(be,W,_),Je=u(Je,W,_),Ut=be.length,vl=Je.length),as=Ut,ne=Je.slice(0,Ut),pe=ne.length;pe<Ut;ne[pe++]=0);hn=be.slice(),hn=[0].concat(hn),yl=be[0],be[1]>=_/2&&yl++;do{if(W=0,E=h(be,ne,Ut,pe),E<0){if($e=ne[0],Ut!=pe&&($e=$e*_+(ne[1]||0)),W=n($e/yl),W>1)for(W>=_&&(W=_-1),$=u(be,W,_),le=$.length,pe=ne.length;h($,ne,le,pe)==1;)W--,d($,Ut<le?hn:be,le,_),le=$.length,E=1;else W==0&&(E=W=1),$=be.slice(),le=$.length;if(le<pe&&($=[0].concat($)),d(ne,$,pe,_),pe=ne.length,E==-1)for(;h(be,ne,Ut,pe)<1;)W++,d(ne,Ut<pe?hn:be,pe,_),pe=ne.length}else E===0&&(W++,ne=[0]);De[T++]=W,ne[0]?ne[pe++]=Je[as]||0:(ne=[Je[as]],pe=1)}while((as++<vl||ne[0]!=null)&&lt--);x=ne[0]!=null,De[0]||De.splice(0,1)}if(_==o){for(T=1,lt=De[0];lt>=10;lt/=10,T++);Ie(Te,y+(Te.e=T+b*l-1)+1,C,x)}else Te.e=b,Te.r=+x;return Te}}();function Oe(u,h,d,v){var g,y,C,_,E;if(d==null?d=J:A(d,0,8),!u.c)return u.toString();if(g=u.c[0],C=u.e,h==null)E=k(u.c),E=v==1||v==2&&(C<=M||C>=f)?j(E,C):L(E,C,"0");else if(u=Ie(new P(u),h,d),y=u.e,E=k(u.c),_=E.length,v==1||v==2&&(h<=y||y<=M)){for(;_<h;E+="0",_++);E=j(E,y)}else if(h-=C,E=L(E,y,"0"),y+1>_){if(--h>0)for(E+=".";h--;E+="0");}else if(h+=y-_,h>0)for(y+1==_&&(E+=".");h--;E+="0");return u.s<0&&g?"-"+E:E}function Ce(u,h){for(var d,v,g=1,y=new P(u[0]);g<u.length;g++)v=new P(u[g]),(!v.s||(d=I(y,v))===h||d===0&&y.s===h)&&(y=v);return y}function Ne(u,h,d){for(var v=1,g=h.length;!h[--g];h.pop());for(g=h[0];g>=10;g/=10,v++);return(d=v+d*l-1)>X?u.c=u.e=null:d<z?u.c=[u.e=0]:(u.e=d,u.c=h),u}Q=function(){var u=/^(-?)0([xbo])(?=\w[\w.]*$)/i,h=/^([^.]+)\.$/,d=/^\.([^.]+)$/,v=/^-?(Infinity|NaN)$/,g=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(y,C,_,E){var b,T=_?C:C.replace(g,"");if(v.test(T))y.s=isNaN(T)?null:T<0?-1:1;else{if(!_&&(T=T.replace(u,function(x,W,$){return b=($=$.toLowerCase())=="x"?16:$=="b"?2:8,!E||E==b?W:x}),E&&(b=E,T=T.replace(h,"$1").replace(d,"0.$1")),C!=T))return new P(T,b);if(P.DEBUG)throw Error(s+"Not a"+(E?" base "+E:"")+" number: "+C);y.s=null}y.c=y.e=null}}();function Ie(u,h,d,v){var g,y,C,_,E,b,T,x=u.c,W=p;if(x){e:{for(g=1,_=x[0];_>=10;_/=10,g++);if(y=h-g,y<0)y+=l,C=h,E=x[b=0],T=n(E/W[g-C-1]%10);else if(b=i((y+1)/l),b>=x.length)if(v){for(;x.length<=b;x.push(0));E=T=0,g=1,y%=l,C=y-l+1}else break e;else{for(E=_=x[b],g=1;_>=10;_/=10,g++);y%=l,C=y-l+g,T=C<0?0:n(E/W[g-C-1]%10)}if(v=v||h<0||x[b+1]!=null||(C<0?E:E%W[g-C-1]),v=d<4?(T||v)&&(d==0||d==(u.s<0?3:2)):T>5||T==5&&(d==4||v||d==6&&(y>0?C>0?E/W[g-C]:0:x[b-1])%10&1||d==(u.s<0?8:7)),h<1||!x[0])return x.length=0,v?(h-=u.e+1,x[0]=W[(l-h%l)%l],u.e=-h||0):x[0]=u.e=0,u;if(y==0?(x.length=b,_=1,b--):(x.length=b+1,_=W[l-y],x[b]=C>0?n(E/W[g-C]%W[C])*_:0),v)for(;;)if(b==0){for(y=1,C=x[0];C>=10;C/=10,y++);for(C=x[0]+=_,_=1;C>=10;C/=10,_++);y!=_&&(u.e++,x[0]==o&&(x[0]=1));break}else{if(x[b]+=_,x[b]!=o)break;x[b--]=0,_=1}for(y=x.length;x[--y]===0;x.pop());}u.e>X?u.c=u.e=null:u.e<z&&(u.c=[u.e=0])}return u}function ge(u){var h,d=u.e;return d===null?u.toString():(h=k(u.c),h=d<=M||d>=f?j(h,d):L(h,d,"0"),u.s<0?"-"+h:h)}return q.absoluteValue=q.abs=function(){var u=new P(this);return u.s<0&&(u.s=1),u},q.comparedTo=function(u,h){return I(this,new P(u,h))},q.decimalPlaces=q.dp=function(u,h){var d,v,g,y=this;if(u!=null)return A(u,0,S),h==null?h=J:A(h,0,8),Ie(new P(y),u+y.e+1,h);if(!(d=y.c))return null;if(v=((g=d.length-1)-N(this.e/l))*l,g=d[g])for(;g%10==0;g/=10,v--);return v<0&&(v=0),v},q.dividedBy=q.div=function(u,h){return F(this,new P(u,h),R,J)},q.dividedToIntegerBy=q.idiv=function(u,h){return F(this,new P(u,h),0,1)},q.exponentiatedBy=q.pow=function(u,h){var d,v,g,y,C,_,E,b,T,x=this;if(u=new P(u),u.c&&!u.isInteger())throw Error(s+"Exponent not an integer: "+ge(u));if(h!=null&&(h=new P(h)),_=u.e>14,!x.c||!x.c[0]||x.c[0]==1&&!x.e&&x.c.length==1||!u.c||!u.c[0])return T=new P(Math.pow(+ge(x),_?u.s*(2-D(u)):+ge(u))),h?T.mod(h):T;if(E=u.s<0,h){if(h.c?!h.c[0]:!h.s)return new P(NaN);v=!E&&x.isInteger()&&h.isInteger(),v&&(x=x.mod(h))}else{if(u.e>9&&(x.e>0||x.e<-1||(x.e==0?x.c[0]>1||_&&x.c[1]>=24e7:x.c[0]<8e13||_&&x.c[0]<=9999975e7)))return y=x.s<0&&D(u)?-0:0,x.e>-1&&(y=1/y),new P(E?1/y:y);ue&&(y=i(ue/l+2))}for(_?(d=new P(.5),E&&(u.s=1),b=D(u)):(g=Math.abs(+ge(u)),b=g%2),T=new P(Y);;){if(b){if(T=T.times(x),!T.c)break;y?T.c.length>y&&(T.c.length=y):v&&(T=T.mod(h))}if(g){if(g=n(g/2),g===0)break;b=g%2}else if(u=u.times(d),Ie(u,u.e+1,1),u.e>14)b=D(u);else{if(g=+ge(u),g===0)break;b=g%2}x=x.times(x),y?x.c&&x.c.length>y&&(x.c.length=y):v&&(x=x.mod(h))}return v?T:(E&&(T=Y.div(T)),h?T.mod(h):y?Ie(T,ue,J,C):T)},q.integerValue=function(u){var h=new P(this);return u==null?u=J:A(u,0,8),Ie(h,h.e+1,u)},q.isEqualTo=q.eq=function(u,h){return I(this,new P(u,h))===0},q.isFinite=function(){return!!this.c},q.isGreaterThan=q.gt=function(u,h){return I(this,new P(u,h))>0},q.isGreaterThanOrEqualTo=q.gte=function(u,h){return(h=I(this,new P(u,h)))===1||h===0},q.isInteger=function(){return!!this.c&&N(this.e/l)>this.c.length-2},q.isLessThan=q.lt=function(u,h){return I(this,new P(u,h))<0},q.isLessThanOrEqualTo=q.lte=function(u,h){return(h=I(this,new P(u,h)))===-1||h===0},q.isNaN=function(){return!this.s},q.isNegative=function(){return this.s<0},q.isPositive=function(){return this.s>0},q.isZero=function(){return!!this.c&&this.c[0]==0},q.minus=function(u,h){var d,v,g,y,C=this,_=C.s;if(u=new P(u,h),h=u.s,!_||!h)return new P(NaN);if(_!=h)return u.s=-h,C.plus(u);var E=C.e/l,b=u.e/l,T=C.c,x=u.c;if(!E||!b){if(!T||!x)return T?(u.s=-h,u):new P(x?C:NaN);if(!T[0]||!x[0])return x[0]?(u.s=-h,u):new P(T[0]?C:J==3?-0:0)}if(E=N(E),b=N(b),T=T.slice(),_=E-b){for((y=_<0)?(_=-_,g=T):(b=E,g=x),g.reverse(),h=_;h--;g.push(0));g.reverse()}else for(v=(y=(_=T.length)<(h=x.length))?_:h,_=h=0;h<v;h++)if(T[h]!=x[h]){y=T[h]<x[h];break}if(y&&(g=T,T=x,x=g,u.s=-u.s),h=(v=x.length)-(d=T.length),h>0)for(;h--;T[d++]=0);for(h=o-1;v>_;){if(T[--v]<x[v]){for(d=v;d&&!T[--d];T[d]=h);--T[d],T[v]+=o}T[v]-=x[v]}for(;T[0]==0;T.splice(0,1),--b);return T[0]?Ne(u,T,b):(u.s=J==3?-1:1,u.c=[u.e=0],u)},q.modulo=q.mod=function(u,h){var d,v,g=this;return u=new P(u,h),!g.c||!u.s||u.c&&!u.c[0]?new P(NaN):!u.c||g.c&&!g.c[0]?new P(g):(te==9?(v=u.s,u.s=1,d=F(g,u,0,3),u.s=v,d.s*=v):d=F(g,u,0,te),u=g.minus(d.times(u)),!u.c[0]&&te==1&&(u.s=g.s),u)},q.multipliedBy=q.times=function(u,h){var d,v,g,y,C,_,E,b,T,x,W,$,le,Te,De,ne=this,pe=ne.c,$e=(u=new P(u,h)).c;if(!pe||!$e||!pe[0]||!$e[0])return!ne.s||!u.s||pe&&!pe[0]&&!$e||$e&&!$e[0]&&!pe?u.c=u.e=u.s=null:(u.s*=ne.s,!pe||!$e?u.c=u.e=null:(u.c=[0],u.e=0)),u;for(v=N(ne.e/l)+N(u.e/l),u.s*=ne.s,E=pe.length,x=$e.length,E<x&&(le=pe,pe=$e,$e=le,g=E,E=x,x=g),g=E+x,le=[];g--;le.push(0));for(Te=o,De=m,g=x;--g>=0;){for(d=0,W=$e[g]%De,$=$e[g]/De|0,C=E,y=g+C;y>g;)b=pe[--C]%De,T=pe[C]/De|0,_=$*b+T*W,b=W*b+_%De*De+le[y]+d,d=(b/Te|0)+(_/De|0)+$*T,le[y--]=b%Te;le[y]=d}return d?++v:le.splice(0,1),Ne(u,le,v)},q.negated=function(){var u=new P(this);return u.s=-u.s||null,u},q.plus=function(u,h){var d,v=this,g=v.s;if(u=new P(u,h),h=u.s,!g||!h)return new P(NaN);if(g!=h)return u.s=-h,v.minus(u);var y=v.e/l,C=u.e/l,_=v.c,E=u.c;if(!y||!C){if(!_||!E)return new P(g/0);if(!_[0]||!E[0])return E[0]?u:new P(_[0]?v:g*0)}if(y=N(y),C=N(C),_=_.slice(),g=y-C){for(g>0?(C=y,d=E):(g=-g,d=_),d.reverse();g--;d.push(0));d.reverse()}for(g=_.length,h=E.length,g-h<0&&(d=E,E=_,_=d,h=g),g=0;h;)g=(_[--h]=_[h]+E[h]+g)/o|0,_[h]=o===_[h]?0:_[h]%o;return g&&(_=[g].concat(_),++C),Ne(u,_,C)},q.precision=q.sd=function(u,h){var d,v,g,y=this;if(u!=null&&u!==!!u)return A(u,1,S),h==null?h=J:A(h,0,8),Ie(new P(y),u,h);if(!(d=y.c))return null;if(g=d.length-1,v=g*l+1,g=d[g]){for(;g%10==0;g/=10,v--);for(g=d[0];g>=10;g/=10,v++);}return u&&y.e+1>v&&(v=y.e+1),v},q.shiftedBy=function(u){return A(u,-c,c),this.times("1e"+u)},q.squareRoot=q.sqrt=function(){var u,h,d,v,g,y=this,C=y.c,_=y.s,E=y.e,b=R+4,T=new P("0.5");if(_!==1||!C||!C[0])return new P(!_||_<0&&(!C||C[0])?NaN:C?y:1/0);if(_=Math.sqrt(+ge(y)),_==0||_==1/0?(h=k(C),(h.length+E)%2==0&&(h+="0"),_=Math.sqrt(+h),E=N((E+1)/2)-(E<0||E%2),_==1/0?h="5e"+E:(h=_.toExponential(),h=h.slice(0,h.indexOf("e")+1)+E),d=new P(h)):d=new P(_+""),d.c[0]){for(E=d.e,_=E+b,_<3&&(_=0);;)if(g=d,d=T.times(g.plus(F(y,g,b,1))),k(g.c).slice(0,_)===(h=k(d.c)).slice(0,_))if(d.e<E&&--_,h=h.slice(_-3,_+1),h=="9999"||!v&&h=="4999"){if(!v&&(Ie(g,g.e+R+2,0),g.times(g).eq(y))){d=g;break}b+=4,_+=4,v=1}else{(!+h||!+h.slice(1)&&h.charAt(0)=="5")&&(Ie(d,d.e+R+2,1),u=!d.times(d).eq(y));break}}return Ie(d,d.e+R+1,J,u)},q.toExponential=function(u,h){return u!=null&&(A(u,0,S),u++),Oe(this,u,h,1)},q.toFixed=function(u,h){return u!=null&&(A(u,0,S),u=u+this.e+1),Oe(this,u,h)},q.toFormat=function(u,h,d){var v,g=this;if(d==null)u!=null&&h&&typeof h=="object"?(d=h,h=null):u&&typeof u=="object"?(d=u,u=h=null):d=he;else if(typeof d!="object")throw Error(s+"Argument not an object: "+d);if(v=g.toFixed(u,h),g.c){var y,C=v.split("."),_=+d.groupSize,E=+d.secondaryGroupSize,b=d.groupSeparator||"",T=C[0],x=C[1],W=g.s<0,$=W?T.slice(1):T,le=$.length;if(E&&(y=_,_=E,E=y,le-=y),_>0&&le>0){for(y=le%_||_,T=$.substr(0,y);y<le;y+=_)T+=b+$.substr(y,_);E>0&&(T+=b+$.slice(y)),W&&(T="-"+T)}v=x?T+(d.decimalSeparator||"")+((E=+d.fractionGroupSize)?x.replace(new RegExp("\\d{"+E+"}\\B","g"),"$&"+(d.fractionGroupSeparator||"")):x):T}return(d.prefix||"")+v+(d.suffix||"")},q.toFraction=function(u){var h,d,v,g,y,C,_,E,b,T,x,W,$=this,le=$.c;if(u!=null&&(_=new P(u),!_.isInteger()&&(_.c||_.s!==1)||_.lt(Y)))throw Error(s+"Argument "+(_.isInteger()?"out of range: ":"not an integer: ")+ge(_));if(!le)return new P($);for(h=new P(Y),b=d=new P(Y),v=E=new P(Y),W=k(le),y=h.e=W.length-$.e-1,h.c[0]=p[(C=y%l)<0?l+C:C],u=!u||_.comparedTo(h)>0?y>0?h:b:_,C=X,X=1/0,_=new P(W),E.c[0]=0;T=F(_,h,0,1),g=d.plus(T.times(v)),g.comparedTo(u)!=1;)d=v,v=g,b=E.plus(T.times(g=b)),E=g,h=_.minus(T.times(g=h)),_=g;return g=F(u.minus(d),v,0,1),E=E.plus(g.times(b)),d=d.plus(g.times(v)),E.s=b.s=$.s,y=y*2,x=F(b,v,y,J).minus($).abs().comparedTo(F(E,d,y,J).minus($).abs())<1?[b,v]:[E,d],X=C,x},q.toNumber=function(){return+ge(this)},q.toPrecision=function(u,h){return u!=null&&A(u,1,S),Oe(this,u,h,2)},q.toString=function(u){var h,d=this,v=d.s,g=d.e;return g===null?v?(h="Infinity",v<0&&(h="-"+h)):h="NaN":(u==null?h=g<=M||g>=f?j(k(d.c),g):L(k(d.c),g,"0"):u===10&&_e?(d=Ie(new P(d),R+g+1,J),h=L(k(d.c),d.e,"0")):(A(u,2,Ee.length,"Base"),h=V(L(k(d.c),g,"0"),10,u,v,!0)),v<0&&d.c[0]&&(h="-"+h)),h},q.valueOf=q.toJSON=function(){return ge(this)},q._isBigNumber=!0,U!=null&&P.set(U),P}function N(U){var F=U|0;return U>0||U===F?F:F-1}function k(U){for(var F,V,Q=1,q=U.length,Y=U[0]+"";Q<q;){for(F=U[Q++]+"",V=l-F.length;V--;F="0"+F);Y+=F}for(q=Y.length;Y.charCodeAt(--q)===48;);return Y.slice(0,q+1||1)}function I(U,F){var V,Q,q=U.c,Y=F.c,R=U.s,J=F.s,M=U.e,f=F.e;if(!R||!J)return null;if(V=q&&!q[0],Q=Y&&!Y[0],V||Q)return V?Q?0:-J:R;if(R!=J)return R;if(V=R<0,Q=M==f,!q||!Y)return Q?0:!q^V?1:-1;if(!Q)return M>f^V?1:-1;for(J=(M=q.length)<(f=Y.length)?M:f,R=0;R<J;R++)if(q[R]!=Y[R])return q[R]>Y[R]^V?1:-1;return M==f?0:M>f^V?1:-1}function A(U,F,V,Q){if(U<F||U>V||U!==n(U))throw Error(s+(Q||"Argument")+(typeof U=="number"?U<F||U>V?" out of range: ":" not an integer: ":" not a primitive number: ")+String(U))}function D(U){var F=U.c.length-1;return N(U.e/l)==F&&U.c[F]%2!=0}function j(U,F){return(U.length>1?U.charAt(0)+"."+U.slice(1):U)+(F<0?"e":"e+")+F}function L(U,F,V){var Q,q;if(F<0){for(q=V+".";++F;q+=V);U=q+U}else if(Q=U.length,++F>Q){for(q=V,F-=Q;--F;q+=V);U+=q}else F<Q&&(U=U.slice(0,F)+"."+U.slice(F));return U}e=O(),e.default=e.BigNumber=e,typeof define=="function"&&define.amd?define(function(){return e}):typeof nl<"u"&&nl.exports?nl.exports=e:(r||(r=typeof self<"u"&&self?self:window),r.BigNumber=e)})(p0)});var of=w(Vr=>{"use strict";Object.defineProperty(Vr,"__esModule",{value:!0});Vr.Election=Vr.Campaign=Vr.ElectionObserver=void 0;var g0=sl(),m0=require("events"),af=nr(),nf=wt(),sf=Symbol("unset"),al=class extends m0.EventEmitter{get hasLeader(){return!!this.current}constructor(e){super(),this.namespace=e,this.running=!0,this.current=sf,this.runLoop=this.loop().catch(t=>{this.emit("error",t)})}on(e,t){return super.on(e,t)}async cancel(){var e;this.running=!1,(e=this.disposer)===null||e===void 0||e.call(this),await this.runLoop}leader(e="utf-8"){let t=this.current;if(!(!t||t===sf))return e==="buffer"?t.value:t.value.toString(e)}setLeader(e){let t=this.current;this.current=e,t===sf?this.emit("change",void 0):e===void 0?t!==void 0&&this.emit("change",void 0):(!t||!e.value.equals(t.value))&&this.emit("change",e.value.toString())}async loop(){for(;this.running;){let e=await this.namespace.getAll().sort("Create","Ascend").limit(1).exec(),t=e.kvs[0],i=e.header.revision;if(!this.running)return;if(!t){this.setLeader(void 0);let s=this.namespace.watch().startRevision(e.header.revision).prefix("").only("put").watcher();if(await new Promise((a,o)=>{s.on("data",l=>{let c=!1;for(let p of l.events)p.type==="Put"&&(t=p.kv,i=p.kv.mod_revision,c=!0);c&&a()}),s.on("error",o),this.disposer=a}).finally(()=>s.cancel()),!this.running)return}if(!t)throw new af.ClientRuntimeError("unreachable lack of election leader");this.setLeader(t);let n=this.namespace.watch().startRevision(new g0.default(i).plus(1).toString()).key(t.key).watcher();await new Promise((s,a)=>{n.on("put",o=>this.setLeader(o)),n.on("delete",()=>s()),n.on("error",a),this.disposer=()=>(s(),n.cancel())}).finally(()=>n.cancel())}}};Vr.ElectionObserver=al;var ns=Symbol("ResignedCampaign"),ol=class extends m0.EventEmitter{constructor(e,t,i){super(),this.namespace=e,this.value=(0,nf.toBuffer)(t),this.lease=this.namespace.lease(i),this.lease.on("lost",n=>this.emit("error",n)),this.start().catch(n=>{var s;this.resign().catch(()=>{}),(s=this.pendingProclaimation)===null||s===void 0||s.reject(n),this.emit("error",n)})}on(e,t){return super.on(e,t)}wait(){return new Promise((e,t)=>{this.on("elected",()=>e(this)),this.on("error",t)})}async proclaim(e){if(this.keyRevision===ns)throw new af.NotCampaigningError;let t=(0,nf.toBuffer)(e);return t.equals(this.value)?Promise.resolve():this.proclaimInner(t,this.keyRevision)}async getCampaignKey(){let e=await this.lease.grant();return this.namespace.prefix.toString()+e}async resign(){this.keyRevision!==ns&&(this.keyRevision=ns,await this.lease.revoke())}async start(){var e;let t=await this.lease.grant(),i=this.value,n=await this.namespace.if(t,"Create","==",0).then(this.namespace.put(t).value(i).lease(t)).else(this.namespace.get(t)).commit();if(this.keyRevision!==ns){if(this.keyRevision=n.header.revision,n.succeeded)this.pendingProclaimation&&(await this.proclaimInner(this.value,this.keyRevision),this.pendingProclaimation.resolve());else{let s=n.responses[0].response_range.kvs[0];this.keyRevision=s.create_revision,s.value.equals(this.value)||(await this.proclaimInner(this.value,this.keyRevision),(e=this.pendingProclaimation)===null||e===void 0||e.resolve())}await this.waitForElected(n.header.revision),this.emit("elected")}}async proclaimInner(e,t){var i;if(!t)return this.pendingProclaimation=(i=this.pendingProclaimation)!==null&&i!==void 0?i:(0,nf.getDeferred)(),this.value=e,this.pendingProclaimation.promise;let n=await this.lease.grant(),s=await this.namespace.if(n,"Create","==",t).then(this.namespace.put(n).value(e).lease(n)).commit();if(this.value=e,!s.succeeded)throw this.resign().catch(()=>{}),new af.NotCampaigningError}async waitForElected(e){for(;this.keyRevision!==ns;){let t=new g0.default(e).minus(1).toString(),i=await this.namespace.getAll().maxCreateRevision(t).sort("Create","Descend").limit(1).exec();if(i.kvs.length===0)return;this.emit("_isWaiting"),await mO(this.namespace,i.kvs.map(n=>n.key))}}};Vr.Campaign=ol;var ll=class r{constructor(e,t,i=60){this.name=t,this.ttl=i,this.namespace=e.namespace(`${r.prefix}/${this.name}/`)}campaign(e){return new ol(this.namespace,e,this.ttl)}async leader(e="utf-8"){let i=(await this.namespace.getAll().sort("Create","Ascend").limit(1).exec()).kvs[0];if(i!==void 0)return e==="buffer"?i.value:i.value.toString()}async observe(){let e=new al(this.namespace);return new Promise((t,i)=>{e.once("change",()=>t(e)),e.once("error",i)})}};Vr.Election=ll;ll.prefix="election";async function gO(r,e,t){let i=await r.watch().key(e).startRevision(t).only("delete").create(),n=new Promise((s,a)=>{i.once("delete",s),i.once("error",a)});try{await n}finally{await i.cancel()}}async function mO(r,e){for(let t of e){let i=await r.get(t).exec();i.kvs.length&&await gO(r,t,i.header.revision)}}});var cl=w(ln=>{"use strict";Object.defineProperty(ln,"__esModule",{value:!0});ln.Lease=ln.LeaseState=void 0;var vO=require("events"),yO=on(),mr=nr(),v0=$r(),_O=wt();function SO(r){if(r instanceof Error)throw r;return r}function y0(r){return r.TTL==="0"}var lf=class{constructor(e,t){this.pool=e,this.lease=t,this.callOptionsFactory=this.pool.callOptionsFactory}exec(e,t,i){return this.pool.exec(e,t,i).catch(n=>{throw n instanceof mr.EtcdLeaseInvalidError&&this.lease.emitLoss(n),n})}markFailed(e,t){this.pool.markFailed(e,t)}withConnection(){throw new Error("not supported")}},vr;(function(r){r[r.Pending=0]="Pending",r[r.Alive=1]="Alive",r[r.Revoked=2]="Revoked"})(vr||(ln.LeaseState=vr={}));var cf=class extends vO.EventEmitter{get state(){return this.innerState}constructor(e,t,i,n={}){super(),this.pool=e,this.namespace=t,this.ttl=i,this.innerState=vr.Pending,this.client=new v0.LeaseClient(this.pool),this.teardown=()=>{};let{autoKeepAlive:s,deadline:a,...o}=n;if(this.defaultOptions=o,!i||i<1)throw new RangeError(`The TTL in an etcd lease must be at least 1 second. Got: ${i}`);this.leaseID=this.client.leaseGrant({TTL:i},n).then(l=>(this.innerState===vr.Revoked||(this.innerState=vr.Alive,this.lastKeepAlive=Date.now(),s!==!1&&this.keepalive()),l.ID)).catch(l=>(this.emitLoss(l),l))}grant(){return this.leaseID.then(SO)}async revoke(e=this.defaultOptions){this.close();let t=await this.leaseID;if(!(t instanceof Error))try{await this.client.leaseRevoke({ID:t},e)}catch(i){if(!(i instanceof mr.EtcdLeaseInvalidError))throw i}}release(){this.close()}put(e){return new yO.PutBuilder(new v0.KVClient(new lf(this.pool,this)),this.namespace,e).lease(this.grant())}keepaliveOnce(e=this.defaultOptions){return Promise.all([this.client.leaseKeepAlive(e),this.grant()]).then(([t,i])=>new Promise((n,s)=>{t.on("data",n),t.on("error",a=>s((0,mr.castGrpcError)(a))),t.write({ID:i})}).then(n=>{if(t.end(),y0(n)){let s=new mr.EtcdLeaseInvalidError(n.ID);throw this.emitLoss(s),s}return this.lastKeepAlive=Date.now(),n}))}revoked(){return this.innerState===vr.Revoked}on(e,t){return super.on(e,t)}close(){this.innerState=vr.Revoked,this.teardown()}emitLoss(e){this.close(),this.emit("lost",e)}keepalive(){if(Date.now()-this.lastKeepAlive>2*1e3*this.ttl){this.close(),this.emit("lost",new mr.EtcdLeaseInvalidError("We lost connection to etcd and our lease has expired."));return}this.client.leaseKeepAlive().then(e=>{if(this.innerState===vr.Revoked)return e.end();let t=1e3*this.ttl/3,i=setInterval(()=>this.fireKeepAlive(e),t),n=(0,_O.debounce)(1e3*this.ttl,()=>this.handleKeepaliveError(new mr.GRPCCancelledError("GRPC watch stream has timed out.")));return this.teardown=()=>{this.teardown=()=>{},n.cancel(),clearInterval(i),e.end()},n(),e.on("error",s=>this.handleKeepaliveError(s)).on("data",s=>{if(y0(s))return this.handleKeepaliveError(new mr.EtcdLeaseInvalidError(s.ID));this.lastKeepAlive=Date.now(),n(),this.emit("keepaliveSucceeded",s)}),this.emit("keepaliveEstablished"),this.fireKeepAlive(e)}).catch(e=>this.handleKeepaliveError(e))}fireKeepAlive(e){return this.emit("keepaliveFired"),this.grant().then(t=>e.write({ID:t})).catch(()=>this.close())}handleKeepaliveError(e){this.innerState!==vr.Revoked&&(this.emit("keepaliveFailed",(0,mr.castGrpcError)(e)),this.teardown(),e instanceof mr.EtcdLeaseInvalidError?this.emitLoss(e):setTimeout(()=>this.keepalive(),100))}};ln.Lease=cf});var hf=w(ul=>{"use strict";Object.defineProperty(ul,"__esModule",{value:!0});ul.Lock=void 0;var _0=on(),EO=nr(),CO=cl(),wO=$r(),uf=class{constructor(e,t,i){this.pool=e,this.namespace=t,this.key=i,this.leaseTTL=30}ttl(e){if(this.lease)throw new Error("Cannot set a lock TTL after acquiring the lock");return this.leaseTTL=e,this}options(e){return this.callOptions=e,this}acquire(){let e=this.lease=new CO.Lease(this.pool,this.namespace,this.leaseTTL),t=new wO.KVClient(this.pool);return e.grant().then(i=>new _0.ComparatorBuilder(t,this.namespace).and(this.key,"Create","==",0).then(new _0.PutBuilder(t,this.namespace,this.key).value("").lease(i)).options(this.callOptions).commit().then(n=>n.succeeded?this:this.release().catch(()=>{}).then(()=>{throw new EO.EtcdLockFailedError(`Failed to acquire a lock on ${this.key}`)})))}leaseId(){return this.lease?this.lease.grant():Promise.resolve(null)}release(){if(!this.lease)throw new Error("Attempted to release a lock which was not acquired");return this.lease.revoke(this.callOptions)}do(e){return this.acquire().then(e).then(t=>this.release().then(()=>t)).catch(t=>this.release().then(()=>{throw t}))}};ul.Lock=uf});var _f=w(fl=>{"use strict";Object.defineProperty(fl,"__esModule",{value:!0});fl.SoftwareTransaction=void 0;var df=sl(),hl=on(),cn=nr(),TO=Kr(),yf=wt();function ff(r,e){return r=(0,yf.toBuffer)(r),e?{kvs:[{key:Buffer.from(r),value:e}],more:!1,count:"1"}:{kvs:[],more:!1,count:"0"}}var pf=class{constructor(){this.reads=Object.create(null),this.completedReads=[],this.earliestMod=new df.default(1/0)}earliestModRevision(){return this.earliestMod}addCurrentChecks(e){this.completedReads.forEach(({key:t,res:i})=>{i.kvs.length?e.and(t,"Mod","==",i.kvs[0].mod_revision):e.and(t,"Mod","==",0)})}runRequest(e,t){let i=t.key.toString(),n=this.reads[i];if(n)return n;let s=e.range(t).then(a=>(this.completedReads.push({key:t.key,res:a}),a.kvs.length>0&&(this.earliestMod=df.default.min(new df.default(a.kvs[0].mod_revision),this.earliestMod)),a));return this.reads[i]=s,s}},gf=class{constructor(){this.ops=[]}addNotChangedChecks(e,t){t!=="Infinity"&&this.ops.forEach(i=>{switch(i.op){case 0:e.and(i.req.key,"Mod","<",t);break;case 1:e.and(i.key,"Mod","<",t);break;case 2:throw new Error("You cannot delete ranges in the SerializableSnapshot isolation level");default:throw new cn.ClientRuntimeError(`Unexpected write op ${JSON.stringify(i)}`)}})}addChanges(e){let t=[];this.ops.forEach(i=>{switch(i.op){case 0:t.push({request_put:i.req});break;case 1:t.push({request_delete_range:i.req});break;case 2:t.push({request_delete_range:i.req});break;default:throw new cn.ClientRuntimeError(`Unexpected write op ${JSON.stringify(i)}`)}}),e.then(...t)}findExistingWrite(e){for(let t=this.ops.length-1;t>=0;t--){let i=this.ops[t];switch(i.op){case 0:if(i.req.key.equals(e))return ff(e,i.req.value);break;case 1:if(i.key.equals(e))return ff(e);break;case 2:if(i.range.includes(e))return ff(e);break;default:throw new cn.ClientRuntimeError(`Unexpected write op ${JSON.stringify(i)}`)}}return null}addPut(e){this.purgeExistingOperationOn(e.key),this.ops.push({op:0,req:e})}addDeletion(e){e.range_end?this.ops.push({req:e,op:2,range:new TO.Range(e.key,e.range_end)}):(this.purgeExistingOperationOn(e.key),this.ops.push({req:e,op:1,key:e.key}))}purgeExistingOperationOn(e){for(let t=0;t<this.ops.length;t++){let{op:i,req:n}=this.ops[t];if((i===0||i===1)&&n.key.equals(e)){this.ops.splice(t,1);break}}}},dl=class{constructor(e){this.options=e,this.writeSet=new gf,this.readSet=new pf}range(e,t){this.assertReadInvariants(t);let i=this.writeSet.findExistingWrite(t.key);return i!==null?Promise.resolve(i):(t.serializable=!0,this.readSet.runRequest(e,t))}put(e){return this.assertNoOption("put",e,["lease","prev_kv"]),this.writeSet.addPut(e),Promise.resolve({})}deleteRange(e){return this.assertNoOption("delete",e,["prev_kv"]),this.writeSet.addDeletion(e),Promise.resolve({header:void 0,deleted:"1",prev_kvs:[]})}assertReadInvariants(e){this.assertNoOption("read",e,["revision","range_end","min_mod_revision","max_mod_revision","min_create_revision","max_create_revision"])}assertNoOption(e,t,i){i.forEach(n=>{if(t[n]!==void 0)throw new Error(`"${String(n)}" is not supported in ${e} requests within STM transactions`)})}},mf=class extends dl{constructor(e,t){super(e),e.prefetch.forEach(i=>{this.range(t,{key:(0,yf.toBuffer)(i)}).catch(()=>{})})}range(e,t){this.assertReadInvariants(t);let i=this.writeSet.findExistingWrite(t.key);return i!==null?Promise.resolve(i):this.firstRead?this.firstRead.then(n=>(t.serializable=!0,t.revision=n.header.revision,this.readSet.runRequest(e,t))):this.firstRead=this.readSet.runRequest(e,t)}},vf=class{constructor(e,t,i){this.options=e,this.namespace=t,this.rawKV=i,this.kv=new Proxy(i,{get:(n,s)=>{switch(s){case"range":return a=>this.tx.range(n,a);case"put":return a=>this.tx.put(a);case"deleteRange":return a=>this.tx.deleteRange(a);default:throw new cn.ClientRuntimeError(`Unexpected kv operation in STM: ${s.toString()}`)}}})}transact(e){return this.transactInner(this.options.retries,e)}get(e){return new hl.SingleRangeBuilder(this.kv,this.namespace,e)}put(e){return new hl.PutBuilder(this.kv,this.namespace,e)}delete(){return new hl.DeleteBuilder(this.kv,this.namespace)}transactInner(e,t){return this.tx=this.options.isolation===1||this.options.isolation===0?new mf(this.options,this.rawKV):new dl(this.options),Promise.resolve(t(this)).then(i=>this.commit().then(()=>i).catch(n=>{if(e===0||!(n instanceof cn.STMConflictError))throw n;return this.transactInner(e-1,t)}))}commit(){let e=new hl.ComparatorBuilder(this.rawKV,yf.NSApplicator.default);switch(this.options.isolation){case 0:let t=this.tx.readSet.earliestModRevision().plus(1).toString();this.tx.writeSet.addNotChangedChecks(e,t),this.tx.readSet.addCurrentChecks(e);break;case 1:this.tx.readSet.addCurrentChecks(e);break;case 2:this.tx.readSet.addCurrentChecks(e);break;case 3:break;default:throw new Error(`Unknown isolation level "${this.options.isolation}"`)}return this.tx.writeSet.addChanges(e),e.options(this.options.callOptions).commit().then(t=>{if(!t.succeeded)throw new cn.STMConflictError})}};fl.SoftwareTransaction=vf});var wf=w(Ft=>{"use strict";Object.defineProperty(Ft,"__esModule",{value:!0});Ft.Watcher=Ft.WatchBuilder=Ft.operationNames=Ft.WatchManager=void 0;var bO=sl(),RO=require("events"),Lt=nr(),S0=Kr(),E0=$r(),un=wt(),Sf=class{constructor(e){this.stream=e,this.state=0,this.queue=[]}attach(e){this.queue=this.queue.concat(e),this.state===0&&this.readQueue()}dequeue(e){this.queue=this.queue.filter(t=>t!==e)}handleCreate(e){let t=this.queue.shift();if(!t)throw new Lt.ClientRuntimeError("Could not find watcher corresponding to create response");t.id=e.watch_id,t.emit("connected",e),this.readQueue()}destroy(){this.setState(0),this.queue=[]}readQueue(){if(this.queue.length===0){this.setState(0);return}let e=this.queue[0];this.setState(2),e.emit("connecting",e.request),this.stream.write({create_request:e.request})}setState(e){this.state=e}},Ef=class{constructor(e,t){this.client=e,this.initialBackoff=t,this.state=0,this.watchers=[],this.expectedClosers=new Set,this.backoff=t.next()}attach(e){switch(this.watchers.push(e),this.state){case 0:this.establishStream();break;case 1:break;case 2:this.queue.attach(e);break;default:throw new Lt.ClientRuntimeError(`Unknown watcher state ${this.state}`)}}detach(e){return this.state!==2?(this.watchers=this.watchers.filter(t=>t!==e),Promise.resolve()):e.id===null?(0,un.onceEvent)(e,"connected","disconnected").then(()=>this.detach(e)):(this.expectedClosers.add(e),this.getStream().write({cancel_request:{watch_id:e.id}}),(0,un.onceEvent)(e,"end").then(async()=>{await(0,un.delay)(0)}))}getStream(){if(this.state!==2)throw new Lt.ClientRuntimeError("Cannot call getStream() if state != Connected");if(!this.stream)throw new Lt.ClientRuntimeError("Expected the watcher stream to exist while state == Connected");return this.stream}establishStream(){if(this.state!==0)throw new Lt.ClientRuntimeError("Cannot call establishStream() if state != Idle");this.watchers.length!==0&&(this.expectedClosers.forEach(e=>{this.watchers=this.watchers.filter(t=>t!==e),e.emit("end")}),this.expectedClosers.clear(),this.state=1,this.client.watch().then(e=>{if(this.state=2,this.queue=new Sf(e),this.stream=e.on("data",t=>t.created?this.handleCreatedResponse(t):this.handleResponse(t)).on("error",t=>this.handleError(t)).on("end",()=>this.handleError(new Lt.EtcdWatchStreamEnded)),this.watchers.length===0)return this.destroyStream();this.queue.attach(this.watchers)}).catch(e=>this.handleError(e)))}destroyStream(){if(this.state!==2)throw new Lt.ClientRuntimeError("Cannot call establishStream() if state != Connected");if(this.watchers.length>0)throw new Lt.ClientRuntimeError("Cannot call destroyStream() with active watchers");this.getStream().cancel(),this.queue.destroy()}handleError(e){var t;this.state===2&&(this.queue.destroy(),this.getStream().cancel()),this.state=0,this.watchers.forEach(i=>{i.emit("disconnected",e),i.id=null}),setTimeout(()=>{this.state===0&&this.establishStream()},this.backoff.duration),this.backoff=(t=this.backoff.next())!==null&&t!==void 0?t:this.backoff}handleCancelResponse(e,t){if(this.watchers=this.watchers.filter(i=>i!==e),this.expectedClosers.has(e)){this.expectedClosers.delete(e),e.emit("end");return}e.emit("error",(0,Lt.castGrpcErrorMessage)(`Watcher canceled: ${t.cancel_reason}`))}handleUpdateResponse(e,t){try{e.emit("data",t)}catch(i){setImmediate(()=>{throw i})}}handleCreatedResponse(e){if(this.backoff=this.initialBackoff.next(),!e.canceled){this.queue.handleCreate(e);return}let t=this.watchers.find(i=>i.id===null);if(!t)throw new Lt.ClientRuntimeError("Got a watch creation error, but found no pending watchers");this.handleCancelResponse(t,e)}handleResponse(e){this.backoff=this.initialBackoff.next();let t=this.watchers.find(i=>i.id===e.watch_id);if(!t)throw new Lt.ClientRuntimeError("Failed to find watcher for IWatchResponse");if(!e.canceled){this.handleUpdateResponse(t,e);return}this.handleCancelResponse(t,e),this.watchers.length===0&&this.destroyStream()}};Ft.WatchManager=Ef;Ft.operationNames={put:E0.FilterType.Nodelete,delete:E0.FilterType.Noput};var Cf=class{constructor(e,t){this.manager=e,this.namespace=t,this.request={progress_notify:!0}}key(e){return this.request.key=(0,un.toBuffer)(e),this}prefix(e){return this.inRange(S0.Range.prefix(e))}inRange(e){let t=S0.Range.from(e);return this.request.key=t.start,this.request.range_end=t.end,this}ignore(...e){return this.only(...e)}only(...e){return this.request.filters=e.map(t=>Ft.operationNames[t]),this}withPreviousKV(){return this.request.prev_kv=!0,this}startRevision(e){return this.request.start_revision=Number(e),this}watcher(){return new pl(this.manager,this.namespace,this.namespace.applyToRequest(this.request))}create(){let e=this.watcher();return Promise.race([(0,un.onceEvent)(e,"connected").then(()=>e),(0,un.onceEvent)(e,"error").then(t=>Promise.reject(t))])}};Ft.WatchBuilder=Cf;var pl=class extends RO.EventEmitter{constructor(e,t,i){super(),this.manager=e,this.namespace=t,this.request=i,this.id=null,this.manager.attach(this),this.on("data",n=>{n.events.forEach(s=>{s.kv.key=this.namespace.unprefix(s.kv.key),s.prev_kv&&(s.prev_kv.key=this.namespace.unprefix(s.prev_kv.key)),this.emit(s.type.toLowerCase(),s.kv,s.prev_kv)}),this.updateRevision(n)}),this.on("connected",n=>this.updateRevision(n))}on(e,t){return super.on(e,t)}lastRevision(){return this.request.start_revision}cancel(){return this.manager.detach(this)}updateRevision(e){this.request.start_revision=new bO.default(e.header.revision).plus(1).toString()}};Ft.Watcher=pl});var Rf=w(gl=>{"use strict";Object.defineProperty(gl,"__esModule",{value:!0});gl.Namespace=void 0;var OO=Yd(),ss=on(),kO=of(),AO=cl(),MO=hf(),PO=Kr(),Tf=$r(),xO=_f(),C0=wt(),w0=wf(),bf=class r{constructor(e,t,i){var n,s;this.prefix=e,this.pool=t,this.options=i,this.kv=new Tf.KVClient(this.pool),this.leaseClient=new Tf.LeaseClient(this.pool),this.watchClient=new Tf.WatchClient(this.pool),this.nsApplicator=new C0.NSApplicator(this.prefix),this.watchManager=new w0.WatchManager(this.watchClient,(s=(n=this.options.faultHandling)===null||n===void 0?void 0:n.watchBackoff)!==null&&s!==void 0?s:new OO.ExponentialBackoff)}get(e){return new ss.SingleRangeBuilder(this.kv,this.nsApplicator,e)}getAll(){return new ss.MultiRangeBuilder(this.kv,this.nsApplicator)}put(e){return new ss.PutBuilder(this.kv,this.nsApplicator,e)}delete(){return new ss.DeleteBuilder(this.kv,this.nsApplicator)}lease(e,t){return new AO.Lease(this.pool,this.nsApplicator,e,t)}lock(e){return new MO.Lock(this.pool,this.nsApplicator,e)}stm(e){return new xO.SoftwareTransaction({isolation:0,prefetch:[],retries:3,...e},this.nsApplicator,this.kv)}if(e,t,i,n){return new ss.ComparatorBuilder(this.kv,this.nsApplicator).and(e,t,i,n)}watch(){return new w0.WatchBuilder(this.watchManager,this.nsApplicator)}range(e){return PO.Range.from(e)}namespace(e){return new r(Buffer.concat([this.prefix,(0,C0.toBuffer)(e)]),this.pool,this.options)}election(e,t){return new kO.Election(this,e,t)}};gl.Namespace=bf});var b0=w(T0=>{"use strict";Object.defineProperty(T0,"__esModule",{value:!0})});var NO=exports&&exports.__createBinding||(Object.create?function(r,e,t,i){i===void 0&&(i=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,i,n)}:function(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}),Bt=exports&&exports.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&NO(e,r,t)};Object.defineProperty(exports,"__esModule",{value:!0});exports.Etcd3=exports.Watcher=exports.WatchBuilder=void 0;var ml=kl(),IO=i0(),DO=Rf(),Of=$r();Bt(kl(),exports);Bt(on(),exports);Bt(nr(),exports);Bt(cl(),exports);Bt(hf(),exports);Bt(Rf(),exports);Bt(b0(),exports);Bt(Kr(),exports);Bt($r(),exports);Bt(_f(),exports);Bt(of(),exports);var R0=wf();Object.defineProperty(exports,"WatchBuilder",{enumerable:!0,get:function(){return R0.WatchBuilder}});Object.defineProperty(exports,"Watcher",{enumerable:!0,get:function(){return R0.Watcher}});var kf=class extends DO.Namespace{constructor(e={hosts:"127.0.0.1:2379"}){super(Buffer.from([]),new IO.ConnectionPool(e),e),this.auth=new Of.AuthClient(this.pool),this.maintenance=new Of.MaintenanceClient(this.pool),this.cluster=new Of.ClusterClient(this.pool)}getRoles(){return this.auth.roleList().then(e=>e.roles.map(t=>new ml.Role(this.auth,t)))}role(e){return new ml.Role(this.auth,e)}getUsers(){return this.auth.userList().then(e=>e.users.map(t=>new ml.User(this.auth,t)))}user(e){return new ml.User(this.auth,e)}mock(e){return this.pool.mock(e),e}unmock(){this.pool.unmock()}close(){this.pool.close()}};exports.Etcd3=kf;
/*! Bundled license information:

@grpc/proto-loader/build/src/util.js:
  (**
   * @license
   * Copyright 2018 gRPC authors.
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *     http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *
   *)

long/umd/index.js:
  (**
   * @license
   * Copyright 2009 The Closure Library Authors
   * Copyright 2020 Daniel Wirtz / The long.js Authors.
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *     http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *
   * SPDX-License-Identifier: Apache-2.0
   *)

@grpc/proto-loader/build/src/index.js:
  (**
   * @license
   * Copyright 2018 gRPC authors.
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *     http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *
   *)
*/
